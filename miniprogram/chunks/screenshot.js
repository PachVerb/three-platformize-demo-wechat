"use strict";var e=require("./three-platformize.js");class t{constructor(e,t){this.parts=e,this.options=t}}for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=new Uint8Array(256),n=0;n<r.length;n++)a[r.charCodeAt(n)]=n;class s{createObjectURL(e){if(e instanceof t){const t=function(e){for(var t,a="",n=new Uint8Array(e),s=n.byteLength,i=s%3,o=s-i,c=0;c<o;c+=3)t=n[c]<<16|n[c+1]<<8|n[c+2],a+=r[(16515072&t)>>18]+r[(258048&t)>>12]+r[(4032&t)>>6]+r[63&t];return 1==i?(t=n[o],a+=r[(252&t)>>2]+r[(3&t)<<4]+"=="):2==i&&(t=n[o]<<8|n[o+1],a+=r[(64512&t)>>10]+r[(1008&t)>>4]+r[(15&t)<<2]+"="),a}(e.parts[0]);return`data:${e.options.type};base64,${t}`}return""}revokeObjectURL(){}}function i(e){if((e=(e=`${e}`).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;let t="",r=0,a=0;for(let n=0;n<e.length;n++)r<<=6,r|=o(e[n]),a+=6,24===a&&(t+=String.fromCharCode((16711680&r)>>16),t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r),r=a=0);return 12===a?(r>>=4,t+=String.fromCharCode(r)):18===a&&(r>>=2,t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r)),t}function o(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e);return t<0?void 0:t}const c=new WeakMap;class l{constructor(e){this.identifier=e.identifier,this.force=void 0===e.force?1:e.force,this.pageX=void 0===e.pageX?e.x:e.pageX,this.pageY=void 0===e.pageY?e.y:e.pageY,this.clientX=void 0===e.clientX?e.x:e.clientX,this.clientY=void 0===e.clientY?e.y:e.clientY,this.screenX=this.pageX,this.screenY=this.pageY}}class u{constructor(){c.set(this,{})}addEventListener(e,t,r={}){let a=c.get(this);a||(a={},c.set(this,a)),a[e]||(a[e]=[]),a[e].push(t),r.capture,r.once,r.passive}removeEventListener(e,t){const r=c.get(this);if(r){const a=r[e];if(a&&a.length>0)for(let e=a.length;e--;e>0)if(a[e]===t){a.splice(e,1);break}}}dispatchEvent(e={}){"function"!=typeof e.preventDefault&&(e.preventDefault=()=>{}),"function"!=typeof e.stopPropagation&&(e.stopPropagation=()=>{});const t=c.get(this);if(t){const r=t[e.type];if(r)for(let t=0;t<r.length;t++)r[t](e)}}}const h=new WeakMap,p=new WeakMap,f=new WeakMap;function d(e,t={}){t.target=t.target||this,"function"==typeof this[`on${e}`]&&this[`on${e}`].call(this,t)}function g(e,t={}){this.readyState=e,t.readyState=e,d.call(this,"readystatechange",t)}const{platform:v}=wx.getSystemInfoSync();class m extends u{constructor(){super(),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="text",this.dataType="string",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,h.set(this,{"content-type":"application/x-www-form-urlencoded"}),p.set(this,{})}abort(){const e=f.get(this);e&&e.abort()}getAllResponseHeaders(){const e=p.get(this);return Object.keys(e).map((t=>`${t}: ${e[t]}`)).join("\n")}getResponseHeader(e){return p.get(this)[e]}open(e,t){this._method=e,this._url=t,g.call(this,m.OPENED)}overrideMimeType(){}send(e=""){if(this.readyState!==m.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");{const r=this._url,a=h.get(this),n=this.responseType,s=this.dataType,i=function(e){return!/^(http|https|ftp|wxfile):\/\/.*/i.test(e)}(r);let o;"arraybuffer"===n||(o="utf8"),delete this.response,this.response=null;let c=!1;const l=({data:e,statusCode:t,header:r})=>{if(!c){if(c=!0,t=void 0===t?200:t,"string"!=typeof e&&!(e instanceof ArrayBuffer))try{e=JSON.stringify(e)}catch(e){}this.status=t,r&&p.set(this,r),d.call(this,"loadstart"),g.call(this,m.HEADERS_RECEIVED),g.call(this,m.LOADING),this.response=e,e instanceof ArrayBuffer?Object.defineProperty(this,"responseText",{enumerable:!0,configurable:!0,get:function(){throw"InvalidStateError : responseType is "+this.responseType}}):this.responseText=e,g.call(this,m.DONE),d.call(this,"load"),d.call(this,"loadend")}},u=({errMsg:e})=>{c||(c=!0,-1!==e.indexOf("abort")?d.call(this,"abort"):d.call(this,"error",{message:e}),d.call(this,"loadend"),i&&console.warn(e))};if(i){const e=wx.getFileSystemManager();var t={filePath:r,success:l,fail:u};return o&&(t.encoding=o),void e.readFile(t)}const f="arraybuffer"===n&&"ios"===v&&m.useFetchPatch;wx.request({data:e,url:r,method:this._method,header:a,dataType:s,responseType:n,enableCache:!1,success:l,fail:u}),f&&setTimeout((function(){wx.request({data:e,url:r,method:this._method,header:a,dataType:s,responseType:n,enableCache:!0,success:l,fail:u})}),m.fetchPatchDelay)}}setRequestHeader(e,t){const r=h.get(this);r[e]=t,h.set(this,r)}addEventListener(e,t){"function"==typeof t&&(this["on"+e]=(e={})=>{e.target=e.target||this,t.call(this,e)})}removeEventListener(e,t){this["on"+e]===t&&(this["on"+e]=null)}}function y(e){return e=(e=e.trim()).replace(/<!--[\s\S]*?-->/g,""),{declaration:t(),root:r()};function t(){if(!n(/^<\?xml\s*/))return;const e={attributes:{}};for(;!s()&&!i("?>");){const t=a();if(!t)return e;e.attributes[t.name]=t.value}return n(/\?>\s*/),n(/<!DOCTYPE[^>]*>\s/),e}function r(){const e=n(/^<([\w-:.]+)\s*/);if(!e)return;const t={name:e[1],attributes:{},children:[]};for(;!(s()||i(">")||i("?>")||i("/>"));){const e=a();if(!e)return t;t.attributes[e.name]=e.value}if(n(/^\s*\/>\s*/))return t;let o;for(n(/\??>\s*/),t.content=function(){const e=n(/^([^<]*)/);return e?e[1]:""}();o=r();)t.children.push(o);return n(/^<\/[\w-:.]+>\s*/),t}function a(){const e=n(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);var t;if(e)return{name:e[1],value:(t=e[2],t.replace(/^['"]|['"]$/g,""))}}function n(t){const r=e.match(t);if(r)return e=e.slice(r[0].length),r}function s(){return 0==e.length}function i(t){return 0==e.indexOf(t)}}function b(e,t){t(e),e.children.forEach((e=>b(e,t)))}m.UNSEND=0,m.OPENED=1,m.HEADERS_RECEIVED=2,m.LOADING=3,m.DONE=4,m.useFetchPatch=!1,m.fetchPatchDelay=200;class x{parseFromString(e){const t=y(e),r={hasAttribute(e){return void 0!==this.attributes[e]},getAttribute(e){return this.attributes[e]},getElementsByTagName(e){const t=[];return this.childNodes.forEach((r=>b(r,(r=>e===r.name&&t.push(r))))),t}};b(t.root,(e=>{e.nodeType=1,e.nodeName=e.name,e.style=new Proxy((e.attributes.style||"").split(";").reduce(((e,t)=>{if(t){let[r,a]=t.split(":");e[r.trim()]=a.trim()}return e}),{}),{get:(e,t)=>e[t]||""}),e.textContent=e.content,e.childNodes=e.children,e.__proto__=r}));const a={documentElement:t.root,childNodes:[t.root]};return a.__proto__=r,a}}class w{decode(e){let t="";for(let r=0,a=e.length;r<a;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}}function S(){return wx.createOffscreenCanvas()}var T=function(){function t(t){e.Loader.call(this,t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new i(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new o(e)})),this.register((function(e){return new n(e)})),this.register((function(e){return new u(e)}))}function r(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}t.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:t,load:function(t,r,a,n){var s,i=this;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:e.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);var o=function(e){n?n(e):console.error(e),i.manager.itemError(t),i.manager.itemEnd(t)},c=new e.FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,(function(e){try{i.parse(e,s,(function(e){r(e),i.manager.itemEnd(t)}),o)}catch(e){o(e)}}),a,o)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(t,r,n,i){var o,c={},l={};if("string"==typeof t)o=t;else if(e.LoaderUtils.decodeText(new Uint8Array(t,0,4))===h){try{c[a.KHR_BINARY_GLTF]=new d(t)}catch(e){return void(i&&i(e))}o=c[a.KHR_BINARY_GLTF].content}else o=e.LoaderUtils.decodeText(new Uint8Array(t));var u=JSON.parse(o);if(void 0===u.asset||u.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var p=new z(u,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});p.fileLoader.setRequestHeader(this.requestHeader);for(var f=0;f<this.pluginCallbacks.length;f++){var m=this.pluginCallbacks[f](p);l[m.name]=m,c[m.name]=!0}if(u.extensionsUsed)for(f=0;f<u.extensionsUsed.length;++f){var x=u.extensionsUsed[f],w=u.extensionsRequired||[];switch(x){case a.KHR_MATERIALS_UNLIT:c[x]=new s;break;case a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:c[x]=new y;break;case a.KHR_DRACO_MESH_COMPRESSION:c[x]=new g(u,this.dracoLoader);break;case a.KHR_TEXTURE_TRANSFORM:c[x]=new v;break;case a.KHR_MESH_QUANTIZATION:c[x]=new b;break;default:w.indexOf(x)>=0&&void 0===l[x]&&console.warn('THREE.GLTFLoader: Unknown extension "'+x+'".')}}p.setExtensions(c),p.setPlugins(l),p.parse(n,i)}}});var a={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};function n(e){this.parser=e,this.name=a.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function s(){this.name=a.KHR_MATERIALS_UNLIT}function i(e){this.parser=e,this.name=a.KHR_MATERIALS_CLEARCOAT}function o(e){this.parser=e,this.name=a.KHR_MATERIALS_TRANSMISSION}function c(e){this.parser=e,this.name=a.KHR_TEXTURE_BASISU}function l(e){this.parser=e,this.name=a.EXT_TEXTURE_WEBP,this.isSupported=null}function u(e){this.name=a.EXT_MESHOPT_COMPRESSION,this.parser=e}n.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],r=0,a=t.length;r<a;r++){var n=t[r];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}},n.prototype._loadLight=function(t){var r=this.parser,a="light:"+t,n=r.cache.get(a);if(n)return n;var s,i=r.json,o=((i.extensions&&i.extensions[this.name]||{}).lights||[])[t],c=new e.Color(16777215);void 0!==o.color&&c.fromArray(o.color);var l=void 0!==o.range?o.range:0;switch(o.type){case"directional":(s=new e.DirectionalLight(c)).target.position.set(0,0,-1),s.add(s.target);break;case"point":(s=new e.PointLight(c)).distance=l;break;case"spot":(s=new e.SpotLight(c)).distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,s.angle=o.spot.outerConeAngle,s.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return s.position.set(0,0,0),s.decay=2,void 0!==o.intensity&&(s.intensity=o.intensity),s.name=r.createUniqueName(o.name||"light_"+t),n=Promise.resolve(s),r.cache.add(a,n),n},n.prototype.createNodeAttachment=function(e){var t=this,r=this.parser,a=r.json.nodes[e],n=(a.extensions&&a.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then((function(e){return r._getNodeRef(t.cache,n,e)}))},s.prototype.getMaterialType=function(){return e.MeshBasicMaterial},s.prototype.extendParams=function(t,r,a){var n=[];t.color=new e.Color(1,1,1),t.opacity=1;var s=r.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){var i=s.baseColorFactor;t.color.fromArray(i),t.opacity=i[3]}void 0!==s.baseColorTexture&&n.push(a.assignTexture(t,"map",s.baseColorTexture))}return Promise.all(n)},i.prototype.getMaterialType=function(t){var r=this.parser.json.materials[t];return r.extensions&&r.extensions[this.name]?e.MeshPhysicalMaterial:null},i.prototype.extendMaterialParams=function(t,r){var a=this.parser,n=a.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var s=[],i=n.extensions[this.name];if(void 0!==i.clearcoatFactor&&(r.clearcoat=i.clearcoatFactor),void 0!==i.clearcoatTexture&&s.push(a.assignTexture(r,"clearcoatMap",i.clearcoatTexture)),void 0!==i.clearcoatRoughnessFactor&&(r.clearcoatRoughness=i.clearcoatRoughnessFactor),void 0!==i.clearcoatRoughnessTexture&&s.push(a.assignTexture(r,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),void 0!==i.clearcoatNormalTexture&&(s.push(a.assignTexture(r,"clearcoatNormalMap",i.clearcoatNormalTexture)),void 0!==i.clearcoatNormalTexture.scale)){var o=i.clearcoatNormalTexture.scale;r.clearcoatNormalScale=new e.Vector2(o,-o)}return Promise.all(s)},o.prototype.getMaterialType=function(t){var r=this.parser.json.materials[t];return r.extensions&&r.extensions[this.name]?e.MeshPhysicalMaterial:null},o.prototype.extendMaterialParams=function(e,t){var r=this.parser,a=r.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();var n=[],s=a.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&n.push(r.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(n)},c.prototype.loadTexture=function(e){var t=this.parser,r=t.json,a=r.textures[e];if(!a.extensions||!a.extensions[this.name])return null;var n=a.extensions[this.name],s=r.images[n.source],i=t.options.ktx2Loader;if(!i){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s,i)},l.prototype.loadTexture=function(e){var t=this.name,r=this.parser,a=r.json,n=a.textures[e];if(!n.extensions||!n.extensions[t])return null;var s=n.extensions[t],i=a.images[s.source],o=r.textureLoader;if(i.uri){var c=r.options.manager.getHandler(i.uri);null!==c&&(o=c)}return this.detectSupport().then((function(n){if(n)return r.loadTextureImage(e,i,o);if(a.extensionsRequired&&a.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)}))},l.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},u.prototype.loadBufferView=function(e){var t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){var a=r.extensions[this.name],n=this.parser.getDependency("buffer",a.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,s.ready]).then((function(e){var t=a.byteOffset||0,r=a.byteLength||0,n=a.count,i=a.byteStride,o=new ArrayBuffer(n*i),c=new Uint8Array(e[0],t,r);return s.decodeGltfBuffer(new Uint8Array(o),n,i,c,a.mode,a.filter),o}))}return null};var h="glTF",p=1313821514,f=5130562;function d(t){this.name=a.KHR_BINARY_GLTF,this.content=null,this.body=null;var r=new DataView(t,0,12);if(this.header={magic:e.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=this.header.length-12,s=new DataView(t,12),i=0;i<n;){var o=s.getUint32(i,!0);i+=4;var c=s.getUint32(i,!0);if(i+=4,c===p){var l=new Uint8Array(t,12+i,o);this.content=e.LoaderUtils.decodeText(l)}else if(c===f){var u=12+i;this.body=t.slice(u,u+o)}i+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function g(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=a.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function v(){this.name=a.KHR_TEXTURE_TRANSFORM}function m(t){e.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var r=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),a=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),i=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new e.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(var t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",r).replace("#include <metalnessmap_pars_fragment>",a).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",i)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function y(){return{name:a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return m},extendParams:function(t,r,a){var n=r.extensions[this.name];t.color=new e.Color(1,1,1),t.opacity=1;var s=[];if(Array.isArray(n.diffuseFactor)){var i=n.diffuseFactor;t.color.fromArray(i),t.opacity=i[3]}if(void 0!==n.diffuseTexture&&s.push(a.assignTexture(t,"map",n.diffuseTexture)),t.emissive=new e.Color(0,0,0),t.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,t.specular=new e.Color(1,1,1),Array.isArray(n.specularFactor)&&t.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var o=n.specularGlossinessTexture;s.push(a.assignTexture(t,"glossinessMap",o)),s.push(a.assignTexture(t,"specularMap",o))}return Promise.all(s)},createMaterial:function(t){var r=new m(t);return r.fog=!0,r.color=t.color,r.map=void 0===t.map?null:t.map,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=void 0===t.aoMap?null:t.aoMap,r.aoMapIntensity=1,r.emissive=t.emissive,r.emissiveIntensity=1,r.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,r.bumpMap=void 0===t.bumpMap?null:t.bumpMap,r.bumpScale=1,r.normalMap=void 0===t.normalMap?null:t.normalMap,r.normalMapType=e.TangentSpaceNormalMap,t.normalScale&&(r.normalScale=t.normalScale),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=void 0===t.specularMap?null:t.specularMap,r.specular=t.specular,r.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,r.glossiness=t.glossiness,r.alphaMap=null,r.envMap=void 0===t.envMap?null:t.envMap,r.envMapIntensity=1,r.refractionRatio=.98,r}}}function b(){this.name=a.KHR_MESH_QUANTIZATION}function x(t,r,a,n){e.Interpolant.call(this,t,r,a,n)}g.prototype.decodePrimitive=function(e,t){var r=this.json,a=this.dracoLoader,n=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes,i={},o={},c={};for(var l in s){var u=O[l]||l.toLowerCase();i[u]=s[l]}for(l in e.attributes){u=O[l]||l.toLowerCase();if(void 0!==s[l]){var h=r.accessors[e.attributes[l]],p=I[h.componentType];c[u]=p,o[u]=!0===h.normalized}}return t.getDependency("bufferView",n).then((function(e){return new Promise((function(t){a.decodeDracoFile(e,(function(e){for(var r in e.attributes){var a=e.attributes[r],n=o[r];void 0!==n&&(a.normalized=n)}t(e)}),i,c)}))}))},v.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},m.prototype=Object.create(e.MeshStandardMaterial.prototype),m.prototype.constructor=m,m.prototype.copy=function(t){return e.MeshStandardMaterial.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},x.prototype=Object.create(e.Interpolant.prototype),x.prototype.constructor=x,x.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,r=this.sampleValues,a=this.valueSize,n=e*a*3+a,s=0;s!==a;s++)t[s]=r[n+s];return t},x.prototype.beforeStart_=x.prototype.copySampleValue_,x.prototype.afterEnd_=x.prototype.copySampleValue_,x.prototype.interpolate_=function(e,t,r,a){for(var n=this.resultBuffer,s=this.sampleValues,i=this.valueSize,o=2*i,c=3*i,l=a-t,u=(r-t)/l,h=u*u,p=h*u,f=e*c,d=f-c,g=-2*p+3*h,v=p-h,m=1-g,y=v-h+u,b=0;b!==i;b++){var x=s[d+b+i],w=s[d+b+o]*l,S=s[f+b+i],T=s[f+b]*l;n[b]=m*x+y*w+g*S+v*T}return n};var w=0,S=1,T=2,F=3,k=4,E=5,A=6,I={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},M={9728:e.NearestFilter,9729:e.LinearFilter,9984:e.NearestMipmapNearestFilter,9985:e.LinearMipmapNearestFilter,9986:e.NearestMipmapLinearFilter,9987:e.LinearMipmapLinearFilter},L={33071:e.ClampToEdgeWrapping,33648:e.MirroredRepeatWrapping,10497:e.RepeatWrapping},C={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},O={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},R={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},U={CUBICSPLINE:void 0,LINEAR:e.InterpolateLinear,STEP:e.InterpolateDiscrete},N="OPAQUE",D="MASK",P="BLEND";function B(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function G(e,t,r){for(var a in r.extensions)void 0===e[a]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[a]=r.extensions[a])}function _(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function H(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var r=0,a=t.weights.length;r<a;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){var n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(r=0,a=n.length;r<a;r++)e.morphTargetDictionary[n[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function V(e){for(var t="",r=Object.keys(e).sort(),a=0,n=r.length;a<n;a++)t+=r[a]+":"+e[r[a]]+";";return t}function z(t,a){this.json=t||{},this.extensions={},this.plugins={},this.options=a||{},this.cache=new r,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},void 0!==e.$createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new e.ImageBitmapLoader(this.options.manager):this.textureLoader=new e.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new e.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function j(t,r,a){var n=r.attributes,s=[];function i(e,r){return a.getDependency("accessor",e).then((function(e){t.setAttribute(r,e)}))}for(var o in n){var c=O[o]||o.toLowerCase();c in t.attributes||s.push(i(n[o],c))}if(void 0!==r.indices&&!t.index){var l=a.getDependency("accessor",r.indices).then((function(e){t.setIndex(e)}));s.push(l)}return _(t,r),function(t,r,a){var n=r.attributes,s=new e.Box3;if(void 0!==n.POSITION){var i=(f=a.json.accessors[n.POSITION]).min,o=f.max;if(void 0!==i&&void 0!==o){s.set(new e.Vector3(i[0],i[1],i[2]),new e.Vector3(o[0],o[1],o[2]));var c=r.targets;if(void 0!==c){for(var l=new e.Vector3,u=new e.Vector3,h=0,p=c.length;h<p;h++){var f,d=c[h];if(void 0!==d.POSITION)i=(f=a.json.accessors[d.POSITION]).min,o=f.max,void 0!==i&&void 0!==o?(u.setX(Math.max(Math.abs(i[0]),Math.abs(o[0]))),u.setY(Math.max(Math.abs(i[1]),Math.abs(o[1]))),u.setZ(Math.max(Math.abs(i[2]),Math.abs(o[2]))),l.max(u)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}s.expandByVector(l)}t.boundingBox=s;var g=new e.Sphere;s.getCenter(g.center),g.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=g}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(t,r,a),Promise.all(s).then((function(){return void 0!==r.targets?function(e,t,r){for(var a=!1,n=!1,s=0,i=t.length;s<i&&(void 0!==(l=t[s]).POSITION&&(a=!0),void 0!==l.NORMAL&&(n=!0),!a||!n);s++);if(!a&&!n)return Promise.resolve(e);var o=[],c=[];for(s=0,i=t.length;s<i;s++){var l=t[s];if(a){var u=void 0!==l.POSITION?r.getDependency("accessor",l.POSITION):e.attributes.position;o.push(u)}n&&(u=void 0!==l.NORMAL?r.getDependency("accessor",l.NORMAL):e.attributes.normal,c.push(u))}return Promise.all([Promise.all(o),Promise.all(c)]).then((function(t){var r=t[0],s=t[1];return a&&(e.morphAttributes.position=r),n&&(e.morphAttributes.normal=s),e.morphTargetsRelative=!0,e}))}(t,r.targets,a):t}))}function W(t,r){var a=t.getIndex();if(null===a){var n=[],s=t.getAttribute("position");if(void 0===s)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var i=0;i<s.count;i++)n.push(i);t.setIndex(n),a=t.getIndex()}var o=a.count-2,c=[];if(r===e.TriangleFanDrawMode)for(i=1;i<=o;i++)c.push(a.getX(0)),c.push(a.getX(i)),c.push(a.getX(i+1));else for(i=0;i<o;i++)i%2==0?(c.push(a.getX(i)),c.push(a.getX(i+1)),c.push(a.getX(i+2))):(c.push(a.getX(i+2)),c.push(a.getX(i+1)),c.push(a.getX(i)));c.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=t.clone();return l.setIndex(c),l}return z.prototype.setExtensions=function(e){this.extensions=e},z.prototype.setPlugins=function(e){this.plugins=e},z.prototype.parse=function(e,t){var r=this,a=this.json,n=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])})).then((function(t){var s={scene:t[0][a.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:a.asset,parser:r,userData:{}};G(n,s,a),_(s,a),Promise.all(r._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){e(s)}))})).catch(t)},z.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[],a=0,n=t.length;a<n;a++)for(var s=t[a].joints,i=0,o=s.length;i<o;i++)e[s[i]].isBone=!0;for(var c=0,l=e.length;c<l;c++){var u=e[c];void 0!==u.mesh&&(this._addNodeRef(this.meshCache,u.mesh),void 0!==u.skin&&(r[u.mesh].isSkinnedMesh=!0)),void 0!==u.camera&&this._addNodeRef(this.cameraCache,u.camera)}},z.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},z.prototype._getNodeRef=function(e,t,r){if(e.refs[t]<=1)return r;var a=r.clone();return a.name+="_instance_"+e.uses[t]++,a},z.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var r=0;r<t.length;r++){var a=e(t[r]);if(a)return a}},z.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var r=[],a=0;a<t.length;a++){var n=e(t[a]);n&&r.push(n)}return r},z.prototype.getDependency=function(e,t){var r=e+":"+t,a=this.cache.get(r);if(!a){switch(e){case"scene":a=this.loadScene(t);break;case"node":a=this.loadNode(t);break;case"mesh":a=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":a=this.loadAccessor(t);break;case"bufferView":a=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":a=this.loadBuffer(t);break;case"material":a=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":a=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":a=this.loadSkin(t);break;case"animation":a=this.loadAnimation(t);break;case"camera":a=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,a)}return a},z.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var r=this,a=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(a.map((function(t,a){return r.getDependency(e,a)}))),this.cache.add(e,t)}return t},z.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[a.KHR_BINARY_GLTF].body);var n=this.options;return new Promise((function(e,a){r.load(B(t.uri,n.path),e,void 0,(function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},z.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var r=t.byteLength||0,a=t.byteOffset||0;return e.slice(a,a+r)}))},z.prototype.loadAccessor=function(t){var r=this,a=this.json,n=this.json.accessors[t];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var s=[];return void 0!==n.bufferView?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),void 0!==n.sparse&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then((function(t){var s,i,o=t[0],c=C[n.type],l=I[n.componentType],u=l.BYTES_PER_ELEMENT,h=u*c,p=n.byteOffset||0,f=void 0!==n.bufferView?a.bufferViews[n.bufferView].byteStride:void 0,d=!0===n.normalized;if(f&&f!==h){var g=Math.floor(p/f),v="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+g+":"+n.count,m=r.cache.get(v);m||(s=new l(o,g*f,n.count*f/u),m=new e.InterleavedBuffer(s,f/u),r.cache.add(v,m)),i=new e.InterleavedBufferAttribute(m,c,p%f/u,d)}else s=null===o?new l(n.count*c):new l(o,p,n.count*c),i=new e.BufferAttribute(s,c,d);if(void 0!==n.sparse){var y=C.SCALAR,b=I[n.sparse.indices.componentType],x=n.sparse.indices.byteOffset||0,w=n.sparse.values.byteOffset||0,S=new b(t[1],x,n.sparse.count*y),T=new l(t[2],w,n.sparse.count*c);null!==o&&(i=new e.BufferAttribute(i.array.slice(),i.itemSize,i.normalized));for(var F=0,k=S.length;F<k;F++){var E=S[F];if(i.setX(E,T[F*c]),c>=2&&i.setY(E,T[F*c+1]),c>=3&&i.setZ(E,T[F*c+2]),c>=4&&i.setW(E,T[F*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i}))},z.prototype.loadTexture=function(e){var t=this.json,r=this.options,a=t.textures[e],n=t.images[a.source],s=this.textureLoader;if(n.uri){var i=r.manager.getHandler(n.uri);null!==i&&(s=i)}return this.loadTextureImage(e,n,s)},z.prototype.loadTextureImage=function(t,r,a){var n=this,s=this.json,i=this.options,o=s.textures[t],c=e.$URL||self.webkitURL,l=r.uri,u=!1,h=!0;if("image/jpeg"===r.mimeType&&(h=!1),void 0!==r.bufferView)l=n.getDependency("bufferView",r.bufferView).then((function(t){if("image/png"===r.mimeType){var a=new DataView(t,25,1).getUint8(0,!1);h=6===a||4===a||3===a}u=!0;var n=new e.$Blob([t],{type:r.mimeType});return l=c.createObjectURL(n)}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");return Promise.resolve(l).then((function(t){return new Promise((function(r,n){var s=r;!0===a.isImageBitmapLoader&&(s=function(t){r(new e.CanvasTexture(t))}),a.load(B(t,i.path),s,void 0,n)}))})).then((function(r){!0===u&&c.revokeObjectURL(l),r.flipY=!1,o.name&&(r.name=o.name),h||(r.format=e.RGBFormat);var a=(s.samplers||{})[o.sampler]||{};return r.magFilter=M[a.magFilter]||e.LinearFilter,r.minFilter=M[a.minFilter]||e.LinearMipmapLinearFilter,r.wrapS=L[a.wrapS]||e.RepeatWrapping,r.wrapT=L[a.wrapT]||e.RepeatWrapping,n.associations.set(r,{type:"textures",index:t}),r}))},z.prototype.assignTexture=function(e,t,r){var n=this;return this.getDependency("texture",r.index).then((function(s){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),n.extensions[a.KHR_TEXTURE_TRANSFORM]){var i=void 0!==r.extensions?r.extensions[a.KHR_TEXTURE_TRANSFORM]:void 0;if(i){var o=n.associations.get(s);s=n.extensions[a.KHR_TEXTURE_TRANSFORM].extendTexture(s,i),n.associations.set(s,o)}}e[t]=s}))},z.prototype.assignFinalMaterial=function(t){var r=t.geometry,a=t.material,n=void 0!==r.attributes.tangent,s=void 0!==r.attributes.color,i=void 0===r.attributes.normal,o=!0===t.isSkinnedMesh,c=Object.keys(r.morphAttributes).length>0,l=c&&void 0!==r.morphAttributes.normal;if(t.isPoints){var u="PointsMaterial:"+a.uuid,h=this.cache.get(u);h||(h=new e.PointsMaterial,e.Material.prototype.copy.call(h,a),h.color.copy(a.color),h.map=a.map,h.sizeAttenuation=!1,this.cache.add(u,h)),a=h}else if(t.isLine){u="LineBasicMaterial:"+a.uuid;var p=this.cache.get(u);p||(p=new e.LineBasicMaterial,e.Material.prototype.copy.call(p,a),p.color.copy(a.color),this.cache.add(u,p)),a=p}if(n||s||i||o||c){u="ClonedMaterial:"+a.uuid+":";a.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),o&&(u+="skinning:"),n&&(u+="vertex-tangents:"),s&&(u+="vertex-colors:"),i&&(u+="flat-shading:"),c&&(u+="morph-targets:"),l&&(u+="morph-normals:");var f=this.cache.get(u);f||(f=a.clone(),o&&(f.skinning=!0),s&&(f.vertexColors=!0),i&&(f.flatShading=!0),c&&(f.morphTargets=!0),l&&(f.morphNormals=!0),n&&(f.vertexTangents=!0,f.normalScale&&(f.normalScale.y*=-1),f.clearcoatNormalScale&&(f.clearcoatNormalScale.y*=-1)),this.cache.add(u,f),this.associations.set(f,this.associations.get(a))),a=f}a.aoMap&&void 0===r.attributes.uv2&&void 0!==r.attributes.uv&&r.setAttribute("uv2",r.attributes.uv),t.material=a},z.prototype.getMaterialType=function(){return e.MeshStandardMaterial},z.prototype.loadMaterial=function(t){var r,n=this,s=this.json,i=this.extensions,o=s.materials[t],c={},l=o.extensions||{},u=[];if(l[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=i[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=h.getMaterialType(),u.push(h.extendParams(c,o,n))}else if(l[a.KHR_MATERIALS_UNLIT]){var p=i[a.KHR_MATERIALS_UNLIT];r=p.getMaterialType(),u.push(p.extendParams(c,o,n))}else{var f=o.pbrMetallicRoughness||{};if(c.color=new e.Color(1,1,1),c.opacity=1,Array.isArray(f.baseColorFactor)){var d=f.baseColorFactor;c.color.fromArray(d),c.opacity=d[3]}void 0!==f.baseColorTexture&&u.push(n.assignTexture(c,"map",f.baseColorTexture)),c.metalness=void 0!==f.metallicFactor?f.metallicFactor:1,c.roughness=void 0!==f.roughnessFactor?f.roughnessFactor:1,void 0!==f.metallicRoughnessTexture&&(u.push(n.assignTexture(c,"metalnessMap",f.metallicRoughnessTexture)),u.push(n.assignTexture(c,"roughnessMap",f.metallicRoughnessTexture))),r=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),u.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,c)}))))}!0===o.doubleSided&&(c.side=e.DoubleSide);var g=o.alphaMode||N;return g===P?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,g===D&&(c.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&r!==e.MeshBasicMaterial&&(u.push(n.assignTexture(c,"normalMap",o.normalTexture)),c.normalScale=new e.Vector2(1,-1),void 0!==o.normalTexture.scale&&c.normalScale.set(o.normalTexture.scale,-o.normalTexture.scale)),void 0!==o.occlusionTexture&&r!==e.MeshBasicMaterial&&(u.push(n.assignTexture(c,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(c.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&r!==e.MeshBasicMaterial&&(c.emissive=(new e.Color).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&r!==e.MeshBasicMaterial&&u.push(n.assignTexture(c,"emissiveMap",o.emissiveTexture)),Promise.all(u).then((function(){var s;return s=r===m?i[a.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):new r(c),o.name&&(s.name=o.name),s.map&&(s.map.encoding=e.sRGBEncoding),s.emissiveMap&&(s.emissiveMap.encoding=e.sRGBEncoding),_(s,o),n.associations.set(s,{type:"materials",index:t}),o.extensions&&G(i,s,o),s}))},z.prototype.createUniqueName=function(t){for(var r=e.PropertyBinding.sanitizeNodeName(t||""),a=r,n=1;this.nodeNamesUsed[a];++n)a=r+"_"+n;return this.nodeNamesUsed[a]=!0,a},z.prototype.loadGeometries=function(t){var r=this,n=this.extensions,s=this.primitiveCache;function i(e){return n[a.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,r).then((function(t){return j(t,e,r)}))}for(var o,c,l=[],u=0,h=t.length;u<h;u++){var p,f=t[u],d=(c=void 0,(c=(o=f).extensions&&o.extensions[a.KHR_DRACO_MESH_COMPRESSION])?"draco:"+c.bufferView+":"+c.indices+":"+V(c.attributes):o.indices+":"+V(o.attributes)+":"+o.mode),g=s[d];if(g)l.push(g.promise);else p=f.extensions&&f.extensions[a.KHR_DRACO_MESH_COMPRESSION]?i(f):j(new e.BufferGeometry,f,r),s[d]={primitive:f,promise:p},l.push(p)}return Promise.all(l)},z.prototype.loadMesh=function(t){for(var r,a=this,n=this.json,s=this.extensions,i=n.meshes[t],o=i.primitives,c=[],l=0,u=o.length;l<u;l++){var h=void 0===o[l].material?(void 0===(r=this.cache).DefaultMaterial&&(r.DefaultMaterial=new e.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:e.FrontSide})),r.DefaultMaterial):this.getDependency("material",o[l].material);c.push(h)}return c.push(a.loadGeometries(o)),Promise.all(c).then((function(r){for(var n=r.slice(0,r.length-1),c=r[r.length-1],l=[],u=0,h=c.length;u<h;u++){var p,f=c[u],d=o[u],g=n[u];if(d.mode===k||d.mode===E||d.mode===A||void 0===d.mode)!0!==(p=!0===i.isSkinnedMesh?new e.SkinnedMesh(f,g):new e.Mesh(f,g)).isSkinnedMesh||p.geometry.attributes.skinWeight.normalized||p.normalizeSkinWeights(),d.mode===E?p.geometry=W(p.geometry,e.TriangleStripDrawMode):d.mode===A&&(p.geometry=W(p.geometry,e.TriangleFanDrawMode));else if(d.mode===S)p=new e.LineSegments(f,g);else if(d.mode===F)p=new e.Line(f,g);else if(d.mode===T)p=new e.LineLoop(f,g);else{if(d.mode!==w)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);p=new e.Points(f,g)}Object.keys(p.geometry.morphAttributes).length>0&&H(p,i),p.name=a.createUniqueName(i.name||"mesh_"+t),_(p,i),d.extensions&&G(s,p,d),a.assignFinalMaterial(p),l.push(p)}if(1===l.length)return l[0];var v=new e.Group;for(u=0,h=l.length;u<h;u++)v.add(l[u]);return v}))},z.prototype.loadCamera=function(t){var r,a=this.json.cameras[t],n=a[a.type];if(n)return"perspective"===a.type?r=new e.PerspectiveCamera(e.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===a.type&&(r=new e.OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),a.name&&(r.name=this.createUniqueName(a.name)),_(r,a),Promise.resolve(r);console.warn("THREE.GLTFLoader: Missing camera parameters.")},z.prototype.loadSkin=function(e){var t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return r.inverseBindMatrices=e,r}))},z.prototype.loadAnimation=function(t){for(var r=this.json.animations[t],a=[],n=[],s=[],i=[],o=[],c=0,l=r.channels.length;c<l;c++){var u=r.channels[c],h=r.samplers[u.sampler],p=u.target,f=void 0!==p.node?p.node:p.id,d=void 0!==r.parameters?r.parameters[h.input]:h.input,g=void 0!==r.parameters?r.parameters[h.output]:h.output;a.push(this.getDependency("node",f)),n.push(this.getDependency("accessor",d)),s.push(this.getDependency("accessor",g)),i.push(h),o.push(p)}return Promise.all([Promise.all(a),Promise.all(n),Promise.all(s),Promise.all(i),Promise.all(o)]).then((function(a){for(var n=a[0],s=a[1],i=a[2],o=a[3],c=a[4],l=[],u=0,h=n.length;u<h;u++){var p=n[u],f=s[u],d=i[u],g=o[u],v=c[u];if(void 0!==p){var m;switch(p.updateMatrix(),p.matrixAutoUpdate=!0,R[v.path]){case R.weights:m=e.NumberKeyframeTrack;break;case R.rotation:m=e.QuaternionKeyframeTrack;break;case R.position:case R.scale:default:m=e.VectorKeyframeTrack}var y=p.name?p.name:p.uuid,b=void 0!==g.interpolation?U[g.interpolation]:e.InterpolateLinear,w=[];R[v.path]===R.weights?p.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&w.push(e.name?e.name:e.uuid)})):w.push(y);var S=d.array;if(d.normalized){var T;if(S.constructor===Int8Array)T=1/127;else if(S.constructor===Uint8Array)T=1/255;else if(S.constructor==Int16Array)T=1/32767;else{if(S.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");T=1/65535}for(var F=new Float32Array(S.length),k=0,E=S.length;k<E;k++)F[k]=S[k]*T;S=F}for(k=0,E=w.length;k<E;k++){var A=new m(w[k]+"."+R[v.path],f.array,S,b);"CUBICSPLINE"===g.interpolation&&(A.createInterpolant=function(e){return new x(this.times,this.values,this.getValueSize()/3,e)},A.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(A)}}}var I=r.name?r.name:"animation_"+t;return new e.AnimationClip(I,void 0,l)}))},z.prototype.loadNode=function(t){var r,a=this.json,n=this.extensions,s=this,i=a.nodes[t],o=i.name?s.createUniqueName(i.name):"";return(r=[],void 0!==i.mesh&&r.push(s.getDependency("mesh",i.mesh).then((function(e){var t=s._getNodeRef(s.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,r=i.weights.length;t<r;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))),void 0!==i.camera&&r.push(s.getDependency("camera",i.camera).then((function(e){return s._getNodeRef(s.cameraCache,i.camera,e)}))),s._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(e){r.push(e)})),Promise.all(r)).then((function(r){var a;if((a=!0===i.isBone?new e.Bone:r.length>1?new e.Group:1===r.length?r[0]:new e.Object3D)!==r[0])for(var c=0,l=r.length;c<l;c++)a.add(r[c]);if(i.name&&(a.userData.name=i.name,a.name=o),_(a,i),i.extensions&&G(n,a,i),void 0!==i.matrix){var u=new e.Matrix4;u.fromArray(i.matrix),a.applyMatrix4(u)}else void 0!==i.translation&&a.position.fromArray(i.translation),void 0!==i.rotation&&a.quaternion.fromArray(i.rotation),void 0!==i.scale&&a.scale.fromArray(i.scale);return s.associations.set(a,{type:"nodes",index:t}),a}))},z.prototype.loadScene=function(){function t(r,a,n,s){var i=n.nodes[r];return s.getDependency("node",r).then((function(t){return void 0===i.skin?t:s.getDependency("skin",i.skin).then((function(e){for(var t=[],a=0,n=(r=e).joints.length;a<n;a++)t.push(s.getDependency("node",r.joints[a]));return Promise.all(t)})).then((function(a){return t.traverse((function(t){if(t.isMesh){for(var n=[],s=[],i=0,o=a.length;i<o;i++){var c=a[i];if(c){n.push(c);var l=new e.Matrix4;void 0!==r.inverseBindMatrices&&l.fromArray(r.inverseBindMatrices.array,16*i),s.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[i])}t.bind(new e.Skeleton(n,s),t.matrixWorld)}})),t}));var r})).then((function(e){a.add(e);var r=[];if(i.children)for(var o=i.children,c=0,l=o.length;c<l;c++){var u=o[c];r.push(t(u,e,n,s))}return Promise.all(r)}))}return function(r){var a=this.json,n=this.extensions,s=this.json.scenes[r],i=new e.Group;s.name&&(i.name=this.createUniqueName(s.name)),_(i,s),s.extensions&&G(n,i,s);for(var o=s.nodes||[],c=[],l=0,u=o.length;l<u;l++)c.push(t(o[l],i,a,this));return Promise.all(c).then((function(){return i}))}}(),t}(),F=function(t,r){var a,n,s,i,o,c;void 0===r&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),r===e.$document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=r,this.enabled=!0,this.target=new e.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:e.MOUSE.ROTATE,MIDDLE:e.MOUSE.DOLLY,RIGHT:e.MOUSE.PAN},this.touches={ONE:e.TOUCH.ROTATE,TWO:e.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return v.phi},this.getAzimuthalAngle=function(){return v.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",Q),this._domElementKeyEvents=e},this.saveState=function(){l.target0.copy(l.target),l.position0.copy(l.object.position),l.zoom0=l.object.zoom},this.reset=function(){l.target.copy(l.target0),l.object.position.copy(l.position0),l.object.zoom=l.zoom0,l.object.updateProjectionMatrix(),l.dispatchEvent(u),l.update(),d=f.NONE},this.update=(a=new e.Vector3,n=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),s=n.clone().invert(),i=new e.Vector3,o=new e.Quaternion,c=2*Math.PI,function(){var e=l.object.position;a.copy(e).sub(l.target),a.applyQuaternion(n),v.setFromVector3(a),l.autoRotate&&d===f.NONE&&C(2*Math.PI/60/60*l.autoRotateSpeed),l.enableDamping?(v.theta+=m.theta*l.dampingFactor,v.phi+=m.phi*l.dampingFactor):(v.theta+=m.theta,v.phi+=m.phi);var t=l.minAzimuthAngle,r=l.maxAzimuthAngle;return isFinite(t)&&isFinite(r)&&(t<-Math.PI?t+=c:t>Math.PI&&(t-=c),r<-Math.PI?r+=c:r>Math.PI&&(r-=c),v.theta=t<=r?Math.max(t,Math.min(r,v.theta)):v.theta>(t+r)/2?Math.max(t,v.theta):Math.min(r,v.theta)),v.phi=Math.max(l.minPolarAngle,Math.min(l.maxPolarAngle,v.phi)),v.makeSafe(),v.radius*=y,v.radius=Math.max(l.minDistance,Math.min(l.maxDistance,v.radius)),!0===l.enableDamping?l.target.addScaledVector(b,l.dampingFactor):l.target.add(b),a.setFromSpherical(v),a.applyQuaternion(s),e.copy(l.target).add(a),l.object.lookAt(l.target),!0===l.enableDamping?(m.theta*=1-l.dampingFactor,m.phi*=1-l.dampingFactor,b.multiplyScalar(1-l.dampingFactor)):(m.set(0,0,0),b.set(0,0,0)),y=1,!!(x||i.distanceToSquared(l.object.position)>g||8*(1-o.dot(l.object.quaternion))>g)&&(l.dispatchEvent(u),i.copy(l.object.position),o.copy(l.object.quaternion),x=!1,!0)}),this.dispose=function(){l.domElement.removeEventListener("contextmenu",te),l.domElement.removeEventListener("pointerdown",q),l.domElement.removeEventListener("wheel",Z),l.domElement.removeEventListener("touchstart",$),l.domElement.removeEventListener("touchend",ee),l.domElement.removeEventListener("touchmove",J),l.domElement.ownerDocument.removeEventListener("pointermove",Y),l.domElement.ownerDocument.removeEventListener("pointerup",K),null!==l._domElementKeyEvents&&l._domElementKeyEvents.removeEventListener("keydown",Q)};var l=this,u={type:"change"},h={type:"start"},p={type:"end"},f={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},d=f.NONE,g=1e-6,v=new e.Spherical,m=new e.Spherical,y=1,b=new e.Vector3,x=!1,w=new e.Vector2,S=new e.Vector2,T=new e.Vector2,F=new e.Vector2,k=new e.Vector2,E=new e.Vector2,A=new e.Vector2,I=new e.Vector2,M=new e.Vector2;function L(){return Math.pow(.95,l.zoomSpeed)}function C(e){m.theta-=e}function O(e){m.phi-=e}var R,U=(R=new e.Vector3,function(e,t){R.setFromMatrixColumn(t,0),R.multiplyScalar(-e),b.add(R)}),N=function(){var t=new e.Vector3;return function(e,r){!0===l.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(l.object.up,t)),t.multiplyScalar(e),b.add(t)}}(),D=function(){var t=new e.Vector3;return function(e,r){var a=l.domElement;if(l.object.isPerspectiveCamera){var n=l.object.position;t.copy(n).sub(l.target);var s=t.length();s*=Math.tan(l.object.fov/2*Math.PI/180),U(2*e*s/a.clientHeight,l.object.matrix),N(2*r*s/a.clientHeight,l.object.matrix)}else l.object.isOrthographicCamera?(U(e*(l.object.right-l.object.left)/l.object.zoom/a.clientWidth,l.object.matrix),N(r*(l.object.top-l.object.bottom)/l.object.zoom/a.clientHeight,l.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),l.enablePan=!1)}}();function P(e){l.object.isPerspectiveCamera?y/=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom*e)),l.object.updateProjectionMatrix(),x=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function B(e){l.object.isPerspectiveCamera?y*=e:l.object.isOrthographicCamera?(l.object.zoom=Math.max(l.minZoom,Math.min(l.maxZoom,l.object.zoom/e)),l.object.updateProjectionMatrix(),x=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),l.enableZoom=!1)}function G(e){w.set(e.clientX,e.clientY)}function _(e){F.set(e.clientX,e.clientY)}function H(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,r)}}function V(e){if(1==e.touches.length)F.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);F.set(t,r)}}function z(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+r*r);A.set(0,a)}function j(e){if(1==e.touches.length)S.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);S.set(t,r)}T.subVectors(S,w).multiplyScalar(l.rotateSpeed);var a=l.domElement;C(2*Math.PI*T.x/a.clientHeight),O(2*Math.PI*T.y/a.clientHeight),w.copy(S)}function W(e){if(1==e.touches.length)k.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);k.set(t,r)}E.subVectors(k,F).multiplyScalar(l.panSpeed),D(E.x,E.y),F.copy(k)}function X(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+r*r);I.set(0,a),M.set(0,Math.pow(I.y/A.y,l.zoomSpeed)),P(M.y),A.copy(I)}function q(t){if(!1!==l.enabled)switch(t.pointerType){case"mouse":case"pen":!function(t){var r;switch(t.preventDefault(),l.domElement.focus?l.domElement.focus():e.$window.focus(),t.button){case 0:r=l.mouseButtons.LEFT;break;case 1:r=l.mouseButtons.MIDDLE;break;case 2:r=l.mouseButtons.RIGHT;break;default:r=-1}switch(r){case e.MOUSE.DOLLY:if(!1===l.enableZoom)return;!function(e){A.set(e.clientX,e.clientY)}(t),d=f.DOLLY;break;case e.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===l.enablePan)return;_(t),d=f.PAN}else{if(!1===l.enableRotate)return;G(t),d=f.ROTATE}break;case e.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===l.enableRotate)return;G(t),d=f.ROTATE}else{if(!1===l.enablePan)return;_(t),d=f.PAN}break;default:d=f.NONE}d!==f.NONE&&(l.domElement.ownerDocument.addEventListener("pointermove",Y),l.domElement.ownerDocument.addEventListener("pointerup",K),l.dispatchEvent(h))}(t)}}function Y(e){if(!1!==l.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===l.enabled)return;switch(e.preventDefault(),d){case f.ROTATE:if(!1===l.enableRotate)return;!function(e){S.set(e.clientX,e.clientY),T.subVectors(S,w).multiplyScalar(l.rotateSpeed);var t=l.domElement;C(2*Math.PI*T.x/t.clientHeight),O(2*Math.PI*T.y/t.clientHeight),w.copy(S),l.update()}(e);break;case f.DOLLY:if(!1===l.enableZoom)return;!function(e){I.set(e.clientX,e.clientY),M.subVectors(I,A),M.y>0?P(L()):M.y<0&&B(L()),A.copy(I),l.update()}(e);break;case f.PAN:if(!1===l.enablePan)return;!function(e){k.set(e.clientX,e.clientY),E.subVectors(k,F).multiplyScalar(l.panSpeed),D(E.x,E.y),F.copy(k),l.update()}(e)}}(e)}}function K(e){switch(e.pointerType){case"mouse":case"pen":!function(e){if(l.domElement.ownerDocument.removeEventListener("pointermove",Y),l.domElement.ownerDocument.removeEventListener("pointerup",K),!1===l.enabled)return;l.dispatchEvent(p),d=f.NONE}()}}function Z(e){!1===l.enabled||!1===l.enableZoom||d!==f.NONE&&d!==f.ROTATE||(e.preventDefault(),l.dispatchEvent(h),function(e){e.deltaY<0?B(L()):e.deltaY>0&&P(L()),l.update()}(e),l.dispatchEvent(p))}function Q(e){!1!==l.enabled&&!1!==l.enablePan&&function(e){var t=!1;switch(e.code){case l.keys.UP:D(0,l.keyPanSpeed),t=!0;break;case l.keys.BOTTOM:D(0,-l.keyPanSpeed),t=!0;break;case l.keys.LEFT:D(l.keyPanSpeed,0),t=!0;break;case l.keys.RIGHT:D(-l.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),l.update())}(e)}function $(t){if(!1!==l.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(l.touches.ONE){case e.TOUCH.ROTATE:if(!1===l.enableRotate)return;H(t),d=f.TOUCH_ROTATE;break;case e.TOUCH.PAN:if(!1===l.enablePan)return;V(t),d=f.TOUCH_PAN;break;default:d=f.NONE}break;case 2:switch(l.touches.TWO){case e.TOUCH.DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&z(e),l.enablePan&&V(e)}(t),d=f.TOUCH_DOLLY_PAN;break;case e.TOUCH.DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&z(e),l.enableRotate&&H(e)}(t),d=f.TOUCH_DOLLY_ROTATE;break;default:d=f.NONE}break;default:d=f.NONE}d!==f.NONE&&l.dispatchEvent(h)}}function J(e){if(!1!==l.enabled)switch(e.preventDefault(),d){case f.TOUCH_ROTATE:if(!1===l.enableRotate)return;j(e),l.update();break;case f.TOUCH_PAN:if(!1===l.enablePan)return;W(e),l.update();break;case f.TOUCH_DOLLY_PAN:if(!1===l.enableZoom&&!1===l.enablePan)return;!function(e){l.enableZoom&&X(e),l.enablePan&&W(e)}(e),l.update();break;case f.TOUCH_DOLLY_ROTATE:if(!1===l.enableZoom&&!1===l.enableRotate)return;!function(e){l.enableZoom&&X(e),l.enableRotate&&j(e)}(e),l.update();break;default:d=f.NONE}}function ee(e){!1!==l.enabled&&(l.dispatchEvent(p),d=f.NONE)}function te(e){!1!==l.enabled&&e.preventDefault()}l.domElement.addEventListener("contextmenu",te),l.domElement.addEventListener("pointerdown",q),l.domElement.addEventListener("wheel",Z),l.domElement.addEventListener("touchstart",$),l.domElement.addEventListener("touchend",ee),l.domElement.addEventListener("touchmove",J),this.update()};(F.prototype=Object.create(e.EventDispatcher.prototype)).constructor=F;var k=function(t,r){F.call(this,t,r),this.screenSpacePanning=!1,this.mouseButtons.LEFT=e.MOUSE.PAN,this.mouseButtons.RIGHT=e.MOUSE.ROTATE,this.touches.ONE=e.TOUCH.PAN,this.touches.TWO=e.TOUCH.DOLLY_ROTATE};function E(e){e.isMesh?(e.geometry&&e.geometry.dispose(),e.material&&Object.keys(e.material).forEach((t=>{const r=e.material[t];r&&r.dispose instanceof Function&&r.dispose()}))):e.isScene&&(e.background&&e.background.dispose&&e.background.dispose(),e.environment&&e.environment.dispose&&e.environment.dispose())}function A(e,t=E){for(var r=e.children.length-1;r>=0;r--){var a=e.children[r];A(a,t),t(a)}t(e)}function I(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}return r}(k.prototype=Object.create(e.EventDispatcher.prototype)).constructor=k;const M="https://techbrood.com/threejs/examples/";class L{__init(){this._objects=[]}__init2(){this._cameraObjects=[]}constructor(e){L.prototype.__init.call(this),L.prototype.__init2.call(this),this.deps=e}add(e){this._objects.push(e),this.deps.scene.add(e)}addCamera(e){this._cameraObjects.push(e),this.deps.camera.add(e)}addControl(){const{camera:e,renderer:t}=this.deps;this.orbitControl=new F(e,t.domElement),this.orbitControl.enableDamping=!0,this.orbitControl.dampingFactor=.05}reset(t=!0){const{camera:r,scene:a,renderer:n}=this.deps;r.position.set(0,0,0),r.quaternion.set(0,0,0,1),I([a.background,"optionalAccess",e=>e.dispose,"optionalCall",e=>e()]),a.background=new e.Color(16777215),a.fog=null,a.position.z=-3,n.shadowMap.enabled=!1,n.physicallyCorrectLights=!1,n.outputEncoding=e.sRGBEncoding,A(this.deps.scene),this._objects.forEach((e=>I([e,"access",e=>e.material,"optionalAccess",e=>e.dispose,"optionalCall",e=>e()]))),this._cameraObjects.forEach((e=>I([e,"access",e=>e.material,"optionalAccess",e=>e.dispose,"optionalCall",e=>e()]))),a.remove(...this._objects),r.remove(...this._cameraObjects),this._objects.length=0,this._cameraObjects.length=0,I([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.dispose,"call",e=>e()]),t&&(this.orbitControl=null,this.deps=null)}}var C=function(e){if("object"!=typeof WXWebAssembly)return{supported:!1};var t,r,a=new Promise((e=>{r=e}));function n(e,r,a,n,s,i){var o=t.exports.sbrk,c=a+3&-4,l=o(c*n),u=o(s.length),h=new Uint8Array(t.exports.memory.buffer);h.set(s,u);var p=e(l,a,n,u,s.length);if(0==p&&i&&i(l,c,n),r.set(h.subarray(l,l+a*n)),o(l-o(0)),0!=p)throw new Error("Malformed buffer data: "+p)}var s={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},i={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{setWasmPath:function(e){WXWebAssembly.instantiate(e,{}).then((function(e){(t=e.instance).exports.__wasm_call_ctors(),r()}))},ready:a,supported:!0,decodeVertexBuffer:function(e,r,a,i,o){n(t.exports.meshopt_decodeVertexBuffer,e,r,a,i,t.exports[s[o]])},decodeIndexBuffer:function(e,r,a,s){n(t.exports.meshopt_decodeIndexBuffer,e,r,a,s)},decodeIndexSequence:function(e,r,a,s){n(t.exports.meshopt_decodeIndexSequence,e,r,a,s)},decodeGltfBuffer:function(e,r,a,o,c,l){n(t.exports[i[c]],e,r,a,o,t.exports[s[l]])}}}();var O=function(t){e.DataTextureLoader.call(this,t)};O.prototype=Object.assign(Object.create(e.DataTextureLoader.prototype),{constructor:O,load:function(t,r,a,n){return e.DataTextureLoader.prototype.load.call(this,t,(function(t,a){t.flipY=!0,t.generateMipmaps=!0,t.unpackAlignment=4,t.magFilter=e.LinearFilter,t.minFilter=e.LinearMipmapLinearFilter,r&&r(t,a)}),a,n)},parse:function(e){var t=0,r=1,a=2,n=3,s=9,i=10,o=11,c=48,l=4,u=0,h=1,p=2,f=3;e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var d=new Uint8Array(e),g=0,v={id_length:d[g++],colormap_type:d[g++],image_type:d[g++],colormap_index:d[g++]|d[g++]<<8,colormap_length:d[g++]|d[g++]<<8,colormap_size:d[g++],origin:[d[g++]|d[g++]<<8,d[g++]|d[g++]<<8],width:d[g++]|d[g++]<<8,height:d[g++]|d[g++]<<8,pixel_size:d[g++],flags:d[g++]};!function(e){switch(e.image_type){case r:case s:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case a:case n:case i:case o:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case t:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(v),v.id_length+g>e.length&&console.error("THREE.TGALoader: No data."),g+=v.id_length;var m=!1,y=!1,b=!1;switch(v.image_type){case s:m=!0,y=!0;break;case r:y=!0;break;case i:m=!0;break;case a:break;case o:m=!0,b=!0;break;case n:b=!0}var x=new Uint8Array(v.width*v.height*4),w=function(e,t,r,a,n){var s,i,o,c;if(i=r.pixel_size>>3,o=r.width*r.height*i,t&&(c=n.subarray(a,a+=r.colormap_length*(r.colormap_size>>3))),e){var l,u,h;s=new Uint8Array(o);for(var p=0,f=new Uint8Array(i);p<o;)if(u=1+(127&(l=n[a++])),128&l){for(h=0;h<i;++h)f[h]=n[a++];for(h=0;h<u;++h)s.set(f,p+h*i);p+=i*u}else{for(u*=i,h=0;h<u;++h)s[p+h]=n[a++];p+=u}}else s=n.subarray(a,a+=t?r.width*r.height:o);return{pixel_data:s,palettes:c}}(m,y,v,g,d);return function(e,t,r,a,n){var s,i,o,d,g,m;switch((v.flags&c)>>l){default:case p:s=0,o=1,g=t,i=0,d=1,m=r;break;case u:s=0,o=1,g=t,i=r-1,d=-1,m=-1;break;case f:s=t-1,o=-1,g=-1,i=0,d=1,m=r;break;case h:s=t-1,o=-1,g=-1,i=r-1,d=-1,m=-1}if(b)switch(v.pixel_size){case 8:!function(e,t,r,a,n,s,i,o){var c,l,u,h=0,p=v.width;for(u=t;u!==a;u+=r)for(l=n;l!==i;l+=s,h++)c=o[h],e[4*(l+p*u)+0]=c,e[4*(l+p*u)+1]=c,e[4*(l+p*u)+2]=c,e[4*(l+p*u)+3]=255}(e,i,d,m,s,o,g,a);break;case 16:!function(e,t,r,a,n,s,i,o){var c,l,u=0,h=v.width;for(l=t;l!==a;l+=r)for(c=n;c!==i;c+=s,u+=2)e[4*(c+h*l)+0]=o[u+0],e[4*(c+h*l)+1]=o[u+0],e[4*(c+h*l)+2]=o[u+0],e[4*(c+h*l)+3]=o[u+1]}(e,i,d,m,s,o,g,a);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(v.pixel_size){case 8:!function(e,t,r,a,n,s,i,o,c){var l,u,h,p=c,f=0,d=v.width;for(h=t;h!==a;h+=r)for(u=n;u!==i;u+=s,f++)l=o[f],e[4*(u+d*h)+3]=255,e[4*(u+d*h)+2]=p[3*l+0],e[4*(u+d*h)+1]=p[3*l+1],e[4*(u+d*h)+0]=p[3*l+2]}(e,i,d,m,s,o,g,a,n);break;case 16:!function(e,t,r,a,n,s,i,o){var c,l,u,h=0,p=v.width;for(u=t;u!==a;u+=r)for(l=n;l!==i;l+=s,h+=2)c=o[h+0]+(o[h+1]<<8),e[4*(l+p*u)+0]=(31744&c)>>7,e[4*(l+p*u)+1]=(992&c)>>2,e[4*(l+p*u)+2]=(31&c)>>3,e[4*(l+p*u)+3]=32768&c?0:255}(e,i,d,m,s,o,g,a);break;case 24:!function(e,t,r,a,n,s,i,o){var c,l,u=0,h=v.width;for(l=t;l!==a;l+=r)for(c=n;c!==i;c+=s,u+=3)e[4*(c+h*l)+3]=255,e[4*(c+h*l)+2]=o[u+0],e[4*(c+h*l)+1]=o[u+1],e[4*(c+h*l)+0]=o[u+2]}(e,i,d,m,s,o,g,a);break;case 32:!function(e,t,r,a,n,s,i,o){var c,l,u=0,h=v.width;for(l=t;l!==a;l+=r)for(c=n;c!==i;c+=s,u+=4)e[4*(c+h*l)+2]=o[u+0],e[4*(c+h*l)+1]=o[u+1],e[4*(c+h*l)+0]=o[u+2],e[4*(c+h*l)+3]=o[u+3]}(e,i,d,m,s,o,g,a);break;default:console.error("THREE.TGALoader: Format not supported.")}}(x,v.width,v.height,w.pixel_data,w.palettes),{data:x,width:v.width,height:v.height}}});var R=function(t){e.Loader.call(this,t)};R.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:R,load:function(t,r,a,n){var s=this,i=new e.FileLoader(s.manager);i.setPath(s.path),i.setRequestHeader(s.requestHeader),i.setWithCredentials(s.withCredentials),i.load(t,(function(e){try{r(s.parse(e))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),a,n)},parse:function(t){function r(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function a(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}function n(e,t){var r=parseInt(g[v].substr(e,t));if(r){var a=function(e,t){return"s"+Math.min(e,t)+"e"+Math.max(e,t)}(b,r);void 0===f[a]&&(p.push([b-1,r-1,1]),f[a]=p.length-1)}}for(var s,i,o,c,l,u={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},h=[],p=[],f={},d={},g=t.split("\n"),v=0,m=g.length;v<m;v++)if("ATOM"===g[v].substr(0,4)||"HETATM"===g[v].substr(0,6)){s=parseFloat(g[v].substr(30,7)),i=parseFloat(g[v].substr(38,7)),o=parseFloat(g[v].substr(46,7)),c=parseInt(g[v].substr(6,5))-1,""===(l=r(g[v].substr(76,2)).toLowerCase())&&(l=r(g[v].substr(12,2)).toLowerCase());var y=[s,i,o,u[l],a(l)];h.push(y),d[c]=y}else if("CONECT"===g[v].substr(0,6)){var b=parseInt(g[v].substr(6,5));n(11,5),n(16,5),n(21,5),n(26,5)}return function(){var t,r,a,n,s,i={geometryAtoms:new e.BufferGeometry,geometryBonds:new e.BufferGeometry,json:{atoms:h}},o=i.geometryAtoms,c=i.geometryBonds,l=[],u=[],f=[];for(t=0,r=h.length;t<r;t++){var g=h[t];a=g[0],n=g[1],s=g[2],l.push(a,n,s);var v=g[3][0]/255,m=g[3][1]/255,y=g[3][2]/255;u.push(v,m,y)}for(t=0,r=p.length;t<r;t++){var b=p[t],x=b[0],w=b[1],S=d[x],T=d[w];a=S[0],n=S[1],s=S[2],f.push(a,n,s),a=T[0],n=T[1],s=T[2],f.push(a,n,s)}return o.setAttribute("position",new e.Float32BufferAttribute(l,3)),o.setAttribute("color",new e.Float32BufferAttribute(u,3)),c.setAttribute("position",new e.Float32BufferAttribute(f,3)),i}()}});var U,N,D=function(t){e.Loader.call(this,t)};D.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:D,load:function(t,r,a,n){var s=this,i=new e.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,(function(e){try{r(s.parse(e))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),a,n)},parse:function(t){function r(e,t,r){for(var a=0,n=e.length;a<n;a++)if(e[a]!==t.getUint8(r+a,!1))return!1;return!0}var a,n=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(t);return function(e){var t;if(50,84+50*(t=new DataView(e)).getUint32(80,!0)===t.byteLength)return!0;for(var a=[115,111,108,105,100],n=0;n<5;n++)if(r(a,t,n))return!1;return!0}(n)?function(t){for(var r,a,n,s,i,o,c,l,u=new DataView(t),h=u.getUint32(80,!0),p=!1,f=0;f<70;f++)1129270351==u.getUint32(f,!1)&&82==u.getUint8(f+4)&&61==u.getUint8(f+5)&&(p=!0,s=new Float32Array(3*h*3),i=u.getUint8(f+6)/255,o=u.getUint8(f+7)/255,c=u.getUint8(f+8)/255,l=u.getUint8(f+9)/255);for(var d=new e.BufferGeometry,g=new Float32Array(3*h*3),v=new Float32Array(3*h*3),m=0;m<h;m++){var y=84+50*m,b=u.getFloat32(y,!0),x=u.getFloat32(y+4,!0),w=u.getFloat32(y+8,!0);if(p){var S=u.getUint16(y+48,!0);0==(32768&S)?(r=(31&S)/31,a=(S>>5&31)/31,n=(S>>10&31)/31):(r=i,a=o,n=c)}for(var T=1;T<=3;T++){var F=y+12*T,k=3*m*3+3*(T-1);g[k]=u.getFloat32(F,!0),g[k+1]=u.getFloat32(F+4,!0),g[k+2]=u.getFloat32(F+8,!0),v[k]=b,v[k+1]=x,v[k+2]=w,p&&(s[k]=r,s[k+1]=a,s[k+2]=n)}}return d.setAttribute("position",new e.BufferAttribute(g,3)),d.setAttribute("normal",new e.BufferAttribute(v,3)),p&&(d.setAttribute("color",new e.BufferAttribute(s,3)),d.hasColors=!0,d.alpha=l),d}(n):function(t){for(var r,a=new e.BufferGeometry,n=/solid([\s\S]*?)endsolid/g,s=/facet([\s\S]*?)endfacet/g,i=0,o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,c=new RegExp("vertex"+o+o+o,"g"),l=new RegExp("normal"+o+o+o,"g"),u=[],h=[],p=new e.Vector3,f=0,d=0,g=0;null!==(r=n.exec(t));){d=g;for(var v=r[0];null!==(r=s.exec(v));){for(var m=0,y=0,b=r[0];null!==(r=l.exec(b));)p.x=parseFloat(r[1]),p.y=parseFloat(r[2]),p.z=parseFloat(r[3]),y++;for(;null!==(r=c.exec(b));)u.push(parseFloat(r[1]),parseFloat(r[2]),parseFloat(r[3])),h.push(p.x,p.y,p.z),m++,g++;1!==y&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+i),3!==m&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+i),i++}var x=d,w=g-d;a.addGroup(x,w,f),f++}return a.setAttribute("position",new e.Float32BufferAttribute(u,3)),a.setAttribute("normal",new e.Float32BufferAttribute(h,3)),a}("string"!=typeof(a=t)?e.LoaderUtils.decodeText(new Uint8Array(a)):a)}});String.prototype.codePointAt||(U=function(){try{var e={},t=Object.defineProperty,r=t(e,e,e)&&t}catch(e){}return r}(),N=function(e){if(null==this)throw TypeError();var t=String(this),r=t.length,a=e?Number(e):0;if(a!=a&&(a=0),!(a<0||a>=r)){var n,s=t.charCodeAt(a);return s>=55296&&s<=56319&&r>a+1&&(n=t.charCodeAt(a+1))>=56320&&n<=57343?1024*(s-55296)+n-56320+65536:s}},U?U(String.prototype,"codePointAt",{value:N,configurable:!0,writable:!0}):String.prototype.codePointAt=N);function P(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function B(e,t){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=t,this.destLen=0,this.ltree=new P,this.dtree=new P}var G=new P,_=new P,H=new Uint8Array(30),V=new Uint16Array(30),z=new Uint8Array(30),j=new Uint16Array(30),W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),X=new P,q=new Uint8Array(320);function Y(e,t,r,a){var n,s;for(n=0;n<r;++n)e[n]=0;for(n=0;n<30-r;++n)e[n+r]=n/r|0;for(s=a,n=0;n<30;++n)t[n]=s,s+=1<<e[n]}var K=new Uint16Array(16);function Z(e,t,r,a){var n,s;for(n=0;n<16;++n)e.table[n]=0;for(n=0;n<a;++n)e.table[t[r+n]]++;for(e.table[0]=0,s=0,n=0;n<16;++n)K[n]=s,s+=e.table[n];for(n=0;n<a;++n)t[r+n]&&(e.trans[K[t[r+n]]++]=n)}function Q(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}function $(e,t,r){if(!t)return r;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var a=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,a+r}function J(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=0,a=0,n=0,s=e.tag;do{a=2*a+(1&s),s>>>=1,++n,r+=t.table[n],a-=t.table[n]}while(a>=0);return e.tag=s,e.bitcount-=n,t.trans[r+a]}function ee(e,t,r){var a,n,s,i,o,c;for(a=$(e,5,257),n=$(e,5,1),s=$(e,4,4),i=0;i<19;++i)q[i]=0;for(i=0;i<s;++i){var l=$(e,3,0);q[W[i]]=l}for(Z(X,q,0,19),o=0;o<a+n;){var u=J(e,X);switch(u){case 16:var h=q[o-1];for(c=$(e,2,3);c;--c)q[o++]=h;break;case 17:for(c=$(e,3,3);c;--c)q[o++]=0;break;case 18:for(c=$(e,7,11);c;--c)q[o++]=0;break;default:q[o++]=u}}Z(t,q,0,a),Z(r,q,a,n)}function te(e,t,r){for(;;){var a,n,s,i,o=J(e,t);if(256===o)return 0;if(o<256)e.dest[e.destLen++]=o;else for(a=$(e,H[o-=257],V[o]),n=J(e,r),i=s=e.destLen-$(e,z[n],j[n]);i<s+a;++i)e.dest[e.destLen++]=e.dest[i]}}function re(e){for(var t,r;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if((t=256*(t=e.source[e.sourceIndex+1])+e.source[e.sourceIndex])!==(65535&~(256*e.source[e.sourceIndex+3]+e.source[e.sourceIndex+2])))return-3;for(e.sourceIndex+=4,r=t;r;--r)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,0}!function(e,t){var r;for(r=0;r<7;++r)e.table[r]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,r=0;r<24;++r)e.trans[r]=256+r;for(r=0;r<144;++r)e.trans[24+r]=r;for(r=0;r<8;++r)e.trans[168+r]=280+r;for(r=0;r<112;++r)e.trans[176+r]=144+r;for(r=0;r<5;++r)t.table[r]=0;for(t.table[5]=32,r=0;r<32;++r)t.trans[r]=r}(G,_),Y(H,V,4,3),Y(z,j,2,1),H[28]=0,V[28]=258;var ae=function(e,t){var r,a,n=new B(e,t);do{switch(r=Q(n),$(n,2,0)){case 0:a=re(n);break;case 1:a=te(n,G,_);break;case 2:ee(n,n.ltree,n.dtree),a=te(n,n.ltree,n.dtree);break;default:a=-3}if(0!==a)throw new Error("Data error")}while(!r);return n.destLen<n.dest.length?"function"==typeof n.dest.slice?n.dest.slice(0,n.destLen):n.dest.subarray(0,n.destLen):n.dest};function ne(e,t,r,a,n){return Math.pow(1-n,3)*e+3*Math.pow(1-n,2)*n*t+3*(1-n)*Math.pow(n,2)*r+Math.pow(n,3)*a}function se(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}function ie(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}function oe(e){throw new Error(e)}function ce(e,t){e||oe(t)}se.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},se.prototype.addPoint=function(e,t){"number"==typeof e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),"number"==typeof t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},se.prototype.addX=function(e){this.addPoint(e,null)},se.prototype.addY=function(e){this.addPoint(null,e)},se.prototype.addBezier=function(e,t,r,a,n,s,i,o){var c=[e,t],l=[r,a],u=[n,s],h=[i,o];this.addPoint(e,t),this.addPoint(i,o);for(var p=0;p<=1;p++){var f=6*c[p]-12*l[p]+6*u[p],d=-3*c[p]+9*l[p]-9*u[p]+3*h[p],g=3*l[p]-3*c[p];if(0!==d){var v=Math.pow(f,2)-4*g*d;if(!(v<0)){var m=(-f+Math.sqrt(v))/(2*d);0<m&&m<1&&(0===p&&this.addX(ne(c[p],l[p],u[p],h[p],m)),1===p&&this.addY(ne(c[p],l[p],u[p],h[p],m)));var y=(-f-Math.sqrt(v))/(2*d);0<y&&y<1&&(0===p&&this.addX(ne(c[p],l[p],u[p],h[p],y)),1===p&&this.addY(ne(c[p],l[p],u[p],h[p],y)))}}else{if(0===f)continue;var b=-g/f;0<b&&b<1&&(0===p&&this.addX(ne(c[p],l[p],u[p],h[p],b)),1===p&&this.addY(ne(c[p],l[p],u[p],h[p],b)))}}},se.prototype.addQuad=function(e,t,r,a,n,s){var i=e+2/3*(r-e),o=t+2/3*(a-t),c=i+1/3*(n-e),l=o+1/3*(s-t);this.addBezier(e,t,i,o,c,l,n,s)},ie.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})},ie.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})},ie.prototype.curveTo=ie.prototype.bezierCurveTo=function(e,t,r,a,n,s){this.commands.push({type:"C",x1:e,y1:t,x2:r,y2:a,x:n,y:s})},ie.prototype.quadTo=ie.prototype.quadraticCurveTo=function(e,t,r,a){this.commands.push({type:"Q",x1:e,y1:t,x:r,y:a})},ie.prototype.close=ie.prototype.closePath=function(){this.commands.push({type:"Z"})},ie.prototype.extend=function(e){if(e.commands)e=e.commands;else if(e instanceof se){var t=e;return this.moveTo(t.x1,t.y1),this.lineTo(t.x2,t.y1),this.lineTo(t.x2,t.y2),this.lineTo(t.x1,t.y2),void this.close()}Array.prototype.push.apply(this.commands,e)},ie.prototype.getBoundingBox=function(){for(var e=new se,t=0,r=0,a=0,n=0,s=0;s<this.commands.length;s++){var i=this.commands[s];switch(i.type){case"M":e.addPoint(i.x,i.y),t=a=i.x,r=n=i.y;break;case"L":e.addPoint(i.x,i.y),a=i.x,n=i.y;break;case"Q":e.addQuad(a,n,i.x1,i.y1,i.x,i.y),a=i.x,n=i.y;break;case"C":e.addBezier(a,n,i.x1,i.y1,i.x2,i.y2,i.x,i.y),a=i.x,n=i.y;break;case"Z":a=t,n=r;break;default:throw new Error("Unexpected path command "+i.type)}}return e.isEmpty()&&e.addPoint(0,0),e},ie.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var r=this.commands[t];"M"===r.type?e.moveTo(r.x,r.y):"L"===r.type?e.lineTo(r.x,r.y):"C"===r.type?e.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):"Q"===r.type?e.quadraticCurveTo(r.x1,r.y1,r.x,r.y):"Z"===r.type&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())},ie.prototype.toPathData=function(e){function t(t){return Math.round(t)===t?""+Math.round(t):t.toFixed(e)}function r(){for(var e=arguments,r="",a=0;a<arguments.length;a+=1){var n=e[a];n>=0&&a>0&&(r+=" "),r+=t(n)}return r}e=void 0!==e?e:2;for(var a="",n=0;n<this.commands.length;n+=1){var s=this.commands[n];"M"===s.type?a+="M"+r(s.x,s.y):"L"===s.type?a+="L"+r(s.x,s.y):"C"===s.type?a+="C"+r(s.x1,s.y1,s.x2,s.y2,s.x,s.y):"Q"===s.type?a+="Q"+r(s.x1,s.y1,s.x,s.y):"Z"===s.type&&(a+="Z")}return a},ie.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&&"black"!==this.fill&&(null===this.fill?t+=' fill="none"':t+=' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+="/>"},ie.prototype.toDOMElement=function(e){var t=this.toPathData(e),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",t),r};var le={fail:oe,argument:ce,assert:ce},ue={},he={},pe={};function fe(e){return function(){return e}}he.BYTE=function(e){return le.argument(e>=0&&e<=255,"Byte value should be between 0 and 255."),[e]},pe.BYTE=fe(1),he.CHAR=function(e){return[e.charCodeAt(0)]},pe.CHAR=fe(1),he.CHARARRAY=function(e){for(var t=[],r=0;r<e.length;r+=1)t[r]=e.charCodeAt(r);return t},pe.CHARARRAY=function(e){return e.length},he.USHORT=function(e){return[e>>8&255,255&e]},pe.USHORT=fe(2),he.SHORT=function(e){return e>=32768&&(e=-(65536-e)),[e>>8&255,255&e]},pe.SHORT=fe(2),he.UINT24=function(e){return[e>>16&255,e>>8&255,255&e]},pe.UINT24=fe(3),he.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},pe.ULONG=fe(4),he.LONG=function(e){return e>=2147483648&&(e=-(4294967296-e)),[e>>24&255,e>>16&255,e>>8&255,255&e]},pe.LONG=fe(4),he.FIXED=he.ULONG,pe.FIXED=pe.ULONG,he.FWORD=he.SHORT,pe.FWORD=pe.SHORT,he.UFWORD=he.USHORT,pe.UFWORD=pe.USHORT,he.LONGDATETIME=function(e){return[0,0,0,0,e>>24&255,e>>16&255,e>>8&255,255&e]},pe.LONGDATETIME=fe(8),he.TAG=function(e){return le.argument(4===e.length,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},pe.TAG=fe(4),he.Card8=he.BYTE,pe.Card8=pe.BYTE,he.Card16=he.USHORT,pe.Card16=pe.USHORT,he.OffSize=he.BYTE,pe.OffSize=pe.BYTE,he.SID=he.USHORT,pe.SID=pe.USHORT,he.NUMBER=function(e){return e>=-107&&e<=107?[e+139]:e>=108&&e<=1131?[247+((e-=108)>>8),255&e]:e>=-1131&&e<=-108?[251+((e=-e-108)>>8),255&e]:e>=-32768&&e<=32767?he.NUMBER16(e):he.NUMBER32(e)},pe.NUMBER=function(e){return he.NUMBER(e).length},he.NUMBER16=function(e){return[28,e>>8&255,255&e]},pe.NUMBER16=fe(3),he.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,255&e]},pe.NUMBER32=fe(5),he.REAL=function(e){var t=e.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(r){var a=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));t=(Math.round(e*a)/a).toString()}for(var n="",s=0,i=t.length;s<i;s+=1){var o=t[s];n+="e"===o?"-"===t[++s]?"c":"b":"."===o?"a":"-"===o?"e":o}for(var c=[30],l=0,u=(n+=1&n.length?"f":"ff").length;l<u;l+=2)c.push(parseInt(n.substr(l,2),16));return c},pe.REAL=function(e){return he.REAL(e).length},he.NAME=he.CHARARRAY,pe.NAME=pe.CHARARRAY,he.STRING=he.CHARARRAY,pe.STRING=pe.CHARARRAY,ue.UTF8=function(e,t,r){for(var a=[],n=r,s=0;s<n;s++,t+=1)a[s]=e.getUint8(t);return String.fromCharCode.apply(null,a)},ue.UTF16=function(e,t,r){for(var a=[],n=r/2,s=0;s<n;s++,t+=2)a[s]=e.getUint16(t);return String.fromCharCode.apply(null,a)},he.UTF16=function(e){for(var t=[],r=0;r<e.length;r+=1){var a=e.charCodeAt(r);t[t.length]=a>>8&255,t[t.length]=255&a}return t},pe.UTF16=function(e){return 2*e.length};var de={"x-mac-croatian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®Š™´¨≠ŽØ∞±≤≥∆µ∂∑∏š∫ªºΩžø¿¡¬√ƒ≈Ć«Č… ÀÃÕŒœĐ—“”‘’÷◊©⁄€‹›Æ»–·‚„‰ÂćÁčÈÍÎÏÌÓÔđÒÚÛÙıˆ˜¯πË˚¸Êæˇ","x-mac-cyrillic":"АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ†°Ґ£§•¶І®©™Ђђ≠Ѓѓ∞±≤≥іµґЈЄєЇїЉљЊњјЅ¬√ƒ≈∆«»… ЋћЌќѕ–—“”‘’÷„ЎўЏџ№Ёёяабвгдежзийклмнопрстуфхцчшщъыьэю","x-mac-gaelic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØḂ±≤≥ḃĊċḊḋḞḟĠġṀæøṁṖṗɼƒſṠ«»… ÀÃÕŒœ–—“”‘’ṡẛÿŸṪ€‹›Ŷŷṫ·Ỳỳ⁊ÂÊÁËÈÍÎÏÌÓÔ♣ÒÚÛÙıÝýŴŵẄẅẀẁẂẃ","x-mac-greek":"Ä¹²É³ÖÜ΅àâä΄¨çéèêë£™îï•½‰ôö¦€ùûü†ΓΔΘΛΞΠß®©ΣΪ§≠°·Α±≤≥¥ΒΕΖΗΙΚΜΦΫΨΩάΝ¬ΟΡ≈Τ«»… ΥΧΆΈœ–―“”‘’÷ΉΊΌΎέήίόΏύαβψδεφγηιξκλμνοπώρστθωςχυζϊϋΐΰ­","x-mac-icelandic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûüÝ°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€ÐðÞþý·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-inuit":"ᐃᐄᐅᐆᐊᐋᐱᐲᐳᐴᐸᐹᑉᑎᑏᑐᑑᑕᑖᑦᑭᑮᑯᑰᑲᑳᒃᒋᒌᒍᒎᒐᒑ°ᒡᒥᒦ•¶ᒧ®©™ᒨᒪᒫᒻᓂᓃᓄᓅᓇᓈᓐᓯᓰᓱᓲᓴᓵᔅᓕᓖᓗᓘᓚᓛᓪᔨᔩᔪᔫᔭ… ᔮᔾᕕᕖᕗ–—“”‘’ᕘᕙᕚᕝᕆᕇᕈᕉᕋᕌᕐᕿᖀᖁᖂᖃᖄᖅᖏᖐᖑᖒᖓᖔᖕᙱᙲᙳᙴᙵᙶᖖᖠᖡᖢᖣᖤᖥᖦᕼŁł","x-mac-ce":"ÄĀāÉĄÖÜáąČäčĆćéŹźĎíďĒēĖóėôöõúĚěü†°Ę£§•¶ß®©™ę¨≠ģĮįĪ≤≥īĶ∂∑łĻļĽľĹĺŅņŃ¬√ńŇ∆«»… ňŐÕőŌ–—“”‘’÷◊ōŔŕŘ‹›řŖŗŠ‚„šŚśÁŤťÍŽžŪÓÔūŮÚůŰűŲųÝýķŻŁżĢˇ",macintosh:"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›ﬁﬂ‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-romanian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ĂȘ∞±≤≥¥µ∂∑∏π∫ªºΩăș¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›Țț‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-turkish":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸĞğİıŞş‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙˆ˜¯˘˙˚¸˝˛ˇ"};ue.MACSTRING=function(e,t,r,a){var n=de[a];if(void 0!==n){for(var s="",i=0;i<r;i++){var o=e.getUint8(t+i);s+=o<=127?String.fromCharCode(o):n[127&o]}return s}};var ge,ve="function"==typeof WeakMap&&new WeakMap;function me(e){return e>=-128&&e<=127}function ye(e,t,r){for(var a=0,n=e.length;t<n&&a<64&&0===e[t];)++t,++a;return r.push(128|a-1),t}function be(e,t,r){for(var a=0,n=e.length,s=t;s<n&&a<64;){var i=e[s];if(!me(i))break;if(0===i&&s+1<n&&0===e[s+1])break;++s,++a}r.push(a-1);for(var o=t;o<s;++o)r.push(e[o]+256&255);return s}function xe(e,t,r){for(var a=0,n=e.length,s=t;s<n&&a<64;){var i=e[s];if(0===i)break;if(me(i)&&s+1<n&&me(e[s+1]))break;++s,++a}r.push(64|a-1);for(var o=t;o<s;++o){var c=e[o];r.push(c+65536>>8&255,c+256&255)}return s}he.MACSTRING=function(e,t){var r=function(e){if(!ge)for(var t in ge={},de)ge[t]=new String(t);var r=ge[e];if(void 0!==r){if(ve){var a=ve.get(r);if(void 0!==a)return a}var n=de[e];if(void 0!==n){for(var s={},i=0;i<n.length;i++)s[n.charCodeAt(i)]=i+128;return ve&&ve.set(r,s),s}}}(t);if(void 0!==r){for(var a=[],n=0;n<e.length;n++){var s=e.charCodeAt(n);if(s>=128&&void 0===(s=r[s]))return;a[n]=s}return a}},pe.MACSTRING=function(e,t){var r=he.MACSTRING(e,t);return void 0!==r?r.length:0},he.VARDELTAS=function(e){for(var t=0,r=[];t<e.length;){var a=e[t];t=0===a?ye(e,t,r):a>=-128&&a<=127?be(e,t,r):xe(e,t,r)}return r},he.INDEX=function(e){for(var t=1,r=[t],a=[],n=0;n<e.length;n+=1){var s=he.OBJECT(e[n]);Array.prototype.push.apply(a,s),t+=s.length,r.push(t)}if(0===a.length)return[0,0];for(var i=[],o=1+Math.floor(Math.log(t)/Math.log(2))/8|0,c=[void 0,he.BYTE,he.USHORT,he.UINT24,he.ULONG][o],l=0;l<r.length;l+=1){var u=c(r[l]);Array.prototype.push.apply(i,u)}return Array.prototype.concat(he.Card16(e.length),he.OffSize(o),i,a)},pe.INDEX=function(e){return he.INDEX(e).length},he.DICT=function(e){for(var t=[],r=Object.keys(e),a=r.length,n=0;n<a;n+=1){var s=parseInt(r[n],0),i=e[s];t=(t=t.concat(he.OPERAND(i.value,i.type))).concat(he.OPERATOR(s))}return t},pe.DICT=function(e){return he.DICT(e).length},he.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]},he.OPERAND=function(e,t){var r=[];if(Array.isArray(t))for(var a=0;a<t.length;a+=1)le.argument(e.length===t.length,"Not enough arguments given for type"+t),r=r.concat(he.OPERAND(e[a],t[a]));else if("SID"===t)r=r.concat(he.NUMBER(e));else if("offset"===t)r=r.concat(he.NUMBER32(e));else if("number"===t)r=r.concat(he.NUMBER(e));else{if("real"!==t)throw new Error("Unknown operand type "+t);r=r.concat(he.REAL(e))}return r},he.OP=he.BYTE,pe.OP=pe.BYTE;var we="function"==typeof WeakMap&&new WeakMap;function Se(e,t,r){for(var a=0;a<t.length;a+=1){var n=t[a];this[n.name]=n.value}if(this.tableName=e,this.fields=t,r)for(var s=Object.keys(r),i=0;i<s.length;i+=1){var o=s[i],c=r[o];void 0!==this[o]&&(this[o]=c)}}function Te(e,t,r){void 0===r&&(r=t.length);var a=new Array(t.length+1);a[0]={name:e+"Count",type:"USHORT",value:r};for(var n=0;n<t.length;n++)a[n+1]={name:e+n,type:"USHORT",value:t[n]};return a}function Fe(e,t,r){var a=t.length,n=new Array(a+1);n[0]={name:e+"Count",type:"USHORT",value:a};for(var s=0;s<a;s++)n[s+1]={name:e+s,type:"TABLE",value:r(t[s],s)};return n}function ke(e,t,r){var a=t.length,n=[];n[0]={name:e+"Count",type:"USHORT",value:a};for(var s=0;s<a;s++)n=n.concat(r(t[s],s));return n}function Ee(e){1===e.format?Se.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(Te("glyph",e.glyphs))):le.assert(!1,"Can't create coverage table format 2 yet.")}function Ae(e){Se.call(this,"scriptListTable",ke("scriptRecord",e,(function(e,t){var r=e.script,a=r.defaultLangSys;return le.assert(!!a,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+t,type:"TAG",value:e.tag},{name:"script"+t,type:"TABLE",value:new Se("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Se("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:a.reqFeatureIndex}].concat(Te("featureIndex",a.featureIndexes)))}].concat(ke("langSys",r.langSysRecords,(function(e,t){var r=e.langSys;return[{name:"langSysTag"+t,type:"TAG",value:e.tag},{name:"langSys"+t,type:"TABLE",value:new Se("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:r.reqFeatureIndex}].concat(Te("featureIndex",r.featureIndexes)))}]}))))}]})))}function Ie(e){Se.call(this,"featureListTable",ke("featureRecord",e,(function(e,t){var r=e.feature;return[{name:"featureTag"+t,type:"TAG",value:e.tag},{name:"feature"+t,type:"TABLE",value:new Se("featureTable",[{name:"featureParams",type:"USHORT",value:r.featureParams}].concat(Te("lookupListIndex",r.lookupListIndexes)))}]})))}function Me(e,t){Se.call(this,"lookupListTable",Fe("lookup",e,(function(e){var r=t[e.lookupType];return le.assert(!!r,"Unable to write GSUB lookup type "+e.lookupType+" tables."),new Se("lookupTable",[{name:"lookupType",type:"USHORT",value:e.lookupType},{name:"lookupFlag",type:"USHORT",value:e.lookupFlag}].concat(Fe("subtable",e.subtables,r)))})))}he.CHARSTRING=function(e){if(we){var t=we.get(e);if(void 0!==t)return t}for(var r=[],a=e.length,n=0;n<a;n+=1){var s=e[n];r=r.concat(he[s.type](s.value))}return we&&we.set(e,r),r},pe.CHARSTRING=function(e){return he.CHARSTRING(e).length},he.OBJECT=function(e){var t=he[e.type];return le.argument(void 0!==t,"No encoding function for type "+e.type),t(e.value)},pe.OBJECT=function(e){var t=pe[e.type];return le.argument(void 0!==t,"No sizeOf function for type "+e.type),t(e.value)},he.TABLE=function(e){for(var t=[],r=e.fields.length,a=[],n=[],s=0;s<r;s+=1){var i=e.fields[s],o=he[i.type];le.argument(void 0!==o,"No encoding function for field type "+i.type+" ("+i.name+")");var c=e[i.name];void 0===c&&(c=i.value);var l=o(c);"TABLE"===i.type?(n.push(t.length),t=t.concat([0,0]),a.push(l)):t=t.concat(l)}for(var u=0;u<a.length;u+=1){var h=n[u],p=t.length;le.argument(p<65536,"Table "+e.tableName+" too big."),t[h]=p>>8,t[h+1]=255&p,t=t.concat(a[u])}return t},pe.TABLE=function(e){for(var t=0,r=e.fields.length,a=0;a<r;a+=1){var n=e.fields[a],s=pe[n.type];le.argument(void 0!==s,"No sizeOf function for field type "+n.type+" ("+n.name+")");var i=e[n.name];void 0===i&&(i=n.value),t+=s(i),"TABLE"===n.type&&(t+=2)}return t},he.RECORD=he.TABLE,pe.RECORD=pe.TABLE,he.LITERAL=function(e){return e},pe.LITERAL=function(e){return e.length},Se.prototype.encode=function(){return he.TABLE(this)},Se.prototype.sizeOf=function(){return pe.TABLE(this)},Ee.prototype=Object.create(Se.prototype),Ee.prototype.constructor=Ee,Ae.prototype=Object.create(Se.prototype),Ae.prototype.constructor=Ae,Ie.prototype=Object.create(Se.prototype),Ie.prototype.constructor=Ie,Me.prototype=Object.create(Se.prototype),Me.prototype.constructor=Me;var Le={Table:Se,Record:Se,Coverage:Ee,ScriptList:Ae,FeatureList:Ie,LookupList:Me,ushortList:Te,tableList:Fe,recordList:ke};function Ce(e,t){return e.getUint8(t)}function Oe(e,t){return e.getUint16(t,!1)}function Re(e,t){return e.getUint32(t,!1)}function Ue(e,t){return e.getInt16(t,!1)+e.getUint16(t+2,!1)/65535}var Ne={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function De(e,t){this.data=e,this.offset=t,this.relativeOffset=0}De.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},De.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},De.prototype.parseCard8=De.prototype.parseByte,De.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},De.prototype.parseCard16=De.prototype.parseUShort,De.prototype.parseSID=De.prototype.parseUShort,De.prototype.parseOffset16=De.prototype.parseUShort,De.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},De.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e},De.prototype.parseULong=function(){var e=Re(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},De.prototype.parseOffset32=De.prototype.parseULong,De.prototype.parseFixed=function(){var e=Ue(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},De.prototype.parseString=function(e){var t=this.data,r=this.offset+this.relativeOffset,a="";this.relativeOffset+=e;for(var n=0;n<e;n++)a+=String.fromCharCode(t.getUint8(r+n));return a},De.prototype.parseTag=function(){return this.parseString(4)},De.prototype.parseLongDateTime=function(){var e=Re(this.data,this.offset+this.relativeOffset+4);return e-=2082844800,this.relativeOffset+=8,e},De.prototype.parseVersion=function(e){var t=Oe(this.data,this.offset+this.relativeOffset),r=Oe(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,void 0===e&&(e=4096),t+r/e/10},De.prototype.skip=function(e,t){void 0===t&&(t=1),this.relativeOffset+=Ne[e]*t},De.prototype.parseULongList=function(e){void 0===e&&(e=this.parseULong());for(var t=new Array(e),r=this.data,a=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=r.getUint32(a),a+=4;return this.relativeOffset+=4*e,t},De.prototype.parseOffset16List=De.prototype.parseUShortList=function(e){void 0===e&&(e=this.parseUShort());for(var t=new Array(e),r=this.data,a=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=r.getUint16(a),a+=2;return this.relativeOffset+=2*e,t},De.prototype.parseShortList=function(e){for(var t=new Array(e),r=this.data,a=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=r.getInt16(a),a+=2;return this.relativeOffset+=2*e,t},De.prototype.parseByteList=function(e){for(var t=new Array(e),r=this.data,a=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=r.getUint8(a++);return this.relativeOffset+=e,t},De.prototype.parseList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),a=0;a<e;a++)r[a]=t.call(this);return r},De.prototype.parseList32=function(e,t){t||(t=e,e=this.parseULong());for(var r=new Array(e),a=0;a<e;a++)r[a]=t.call(this);return r},De.prototype.parseRecordList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),a=Object.keys(t),n=0;n<e;n++){for(var s={},i=0;i<a.length;i++){var o=a[i],c=t[o];s[o]=c.call(this)}r[n]=s}return r},De.prototype.parseRecordList32=function(e,t){t||(t=e,e=this.parseULong());for(var r=new Array(e),a=Object.keys(t),n=0;n<e;n++){for(var s={},i=0;i<a.length;i++){var o=a[i],c=t[o];s[o]=c.call(this)}r[n]=s}return r},De.prototype.parseStruct=function(e){if("function"==typeof e)return e.call(this);for(var t=Object.keys(e),r={},a=0;a<t.length;a++){var n=t[a],s=e[n];r[n]=s.call(this)}return r},De.prototype.parseValueRecord=function(e){if(void 0===e&&(e=this.parseUShort()),0!==e){var t={};return 1&e&&(t.xPlacement=this.parseShort()),2&e&&(t.yPlacement=this.parseShort()),4&e&&(t.xAdvance=this.parseShort()),8&e&&(t.yAdvance=this.parseShort()),16&e&&(t.xPlaDevice=void 0,this.parseShort()),32&e&&(t.yPlaDevice=void 0,this.parseShort()),64&e&&(t.xAdvDevice=void 0,this.parseShort()),128&e&&(t.yAdvDevice=void 0,this.parseShort()),t}},De.prototype.parseValueRecordList=function(){for(var e=this.parseUShort(),t=this.parseUShort(),r=new Array(t),a=0;a<t;a++)r[a]=this.parseValueRecord(e);return r},De.prototype.parsePointer=function(e){var t=this.parseOffset16();if(t>0)return new De(this.data,this.offset+t).parseStruct(e)},De.prototype.parsePointer32=function(e){var t=this.parseOffset32();if(t>0)return new De(this.data,this.offset+t).parseStruct(e)},De.prototype.parseListOfLists=function(e){for(var t=this.parseOffset16List(),r=t.length,a=this.relativeOffset,n=new Array(r),s=0;s<r;s++){var i=t[s];if(0!==i)if(this.relativeOffset=i,e){for(var o=this.parseOffset16List(),c=new Array(o.length),l=0;l<o.length;l++)this.relativeOffset=i+o[l],c[l]=e.call(this);n[s]=c}else n[s]=this.parseUShortList();else n[s]=void 0}return this.relativeOffset=a,n},De.prototype.parseCoverage=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort(),r=this.parseUShort();if(1===t)return{format:1,glyphs:this.parseUShortList(r)};if(2===t){for(var a=new Array(r),n=0;n<r;n++)a[n]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:a}}throw new Error("0x"+e.toString(16)+": Coverage format must be 1 or 2.")},De.prototype.parseClassDef=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(2===t)return{format:2,ranges:this.parseRecordList({start:De.uShort,end:De.uShort,classId:De.uShort})};throw new Error("0x"+e.toString(16)+": ClassDef format must be 1 or 2.")},De.list=function(e,t){return function(){return this.parseList(e,t)}},De.list32=function(e,t){return function(){return this.parseList32(e,t)}},De.recordList=function(e,t){return function(){return this.parseRecordList(e,t)}},De.recordList32=function(e,t){return function(){return this.parseRecordList32(e,t)}},De.pointer=function(e){return function(){return this.parsePointer(e)}},De.pointer32=function(e){return function(){return this.parsePointer32(e)}},De.tag=De.prototype.parseTag,De.byte=De.prototype.parseByte,De.uShort=De.offset16=De.prototype.parseUShort,De.uShortList=De.prototype.parseUShortList,De.uLong=De.offset32=De.prototype.parseULong,De.uLongList=De.prototype.parseULongList,De.struct=De.prototype.parseStruct,De.coverage=De.prototype.parseCoverage,De.classDef=De.prototype.parseClassDef;var Pe={reserved:De.uShort,reqFeatureIndex:De.uShort,featureIndexes:De.uShortList};De.prototype.parseScriptList=function(){return this.parsePointer(De.recordList({tag:De.tag,script:De.pointer({defaultLangSys:De.pointer(Pe),langSysRecords:De.recordList({tag:De.tag,langSys:De.pointer(Pe)})})}))||[]},De.prototype.parseFeatureList=function(){return this.parsePointer(De.recordList({tag:De.tag,feature:De.pointer({featureParams:De.offset16,lookupListIndexes:De.uShortList})}))||[]},De.prototype.parseLookupList=function(e){return this.parsePointer(De.list(De.pointer((function(){var t=this.parseUShort();le.argument(1<=t&&t<=9,"GPOS/GSUB lookup type "+t+" unknown.");var r=this.parseUShort(),a=16&r;return{lookupType:t,lookupFlag:r,subtables:this.parseList(De.pointer(e[t])),markFilteringSet:a?this.parseUShort():void 0}}))))||[]},De.prototype.parseFeatureVariationsList=function(){return this.parsePointer32((function(){var e=this.parseUShort(),t=this.parseUShort();return le.argument(1===e&&t<1,"GPOS/GSUB feature variations table unknown."),this.parseRecordList32({conditionSetOffset:De.offset32,featureTableSubstitutionOffset:De.offset32})}))||[]};var Be={getByte:Ce,getCard8:Ce,getUShort:Oe,getCard16:Oe,getShort:function(e,t){return e.getInt16(t,!1)},getULong:Re,getFixed:Ue,getTag:function(e,t){for(var r="",a=t;a<t+4;a+=1)r+=String.fromCharCode(e.getInt8(a));return r},getOffset:function(e,t,r){for(var a=0,n=0;n<r;n+=1)a<<=8,a+=e.getUint8(t+n);return a},getBytes:function(e,t,r){for(var a=[],n=t;n<r;n+=1)a.push(e.getUint8(n));return a},bytesToString:function(e){for(var t="",r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return t},Parser:De};function Ge(e,t,r){e.segments.push({end:t,start:t,delta:-(t-r),offset:0,glyphIndex:r})}var _e={parse:function(e,t){var r={};r.version=Be.getUShort(e,t),le.argument(0===r.version,"cmap table version should be 0."),r.numTables=Be.getUShort(e,t+2);for(var a=-1,n=r.numTables-1;n>=0;n-=1){var s=Be.getUShort(e,t+4+8*n),i=Be.getUShort(e,t+4+8*n+2);if(3===s&&(0===i||1===i||10===i)||0===s&&(0===i||1===i||2===i||3===i||4===i)){a=Be.getULong(e,t+4+8*n+4);break}}if(-1===a)throw new Error("No valid cmap sub-tables found.");var o=new Be.Parser(e,t+a);if(r.format=o.parseUShort(),12===r.format)!function(e,t){var r;t.parseUShort(),e.length=t.parseULong(),e.language=t.parseULong(),e.groupCount=r=t.parseULong(),e.glyphIndexMap={};for(var a=0;a<r;a+=1)for(var n=t.parseULong(),s=t.parseULong(),i=t.parseULong(),o=n;o<=s;o+=1)e.glyphIndexMap[o]=i,i++}(r,o);else{if(4!==r.format)throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");!function(e,t,r,a,n){var s;e.length=t.parseUShort(),e.language=t.parseUShort(),e.segCount=s=t.parseUShort()>>1,t.skip("uShort",3),e.glyphIndexMap={};for(var i=new Be.Parser(r,a+n+14),o=new Be.Parser(r,a+n+16+2*s),c=new Be.Parser(r,a+n+16+4*s),l=new Be.Parser(r,a+n+16+6*s),u=a+n+16+8*s,h=0;h<s-1;h+=1)for(var p=void 0,f=i.parseUShort(),d=o.parseUShort(),g=c.parseShort(),v=l.parseUShort(),m=d;m<=f;m+=1)0!==v?(u=l.offset+l.relativeOffset-2,u+=v,u+=2*(m-d),0!==(p=Be.getUShort(r,u))&&(p=p+g&65535)):p=m+g&65535,e.glyphIndexMap[m]=p}(r,o,e,t,a)}return r},make:function(e){var t,r=!0;for(t=e.length-1;t>0;t-=1){if(e.get(t).unicode>65535){console.log("Adding CMAP format 12 (needed!)"),r=!1;break}}var a=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:r?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:r?12:20}];r||(a=a.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),a=a.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var n=new Le.Table("cmap",a);for(n.segments=[],t=0;t<e.length;t+=1){for(var s=e.get(t),i=0;i<s.unicodes.length;i+=1)Ge(n,s.unicodes[i],t);n.segments=n.segments.sort((function(e,t){return e.start-t.start}))}!function(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}(n);var o=n.segments.length,c=0,l=[],u=[],h=[],p=[],f=[],d=[];for(t=0;t<o;t+=1){var g=n.segments[t];g.end<=65535&&g.start<=65535?(l=l.concat({name:"end_"+t,type:"USHORT",value:g.end}),u=u.concat({name:"start_"+t,type:"USHORT",value:g.start}),h=h.concat({name:"idDelta_"+t,type:"SHORT",value:g.delta}),p=p.concat({name:"idRangeOffset_"+t,type:"USHORT",value:g.offset}),void 0!==g.glyphId&&(f=f.concat({name:"glyph_"+t,type:"USHORT",value:g.glyphId}))):c+=1,r||void 0===g.glyphIndex||(d=(d=(d=d.concat({name:"cmap12Start_"+t,type:"ULONG",value:g.start})).concat({name:"cmap12End_"+t,type:"ULONG",value:g.end})).concat({name:"cmap12Glyph_"+t,type:"ULONG",value:g.glyphIndex}))}if(n.segCountX2=2*(o-c),n.searchRange=2*Math.pow(2,Math.floor(Math.log(o-c)/Math.log(2))),n.entrySelector=Math.log(n.searchRange/2)/Math.log(2),n.rangeShift=n.segCountX2-n.searchRange,n.fields=n.fields.concat(l),n.fields.push({name:"reservedPad",type:"USHORT",value:0}),n.fields=n.fields.concat(u),n.fields=n.fields.concat(h),n.fields=n.fields.concat(p),n.fields=n.fields.concat(f),n.cmap4Length=14+2*l.length+2+2*u.length+2*h.length+2*p.length+2*f.length,!r){var v=16+4*d.length;n.cmap12Offset=20+n.cmap4Length,n.fields=n.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:v},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:d.length/3}]),n.fields=n.fields.concat(d)}return n}},He=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Ve=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],ze=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],je=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function We(e){this.font=e}function Xe(e){this.cmap=e}function qe(e,t){this.encoding=e,this.charset=t}function Ye(e){switch(e.version){case 1:this.names=je.slice();break;case 2:this.names=new Array(e.numberOfGlyphs);for(var t=0;t<e.numberOfGlyphs;t++)e.glyphNameIndex[t]<je.length?this.names[t]=je[e.glyphNameIndex[t]]:this.names[t]=e.names[e.glyphNameIndex[t]-je.length];break;case 2.5:this.names=new Array(e.numberOfGlyphs);for(var r=0;r<e.numberOfGlyphs;r++)this.names[r]=je[r+e.glyphNameIndex[r]];break;case 3:default:this.names=[]}}function Ke(e,t){t.lowMemory?function(e){e._IndexToUnicodeMap={};for(var t=e.tables.cmap.glyphIndexMap,r=Object.keys(t),a=0;a<r.length;a+=1){var n=r[a],s=t[n];void 0===e._IndexToUnicodeMap[s]?e._IndexToUnicodeMap[s]={unicodes:[parseInt(n)]}:e._IndexToUnicodeMap[s].unicodes.push(parseInt(n))}}(e):function(e){for(var t,r=e.tables.cmap.glyphIndexMap,a=Object.keys(r),n=0;n<a.length;n+=1){var s=a[n],i=r[s];(t=e.glyphs.get(i)).addUnicode(parseInt(s))}for(var o=0;o<e.glyphs.length;o+=1)t=e.glyphs.get(o),e.cffEncoding?e.isCIDFont?t.name="gid"+o:t.name=e.cffEncoding.charset[o]:e.glyphNames.names&&(t.name=e.glyphNames.glyphIndexToName(o))}(e)}We.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),r=this.font.glyphs;if(r)for(var a=0;a<r.length;a+=1)for(var n=r.get(a),s=0;s<n.unicodes.length;s+=1)if(n.unicodes[s]===t)return a;return null},Xe.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.codePointAt(0)]||0},qe.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),r=this.encoding[t];return this.charset.indexOf(r)},Ye.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)},Ye.prototype.glyphIndexToName=function(e){return this.names[e]};var Ze={line:function(e,t,r,a,n){e.beginPath(),e.moveTo(t,r),e.lineTo(a,n),e.stroke()}};function Qe(e){this.bindConstructorValues(e)}function $e(e,t,r){Object.defineProperty(e,t,{get:function(){return e.path,e[r]},set:function(t){e[r]=t},enumerable:!0,configurable:!0})}function Je(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var r=0;r<t.length;r++){var a=t[r];a.path.unitsPerEm=e.unitsPerEm,this.glyphs[r]=a}this.length=t&&t.length||0}Qe.prototype.bindConstructorValues=function(e){var t,r;this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||void 0!==e.unicode?[e.unicode]:[],"xMin"in e&&(this.xMin=e.xMin),"yMin"in e&&(this.yMin=e.yMin),"xMax"in e&&(this.xMax=e.xMax),"yMax"in e&&(this.yMax=e.yMax),"advanceWidth"in e&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",(t=e.path,r=t||new ie,{configurable:!0,get:function(){return"function"==typeof r&&(r=r()),r},set:function(e){r=e}}))},Qe.prototype.addUnicode=function(e){0===this.unicodes.length&&(this.unicode=e),this.unicodes.push(e)},Qe.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},Qe.prototype.getPath=function(e,t,r,a,n){var s,i;e=void 0!==e?e:0,t=void 0!==t?t:0,r=void 0!==r?r:72,a||(a={});var o=a.xScale,c=a.yScale;if(a.hinting&&n&&n.hinting&&(i=this.path&&n.hinting.exec(this,r)),i)s=n.hinting.getCommands(i),e=Math.round(e),t=Math.round(t),o=c=1;else{s=this.path.commands;var l=1/(this.path.unitsPerEm||1e3)*r;void 0===o&&(o=l),void 0===c&&(c=l)}for(var u=new ie,h=0;h<s.length;h+=1){var p=s[h];"M"===p.type?u.moveTo(e+p.x*o,t+-p.y*c):"L"===p.type?u.lineTo(e+p.x*o,t+-p.y*c):"Q"===p.type?u.quadraticCurveTo(e+p.x1*o,t+-p.y1*c,e+p.x*o,t+-p.y*c):"C"===p.type?u.curveTo(e+p.x1*o,t+-p.y1*c,e+p.x2*o,t+-p.y2*c,e+p.x*o,t+-p.y*c):"Z"===p.type&&u.closePath()}return u},Qe.prototype.getContours=function(){if(void 0===this.points)return[];for(var e=[],t=[],r=0;r<this.points.length;r+=1){var a=this.points[r];t.push(a),a.lastPointOfContour&&(e.push(t),t=[])}return le.argument(0===t.length,"There are still points left in the current contour."),e},Qe.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],r=[],a=0;a<e.length;a+=1){var n=e[a];"Z"!==n.type&&(t.push(n.x),r.push(n.y)),"Q"!==n.type&&"C"!==n.type||(t.push(n.x1),r.push(n.y1)),"C"===n.type&&(t.push(n.x2),r.push(n.y2))}var s={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(s.xMin)||(s.xMin=0),isFinite(s.xMax)||(s.xMax=this.advanceWidth),isFinite(s.yMin)||(s.yMin=0),isFinite(s.yMax)||(s.yMax=0),s.rightSideBearing=this.advanceWidth-s.leftSideBearing-(s.xMax-s.xMin),s},Qe.prototype.draw=function(e,t,r,a,n){this.getPath(t,r,a,n).draw(e)},Qe.prototype.drawPoints=function(e,t,r,a){function n(t,r,a,n){e.beginPath();for(var s=0;s<t.length;s+=1)e.moveTo(r+t[s].x*n,a+t[s].y*n),e.arc(r+t[s].x*n,a+t[s].y*n,2,0,2*Math.PI,!1);e.closePath(),e.fill()}t=void 0!==t?t:0,r=void 0!==r?r:0,a=void 0!==a?a:24;for(var s=1/this.path.unitsPerEm*a,i=[],o=[],c=this.path,l=0;l<c.commands.length;l+=1){var u=c.commands[l];void 0!==u.x&&i.push({x:u.x,y:-u.y}),void 0!==u.x1&&o.push({x:u.x1,y:-u.y1}),void 0!==u.x2&&o.push({x:u.x2,y:-u.y2})}e.fillStyle="blue",n(i,t,r,s),e.fillStyle="red",n(o,t,r,s)},Qe.prototype.drawMetrics=function(e,t,r,a){var n;t=void 0!==t?t:0,r=void 0!==r?r:0,a=void 0!==a?a:24,n=1/this.path.unitsPerEm*a,e.lineWidth=1,e.strokeStyle="black",Ze.line(e,t,-1e4,t,1e4),Ze.line(e,-1e4,r,1e4,r);var s=this.xMin||0,i=this.yMin||0,o=this.xMax||0,c=this.yMax||0,l=this.advanceWidth||0;e.strokeStyle="blue",Ze.line(e,t+s*n,-1e4,t+s*n,1e4),Ze.line(e,t+o*n,-1e4,t+o*n,1e4),Ze.line(e,-1e4,r+-i*n,1e4,r+-i*n),Ze.line(e,-1e4,r+-c*n,1e4,r+-c*n),e.strokeStyle="green",Ze.line(e,t+l*n,-1e4,t+l*n,1e4)},Je.prototype.get=function(e){if(void 0===this.glyphs[e]){this.font._push(e),"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());var t=this.glyphs[e],r=this.font._IndexToUnicodeMap[e];if(r)for(var a=0;a<r.unicodes.length;a++)t.addUnicode(r.unicodes[a]);this.font.cffEncoding?this.font.isCIDFont?t.name="gid"+e:t.name=this.font.cffEncoding.charset[e]:this.font.glyphNames.names&&(t.name=this.font.glyphNames.glyphIndexToName(e)),this.glyphs[e].advanceWidth=this.font._hmtxTableData[e].advanceWidth,this.glyphs[e].leftSideBearing=this.font._hmtxTableData[e].leftSideBearing}else"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());return this.glyphs[e]},Je.prototype.push=function(e,t){this.glyphs[e]=t,this.length++};var et={GlyphSet:Je,glyphLoader:function(e,t){return new Qe({index:t,font:e})},ttfGlyphLoader:function(e,t,r,a,n,s){return function(){var i=new Qe({index:t,font:e});return i.path=function(){r(i,a,n);var t=s(e.glyphs,i);return t.unitsPerEm=e.unitsPerEm,t},$e(i,"xMin","_xMin"),$e(i,"xMax","_xMax"),$e(i,"yMin","_yMin"),$e(i,"yMax","_yMax"),i}},cffGlyphLoader:function(e,t,r,a){return function(){var n=new Qe({index:t,font:e});return n.path=function(){var t=r(e,n,a);return t.unitsPerEm=e.unitsPerEm,t},n}}};function tt(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r+=1)if(!tt(e[r],t[r]))return!1;return!0}return!1}function rt(e){return e.length<1240?107:e.length<33900?1131:32768}function at(e,t,r){var a,n,s=[],i=[],o=Be.getCard16(e,t);if(0!==o){var c=Be.getByte(e,t+2);a=t+(o+1)*c+2;for(var l=t+3,u=0;u<o+1;u+=1)s.push(Be.getOffset(e,l,c)),l+=c;n=a+s[o]}else n=t+2;for(var h=0;h<s.length-1;h+=1){var p=Be.getBytes(e,a+s[h],a+s[h+1]);r&&(p=r(p)),i.push(p)}return{objects:i,startOffset:t,endOffset:n}}function nt(e,t){if(28===t)return e.parseByte()<<8|e.parseByte();if(29===t)return e.parseByte()<<24|e.parseByte()<<16|e.parseByte()<<8|e.parseByte();if(30===t)return function(e){for(var t="",r=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var a=e.parseByte(),n=a>>4,s=15&a;if(15===n)break;if(t+=r[n],15===s)break;t+=r[s]}return parseFloat(t)}(e);if(t>=32&&t<=246)return t-139;if(t>=247&&t<=250)return 256*(t-247)+e.parseByte()+108;if(t>=251&&t<=254)return 256*-(t-251)-e.parseByte()-108;throw new Error("Invalid b0 "+t)}function st(e,t,r){t=void 0!==t?t:0;var a=new Be.Parser(e,t),n=[],s=[];for(r=void 0!==r?r:e.length;a.relativeOffset<r;){var i=a.parseByte();i<=21?(12===i&&(i=1200+a.parseByte()),n.push([i,s]),s=[]):s.push(nt(a,i))}return function(e){for(var t={},r=0;r<e.length;r+=1){var a=e[r][0],n=e[r][1],s=void 0;if(s=1===n.length?n[0]:n,t.hasOwnProperty(a)&&!isNaN(t[a]))throw new Error("Object "+t+" already has key "+a);t[a]=s}return t}(n)}function it(e,t){return t=t<=390?He[t]:e[t-391]}function ot(e,t,r){for(var a,n={},s=0;s<t.length;s+=1){var i=t[s];if(Array.isArray(i.type)){var o=[];o.length=i.type.length;for(var c=0;c<i.type.length;c++)void 0===(a=void 0!==e[i.op]?e[i.op][c]:void 0)&&(a=void 0!==i.value&&void 0!==i.value[c]?i.value[c]:null),"SID"===i.type[c]&&(a=it(r,a)),o[c]=a;n[i.name]=o}else void 0===(a=e[i.op])&&(a=void 0!==i.value?i.value:null),"SID"===i.type&&(a=it(r,a)),n[i.name]=a}return n}var ct=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],lt=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function ut(e,t){return ot(st(e,0,e.byteLength),ct,t)}function ht(e,t,r,a){return ot(st(e,t,r),lt,a)}function pt(e,t,r,a){for(var n=[],s=0;s<r.length;s+=1){var i=ut(new DataView(new Uint8Array(r[s]).buffer),a);i._subrs=[],i._subrsBias=0;var o=i.private[0],c=i.private[1];if(0!==o&&0!==c){var l=ht(e,c+t,o,a);if(i._defaultWidthX=l.defaultWidthX,i._nominalWidthX=l.nominalWidthX,0!==l.subrs){var u=at(e,c+l.subrs+t);i._subrs=u.objects,i._subrsBias=rt(i._subrs)}i._privateDict=l}n.push(i)}return n}function ft(e,t,r){var a,n,s,i,o,c,l,u,h=new ie,p=[],f=0,d=!1,g=!1,v=0,m=0;if(e.isCIDFont){var y=e.tables.cff.topDict._fdSelect[t.index],b=e.tables.cff.topDict._fdArray[y];o=b._subrs,c=b._subrsBias,l=b._defaultWidthX,u=b._nominalWidthX}else o=e.tables.cff.topDict._subrs,c=e.tables.cff.topDict._subrsBias,l=e.tables.cff.topDict._defaultWidthX,u=e.tables.cff.topDict._nominalWidthX;var x=l;function w(e,t){g&&h.closePath(),h.moveTo(e,t),g=!0}function S(){p.length%2!=0&&!d&&(x=p.shift()+u),f+=p.length>>1,p.length=0,d=!0}return function r(l){for(var y,b,T,F,k,E,A,I,M,L,C,O,R=0;R<l.length;){var U=l[R];switch(R+=1,U){case 1:case 3:S();break;case 4:p.length>1&&!d&&(x=p.shift()+u,d=!0),m+=p.pop(),w(v,m);break;case 5:for(;p.length>0;)v+=p.shift(),m+=p.shift(),h.lineTo(v,m);break;case 6:for(;p.length>0&&(v+=p.shift(),h.lineTo(v,m),0!==p.length);)m+=p.shift(),h.lineTo(v,m);break;case 7:for(;p.length>0&&(m+=p.shift(),h.lineTo(v,m),0!==p.length);)v+=p.shift(),h.lineTo(v,m);break;case 8:for(;p.length>0;)a=v+p.shift(),n=m+p.shift(),s=a+p.shift(),i=n+p.shift(),v=s+p.shift(),m=i+p.shift(),h.curveTo(a,n,s,i,v,m);break;case 10:k=p.pop()+c,(E=o[k])&&r(E);break;case 11:return;case 12:switch(U=l[R],R+=1,U){case 35:a=v+p.shift(),n=m+p.shift(),s=a+p.shift(),i=n+p.shift(),A=s+p.shift(),I=i+p.shift(),M=A+p.shift(),L=I+p.shift(),C=M+p.shift(),O=L+p.shift(),v=C+p.shift(),m=O+p.shift(),p.shift(),h.curveTo(a,n,s,i,A,I),h.curveTo(M,L,C,O,v,m);break;case 34:a=v+p.shift(),n=m,s=a+p.shift(),i=n+p.shift(),A=s+p.shift(),I=i,M=A+p.shift(),L=i,C=M+p.shift(),O=m,v=C+p.shift(),h.curveTo(a,n,s,i,A,I),h.curveTo(M,L,C,O,v,m);break;case 36:a=v+p.shift(),n=m+p.shift(),s=a+p.shift(),i=n+p.shift(),A=s+p.shift(),I=i,M=A+p.shift(),L=i,C=M+p.shift(),O=L+p.shift(),v=C+p.shift(),h.curveTo(a,n,s,i,A,I),h.curveTo(M,L,C,O,v,m);break;case 37:a=v+p.shift(),n=m+p.shift(),s=a+p.shift(),i=n+p.shift(),A=s+p.shift(),I=i+p.shift(),M=A+p.shift(),L=I+p.shift(),C=M+p.shift(),O=L+p.shift(),Math.abs(C-v)>Math.abs(O-m)?v=C+p.shift():m=O+p.shift(),h.curveTo(a,n,s,i,A,I),h.curveTo(M,L,C,O,v,m);break;default:console.log("Glyph "+t.index+": unknown operator 1200"+U),p.length=0}break;case 14:p.length>0&&!d&&(x=p.shift()+u,d=!0),g&&(h.closePath(),g=!1);break;case 18:S();break;case 19:case 20:S(),R+=f+7>>3;break;case 21:p.length>2&&!d&&(x=p.shift()+u,d=!0),m+=p.pop(),w(v+=p.pop(),m);break;case 22:p.length>1&&!d&&(x=p.shift()+u,d=!0),w(v+=p.pop(),m);break;case 23:S();break;case 24:for(;p.length>2;)a=v+p.shift(),n=m+p.shift(),s=a+p.shift(),i=n+p.shift(),v=s+p.shift(),m=i+p.shift(),h.curveTo(a,n,s,i,v,m);v+=p.shift(),m+=p.shift(),h.lineTo(v,m);break;case 25:for(;p.length>6;)v+=p.shift(),m+=p.shift(),h.lineTo(v,m);a=v+p.shift(),n=m+p.shift(),s=a+p.shift(),i=n+p.shift(),v=s+p.shift(),m=i+p.shift(),h.curveTo(a,n,s,i,v,m);break;case 26:for(p.length%2&&(v+=p.shift());p.length>0;)a=v,n=m+p.shift(),s=a+p.shift(),i=n+p.shift(),v=s,m=i+p.shift(),h.curveTo(a,n,s,i,v,m);break;case 27:for(p.length%2&&(m+=p.shift());p.length>0;)a=v+p.shift(),n=m,s=a+p.shift(),i=n+p.shift(),v=s+p.shift(),m=i,h.curveTo(a,n,s,i,v,m);break;case 28:y=l[R],b=l[R+1],p.push((y<<24|b<<16)>>16),R+=2;break;case 29:k=p.pop()+e.gsubrsBias,(E=e.gsubrs[k])&&r(E);break;case 30:for(;p.length>0&&(a=v,n=m+p.shift(),s=a+p.shift(),i=n+p.shift(),v=s+p.shift(),m=i+(1===p.length?p.shift():0),h.curveTo(a,n,s,i,v,m),0!==p.length);)a=v+p.shift(),n=m,s=a+p.shift(),i=n+p.shift(),m=i+p.shift(),v=s+(1===p.length?p.shift():0),h.curveTo(a,n,s,i,v,m);break;case 31:for(;p.length>0&&(a=v+p.shift(),n=m,s=a+p.shift(),i=n+p.shift(),m=i+p.shift(),v=s+(1===p.length?p.shift():0),h.curveTo(a,n,s,i,v,m),0!==p.length);)a=v,n=m+p.shift(),s=a+p.shift(),i=n+p.shift(),v=s+p.shift(),m=i+(1===p.length?p.shift():0),h.curveTo(a,n,s,i,v,m);break;default:U<32?console.log("Glyph "+t.index+": unknown operator "+U):U<247?p.push(U-139):U<251?(y=l[R],R+=1,p.push(256*(U-247)+y+108)):U<255?(y=l[R],R+=1,p.push(256*-(U-251)-y-108)):(y=l[R],b=l[R+1],T=l[R+2],F=l[R+3],R+=4,p.push((y<<24|b<<16|T<<8|F)/65536))}}}(r),t.advanceWidth=x,h}function dt(e,t){var r,a=He.indexOf(e);return a>=0&&(r=a),(a=t.indexOf(e))>=0?r=a+He.length:(r=He.length+t.length,t.push(e)),r}function gt(e,t,r){for(var a={},n=0;n<e.length;n+=1){var s=e[n],i=t[s.name];void 0===i||tt(i,s.value)||("SID"===s.type&&(i=dt(i,r)),a[s.op]={name:s.name,type:s.type,value:i})}return a}function vt(e,t){var r=new Le.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=gt(ct,e,t),r}function mt(e){var t=new Le.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function yt(e){var t=[],r=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var a=0,n=0,s=0;s<r.commands.length;s+=1){var i=void 0,o=void 0,c=r.commands[s];if("Q"===c.type){var l=1/3,u=2/3;c={type:"C",x:c.x,y:c.y,x1:l*a+u*c.x1,y1:l*n+u*c.y1,x2:l*c.x+u*c.x1,y2:l*c.y+u*c.y1}}if("M"===c.type)i=Math.round(c.x-a),o=Math.round(c.y-n),t.push({name:"dx",type:"NUMBER",value:i}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rmoveto",type:"OP",value:21}),a=Math.round(c.x),n=Math.round(c.y);else if("L"===c.type)i=Math.round(c.x-a),o=Math.round(c.y-n),t.push({name:"dx",type:"NUMBER",value:i}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rlineto",type:"OP",value:5}),a=Math.round(c.x),n=Math.round(c.y);else if("C"===c.type){var h=Math.round(c.x1-a),p=Math.round(c.y1-n),f=Math.round(c.x2-c.x1),d=Math.round(c.y2-c.y1);i=Math.round(c.x-c.x2),o=Math.round(c.y-c.y2),t.push({name:"dx1",type:"NUMBER",value:h}),t.push({name:"dy1",type:"NUMBER",value:p}),t.push({name:"dx2",type:"NUMBER",value:f}),t.push({name:"dy2",type:"NUMBER",value:d}),t.push({name:"dx",type:"NUMBER",value:i}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rrcurveto",type:"OP",value:8}),a=Math.round(c.x),n=Math.round(c.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}var bt={parse:function(e,t,r,a){r.tables.cff={};var n=function(e,t){var r={};return r.formatMajor=Be.getCard8(e,t),r.formatMinor=Be.getCard8(e,t+1),r.size=Be.getCard8(e,t+2),r.offsetSize=Be.getCard8(e,t+3),r.startOffset=t,r.endOffset=t+4,r}(e,t),s=at(e,n.endOffset,Be.bytesToString),i=at(e,s.endOffset),o=at(e,i.endOffset,Be.bytesToString),c=at(e,o.endOffset);r.gsubrs=c.objects,r.gsubrsBias=rt(r.gsubrs);var l=pt(e,t,i.objects,o.objects);if(1!==l.length)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+l.length);var u=l[0];if(r.tables.cff.topDict=u,u._privateDict&&(r.defaultWidthX=u._privateDict.defaultWidthX,r.nominalWidthX=u._privateDict.nominalWidthX),void 0!==u.ros[0]&&void 0!==u.ros[1]&&(r.isCIDFont=!0),r.isCIDFont){var h=u.fdArray,p=u.fdSelect;if(0===h||0===p)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");var f=at(e,h+=t),d=pt(e,t,f.objects,o.objects);u._fdArray=d,p+=t,u._fdSelect=function(e,t,r,a){var n,s=[],i=new Be.Parser(e,t),o=i.parseCard8();if(0===o)for(var c=0;c<r;c++){if((n=i.parseCard8())>=a)throw new Error("CFF table CID Font FDSelect has bad FD index value "+n+" (FD count "+a+")");s.push(n)}else{if(3!==o)throw new Error("CFF Table CID Font FDSelect table has unsupported format "+o);var l,u=i.parseCard16(),h=i.parseCard16();if(0!==h)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+h);for(var p=0;p<u;p++){if(n=i.parseCard8(),l=i.parseCard16(),n>=a)throw new Error("CFF table CID Font FDSelect has bad FD index value "+n+" (FD count "+a+")");if(l>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+l);for(;h<l;h++)s.push(n);h=l}if(l!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+l)}return s}(e,p,r.numGlyphs,d.length)}var g,v=t+u.private[1],m=ht(e,v,u.private[0],o.objects);if(r.defaultWidthX=m.defaultWidthX,r.nominalWidthX=m.nominalWidthX,0!==m.subrs){var y=v+m.subrs,b=at(e,y);r.subrs=b.objects,r.subrsBias=rt(r.subrs)}else r.subrs=[],r.subrsBias=0;a.lowMemory?(g=function(e,t){var r,a,n=[],s=Be.getCard16(e,t);if(0!==s){var i=Be.getByte(e,t+2);r=t+(s+1)*i+2;for(var o=t+3,c=0;c<s+1;c+=1)n.push(Be.getOffset(e,o,i)),o+=i;a=r+n[s]}else a=t+2;return{offsets:n,startOffset:t,endOffset:a}}(e,t+u.charStrings),r.nGlyphs=g.offsets.length):(g=at(e,t+u.charStrings),r.nGlyphs=g.objects.length);var x=function(e,t,r,a){var n,s,i=new Be.Parser(e,t);r-=1;var o=[".notdef"],c=i.parseCard8();if(0===c)for(var l=0;l<r;l+=1)n=i.parseSID(),o.push(it(a,n));else if(1===c)for(;o.length<=r;){n=i.parseSID(),s=i.parseCard8();for(var u=0;u<=s;u+=1)o.push(it(a,n)),n+=1}else{if(2!==c)throw new Error("Unknown charset format "+c);for(;o.length<=r;){n=i.parseSID(),s=i.parseCard16();for(var h=0;h<=s;h+=1)o.push(it(a,n)),n+=1}}return o}(e,t+u.charset,r.nGlyphs,o.objects);if(0===u.encoding?r.cffEncoding=new qe(Ve,x):1===u.encoding?r.cffEncoding=new qe(ze,x):r.cffEncoding=function(e,t,r){var a,n={},s=new Be.Parser(e,t),i=s.parseCard8();if(0===i)for(var o=s.parseCard8(),c=0;c<o;c+=1)n[a=s.parseCard8()]=c;else{if(1!==i)throw new Error("Unknown encoding format "+i);var l=s.parseCard8();a=1;for(var u=0;u<l;u+=1)for(var h=s.parseCard8(),p=s.parseCard8(),f=h;f<=h+p;f+=1)n[f]=a,a+=1}return new qe(n,r)}(e,t+u.encoding,x),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new et.GlyphSet(r),a.lowMemory)r._push=function(a){var n=function(e,t,r,a,n){var s=Be.getCard16(r,a),i=0;0!==s&&(i=a+(s+1)*Be.getByte(r,a+2)+2);var o=Be.getBytes(r,i+t[e],i+t[e+1]);return n&&(o=n(o)),o}(a,g.offsets,e,t+u.charStrings);r.glyphs.push(a,et.cffGlyphLoader(r,a,ft,n))};else for(var w=0;w<r.nGlyphs;w+=1){var S=g.objects[w];r.glyphs.push(w,et.cffGlyphLoader(r,w,ft,S))}},make:function(e,t){for(var r,a=new Le.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/t.unitsPerEm,s={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontBBox:t.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},i=[],o=1;o<e.length;o+=1)r=e.get(o),i.push(r.name);var c=[];a.header=new Le.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}]),a.nameIndex=function(e){var t=new Le.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var r=0;r<e.length;r+=1)t.names.push({name:"name_"+r,type:"NAME",value:e[r]});return t}([t.postScriptName]);var l=vt(s,c);a.topDictIndex=mt(l),a.globalSubrIndex=new Le.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}]),a.charsets=function(e,t){for(var r=new Le.Record("Charsets",[{name:"format",type:"Card8",value:0}]),a=0;a<e.length;a+=1){var n=dt(e[a],t);r.fields.push({name:"glyph_"+a,type:"SID",value:n})}return r}(i,c),a.charStringsIndex=function(e){for(var t=new Le.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<e.length;r+=1){var a=e.get(r),n=yt(a);t.charStrings.push({name:a.name,type:"CHARSTRING",value:n})}return t}(e),a.privateDict=function(e,t){var r=new Le.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=gt(lt,e,t),r}({},c),a.stringIndex=function(e){var t=new Le.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var r=0;r<e.length;r+=1)t.strings.push({name:"string_"+r,type:"STRING",value:e[r]});return t}(c);var u=a.header.sizeOf()+a.nameIndex.sizeOf()+a.topDictIndex.sizeOf()+a.stringIndex.sizeOf()+a.globalSubrIndex.sizeOf();return s.charset=u,s.encoding=0,s.charStrings=s.charset+a.charsets.sizeOf(),s.private[1]=s.charStrings+a.charStringsIndex.sizeOf(),l=vt(s,c),a.topDictIndex=mt(l),a}};var xt={parse:function(e,t){var r={},a=new Be.Parser(e,t);return r.version=a.parseVersion(),r.fontRevision=Math.round(1e3*a.parseFixed())/1e3,r.checkSumAdjustment=a.parseULong(),r.magicNumber=a.parseULong(),le.argument(1594834165===r.magicNumber,"Font header has wrong magic number."),r.flags=a.parseUShort(),r.unitsPerEm=a.parseUShort(),r.created=a.parseLongDateTime(),r.modified=a.parseLongDateTime(),r.xMin=a.parseShort(),r.yMin=a.parseShort(),r.xMax=a.parseShort(),r.yMax=a.parseShort(),r.macStyle=a.parseUShort(),r.lowestRecPPEM=a.parseUShort(),r.fontDirectionHint=a.parseShort(),r.indexToLocFormat=a.parseShort(),r.glyphDataFormat=a.parseShort(),r},make:function(e){var t=Math.round((new Date).getTime()/1e3)+2082844800,r=t;return e.createdTimestamp&&(r=e.createdTimestamp+2082844800),new Le.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:t},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}};var wt={parse:function(e,t){var r={},a=new Be.Parser(e,t);return r.version=a.parseVersion(),r.ascender=a.parseShort(),r.descender=a.parseShort(),r.lineGap=a.parseShort(),r.advanceWidthMax=a.parseUShort(),r.minLeftSideBearing=a.parseShort(),r.minRightSideBearing=a.parseShort(),r.xMaxExtent=a.parseShort(),r.caretSlopeRise=a.parseShort(),r.caretSlopeRun=a.parseShort(),r.caretOffset=a.parseShort(),a.relativeOffset+=8,r.metricDataFormat=a.parseShort(),r.numberOfHMetrics=a.parseUShort(),r},make:function(e){return new Le.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}};var St={parse:function(e,t,r,a,n,s,i){i.lowMemory?function(e,t,r,a,n){var s,i;e._hmtxTableData={};for(var o=new Be.Parser(t,r),c=0;c<n;c+=1)c<a&&(s=o.parseUShort(),i=o.parseShort()),e._hmtxTableData[c]={advanceWidth:s,leftSideBearing:i}}(e,t,r,a,n):function(e,t,r,a,n){for(var s,i,o=new Be.Parser(e,t),c=0;c<a;c+=1){c<r&&(s=o.parseUShort(),i=o.parseShort());var l=n.get(c);l.advanceWidth=s,l.leftSideBearing=i}}(t,r,a,n,s)},make:function(e){for(var t=new Le.Table("hmtx",[]),r=0;r<e.length;r+=1){var a=e.get(r),n=a.advanceWidth||0,s=a.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:n}),t.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:s})}return t}};var Tt={make:function(e){for(var t=new Le.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),r="",a=12+4*e.length,n=0;n<e.length;++n){var s=r.indexOf(e[n]);s<0&&(s=r.length,r+=e[n]),t.fields.push({name:"offset "+n,type:"USHORT",value:a+s}),t.fields.push({name:"length "+n,type:"USHORT",value:e[n].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),t},parse:function(e,t){var r=new Be.Parser(e,t),a=r.parseULong();le.argument(1===a,"Unsupported ltag table version."),r.skip("uLong",1);for(var n=r.parseULong(),s=[],i=0;i<n;i++){for(var o="",c=t+r.parseUShort(),l=r.parseUShort(),u=c;u<c+l;++u)o+=String.fromCharCode(e.getInt8(u));s.push(o)}return s}};var Ft={parse:function(e,t){var r={},a=new Be.Parser(e,t);return r.version=a.parseVersion(),r.numGlyphs=a.parseUShort(),1===r.version&&(r.maxPoints=a.parseUShort(),r.maxContours=a.parseUShort(),r.maxCompositePoints=a.parseUShort(),r.maxCompositeContours=a.parseUShort(),r.maxZones=a.parseUShort(),r.maxTwilightPoints=a.parseUShort(),r.maxStorage=a.parseUShort(),r.maxFunctionDefs=a.parseUShort(),r.maxInstructionDefs=a.parseUShort(),r.maxStackElements=a.parseUShort(),r.maxSizeOfInstructions=a.parseUShort(),r.maxComponentElements=a.parseUShort(),r.maxComponentDepth=a.parseUShort()),r},make:function(e){return new Le.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}},kt=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],Et={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},At={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},It={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Mt(e,t,r){switch(e){case 0:if(65535===t)return"und";if(r)return r[t];break;case 1:return Et[t];case 3:return It[t]}}var Lt={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Ct={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Ot(e,t,r){switch(e){case 0:return"utf-16";case 1:return Ct[r]||Lt[t];case 3:if(1===t||10===t)return"utf-16"}}function Rt(e){var t={};for(var r in e)t[e[r]]=parseInt(r);return t}function Ut(e,t,r,a,n,s){return new Le.Record("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:a},{name:"length",type:"USHORT",value:n},{name:"offset",type:"USHORT",value:s}])}function Nt(e,t){var r=function(e,t){var r=e.length,a=t.length-r+1;e:for(var n=0;n<a;n++)for(;n<a;n++){for(var s=0;s<r;s++)if(t[n+s]!==e[s])continue e;return n}return-1}(e,t);if(r<0){r=t.length;for(var a=0,n=e.length;a<n;++a)t.push(e[a])}return r}var Dt={parse:function(e,t,r){for(var a={},n=new Be.Parser(e,t),s=n.parseUShort(),i=n.parseUShort(),o=n.offset+n.parseUShort(),c=0;c<i;c++){var l=n.parseUShort(),u=n.parseUShort(),h=n.parseUShort(),p=n.parseUShort(),f=kt[p]||p,d=n.parseUShort(),g=n.parseUShort(),v=Mt(l,h,r),m=Ot(l,u,h);if(void 0!==m&&void 0!==v){var y=void 0;if(y="utf-16"===m?ue.UTF16(e,o+g,d):ue.MACSTRING(e,o+g,d,m)){var b=a[f];void 0===b&&(b=a[f]={}),b[v]=y}}}return 1===s&&n.parseUShort(),a},make:function(e,t){var r,a=[],n={},s=Rt(kt);for(var i in e){var o=s[i];if(void 0===o&&(o=i),r=parseInt(o),isNaN(r))throw new Error('Name table entry "'+i+'" does not exist, see nameTableNames for complete list.');n[r]=e[i],a.push(r)}for(var c=Rt(Et),l=Rt(It),u=[],h=[],p=0;p<a.length;p++){var f=n[r=a[p]];for(var d in f){var g=f[d],v=1,m=c[d],y=At[m],b=Ot(v,y,m),x=he.MACSTRING(g,b);void 0===x&&(v=0,(m=t.indexOf(d))<0&&(m=t.length,t.push(d)),y=4,x=he.UTF16(g));var w=Nt(x,h);u.push(Ut(v,y,m,r,x.length,w));var S=l[d];if(void 0!==S){var T=he.UTF16(g),F=Nt(T,h);u.push(Ut(3,1,S,r,T.length,F))}}}u.sort((function(e,t){return e.platformID-t.platformID||e.encodingID-t.encodingID||e.languageID-t.languageID||e.nameID-t.nameID}));for(var k=new Le.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:u.length},{name:"stringOffset",type:"USHORT",value:6+12*u.length}]),E=0;E<u.length;E++)k.fields.push({name:"record_"+E,type:"RECORD",value:u[E]});return k.fields.push({name:"strings",type:"LITERAL",value:h}),k}},Pt=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];var Bt={parse:function(e,t){var r={},a=new Be.Parser(e,t);r.version=a.parseUShort(),r.xAvgCharWidth=a.parseShort(),r.usWeightClass=a.parseUShort(),r.usWidthClass=a.parseUShort(),r.fsType=a.parseUShort(),r.ySubscriptXSize=a.parseShort(),r.ySubscriptYSize=a.parseShort(),r.ySubscriptXOffset=a.parseShort(),r.ySubscriptYOffset=a.parseShort(),r.ySuperscriptXSize=a.parseShort(),r.ySuperscriptYSize=a.parseShort(),r.ySuperscriptXOffset=a.parseShort(),r.ySuperscriptYOffset=a.parseShort(),r.yStrikeoutSize=a.parseShort(),r.yStrikeoutPosition=a.parseShort(),r.sFamilyClass=a.parseShort(),r.panose=[];for(var n=0;n<10;n++)r.panose[n]=a.parseByte();return r.ulUnicodeRange1=a.parseULong(),r.ulUnicodeRange2=a.parseULong(),r.ulUnicodeRange3=a.parseULong(),r.ulUnicodeRange4=a.parseULong(),r.achVendID=String.fromCharCode(a.parseByte(),a.parseByte(),a.parseByte(),a.parseByte()),r.fsSelection=a.parseUShort(),r.usFirstCharIndex=a.parseUShort(),r.usLastCharIndex=a.parseUShort(),r.sTypoAscender=a.parseShort(),r.sTypoDescender=a.parseShort(),r.sTypoLineGap=a.parseShort(),r.usWinAscent=a.parseUShort(),r.usWinDescent=a.parseUShort(),r.version>=1&&(r.ulCodePageRange1=a.parseULong(),r.ulCodePageRange2=a.parseULong()),r.version>=2&&(r.sxHeight=a.parseShort(),r.sCapHeight=a.parseShort(),r.usDefaultChar=a.parseUShort(),r.usBreakChar=a.parseUShort(),r.usMaxContent=a.parseUShort()),r},make:function(e){return new Le.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)},unicodeRanges:Pt,getUnicodeRange:function(e){for(var t=0;t<Pt.length;t+=1){var r=Pt[t];if(e>=r.begin&&e<r.end)return t}return-1}};var Gt={parse:function(e,t){var r={},a=new Be.Parser(e,t);switch(r.version=a.parseVersion(),r.italicAngle=a.parseFixed(),r.underlinePosition=a.parseShort(),r.underlineThickness=a.parseShort(),r.isFixedPitch=a.parseULong(),r.minMemType42=a.parseULong(),r.maxMemType42=a.parseULong(),r.minMemType1=a.parseULong(),r.maxMemType1=a.parseULong(),r.version){case 1:r.names=je.slice();break;case 2:r.numberOfGlyphs=a.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var n=0;n<r.numberOfGlyphs;n++)r.glyphNameIndex[n]=a.parseUShort();r.names=[];for(var s=0;s<r.numberOfGlyphs;s++)if(r.glyphNameIndex[s]>=je.length){var i=a.parseChar();r.names.push(a.parseString(i))}break;case 2.5:r.numberOfGlyphs=a.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var o=0;o<r.numberOfGlyphs;o++)r.offset[o]=a.parseChar()}return r},make:function(){return new Le.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}},_t=new Array(9);_t[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(De.coverage),deltaGlyphId:this.parseUShort()}:2===t?{substFormat:2,coverage:this.parsePointer(De.coverage),substitute:this.parseOffset16List()}:void le.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},_t[2]=function(){var e=this.parseUShort();return le.argument(1===e,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(De.coverage),sequences:this.parseListOfLists()}},_t[3]=function(){var e=this.parseUShort();return le.argument(1===e,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(De.coverage),alternateSets:this.parseListOfLists()}},_t[4]=function(){var e=this.parseUShort();return le.argument(1===e,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(De.coverage),ligatureSets:this.parseListOfLists((function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}}))}};var Ht={sequenceIndex:De.uShort,lookupListIndex:De.uShort};_t[5]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{substFormat:t,coverage:this.parsePointer(De.coverage),ruleSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{input:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,Ht)}}))};if(2===t)return{substFormat:t,coverage:this.parsePointer(De.coverage),classDef:this.parsePointer(De.classDef),classSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{classes:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,Ht)}}))};if(3===t){var r=this.parseUShort(),a=this.parseUShort();return{substFormat:t,coverages:this.parseList(r,De.pointer(De.coverage)),lookupRecords:this.parseRecordList(a,Ht)}}le.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},_t[6]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(De.coverage),chainRuleSets:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Ht)}}))}:2===t?{substFormat:2,coverage:this.parsePointer(De.coverage),backtrackClassDef:this.parsePointer(De.classDef),inputClassDef:this.parsePointer(De.classDef),lookaheadClassDef:this.parsePointer(De.classDef),chainClassSet:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Ht)}}))}:3===t?{substFormat:3,backtrackCoverage:this.parseList(De.pointer(De.coverage)),inputCoverage:this.parseList(De.pointer(De.coverage)),lookaheadCoverage:this.parseList(De.pointer(De.coverage)),lookupRecords:this.parseRecordList(Ht)}:void le.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},_t[7]=function(){var e=this.parseUShort();le.argument(1===e,"GSUB Extension Substitution subtable identifier-format must be 1");var t=this.parseUShort(),r=new De(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:t,extension:_t[t].call(r)}},_t[8]=function(){var e=this.parseUShort();return le.argument(1===e,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(De.coverage),backtrackCoverage:this.parseList(De.pointer(De.coverage)),lookaheadCoverage:this.parseList(De.pointer(De.coverage)),substitutes:this.parseUShortList()}};var Vt=new Array(9);Vt[1]=function(e){return 1===e.substFormat?new Le.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Le.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Le.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Le.Coverage(e.coverage)}].concat(Le.ushortList("substitute",e.substitute)))},Vt[3]=function(e){return le.assert(1===e.substFormat,"Lookup type 3 substFormat must be 1."),new Le.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Le.Coverage(e.coverage)}].concat(Le.tableList("altSet",e.alternateSets,(function(e){return new Le.Table("alternateSetTable",Le.ushortList("alternate",e))}))))},Vt[4]=function(e){return le.assert(1===e.substFormat,"Lookup type 4 substFormat must be 1."),new Le.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Le.Coverage(e.coverage)}].concat(Le.tableList("ligSet",e.ligatureSets,(function(e){return new Le.Table("ligatureSetTable",Le.tableList("ligature",e,(function(e){return new Le.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:e.ligGlyph}].concat(Le.ushortList("component",e.components,e.components.length+1)))})))}))))};var zt={parse:function(e,t){var r=new De(e,t=t||0),a=r.parseVersion(1);return le.argument(1===a||1.1===a,"Unsupported GSUB table version."),1===a?{version:a,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(_t)}:{version:a,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(_t),variations:r.parseFeatureVariationsList()}},make:function(e){return new Le.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Le.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new Le.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new Le.LookupList(e.lookups,Vt)}])}};var jt={parse:function(e,t){var r=new Be.Parser(e,t),a=r.parseULong();le.argument(1===a,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var n=r.parseULong(),s={},i=0;i<n;i++){var o=r.parseTag(),c=r.parseULong(),l=r.parseULong(),u=ue.UTF8(e,t+c,l);s[o]=u}return s},make:function(e){var t=Object.keys(e).length,r="",a=16+12*t,n=new Le.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:a},{name:"numTags",type:"ULONG",value:t}]);for(var s in e){var i=r.length;r+=e[s],n.fields.push({name:"tag "+s,type:"TAG",value:s}),n.fields.push({name:"offset "+s,type:"ULONG",value:a+i}),n.fields.push({name:"length "+s,type:"ULONG",value:e[s].length})}return n.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),n}};function Wt(e){return Math.log(e)/Math.log(2)|0}function Xt(e){for(;e.length%4!=0;)e.push(0);for(var t=0,r=0;r<e.length;r+=4)t+=(e[r]<<24)+(e[r+1]<<16)+(e[r+2]<<8)+e[r+3];return t%=Math.pow(2,32)}function qt(e,t,r,a){return new Le.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==e?e:""},{name:"checkSum",type:"ULONG",value:void 0!==t?t:0},{name:"offset",type:"ULONG",value:void 0!==r?r:0},{name:"length",type:"ULONG",value:void 0!==a?a:0}])}function Yt(e){var t=new Le.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var r=Math.pow(2,Wt(t.numTables));t.searchRange=16*r,t.entrySelector=Wt(r),t.rangeShift=16*t.numTables-t.searchRange;for(var a=[],n=[],s=t.sizeOf()+qt().sizeOf()*t.numTables;s%4!=0;)s+=1,n.push({name:"padding",type:"BYTE",value:0});for(var i=0;i<e.length;i+=1){var o=e[i];le.argument(4===o.tableName.length,"Table name"+o.tableName+" is invalid.");var c=o.sizeOf(),l=qt(o.tableName,Xt(o.encode()),s,c);for(a.push({name:l.tag+" Table Record",type:"RECORD",value:l}),n.push({name:o.tableName+" table",type:"RECORD",value:o}),s+=c,le.argument(!isNaN(s),"Something went wrong calculating the offset.");s%4!=0;)s+=1,n.push({name:"padding",type:"BYTE",value:0})}return a.sort((function(e,t){return e.value.tag>t.value.tag?1:-1})),t.fields=t.fields.concat(a),t.fields=t.fields.concat(n),t}function Kt(e,t,r){for(var a=0;a<t.length;a+=1){var n=e.charToGlyphIndex(t[a]);if(n>0)return e.glyphs.get(n).getMetrics()}return r}function Zt(e){for(var t=0,r=0;r<e.length;r+=1)t+=e[r];return t/e.length}var Qt={make:Yt,fontToTable:function(e){for(var t,r=[],a=[],n=[],s=[],i=[],o=[],c=[],l=0,u=0,h=0,p=0,f=0,d=0;d<e.glyphs.length;d+=1){var g=e.glyphs.get(d),v=0|g.unicode;if(isNaN(g.advanceWidth))throw new Error("Glyph "+g.name+" ("+d+"): advanceWidth is not a number.");(t>v||void 0===t)&&v>0&&(t=v),l<v&&(l=v);var m=Bt.getUnicodeRange(v);if(m<32)u|=1<<m;else if(m<64)h|=1<<m-32;else if(m<96)p|=1<<m-64;else{if(!(m<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");f|=1<<m-96}if(".notdef"!==g.name){var y=g.getMetrics();r.push(y.xMin),a.push(y.yMin),n.push(y.xMax),s.push(y.yMax),o.push(y.leftSideBearing),c.push(y.rightSideBearing),i.push(g.advanceWidth)}}var b={xMin:Math.min.apply(null,r),yMin:Math.min.apply(null,a),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,s),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:Zt(i),minLeftSideBearing:Math.min.apply(null,o),maxLeftSideBearing:Math.max.apply(null,o),minRightSideBearing:Math.min.apply(null,c)};b.ascender=e.ascender,b.descender=e.descender;var x=xt.make({flags:3,unitsPerEm:e.unitsPerEm,xMin:b.xMin,yMin:b.yMin,xMax:b.xMax,yMax:b.yMax,lowestRecPPEM:3,createdTimestamp:e.createdTimestamp}),w=wt.make({ascender:b.ascender,descender:b.descender,advanceWidthMax:b.advanceWidthMax,minLeftSideBearing:b.minLeftSideBearing,minRightSideBearing:b.minRightSideBearing,xMaxExtent:b.maxLeftSideBearing+(b.xMax-b.xMin),numberOfHMetrics:e.glyphs.length}),S=Ft.make(e.glyphs.length),T=Bt.make(Object.assign({xAvgCharWidth:Math.round(b.advanceWidthAvg),usFirstCharIndex:t,usLastCharIndex:l,ulUnicodeRange1:u,ulUnicodeRange2:h,ulUnicodeRange3:p,ulUnicodeRange4:f,sTypoAscender:b.ascender,sTypoDescender:b.descender,sTypoLineGap:0,usWinAscent:b.yMax,usWinDescent:Math.abs(b.yMin),ulCodePageRange1:1,sxHeight:Kt(e,"xyvw",{yMax:Math.round(b.ascender/2)}).yMax,sCapHeight:Kt(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",b).yMax,usDefaultChar:e.hasChar(" ")?32:0,usBreakChar:e.hasChar(" ")?32:0},e.tables.os2)),F=St.make(e.glyphs),k=_e.make(e.glyphs),E=e.getEnglishName("fontFamily"),A=e.getEnglishName("fontSubfamily"),I=E+" "+A,M=e.getEnglishName("postScriptName");M||(M=E.replace(/\s/g,"")+"-"+A);var L={};for(var C in e.names)L[C]=e.names[C];L.uniqueID||(L.uniqueID={en:e.getEnglishName("manufacturer")+":"+I}),L.postScriptName||(L.postScriptName={en:M}),L.preferredFamily||(L.preferredFamily=e.names.fontFamily),L.preferredSubfamily||(L.preferredSubfamily=e.names.fontSubfamily);var O=[],R=Dt.make(L,O),U=O.length>0?Tt.make(O):void 0,N=Gt.make(),D=bt.make(e.glyphs,{version:e.getEnglishName("version"),fullName:I,familyName:E,weightName:A,postScriptName:M,unitsPerEm:e.unitsPerEm,fontBBox:[0,b.yMin,b.ascender,b.advanceWidthMax]}),P=e.metas&&Object.keys(e.metas).length>0?jt.make(e.metas):void 0,B=[x,w,S,T,R,k,N,D,F];U&&B.push(U),e.tables.gsub&&B.push(zt.make(e.tables.gsub)),P&&B.push(P);for(var G=Yt(B),_=Xt(G.encode()),H=G.fields,V=!1,z=0;z<H.length;z+=1)if("head table"===H[z].name){H[z].value.checkSumAdjustment=2981146554-_,V=!0;break}if(!V)throw new Error("Could not find head table with checkSum to adjust.");return G},computeCheckSum:Xt};function $t(e,t){for(var r=0,a=e.length-1;r<=a;){var n=r+a>>>1,s=e[n].tag;if(s===t)return n;s<t?r=n+1:a=n-1}return-r-1}function Jt(e,t){for(var r=0,a=e.length-1;r<=a;){var n=r+a>>>1,s=e[n];if(s===t)return n;s<t?r=n+1:a=n-1}return-r-1}function er(e,t){for(var r,a=0,n=e.length-1;a<=n;){var s=a+n>>>1,i=(r=e[s]).start;if(i===t)return r;i<t?a=s+1:n=s-1}if(a>0)return t>(r=e[a-1]).end?0:r}function tr(e,t){this.font=e,this.tableName=t}function rr(e){tr.call(this,e,"gpos")}function ar(e){tr.call(this,e,"gsub")}function nr(e,t){var r=e.length;if(r!==t.length)return!1;for(var a=0;a<r;a++)if(e[a]!==t[a])return!1;return!0}function sr(e,t,r){for(var a=e.subtables,n=0;n<a.length;n++){var s=a[n];if(s.substFormat===t)return s}if(r)return a.push(r),r}function ir(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),a=0;a<e.length;++a)r[a]=e[a];return t}function or(e,t){if(!e)throw t}function cr(e,t,r,a,n){var s;return(t&a)>0?(s=e.parseByte(),0==(t&n)&&(s=-s),s=r+s):s=(t&n)>0?r:r+e.parseShort(),s}function lr(e,t,r){var a,n,s=new Be.Parser(t,r);if(e.numberOfContours=s.parseShort(),e._xMin=s.parseShort(),e._yMin=s.parseShort(),e._xMax=s.parseShort(),e._yMax=s.parseShort(),e.numberOfContours>0){for(var i=e.endPointIndices=[],o=0;o<e.numberOfContours;o+=1)i.push(s.parseUShort());e.instructionLength=s.parseUShort(),e.instructions=[];for(var c=0;c<e.instructionLength;c+=1)e.instructions.push(s.parseByte());var l=i[i.length-1]+1;a=[];for(var u=0;u<l;u+=1)if(n=s.parseByte(),a.push(n),(8&n)>0)for(var h=s.parseByte(),p=0;p<h;p+=1)a.push(n),u+=1;if(le.argument(a.length===l,"Bad flags."),i.length>0){var f,d=[];if(l>0){for(var g=0;g<l;g+=1)n=a[g],(f={}).onCurve=!!(1&n),f.lastPointOfContour=i.indexOf(g)>=0,d.push(f);for(var v=0,m=0;m<l;m+=1)n=a[m],(f=d[m]).x=cr(s,n,v,2,16),v=f.x;for(var y=0,b=0;b<l;b+=1)n=a[b],(f=d[b]).y=cr(s,n,y,4,32),y=f.y}e.points=d}else e.points=[]}else if(0===e.numberOfContours)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var x=!0;x;){a=s.parseUShort();var w={glyphIndex:s.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&a)>0?(2&a)>0?(w.dx=s.parseShort(),w.dy=s.parseShort()):w.matchedPoints=[s.parseUShort(),s.parseUShort()]:(2&a)>0?(w.dx=s.parseChar(),w.dy=s.parseChar()):w.matchedPoints=[s.parseByte(),s.parseByte()],(8&a)>0?w.xScale=w.yScale=s.parseF2Dot14():(64&a)>0?(w.xScale=s.parseF2Dot14(),w.yScale=s.parseF2Dot14()):(128&a)>0&&(w.xScale=s.parseF2Dot14(),w.scale01=s.parseF2Dot14(),w.scale10=s.parseF2Dot14(),w.yScale=s.parseF2Dot14()),e.components.push(w),x=!!(32&a)}if(256&a){e.instructionLength=s.parseUShort(),e.instructions=[];for(var S=0;S<e.instructionLength;S+=1)e.instructions.push(s.parseByte())}}}function ur(e,t){for(var r=[],a=0;a<e.length;a+=1){var n=e[a],s={x:t.xScale*n.x+t.scale01*n.y+t.dx,y:t.scale10*n.x+t.yScale*n.y+t.dy,onCurve:n.onCurve,lastPointOfContour:n.lastPointOfContour};r.push(s)}return r}function hr(e){var t=new ie;if(!e)return t;for(var r=function(e){for(var t=[],r=[],a=0;a<e.length;a+=1){var n=e[a];r.push(n),n.lastPointOfContour&&(t.push(r),r=[])}return le.argument(0===r.length,"There are still points left in the current contour."),t}(e),a=0;a<r.length;++a){var n=r[a],s=null,i=n[n.length-1],o=n[0];if(i.onCurve)t.moveTo(i.x,i.y);else if(o.onCurve)t.moveTo(o.x,o.y);else{var c={x:.5*(i.x+o.x),y:.5*(i.y+o.y)};t.moveTo(c.x,c.y)}for(var l=0;l<n.length;++l)if(s=i,i=o,o=n[(l+1)%n.length],i.onCurve)t.lineTo(i.x,i.y);else{var u=o;s.onCurve||(i.x,s.x,i.y,s.y),o.onCurve||(u={x:.5*(i.x+o.x),y:.5*(i.y+o.y)}),t.quadraticCurveTo(i.x,i.y,u.x,u.y)}t.closePath()}return t}function pr(e,t){if(t.isComposite)for(var r=0;r<t.components.length;r+=1){var a=t.components[r],n=e.get(a.glyphIndex);if(n.getPath(),n.points){var s=void 0;if(void 0===a.matchedPoints)s=ur(n.points,a);else{if(a.matchedPoints[0]>t.points.length-1||a.matchedPoints[1]>n.points.length-1)throw Error("Matched points out of range in "+t.name);var i=t.points[a.matchedPoints[0]],o=n.points[a.matchedPoints[1]],c={xScale:a.xScale,scale01:a.scale01,scale10:a.scale10,yScale:a.yScale,dx:0,dy:0};o=ur([o],c)[0],c.dx=i.x-o.x,c.dy=i.y-o.y,s=ur(n.points,c)}t.points=t.points.concat(s)}}return hr(t.points)}tr.prototype={searchTag:$t,binSearch:Jt,getTable:function(e){var t=this.font.tables[this.tableName];return!t&&e&&(t=this.font.tables[this.tableName]=this.createDefaultTable()),t},getScriptNames:function(){var e=this.getTable();return e?e.scripts.map((function(e){return e.tag})):[]},getDefaultScriptName:function(){var e=this.getTable();if(e){for(var t=!1,r=0;r<e.scripts.length;r++){var a=e.scripts[r].tag;if("DFLT"===a)return a;"latn"===a&&(t=!0)}return t?"latn":void 0}},getScriptTable:function(e,t){var r=this.getTable(t);if(r){e=e||"DFLT";var a=r.scripts,n=$t(r.scripts,e);if(n>=0)return a[n].script;if(t){var s={tag:e,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return a.splice(-1-n,0,s),s.script}}},getLangSysTable:function(e,t,r){var a=this.getScriptTable(e,r);if(a){if(!t||"dflt"===t||"DFLT"===t)return a.defaultLangSys;var n=$t(a.langSysRecords,t);if(n>=0)return a.langSysRecords[n].langSys;if(r){var s={tag:t,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return a.langSysRecords.splice(-1-n,0,s),s.langSys}}},getFeatureTable:function(e,t,r,a){var n=this.getLangSysTable(e,t,a);if(n){for(var s,i=n.featureIndexes,o=this.font.tables[this.tableName].features,c=0;c<i.length;c++)if((s=o[i[c]]).tag===r)return s.feature;if(a){var l=o.length;return le.assert(0===l||r>=o[l-1].tag,"Features must be added in alphabetical order."),s={tag:r,feature:{params:0,lookupListIndexes:[]}},o.push(s),i.push(l),s.feature}}},getLookupTables:function(e,t,r,a,n){var s=this.getFeatureTable(e,t,r,n),i=[];if(s){for(var o,c=s.lookupListIndexes,l=this.font.tables[this.tableName].lookups,u=0;u<c.length;u++)(o=l[c[u]]).lookupType===a&&i.push(o);if(0===i.length&&n){o={lookupType:a,lookupFlag:0,subtables:[],markFilteringSet:void 0};var h=l.length;return l.push(o),c.push(h),[o]}}return i},getGlyphClass:function(e,t){switch(e.format){case 1:return e.startGlyph<=t&&t<e.startGlyph+e.classes.length?e.classes[t-e.startGlyph]:0;case 2:var r=er(e.ranges,t);return r?r.classId:0}},getCoverageIndex:function(e,t){switch(e.format){case 1:var r=Jt(e.glyphs,t);return r>=0?r:-1;case 2:var a=er(e.ranges,t);return a?a.index+t-a.start:-1}},expandCoverage:function(e){if(1===e.format)return e.glyphs;for(var t=[],r=e.ranges,a=0;a<r.length;a++)for(var n=r[a],s=n.start,i=n.end,o=s;o<=i;o++)t.push(o);return t}},rr.prototype=tr.prototype,rr.prototype.init=function(){var e=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(e)},rr.prototype.getKerningValue=function(e,t,r){for(var a=0;a<e.length;a++)for(var n=e[a].subtables,s=0;s<n.length;s++){var i=n[s],o=this.getCoverageIndex(i.coverage,t);if(!(o<0))switch(i.posFormat){case 1:for(var c=i.pairSets[o],l=0;l<c.length;l++){var u=c[l];if(u.secondGlyph===r)return u.value1&&u.value1.xAdvance||0}break;case 2:var h=this.getGlyphClass(i.classDef1,t),p=this.getGlyphClass(i.classDef2,r),f=i.classRecords[h][p];return f.value1&&f.value1.xAdvance||0}}return 0},rr.prototype.getKerningTables=function(e,t){if(this.font.tables.gpos)return this.getLookupTables(e,t,"kern",2)},ar.prototype=tr.prototype,ar.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},ar.prototype.getSingle=function(e,t,r){for(var a=[],n=this.getLookupTables(t,r,e,1),s=0;s<n.length;s++)for(var i=n[s].subtables,o=0;o<i.length;o++){var c=i[o],l=this.expandCoverage(c.coverage),u=void 0;if(1===c.substFormat){var h=c.deltaGlyphId;for(u=0;u<l.length;u++){var p=l[u];a.push({sub:p,by:p+h})}}else{var f=c.substitute;for(u=0;u<l.length;u++)a.push({sub:l[u],by:f[u]})}}return a},ar.prototype.getAlternates=function(e,t,r){for(var a=[],n=this.getLookupTables(t,r,e,3),s=0;s<n.length;s++)for(var i=n[s].subtables,o=0;o<i.length;o++)for(var c=i[o],l=this.expandCoverage(c.coverage),u=c.alternateSets,h=0;h<l.length;h++)a.push({sub:l[h],by:u[h]});return a},ar.prototype.getLigatures=function(e,t,r){for(var a=[],n=this.getLookupTables(t,r,e,4),s=0;s<n.length;s++)for(var i=n[s].subtables,o=0;o<i.length;o++)for(var c=i[o],l=this.expandCoverage(c.coverage),u=c.ligatureSets,h=0;h<l.length;h++)for(var p=l[h],f=u[h],d=0;d<f.length;d++){var g=f[d];a.push({sub:[p].concat(g.components),by:g.ligGlyph})}return a},ar.prototype.addSingle=function(e,t,r,a){var n=sr(this.getLookupTables(r,a,e,1,!0)[0],2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});le.assert(1===n.coverage.format,"Ligature: unable to modify coverage table format "+n.coverage.format);var s=t.sub,i=this.binSearch(n.coverage.glyphs,s);i<0&&(i=-1-i,n.coverage.glyphs.splice(i,0,s),n.substitute.splice(i,0,0)),n.substitute[i]=t.by},ar.prototype.addAlternate=function(e,t,r,a){var n=sr(this.getLookupTables(r,a,e,3,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});le.assert(1===n.coverage.format,"Ligature: unable to modify coverage table format "+n.coverage.format);var s=t.sub,i=this.binSearch(n.coverage.glyphs,s);i<0&&(i=-1-i,n.coverage.glyphs.splice(i,0,s),n.alternateSets.splice(i,0,0)),n.alternateSets[i]=t.by},ar.prototype.addLigature=function(e,t,r,a){var n=this.getLookupTables(r,a,e,4,!0)[0],s=n.subtables[0];s||(s={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},n.subtables[0]=s),le.assert(1===s.coverage.format,"Ligature: unable to modify coverage table format "+s.coverage.format);var i=t.sub[0],o=t.sub.slice(1),c={ligGlyph:t.by,components:o},l=this.binSearch(s.coverage.glyphs,i);if(l>=0){for(var u=s.ligatureSets[l],h=0;h<u.length;h++)if(nr(u[h].components,o))return;u.push(c)}else l=-1-l,s.coverage.glyphs.splice(l,0,i),s.ligatureSets.splice(l,0,[c])},ar.prototype.getFeature=function(e,t,r){if(/ss\d\d/.test(e))return this.getSingle(e,t,r);switch(e){case"aalt":case"salt":return this.getSingle(e,t,r).concat(this.getAlternates(e,t,r));case"dlig":case"liga":case"rlig":return this.getLigatures(e,t,r)}},ar.prototype.add=function(e,t,r,a){if(/ss\d\d/.test(e))return this.addSingle(e,t,r,a);switch(e){case"aalt":case"salt":return"number"==typeof t.by?this.addSingle(e,t,r,a):this.addAlternate(e,t,r,a);case"dlig":case"liga":case"rlig":return this.addLigature(e,t,r,a)}};var fr,dr,gr,vr,mr={getPath:hr,parse:function(e,t,r,a,n){return n.lowMemory?function(e,t,r,a){var n=new et.GlyphSet(a);return a._push=function(s){var i=r[s];i!==r[s+1]?n.push(s,et.ttfGlyphLoader(a,s,lr,e,t+i,pr)):n.push(s,et.glyphLoader(a,s))},n}(e,t,r,a):function(e,t,r,a){for(var n=new et.GlyphSet(a),s=0;s<r.length-1;s+=1){var i=r[s];i!==r[s+1]?n.push(s,et.ttfGlyphLoader(a,s,lr,e,t+i,pr)):n.push(s,et.glyphLoader(a,s))}return n}(e,t,r,a)}};function yr(e){this.font=e,this.getCommands=function(e){return mr.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function br(e){return e}function xr(e){return Math.sign(e)*Math.round(Math.abs(e))}function wr(e){return Math.sign(e)*Math.round(Math.abs(2*e))/2}function Sr(e){return Math.sign(e)*(Math.round(Math.abs(e)+.5)-.5)}function Tr(e){return Math.sign(e)*Math.ceil(Math.abs(e))}function Fr(e){return Math.sign(e)*Math.floor(Math.abs(e))}var kr=function(e){var t=this.srPeriod,r=this.srPhase,a=1;return e<0&&(e=-e,a=-1),e+=this.srThreshold-r,e=Math.trunc(e/t)*t,(e+=r)<0?r*a:e*a},Er={x:1,y:0,axis:"x",distance:function(e,t,r,a){return(r?e.xo:e.x)-(a?t.xo:t.x)},interpolate:function(e,t,r,a){var n,s,i,o,c,l,u;if(!a||a===this)return n=e.xo-t.xo,s=e.xo-r.xo,c=t.x-t.xo,l=r.x-r.xo,0===(u=(i=Math.abs(n))+(o=Math.abs(s)))?void(e.x=e.xo+(c+l)/2):void(e.x=e.xo+(c*o+l*i)/u);n=a.distance(e,t,!0,!0),s=a.distance(e,r,!0,!0),c=a.distance(t,t,!1,!0),l=a.distance(r,r,!1,!0),0!==(u=(i=Math.abs(n))+(o=Math.abs(s)))?Er.setRelative(e,e,(c*o+l*i)/u,a,!0):Er.setRelative(e,e,(c+l)/2,a,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(e,t,r,a,n){if(a&&a!==this){var s=n?t.xo:t.x,i=n?t.yo:t.y,o=s+r*a.x,c=i+r*a.y;e.x=o+(e.y-c)/a.normalSlope}else e.x=(n?t.xo:t.x)+r},slope:0,touch:function(e){e.xTouched=!0},touched:function(e){return e.xTouched},untouch:function(e){e.xTouched=!1}},Ar={x:0,y:1,axis:"y",distance:function(e,t,r,a){return(r?e.yo:e.y)-(a?t.yo:t.y)},interpolate:function(e,t,r,a){var n,s,i,o,c,l,u;if(!a||a===this)return n=e.yo-t.yo,s=e.yo-r.yo,c=t.y-t.yo,l=r.y-r.yo,0===(u=(i=Math.abs(n))+(o=Math.abs(s)))?void(e.y=e.yo+(c+l)/2):void(e.y=e.yo+(c*o+l*i)/u);n=a.distance(e,t,!0,!0),s=a.distance(e,r,!0,!0),c=a.distance(t,t,!1,!0),l=a.distance(r,r,!1,!0),0!==(u=(i=Math.abs(n))+(o=Math.abs(s)))?Ar.setRelative(e,e,(c*o+l*i)/u,a,!0):Ar.setRelative(e,e,(c+l)/2,a,!0)},normalSlope:0,setRelative:function(e,t,r,a,n){if(a&&a!==this){var s=n?t.xo:t.x,i=n?t.yo:t.y,o=s+r*a.x,c=i+r*a.y;e.y=c+a.normalSlope*(e.x-o)}else e.y=(n?t.yo:t.y)+r},slope:Number.POSITIVE_INFINITY,touch:function(e){e.yTouched=!0},touched:function(e){return e.yTouched},untouch:function(e){e.yTouched=!1}};function Ir(e,t){this.x=e,this.y=t,this.axis=void 0,this.slope=t/e,this.normalSlope=-e/t,Object.freeze(this)}function Mr(e,t){var r=Math.sqrt(e*e+t*t);return t/=r,1===(e/=r)&&0===t?Er:0===e&&1===t?Ar:new Ir(e,t)}function Lr(e,t,r,a){this.x=this.xo=Math.round(64*e)/64,this.y=this.yo=Math.round(64*t)/64,this.lastPointOfContour=r,this.onCurve=a,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Object.freeze(Er),Object.freeze(Ar),Ir.prototype.distance=function(e,t,r,a){return this.x*Er.distance(e,t,r,a)+this.y*Ar.distance(e,t,r,a)},Ir.prototype.interpolate=function(e,t,r,a){var n,s,i,o,c,l,u;i=a.distance(e,t,!0,!0),o=a.distance(e,r,!0,!0),n=a.distance(t,t,!1,!0),s=a.distance(r,r,!1,!0),0!==(u=(c=Math.abs(i))+(l=Math.abs(o)))?this.setRelative(e,e,(n*l+s*c)/u,a,!0):this.setRelative(e,e,(n+s)/2,a,!0)},Ir.prototype.setRelative=function(e,t,r,a,n){a=a||this;var s=n?t.xo:t.x,i=n?t.yo:t.y,o=s+r*a.x,c=i+r*a.y,l=a.normalSlope,u=this.slope,h=e.x,p=e.y;e.x=(u*h-l*o+c-p)/(u-l),e.y=u*(e.x-h)+p},Ir.prototype.touch=function(e){e.xTouched=!0,e.yTouched=!0},Lr.prototype.nextTouched=function(e){for(var t=this.nextPointOnContour;!e.touched(t)&&t!==this;)t=t.nextPointOnContour;return t},Lr.prototype.prevTouched=function(e){for(var t=this.prevPointOnContour;!e.touched(t)&&t!==this;)t=t.prevPointOnContour;return t};var Cr=Object.freeze(new Lr(0,0)),Or={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Rr(e,t){switch(this.env=e,this.stack=[],this.prog=t,e){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Er,this.round=xr}}function Ur(e){for(var t=e.tZone=new Array(e.gZone.length),r=0;r<t.length;r++)t[r]=new Lr(0,0)}function Nr(e,t){var r,a=e.prog,n=e.ip,s=1;do{if(88===(r=a[++n]))s++;else if(89===r)s--;else if(64===r)n+=a[n+1]+1;else if(65===r)n+=2*a[n+1]+1;else if(r>=176&&r<=183)n+=r-176+1;else if(r>=184&&r<=191)n+=2*(r-184+1);else if(t&&1===s&&27===r)break}while(s>0);e.ip=n}function Dr(e,t){exports.DEBUG&&console.log(t.step,"SVTCA["+e.axis+"]"),t.fv=t.pv=t.dpv=e}function Pr(e,t){exports.DEBUG&&console.log(t.step,"SPVTCA["+e.axis+"]"),t.pv=t.dpv=e}function Br(e,t){exports.DEBUG&&console.log(t.step,"SFVTCA["+e.axis+"]"),t.fv=e}function Gr(e,t){var r,a,n=t.stack,s=n.pop(),i=n.pop(),o=t.z2[s],c=t.z1[i];exports.DEBUG&&console.log("SPVTL["+e+"]",s,i),e?(r=o.y-c.y,a=c.x-o.x):(r=c.x-o.x,a=c.y-o.y),t.pv=t.dpv=Mr(r,a)}function _r(e,t){var r,a,n=t.stack,s=n.pop(),i=n.pop(),o=t.z2[s],c=t.z1[i];exports.DEBUG&&console.log("SFVTL["+e+"]",s,i),e?(r=o.y-c.y,a=c.x-o.x):(r=c.x-o.x,a=c.y-o.y),t.fv=Mr(r,a)}function Hr(e){exports.DEBUG&&console.log(e.step,"POP[]"),e.stack.pop()}function Vr(e,t){var r=t.stack.pop(),a=t.z0[r],n=t.fv,s=t.pv;exports.DEBUG&&console.log(t.step,"MDAP["+e+"]",r);var i=s.distance(a,Cr);e&&(i=t.round(i)),n.setRelative(a,Cr,i,s),n.touch(a),t.rp0=t.rp1=r}function zr(e,t){var r,a,n,s=t.z2,i=s.length-2;exports.DEBUG&&console.log(t.step,"IUP["+e.axis+"]");for(var o=0;o<i;o++)r=s[o],e.touched(r)||(a=r.prevTouched(e))!==r&&(a===(n=r.nextTouched(e))&&e.setRelative(r,r,e.distance(a,a,!1,!0),e,!0),e.interpolate(r,a,n,e))}function jr(e,t){for(var r=t.stack,a=e?t.rp1:t.rp2,n=(e?t.z0:t.z1)[a],s=t.fv,i=t.pv,o=t.loop,c=t.z2;o--;){var l=r.pop(),u=c[l],h=i.distance(n,n,!1,!0);s.setRelative(u,u,h,i),s.touch(u),exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"SHP["+(e?"rp1":"rp2")+"]",l)}t.loop=1}function Wr(e,t){var r=t.stack,a=e?t.rp1:t.rp2,n=(e?t.z0:t.z1)[a],s=t.fv,i=t.pv,o=r.pop(),c=t.z2[t.contours[o]],l=c;exports.DEBUG&&console.log(t.step,"SHC["+e+"]",o);var u=i.distance(n,n,!1,!0);do{l!==n&&s.setRelative(l,l,u,i),l=l.nextPointOnContour}while(l!==c)}function Xr(e,t){var r,a,n=t.stack,s=e?t.rp1:t.rp2,i=(e?t.z0:t.z1)[s],o=t.fv,c=t.pv,l=n.pop();switch(exports.DEBUG&&console.log(t.step,"SHZ["+e+"]",l),l){case 0:r=t.tZone;break;case 1:r=t.gZone;break;default:throw new Error("Invalid zone")}for(var u=c.distance(i,i,!1,!0),h=r.length-2,p=0;p<h;p++)a=r[p],o.setRelative(a,a,u,c)}function qr(e,t){var r=t.stack,a=r.pop()/64,n=r.pop(),s=t.z1[n],i=t.z0[t.rp0],o=t.fv,c=t.pv;o.setRelative(s,i,a,c),o.touch(s),exports.DEBUG&&console.log(t.step,"MSIRP["+e+"]",a,n),t.rp1=t.rp0,t.rp2=n,e&&(t.rp0=n)}function Yr(e,t){var r=t.stack,a=r.pop(),n=r.pop(),s=t.z0[n],i=t.fv,o=t.pv,c=t.cvt[a];exports.DEBUG&&console.log(t.step,"MIAP["+e+"]",a,"(",c,")",n);var l=o.distance(s,Cr);e&&(Math.abs(l-c)<t.cvCutIn&&(l=c),l=t.round(l)),i.setRelative(s,Cr,l,o),0===t.zp0&&(s.xo=s.x,s.yo=s.y),i.touch(s),t.rp0=t.rp1=n}function Kr(e,t){var r=t.stack,a=r.pop(),n=t.z2[a];exports.DEBUG&&console.log(t.step,"GC["+e+"]",a),r.push(64*t.dpv.distance(n,Cr,e,!1))}function Zr(e,t){var r=t.stack,a=r.pop(),n=r.pop(),s=t.z1[a],i=t.z0[n],o=t.dpv.distance(i,s,e,e);exports.DEBUG&&console.log(t.step,"MD["+e+"]",a,n,"->",o),t.stack.push(Math.round(64*o))}function Qr(e,t){var r=t.stack,a=r.pop(),n=t.fv,s=t.pv,i=t.ppem,o=t.deltaBase+16*(e-1),c=t.deltaShift,l=t.z0;exports.DEBUG&&console.log(t.step,"DELTAP["+e+"]",a,r);for(var u=0;u<a;u++){var h=r.pop(),p=r.pop();if(o+((240&p)>>4)===i){var f=(15&p)-8;f>=0&&f++,exports.DEBUG&&console.log(t.step,"DELTAPFIX",h,"by",f*c);var d=l[h];n.setRelative(d,d,f*c,s)}}}function $r(e,t){var r=t.stack,a=r.pop();exports.DEBUG&&console.log(t.step,"ROUND[]"),r.push(64*t.round(a/64))}function Jr(e,t){var r=t.stack,a=r.pop(),n=t.ppem,s=t.deltaBase+16*(e-1),i=t.deltaShift;exports.DEBUG&&console.log(t.step,"DELTAC["+e+"]",a,r);for(var o=0;o<a;o++){var c=r.pop(),l=r.pop();if(s+((240&l)>>4)===n){var u=(15&l)-8;u>=0&&u++;var h=u*i;exports.DEBUG&&console.log(t.step,"DELTACFIX",c,"by",h),t.cvt[c]+=h}}}function ea(e,t){var r,a,n=t.stack,s=n.pop(),i=n.pop(),o=t.z2[s],c=t.z1[i];exports.DEBUG&&console.log(t.step,"SDPVTL["+e+"]",s,i),e?(r=o.y-c.y,a=c.x-o.x):(r=c.x-o.x,a=c.y-o.y),t.dpv=Mr(r,a)}function ta(e,t){var r=t.stack,a=t.prog,n=t.ip;exports.DEBUG&&console.log(t.step,"PUSHB["+e+"]");for(var s=0;s<e;s++)r.push(a[++n]);t.ip=n}function ra(e,t){var r=t.ip,a=t.prog,n=t.stack;exports.DEBUG&&console.log(t.ip,"PUSHW["+e+"]");for(var s=0;s<e;s++){var i=a[++r]<<8|a[++r];32768&i&&(i=-(1+(65535^i))),n.push(i)}t.ip=r}function aa(e,t,r,a,n,s){var i,o,c,l,u=s.stack,h=e&&u.pop(),p=u.pop(),f=s.rp0,d=s.z0[f],g=s.z1[p],v=s.minDis,m=s.fv,y=s.dpv;c=(o=i=y.distance(g,d,!0,!0))>=0?1:-1,o=Math.abs(o),e&&(l=s.cvt[h],a&&Math.abs(o-l)<s.cvCutIn&&(o=l)),r&&o<v&&(o=v),a&&(o=s.round(o)),m.setRelative(g,d,c*o,y),m.touch(g),exports.DEBUG&&console.log(s.step,(e?"MIRP[":"MDRP[")+(t?"M":"m")+(r?">":"_")+(a?"R":"_")+(0===n?"Gr":1===n?"Bl":2===n?"Wh":"")+"]",e?h+"("+s.cvt[h]+","+l+")":"",p,"(d =",i,"->",c*o,")"),s.rp1=s.rp0,s.rp2=p,t&&(s.rp0=p)}function na(e){this.char=e,this.state={},this.activeState=null}function sa(e,t,r){this.contextName=r,this.startIndex=e,this.endOffset=t}function ia(e,t,r){this.contextName=e,this.openRange=null,this.ranges=[],this.checkStart=t,this.checkEnd=r}function oa(e,t){this.context=e,this.index=t,this.length=e.length,this.current=e[t],this.backtrack=e.slice(0,t),this.lookahead=e.slice(t+1)}function ca(e){this.eventId=e,this.subscribers=[]}function la(e){var t=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach((function(e){Object.defineProperty(t.events,e,{value:new ca(e)})})),e&&r.forEach((function(r){var a=e[r];"function"==typeof a&&t.events[r].subscribe(a)}));["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"].forEach((function(e){t.events[e].subscribe(t.updateContextsRanges)}))}function ua(e){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],la.call(this,e)}function ha(e){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(e)}function pa(e){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(e)}function fa(e){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(e)}function da(e){return/[A-z]/.test(e)}function ga(e){this.font=e,this.features={}}function va(e){this.id=e.id,this.tag=e.tag,this.substitution=e.substitution}function ma(e,t){if(!e)return-1;switch(t.format){case 1:return t.glyphs.indexOf(e);case 2:for(var r=t.ranges,a=0;a<r.length;a++){var n=r[a];if(e>=n.start&&e<=n.end){var s=e-n.start;return n.index+s}}break;default:return-1}return-1}function ya(e,t){return-1===ma(e,t.coverage)?null:e+t.deltaGlyphId}function ba(e,t){var r=ma(e,t.coverage);return-1===r?null:t.substitute[r]}function xa(e,t){for(var r=[],a=0;a<e.length;a++){var n=e[a],s=t.current,i=ma(s=Array.isArray(s)?s[0]:s,n);-1!==i&&r.push(i)}return r.length!==e.length?-1:r}function wa(e,t){var r=t.inputCoverage.length+t.lookaheadCoverage.length+t.backtrackCoverage.length;if(e.context.length<r)return[];var a=xa(t.inputCoverage,e);if(-1===a)return[];var n=t.inputCoverage.length-1;if(e.lookahead.length<t.lookaheadCoverage.length)return[];for(var s=e.lookahead.slice(n);s.length&&fa(s[0].char);)s.shift();var i=new oa(s,0),o=xa(t.lookaheadCoverage,i),c=[].concat(e.backtrack);for(c.reverse();c.length&&fa(c[0].char);)c.shift();if(c.length<t.backtrackCoverage.length)return[];var l=new oa(c,0),u=xa(t.backtrackCoverage,l),h=[];if(a.length===t.inputCoverage.length&&o.length===t.lookaheadCoverage.length&&u.length===t.backtrackCoverage.length)for(var p=0;p<t.lookupRecords.length;p++)for(var f=t.lookupRecords[p].lookupListIndex,d=this.getLookupByIndex(f),g=0;g<d.subtables.length;g++){var v=d.subtables[g],m=this.getLookupMethod(d,v);if("12"===this.getSubstitutionType(d,v))for(var y=0;y<a.length;y++){var b=m(e.get(y));b&&h.push(b)}}return h}function Sa(e,t){var r,a=ma(e.current,t.coverage);if(-1===a)return null;for(var n=t.ligatureSets[a],s=0;s<n.length;s++){r=n[s];for(var i=0;i<r.components.length;i++){if(e.lookahead[i]!==r.components[i])break;if(i===r.components.length-1)return r}}return null}function Ta(e,t){var r=ma(e,t.coverage);return-1===r?null:t.sequences[r]}yr.prototype.exec=function(e,t){if("number"!=typeof t)throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,a=this._prepState;if(!a||a.ppem!==t){var n=this._fpgmState;if(!n){Rr.prototype=Or,(n=this._fpgmState=new Rr("fpgm",r.tables.fpgm)).funcs=[],n.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),n.step=-1);try{dr(n)}catch(e){return console.log("Hinting error in FPGM:"+e),void(this._errorState=3)}}Rr.prototype=n,(a=this._prepState=new Rr("prep",r.tables.prep)).ppem=t;var s=r.tables.cvt;if(s)for(var i=a.cvt=new Array(s.length),o=t/r.unitsPerEm,c=0;c<s.length;c++)i[c]=s[c]*o;else a.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),a.step=-1);try{dr(a)}catch(e){this._errorState<2&&console.log("Hinting error in PREP:"+e),this._errorState=2}}if(!(this._errorState>1))try{return gr(e,a)}catch(e){return this._errorState<1&&(console.log("Hinting error:"+e),console.log("Note: further hinting errors are silenced")),void(this._errorState=1)}}},gr=function(e,t){var r,a,n,s=t.ppem/t.font.unitsPerEm,i=s,o=e.components;if(Rr.prototype=t,o){var c=t.font;a=[],r=[];for(var l=0;l<o.length;l++){var u=o[l],h=c.glyphs.get(u.glyphIndex);n=new Rr("glyf",h.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+l+"---"),n.step=-1),vr(h,n,s,i);for(var p=Math.round(u.dx*s),f=Math.round(u.dy*i),d=n.gZone,g=n.contours,v=0;v<d.length;v++){var m=d[v];m.xTouched=m.yTouched=!1,m.xo=m.x=m.x+p,m.yo=m.y=m.y+f}var y=a.length;a.push.apply(a,d);for(var b=0;b<g.length;b++)r.push(g[b]+y)}e.instructions&&!n.inhibitGridFit&&((n=new Rr("glyf",e.instructions)).gZone=n.z0=n.z1=n.z2=a,n.contours=r,a.push(new Lr(0,0),new Lr(Math.round(e.advanceWidth*s),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),n.step=-1),dr(n),a.length-=2)}else n=new Rr("glyf",e.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),n.step=-1),vr(e,n,s,i),a=n.gZone;return a},vr=function(e,t,r,a){for(var n,s,i,o=e.points||[],c=o.length,l=t.gZone=t.z0=t.z1=t.z2=[],u=t.contours=[],h=0;h<c;h++)n=o[h],l[h]=new Lr(n.x*r,n.y*a,n.lastPointOfContour,n.onCurve);for(var p=0;p<c;p++)n=l[p],s||(s=n,u.push(p)),n.lastPointOfContour?(n.nextPointOnContour=s,s.prevPointOnContour=n,s=void 0):(i=l[p+1],n.nextPointOnContour=i,i.prevPointOnContour=n);if(!t.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",t.stack);for(var f=0;f<c;f++)console.log(f,l[f].x,l[f].y)}if(l.push(new Lr(0,0),new Lr(Math.round(e.advanceWidth*r),0)),dr(t),l.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",t.stack);for(var d=0;d<c;d++)console.log(d,l[d].x,l[d].y)}}},dr=function(e){var t=e.prog;if(t){var r,a=t.length;for(e.ip=0;e.ip<a;e.ip++){if(exports.DEBUG&&e.step++,!(r=fr[t[e.ip]]))throw new Error("unknown instruction: 0x"+Number(t[e.ip]).toString(16));r(e)}}},fr=[Dr.bind(void 0,Ar),Dr.bind(void 0,Er),Pr.bind(void 0,Ar),Pr.bind(void 0,Er),Br.bind(void 0,Ar),Br.bind(void 0,Er),Gr.bind(void 0,0),Gr.bind(void 0,1),_r.bind(void 0,0),_r.bind(void 0,1),function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"SPVFS[]",r,a),e.pv=e.dpv=Mr(a,r)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"SPVFS[]",r,a),e.fv=Mr(a,r)},function(e){var t=e.stack,r=e.pv;exports.DEBUG&&console.log(e.step,"GPV[]"),t.push(16384*r.x),t.push(16384*r.y)},function(e){var t=e.stack,r=e.fv;exports.DEBUG&&console.log(e.step,"GFV[]"),t.push(16384*r.x),t.push(16384*r.y)},function(e){e.fv=e.pv,exports.DEBUG&&console.log(e.step,"SFVTPV[]")},function(e){var t=e.stack,r=t.pop(),a=t.pop(),n=t.pop(),s=t.pop(),i=t.pop(),o=e.z0,c=e.z1,l=o[r],u=o[a],h=c[n],p=c[s],f=e.z2[i];exports.DEBUG&&console.log("ISECT[], ",r,a,n,s,i);var d=l.x,g=l.y,v=u.x,m=u.y,y=h.x,b=h.y,x=p.x,w=p.y,S=(d-v)*(b-w)-(g-m)*(y-x),T=d*m-g*v,F=y*w-b*x;f.x=(T*(y-x)-F*(d-v))/S,f.y=(T*(b-w)-F*(g-m))/S},function(e){e.rp0=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP0[]",e.rp0)},function(e){e.rp1=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP1[]",e.rp1)},function(e){e.rp2=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP2[]",e.rp2)},function(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP0[]",t),e.zp0=t,t){case 0:e.tZone||Ur(e),e.z0=e.tZone;break;case 1:e.z0=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP1[]",t),e.zp1=t,t){case 0:e.tZone||Ur(e),e.z1=e.tZone;break;case 1:e.z1=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP2[]",t),e.zp2=t,t){case 0:e.tZone||Ur(e),e.z2=e.tZone;break;case 1:e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZPS[]",t),e.zp0=e.zp1=e.zp2=t,t){case 0:e.tZone||Ur(e),e.z0=e.z1=e.z2=e.tZone;break;case 1:e.z0=e.z1=e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){e.loop=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SLOOP[]",e.loop)},function(e){exports.DEBUG&&console.log(e.step,"RTG[]"),e.round=xr},function(e){exports.DEBUG&&console.log(e.step,"RTHG[]"),e.round=Sr},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SMD[]",t),e.minDis=t/64},function(e){exports.DEBUG&&console.log(e.step,"ELSE[]"),Nr(e,!1)},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"JMPR[]",t),e.ip+=t-1},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCVTCI[]",t),e.cvCutIn=t/64},void 0,void 0,function(e){var t=e.stack;exports.DEBUG&&console.log(e.step,"DUP[]"),t.push(t[t.length-1])},Hr,function(e){exports.DEBUG&&console.log(e.step,"CLEAR[]"),e.stack.length=0},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"SWAP[]"),t.push(r),t.push(a)},function(e){var t=e.stack;exports.DEBUG&&console.log(e.step,"DEPTH[]"),t.push(t.length)},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"CINDEX[]",r),t.push(t[t.length-r])},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"MINDEX[]",r),t.push(t.splice(t.length-r,1)[0])},void 0,void 0,void 0,function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"LOOPCALL[]",r,a);var n=e.ip,s=e.prog;e.prog=e.funcs[r];for(var i=0;i<a;i++)dr(e),exports.DEBUG&&console.log(++e.step,i+1<a?"next loopcall":"done loopcall",i);e.ip=n,e.prog=s},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"CALL[]",t);var r=e.ip,a=e.prog;e.prog=e.funcs[t],dr(e),e.ip=r,e.prog=a,exports.DEBUG&&console.log(++e.step,"returning from",t)},function(e){if("fpgm"!==e.env)throw new Error("FDEF not allowed here");var t=e.stack,r=e.prog,a=e.ip,n=t.pop(),s=a;for(exports.DEBUG&&console.log(e.step,"FDEF[]",n);45!==r[++a];);e.ip=a,e.funcs[n]=r.slice(s+1,a)},void 0,Vr.bind(void 0,0),Vr.bind(void 0,1),zr.bind(void 0,Ar),zr.bind(void 0,Er),jr.bind(void 0,0),jr.bind(void 0,1),Wr.bind(void 0,0),Wr.bind(void 0,1),Xr.bind(void 0,0),Xr.bind(void 0,1),function(e){for(var t=e.stack,r=e.loop,a=e.fv,n=t.pop()/64,s=e.z2;r--;){var i=t.pop(),o=s[i];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-r)+": ":"")+"SHPIX[]",i,n),a.setRelative(o,o,n),a.touch(o)}e.loop=1},function(e){for(var t=e.stack,r=e.rp1,a=e.rp2,n=e.loop,s=e.z0[r],i=e.z1[a],o=e.fv,c=e.dpv,l=e.z2;n--;){var u=t.pop(),h=l[u];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-n)+": ":"")+"IP[]",u,r,"<->",a),o.interpolate(h,s,i,c),o.touch(h)}e.loop=1},qr.bind(void 0,0),qr.bind(void 0,1),function(e){for(var t=e.stack,r=e.rp0,a=e.z0[r],n=e.loop,s=e.fv,i=e.pv,o=e.z1;n--;){var c=t.pop(),l=o[c];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-n)+": ":"")+"ALIGNRP[]",c),s.setRelative(l,a,0,i),s.touch(l)}e.loop=1},function(e){exports.DEBUG&&console.log(e.step,"RTDG[]"),e.round=wr},Yr.bind(void 0,0),Yr.bind(void 0,1),function(e){var t=e.prog,r=e.ip,a=e.stack,n=t[++r];exports.DEBUG&&console.log(e.step,"NPUSHB[]",n);for(var s=0;s<n;s++)a.push(t[++r]);e.ip=r},function(e){var t=e.ip,r=e.prog,a=e.stack,n=r[++t];exports.DEBUG&&console.log(e.step,"NPUSHW[]",n);for(var s=0;s<n;s++){var i=r[++t]<<8|r[++t];32768&i&&(i=-(1+(65535^i))),a.push(i)}e.ip=t},function(e){var t=e.stack,r=e.store;r||(r=e.store=[]);var a=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"WS",a,n),r[n]=a},function(e){var t=e.stack,r=e.store,a=t.pop();exports.DEBUG&&console.log(e.step,"RS",a);var n=r&&r[a]||0;t.push(n)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"WCVTP",r,a),e.cvt[a]=r/64},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"RCVT",r),t.push(64*e.cvt[r])},Kr.bind(void 0,0),Kr.bind(void 0,1),void 0,Zr.bind(void 0,0),Zr.bind(void 0,1),function(e){exports.DEBUG&&console.log(e.step,"MPPEM[]"),e.stack.push(e.ppem)},void 0,function(e){exports.DEBUG&&console.log(e.step,"FLIPON[]"),e.autoFlip=!0},void 0,void 0,function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"LT[]",r,a),t.push(a<r?1:0)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"LTEQ[]",r,a),t.push(a<=r?1:0)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"GT[]",r,a),t.push(a>r?1:0)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"GTEQ[]",r,a),t.push(a>=r?1:0)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"EQ[]",r,a),t.push(r===a?1:0)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"NEQ[]",r,a),t.push(r!==a?1:0)},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"ODD[]",r),t.push(Math.trunc(r)%2?1:0)},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"EVEN[]",r),t.push(Math.trunc(r)%2?0:1)},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"IF[]",t),t||(Nr(e,!0),exports.DEBUG&&console.log(e.step,"EIF[]"))},function(e){exports.DEBUG&&console.log(e.step,"EIF[]")},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"AND[]",r,a),t.push(r&&a?1:0)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"OR[]",r,a),t.push(r||a?1:0)},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"NOT[]",r),t.push(r?0:1)},Qr.bind(void 0,1),function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SDB[]",t),e.deltaBase=t},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SDS[]",t),e.deltaShift=Math.pow(.5,t)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"ADD[]",r,a),t.push(a+r)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"SUB[]",r,a),t.push(a-r)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"DIV[]",r,a),t.push(64*a/r)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"MUL[]",r,a),t.push(a*r/64)},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"ABS[]",r),t.push(Math.abs(r))},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"NEG[]",r),t.push(-r)},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"FLOOR[]",r),t.push(64*Math.floor(r/64))},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"CEILING[]",r),t.push(64*Math.ceil(r/64))},$r.bind(void 0,0),$r.bind(void 0,1),$r.bind(void 0,2),$r.bind(void 0,3),void 0,void 0,void 0,void 0,function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"WCVTF[]",r,a),e.cvt[a]=r*e.ppem/e.font.unitsPerEm},Qr.bind(void 0,2),Qr.bind(void 0,3),Jr.bind(void 0,1),Jr.bind(void 0,2),Jr.bind(void 0,3),function(e){var t,r=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SROUND[]",r),e.round=kr,192&r){case 0:t=.5;break;case 64:t=1;break;case 128:t=2;break;default:throw new Error("invalid SROUND value")}switch(e.srPeriod=t,48&r){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*t;break;case 32:e.srPhase=.5*t;break;case 48:e.srPhase=.75*t;break;default:throw new Error("invalid SROUND value")}r&=15,e.srThreshold=0===r?0:(r/8-.5)*t},function(e){var t,r=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"S45ROUND[]",r),e.round=kr,192&r){case 0:t=Math.sqrt(2)/2;break;case 64:t=Math.sqrt(2);break;case 128:t=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(e.srPeriod=t,48&r){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*t;break;case 32:e.srPhase=.5*t;break;case 48:e.srPhase=.75*t;break;default:throw new Error("invalid S45ROUND value")}r&=15,e.srThreshold=0===r?0:(r/8-.5)*t},void 0,void 0,function(e){exports.DEBUG&&console.log(e.step,"ROFF[]"),e.round=br},void 0,function(e){exports.DEBUG&&console.log(e.step,"RUTG[]"),e.round=Tr},function(e){exports.DEBUG&&console.log(e.step,"RDTG[]"),e.round=Fr},Hr,Hr,void 0,void 0,void 0,void 0,void 0,function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCANCTRL[]",t)},ea.bind(void 0,0),ea.bind(void 0,1),function(e){var t=e.stack,r=t.pop(),a=0;exports.DEBUG&&console.log(e.step,"GETINFO[]",r),1&r&&(a=35),32&r&&(a|=4096),t.push(a)},void 0,function(e){var t=e.stack,r=t.pop(),a=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"ROLL[]"),t.push(a),t.push(r),t.push(n)},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"MAX[]",r,a),t.push(Math.max(a,r))},function(e){var t=e.stack,r=t.pop(),a=t.pop();exports.DEBUG&&console.log(e.step,"MIN[]",r,a),t.push(Math.min(a,r))},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCANTYPE[]",t)},function(e){var t=e.stack.pop(),r=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"INSTCTRL[]",t,r),t){case 1:return void(e.inhibitGridFit=!!r);case 2:return void(e.ignoreCvt=!!r);default:throw new Error("invalid INSTCTRL[] selector")}},void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,ta.bind(void 0,1),ta.bind(void 0,2),ta.bind(void 0,3),ta.bind(void 0,4),ta.bind(void 0,5),ta.bind(void 0,6),ta.bind(void 0,7),ta.bind(void 0,8),ra.bind(void 0,1),ra.bind(void 0,2),ra.bind(void 0,3),ra.bind(void 0,4),ra.bind(void 0,5),ra.bind(void 0,6),ra.bind(void 0,7),ra.bind(void 0,8),aa.bind(void 0,0,0,0,0,0),aa.bind(void 0,0,0,0,0,1),aa.bind(void 0,0,0,0,0,2),aa.bind(void 0,0,0,0,0,3),aa.bind(void 0,0,0,0,1,0),aa.bind(void 0,0,0,0,1,1),aa.bind(void 0,0,0,0,1,2),aa.bind(void 0,0,0,0,1,3),aa.bind(void 0,0,0,1,0,0),aa.bind(void 0,0,0,1,0,1),aa.bind(void 0,0,0,1,0,2),aa.bind(void 0,0,0,1,0,3),aa.bind(void 0,0,0,1,1,0),aa.bind(void 0,0,0,1,1,1),aa.bind(void 0,0,0,1,1,2),aa.bind(void 0,0,0,1,1,3),aa.bind(void 0,0,1,0,0,0),aa.bind(void 0,0,1,0,0,1),aa.bind(void 0,0,1,0,0,2),aa.bind(void 0,0,1,0,0,3),aa.bind(void 0,0,1,0,1,0),aa.bind(void 0,0,1,0,1,1),aa.bind(void 0,0,1,0,1,2),aa.bind(void 0,0,1,0,1,3),aa.bind(void 0,0,1,1,0,0),aa.bind(void 0,0,1,1,0,1),aa.bind(void 0,0,1,1,0,2),aa.bind(void 0,0,1,1,0,3),aa.bind(void 0,0,1,1,1,0),aa.bind(void 0,0,1,1,1,1),aa.bind(void 0,0,1,1,1,2),aa.bind(void 0,0,1,1,1,3),aa.bind(void 0,1,0,0,0,0),aa.bind(void 0,1,0,0,0,1),aa.bind(void 0,1,0,0,0,2),aa.bind(void 0,1,0,0,0,3),aa.bind(void 0,1,0,0,1,0),aa.bind(void 0,1,0,0,1,1),aa.bind(void 0,1,0,0,1,2),aa.bind(void 0,1,0,0,1,3),aa.bind(void 0,1,0,1,0,0),aa.bind(void 0,1,0,1,0,1),aa.bind(void 0,1,0,1,0,2),aa.bind(void 0,1,0,1,0,3),aa.bind(void 0,1,0,1,1,0),aa.bind(void 0,1,0,1,1,1),aa.bind(void 0,1,0,1,1,2),aa.bind(void 0,1,0,1,1,3),aa.bind(void 0,1,1,0,0,0),aa.bind(void 0,1,1,0,0,1),aa.bind(void 0,1,1,0,0,2),aa.bind(void 0,1,1,0,0,3),aa.bind(void 0,1,1,0,1,0),aa.bind(void 0,1,1,0,1,1),aa.bind(void 0,1,1,0,1,2),aa.bind(void 0,1,1,0,1,3),aa.bind(void 0,1,1,1,0,0),aa.bind(void 0,1,1,1,0,1),aa.bind(void 0,1,1,1,0,2),aa.bind(void 0,1,1,1,0,3),aa.bind(void 0,1,1,1,1,0),aa.bind(void 0,1,1,1,1,1),aa.bind(void 0,1,1,1,1,2),aa.bind(void 0,1,1,1,1,3)],na.prototype.setState=function(e,t){return this.state[e]=t,this.activeState={key:e,value:this.state[e]},this.activeState},na.prototype.getState=function(e){return this.state[e]||null},ua.prototype.inboundIndex=function(e){return e>=0&&e<this.tokens.length},ua.prototype.composeRUD=function(e){var t=this,r=e.map((function(e){return t[e[0]].apply(t,e.slice(1).concat(true))})),a=function(e){return"object"==typeof e&&e.hasOwnProperty("FAIL")};if(r.every(a))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:r.filter(a)};this.dispatch("composeRUD",[r.filter((function(e){return!a(e)}))])},ua.prototype.replaceRange=function(e,t,r,a){t=null!==t?t:this.tokens.length;var n=r.every((function(e){return e instanceof na}));if(!isNaN(e)&&this.inboundIndex(e)&&n){var s=this.tokens.splice.apply(this.tokens,[e,t].concat(r));return a||this.dispatch("replaceToken",[e,t,r]),[s,r]}return{FAIL:"replaceRange: invalid tokens or startIndex."}},ua.prototype.replaceToken=function(e,t,r){if(!isNaN(e)&&this.inboundIndex(e)&&t instanceof na){var a=this.tokens.splice(e,1,t);return r||this.dispatch("replaceToken",[e,t]),[a[0],t]}return{FAIL:"replaceToken: invalid token or index."}},ua.prototype.removeRange=function(e,t,r){t=isNaN(t)?this.tokens.length:t;var a=this.tokens.splice(e,t);return r||this.dispatch("removeRange",[a,e,t]),a},ua.prototype.removeToken=function(e,t){if(!isNaN(e)&&this.inboundIndex(e)){var r=this.tokens.splice(e,1);return t||this.dispatch("removeToken",[r,e]),r}return{FAIL:"removeToken: invalid token index."}},ua.prototype.insertToken=function(e,t,r){return e.every((function(e){return e instanceof na}))?(this.tokens.splice.apply(this.tokens,[t,0].concat(e)),r||this.dispatch("insertToken",[e,t]),e):{FAIL:"insertToken: invalid token(s)."}},ua.prototype.registerModifier=function(e,t,r){this.events.newToken.subscribe((function(a,n){var s=[a,n],i=[a,n];if(null===t||!0===t.apply(this,s)){var o=r.apply(this,i);a.setState(e,o)}})),this.registeredModifiers.push(e)},ca.prototype.subscribe=function(e){return"function"==typeof e?this.subscribers.push(e)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},ca.prototype.unsubscribe=function(e){this.subscribers.splice(e,1)},oa.prototype.setCurrentIndex=function(e){this.index=e,this.current=this.context[e],this.backtrack=this.context.slice(0,e),this.lookahead=this.context.slice(e+1)},oa.prototype.get=function(e){switch(!0){case 0===e:return this.current;case e<0&&Math.abs(e)<=this.backtrack.length:return this.backtrack.slice(e)[0];case e>0&&e<=this.lookahead.length:return this.lookahead[e-1];default:return null}},ua.prototype.rangeToText=function(e){if(e instanceof sa)return this.getRangeTokens(e).map((function(e){return e.char})).join("")},ua.prototype.getText=function(){return this.tokens.map((function(e){return e.char})).join("")},ua.prototype.getContext=function(e){var t=this.registeredContexts[e];return t||null},ua.prototype.on=function(e,t){var r=this.events[e];return r?r.subscribe(t):null},ua.prototype.dispatch=function(e,t){var r=this,a=this.events[e];a instanceof ca&&a.subscribers.forEach((function(e){e.apply(r,t||[])}))},ua.prototype.registerContextChecker=function(e,t,r){if(this.getContext(e))return{FAIL:"context name '"+e+"' is already registered."};if("function"!=typeof t)return{FAIL:"missing context start check."};if("function"!=typeof r)return{FAIL:"missing context end check."};var a=new ia(e,t,r);return this.registeredContexts[e]=a,this.contextCheckers.push(a),a},ua.prototype.getRangeTokens=function(e){var t=e.startIndex+e.endOffset;return[].concat(this.tokens.slice(e.startIndex,t))},ua.prototype.getContextRanges=function(e){var t=this.getContext(e);return t?t.ranges:{FAIL:"context checker '"+e+"' is not registered."}},ua.prototype.resetContextsRanges=function(){var e=this.registeredContexts;for(var t in e){if(e.hasOwnProperty(t))e[t].ranges=[]}},ua.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var e=this.tokens.map((function(e){return e.char})),t=0;t<e.length;t++){var r=new oa(e,t);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},ua.prototype.setEndOffset=function(e,t){var r=new sa(this.getContext(t).openRange.startIndex,e,t),a=this.getContext(t).ranges;return r.rangeId=t+"."+a.length,a.push(r),this.getContext(t).openRange=null,r},ua.prototype.runContextCheck=function(e){var t=this,r=e.index;this.contextCheckers.forEach((function(a){var n=a.contextName,s=t.getContext(n).openRange;if(!s&&a.checkStart(e)&&(s=new sa(r,null,n),t.getContext(n).openRange=s,t.dispatch("contextStart",[n,r])),s&&a.checkEnd(e)){var i=r-s.startIndex+1,o=t.setEndOffset(i,n);t.dispatch("contextEnd",[n,o])}}))},ua.prototype.tokenize=function(e){this.tokens=[],this.resetContextsRanges();var t=Array.from(e);this.dispatch("start");for(var r=0;r<t.length;r++){var a=t[r],n=new oa(t,r);this.dispatch("next",[n]),this.runContextCheck(n);var s=new na(a);this.tokens.push(s),this.dispatch("newToken",[s,n])}return this.dispatch("end",[this.tokens]),this.tokens},ga.prototype.getDefaultScriptFeaturesIndexes=function(){for(var e=this.font.tables.gsub.scripts,t=0;t<e.length;t++){var r=e[t];if("DFLT"===r.tag)return r.script.defaultLangSys.featureIndexes}return[]},ga.prototype.getScriptFeaturesIndexes=function(e){if(!this.font.tables.gsub)return[];if(!e)return this.getDefaultScriptFeaturesIndexes();for(var t=this.font.tables.gsub.scripts,r=0;r<t.length;r++){var a=t[r];if(a.tag===e&&a.script.defaultLangSys)return a.script.defaultLangSys.featureIndexes;var n=a.langSysRecords;if(n)for(var s=0;s<n.length;s++){var i=n[s];if(i.tag===e)return i.langSys.featureIndexes}}return this.getDefaultScriptFeaturesIndexes()},ga.prototype.mapTagsToFeatures=function(e,t){for(var r={},a=0;a<e.length;a++){var n=e[a].tag,s=e[a].feature;r[n]=s}this.features[t].tags=r},ga.prototype.getScriptFeatures=function(e){var t=this.features[e];if(this.features.hasOwnProperty(e))return t;var r=this.getScriptFeaturesIndexes(e);if(!r)return null;var a=this.font.tables.gsub;return t=r.map((function(e){return a.features[e]})),this.features[e]=t,this.mapTagsToFeatures(t,e),t},ga.prototype.getSubstitutionType=function(e,t){return e.lookupType.toString()+t.substFormat.toString()},ga.prototype.getLookupMethod=function(e,t){var r=this;switch(this.getSubstitutionType(e,t)){case"11":return function(e){return ya.apply(r,[e,t])};case"12":return function(e){return ba.apply(r,[e,t])};case"63":return function(e){return wa.apply(r,[e,t])};case"41":return function(e){return Sa.apply(r,[e,t])};case"21":return function(e){return Ta.apply(r,[e,t])};default:throw new Error("lookupType: "+e.lookupType+" - substFormat: "+t.substFormat+" is not yet supported")}},ga.prototype.lookupFeature=function(e){var t=e.contextParams,r=t.index,a=this.getFeature({tag:e.tag,script:e.script});if(!a)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+e.tag+"' for script '"+e.script+"'.");for(var n=this.getFeatureLookups(a),s=[].concat(t.context),i=0;i<n.length;i++)for(var o=n[i],c=this.getLookupSubtables(o),l=0;l<c.length;l++){var u=c[l],h=this.getSubstitutionType(o,u),p=this.getLookupMethod(o,u),f=void 0;switch(h){case"11":(f=p(t.current))&&s.splice(r,1,new va({id:11,tag:e.tag,substitution:f}));break;case"12":(f=p(t.current))&&s.splice(r,1,new va({id:12,tag:e.tag,substitution:f}));break;case"63":f=p(t),Array.isArray(f)&&f.length&&s.splice(r,1,new va({id:63,tag:e.tag,substitution:f}));break;case"41":(f=p(t))&&s.splice(r,1,new va({id:41,tag:e.tag,substitution:f}));break;case"21":(f=p(t.current))&&s.splice(r,1,new va({id:21,tag:e.tag,substitution:f}))}t=new oa(s,r),Array.isArray(f)&&!f.length||(f=null)}return s.length?s:null},ga.prototype.supports=function(e){if(!e.script)return!1;this.getScriptFeatures(e.script);var t=this.features.hasOwnProperty(e.script);if(!e.tag)return t;var r=this.features[e.script].some((function(t){return t.tag===e.tag}));return t&&r},ga.prototype.getLookupSubtables=function(e){return e.subtables||null},ga.prototype.getLookupByIndex=function(e){return this.font.tables.gsub.lookups[e]||null},ga.prototype.getFeatureLookups=function(e){return e.lookupListIndexes.map(this.getLookupByIndex.bind(this))},ga.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var t=this.features[e.script];return t?t.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};var Fa={startCheck:function(e){var t=e.current,r=e.get(-1);return null===r&&ha(t)||!ha(r)&&ha(t)},endCheck:function(e){var t=e.get(1);return null===t||!ha(t)}};var ka={startCheck:function(e){var t=e.current,r=e.get(-1);return(ha(t)||fa(t))&&!ha(r)},endCheck:function(e){var t=e.get(1);switch(!0){case null===t:return!0;case!ha(t)&&!fa(t):var r=/\s/.test(t);if(!r)return!0;if(r){if(!e.lookahead.some((function(e){return ha(e)||fa(e)})))return!0}break;default:return!1}}};var Ea={11:function(e,t,r){t[r].setState(e.tag,e.substitution)},12:function(e,t,r){t[r].setState(e.tag,e.substitution)},63:function(e,t,r){e.substitution.forEach((function(a,n){t[r+n].setState(e.tag,a)}))},41:function(e,t,r){var a=t[r];a.setState(e.tag,e.substitution.ligGlyph);for(var n=e.substitution.components.length,s=0;s<n;s++)(a=t[r+s+1]).setState("deleted",!0)}};function Aa(e,t,r){e instanceof va&&Ea[e.id]&&Ea[e.id](e,t,r)}function Ia(e){var t=this,r="arab",a=this.featuresTags.arab,n=this.tokenizer.getRangeTokens(e);if(1!==n.length){var s=new oa(n.map((function(e){return e.getState("glyphIndex")})),0),i=new oa(n.map((function(e){return e.char})),0);n.forEach((function(e,o){if(!fa(e.char)){s.setCurrentIndex(o),i.setCurrentIndex(o);var c,l=0;switch(function(e){for(var t=[].concat(e.backtrack),r=t.length-1;r>=0;r--){var a=t[r],n=pa(a),s=fa(a);if(!n&&!s)return!0;if(n)return!1}return!1}(i)&&(l|=1),function(e){if(pa(e.current))return!1;for(var t=0;t<e.lookahead.length;t++)if(!fa(e.lookahead[t]))return!0;return!1}(i)&&(l|=2),l){case 1:c="fina";break;case 2:c="init";break;case 3:c="medi"}if(-1!==a.indexOf(c)){var u=t.query.lookupFeature({tag:c,script:r,contextParams:s});if(u instanceof Error)return console.info(u.message);u.forEach((function(e,t){e instanceof va&&(Aa(e,n,t),s.context[t]=e.substitution)}))}}}))}}function Ma(e,t){return new oa(e.map((function(e){return e.activeState.value})),t||0)}function La(e){var t=this,r=this.tokenizer.getRangeTokens(e),a=Ma(r);a.context.forEach((function(e,n){a.setCurrentIndex(n);var s=t.query.lookupFeature({tag:"rlig",script:"arab",contextParams:a});s.length&&(s.forEach((function(e){return Aa(e,r,n)})),a=Ma(r))}))}var Ca={startCheck:function(e){var t=e.current,r=e.get(-1);return null===r&&da(t)||!da(r)&&da(t)},endCheck:function(e){var t=e.get(1);return null===t||!da(t)}};function Oa(e,t){return new oa(e.map((function(e){return e.activeState.value})),t||0)}function Ra(e){var t=this,r=this.tokenizer.getRangeTokens(e),a=Oa(r);a.context.forEach((function(e,n){a.setCurrentIndex(n);var s=t.query.lookupFeature({tag:"liga",script:"latn",contextParams:a});s.length&&(s.forEach((function(e){return Aa(e,r,n)})),a=Oa(r))}))}function Ua(e){this.baseDir=e||"ltr",this.tokenizer=new ua,this.featuresTags={}}function Na(e){var t=this.contextChecks[e+"Check"];return this.tokenizer.registerContextChecker(e,t.startCheck,t.endCheck)}function Da(){return Na.call(this,"latinWord"),Na.call(this,"arabicWord"),Na.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function Pa(){var e=this;this.tokenizer.getContextRanges("arabicSentence").forEach((function(t){var r=e.tokenizer.getRangeTokens(t);e.tokenizer.replaceRange(t.startIndex,t.endOffset,r.reverse())}))}function Ba(){if(-1===this.tokenizer.registeredModifiers.indexOf("glyphIndex"))throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function Ga(){var e=this;this.featuresTags.hasOwnProperty("arab")&&(Ba.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){Ia.call(e,t)})))}function _a(){var e=this,t="arab";this.featuresTags.hasOwnProperty(t)&&(-1!==this.featuresTags.arab.indexOf("rlig")&&(Ba.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){La.call(e,t)}))))}function Ha(){var e=this,t="latn";this.featuresTags.hasOwnProperty(t)&&(-1!==this.featuresTags.latn.indexOf("liga")&&(Ba.call(this),this.tokenizer.getContextRanges("latinWord").forEach((function(t){Ra.call(e,t)}))))}function Va(e){(e=e||{}).tables=e.tables||{},e.empty||(or(e.familyName,"When creating a new Font object, familyName is required."),or(e.styleName,"When creating a new Font object, styleName is required."),or(e.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),or(e.ascender,"When creating a new Font object, ascender is required."),or(e.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},fullName:{en:e.fullName||e.familyName+" "+e.styleName},postScriptName:{en:e.postScriptName||(e.familyName+e.styleName).replace(/\s/g,"")},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender,this.createdTimestamp=e.createdTimestamp,this.tables=Object.assign(e.tables,{os2:Object.assign({usWeightClass:e.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:e.widthClass||this.usWidthClasses.MEDIUM,fsSelection:e.fsSelection||this.fsSelectionValues.REGULAR},e.tables.os2)})),this.supported=!0,this.glyphs=new et.GlyphSet(this,e.glyphs||[]),this.encoding=new We(this),this.position=new rr(this),this.substitution=new ar(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){return this._hinting?this._hinting:"truetype"===this.outlinesFormat?this._hinting=new yr(this):void 0}})}function za(e,t){var r=JSON.stringify(e),a=256;for(var n in t){var s=parseInt(n);if(s&&!(s<256)){if(JSON.stringify(t[n])===r)return s;a<=s&&(a=s+1)}}return t[a]=e,a}function ja(e,t,r){var a=za(t.name,r);return[{name:"tag_"+e,type:"TAG",value:t.tag},{name:"minValue_"+e,type:"FIXED",value:t.minValue<<16},{name:"defaultValue_"+e,type:"FIXED",value:t.defaultValue<<16},{name:"maxValue_"+e,type:"FIXED",value:t.maxValue<<16},{name:"flags_"+e,type:"USHORT",value:0},{name:"nameID_"+e,type:"USHORT",value:a}]}function Wa(e,t,r){var a={},n=new Be.Parser(e,t);return a.tag=n.parseTag(),a.minValue=n.parseFixed(),a.defaultValue=n.parseFixed(),a.maxValue=n.parseFixed(),n.skip("uShort",1),a.name=r[n.parseUShort()]||{},a}function Xa(e,t,r,a){for(var n=[{name:"nameID_"+e,type:"USHORT",value:za(t.name,a)},{name:"flags_"+e,type:"USHORT",value:0}],s=0;s<r.length;++s){var i=r[s].tag;n.push({name:"axis_"+e+" "+i,type:"FIXED",value:t.coordinates[i]<<16})}return n}function qa(e,t,r,a){var n={},s=new Be.Parser(e,t);n.name=a[s.parseUShort()]||{},s.skip("uShort",1),n.coordinates={};for(var i=0;i<r.length;++i)n.coordinates[r[i].tag]=s.parseFixed();return n}Ua.prototype.setText=function(e){this.text=e},Ua.prototype.contextChecks={latinWordCheck:Ca,arabicWordCheck:Fa,arabicSentenceCheck:ka},Ua.prototype.registerFeatures=function(e,t){var r=this,a=t.filter((function(t){return r.query.supports({script:e,tag:t})}));this.featuresTags.hasOwnProperty(e)?this.featuresTags[e]=this.featuresTags[e].concat(a):this.featuresTags[e]=a},Ua.prototype.applyFeatures=function(e,t){if(!e)throw new Error("No valid font was provided to apply features");this.query||(this.query=new ga(e));for(var r=0;r<t.length;r++){var a=t[r];this.query.supports({script:a.script})&&this.registerFeatures(a.script,a.tags)}},Ua.prototype.registerModifier=function(e,t,r){this.tokenizer.registerModifier(e,t,r)},Ua.prototype.checkContextReady=function(e){return!!this.tokenizer.getContext(e)},Ua.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(Ga.call(this),_a.call(this)),this.checkContextReady("latinWord")&&Ha.call(this),this.checkContextReady("arabicSentence")&&Pa.call(this)},Ua.prototype.processText=function(e){this.text&&this.text===e||(this.setText(e),Da.call(this),this.applyFeaturesToContexts())},Ua.prototype.getBidiText=function(e){return this.processText(e),this.tokenizer.getText()},Ua.prototype.getTextGlyphs=function(e){this.processText(e);for(var t=[],r=0;r<this.tokenizer.tokens.length;r++){var a=this.tokenizer.tokens[r];if(!a.state.deleted){var n=a.activeState.value;t.push(Array.isArray(n)?n[0]:n)}}return t},Va.prototype.hasChar=function(e){return null!==this.encoding.charToGlyphIndex(e)},Va.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)},Va.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},Va.prototype.updateFeatures=function(e){return this.defaultRenderOptions.features.map((function(t){return"latn"===t.script?{script:"latn",tags:t.tags.filter((function(t){return e[t]}))}:t}))},Va.prototype.stringToGlyphs=function(e,t){var r=this,a=new Ua;a.registerModifier("glyphIndex",null,(function(e){return r.charToGlyphIndex(e.char)}));var n=t?this.updateFeatures(t.features):this.defaultRenderOptions.features;a.applyFeatures(this,n);for(var s=a.getTextGlyphs(e),i=s.length,o=new Array(i),c=this.glyphs.get(0),l=0;l<i;l+=1)o[l]=this.glyphs.get(s[l])||c;return o},Va.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)},Va.prototype.nameToGlyph=function(e){var t=this.nameToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},Va.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""},Va.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,e,t):this.kerningPairs[e+","+t]||0},Va.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},Va.prototype.forEachGlyph=function(e,t,r,a,n,s){t=void 0!==t?t:0,r=void 0!==r?r:0,a=void 0!==a?a:72,n=Object.assign({},this.defaultRenderOptions,n);var i,o=1/this.unitsPerEm*a,c=this.stringToGlyphs(e,n);if(n.kerning){var l=n.script||this.position.getDefaultScriptName();i=this.position.getKerningTables(l,n.language)}for(var u=0;u<c.length;u+=1){var h=c[u];if(s.call(this,h,t,r,a,n),h.advanceWidth&&(t+=h.advanceWidth*o),n.kerning&&u<c.length-1)t+=(i?this.position.getKerningValue(i,h.index,c[u+1].index):this.getKerningValue(h,c[u+1]))*o;n.letterSpacing?t+=n.letterSpacing*a:n.tracking&&(t+=n.tracking/1e3*a)}return t},Va.prototype.getPath=function(e,t,r,a,n){var s=new ie;return this.forEachGlyph(e,t,r,a,n,(function(e,t,r,a){var i=e.getPath(t,r,a,n,this);s.extend(i)})),s},Va.prototype.getPaths=function(e,t,r,a,n){var s=[];return this.forEachGlyph(e,t,r,a,n,(function(e,t,r,a){var i=e.getPath(t,r,a,n,this);s.push(i)})),s},Va.prototype.getAdvanceWidth=function(e,t,r){return this.forEachGlyph(e,0,0,t,r,(function(){}))},Va.prototype.draw=function(e,t,r,a,n,s){this.getPath(t,r,a,n,s).draw(e)},Va.prototype.drawPoints=function(e,t,r,a,n,s){this.forEachGlyph(t,r,a,n,s,(function(t,r,a,n){t.drawPoints(e,r,a,n)}))},Va.prototype.drawMetrics=function(e,t,r,a,n,s){this.forEachGlyph(t,r,a,n,s,(function(t,r,a,n){t.drawMetrics(e,r,a,n)}))},Va.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en},Va.prototype.validate=function(){var e=this;function t(t){var r=e.getEnglishName(t);r&&r.trim().length}t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),this.unitsPerEm},Va.prototype.toTables=function(){return Qt.fontToTable(this)},Va.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},Va.prototype.toArrayBuffer=function(){for(var e=this.toTables().encode(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),a=0;a<e.length;a++)r[a]=e[a];return t},Va.prototype.download=function(e){var t=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");e=e||t.replace(/\s/g,"")+"-"+r+".otf";var a=this.toArrayBuffer();if("undefined"!=typeof window)if(window.URL=window.URL||window.webkitURL,window.URL){var n=new DataView(a),s=new Blob([n],{type:"font/opentype"}),i=document.createElement("a");i.href=window.URL.createObjectURL(s),i.download=e;var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),i.dispatchEvent(o)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var c=require("fs"),l=function(e){for(var t=new Buffer(e.byteLength),r=new Uint8Array(e),a=0;a<t.length;++a)t[a]=r[a];return t}(a);c.writeFileSync(e,l)}},Va.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},Va.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},Va.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var Ya={make:function(e,t){var r=new Le.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:e.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:e.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*e.axes.length}]);r.offsetToData=r.sizeOf();for(var a=0;a<e.axes.length;a++)r.fields=r.fields.concat(ja(a,e.axes[a],t));for(var n=0;n<e.instances.length;n++)r.fields=r.fields.concat(Xa(n,e.instances[n],e.axes,t));return r},parse:function(e,t,r){var a=new Be.Parser(e,t),n=a.parseULong();le.argument(65536===n,"Unsupported fvar table version.");var s=a.parseOffset16();a.skip("uShort",1);for(var i=a.parseUShort(),o=a.parseUShort(),c=a.parseUShort(),l=a.parseUShort(),u=[],h=0;h<i;h++)u.push(Wa(e,t+s+h*o,r));for(var p=[],f=t+s+i*o,d=0;d<c;d++)p.push(qa(e,f+d*l,u,r));return{axes:u,instances:p}}},Ka=new Array(10);Ka[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{posFormat:1,coverage:this.parsePointer(De.coverage),value:this.parseValueRecord()}:2===t?{posFormat:2,coverage:this.parsePointer(De.coverage),values:this.parseValueRecordList()}:void le.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},Ka[2]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();le.assert(1===t||2===t,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var r=this.parsePointer(De.coverage),a=this.parseUShort(),n=this.parseUShort();if(1===t)return{posFormat:t,coverage:r,valueFormat1:a,valueFormat2:n,pairSets:this.parseList(De.pointer(De.list((function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(a),value2:this.parseValueRecord(n)}}))))};if(2===t){var s=this.parsePointer(De.classDef),i=this.parsePointer(De.classDef),o=this.parseUShort(),c=this.parseUShort();return{posFormat:t,coverage:r,valueFormat1:a,valueFormat2:n,classDef1:s,classDef2:i,class1Count:o,class2Count:c,classRecords:this.parseList(o,De.list(c,(function(){return{value1:this.parseValueRecord(a),value2:this.parseValueRecord(n)}})))}}},Ka[3]=function(){return{error:"GPOS Lookup 3 not supported"}},Ka[4]=function(){return{error:"GPOS Lookup 4 not supported"}},Ka[5]=function(){return{error:"GPOS Lookup 5 not supported"}},Ka[6]=function(){return{error:"GPOS Lookup 6 not supported"}},Ka[7]=function(){return{error:"GPOS Lookup 7 not supported"}},Ka[8]=function(){return{error:"GPOS Lookup 8 not supported"}},Ka[9]=function(){return{error:"GPOS Lookup 9 not supported"}};var Za=new Array(10);var Qa={parse:function(e,t){var r=new De(e,t=t||0),a=r.parseVersion(1);return le.argument(1===a||1.1===a,"Unsupported GPOS table version "+a),1===a?{version:a,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Ka)}:{version:a,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Ka),variations:r.parseFeatureVariationsList()}},make:function(e){return new Le.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Le.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new Le.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new Le.LookupList(e.lookups,Za)}])}};var $a={parse:function(e,t){var r=new Be.Parser(e,t),a=r.parseUShort();if(0===a)return function(e){var t={};e.skip("uShort");var r=e.parseUShort();le.argument(0===r,"Unsupported kern sub-table version."),e.skip("uShort",2);var a=e.parseUShort();e.skip("uShort",3);for(var n=0;n<a;n+=1){var s=e.parseUShort(),i=e.parseUShort(),o=e.parseShort();t[s+","+i]=o}return t}(r);if(1===a)return function(e){var t={};e.skip("uShort"),e.parseULong()>1&&console.warn("Only the first kern subtable is supported."),e.skip("uLong");var r=255&e.parseUShort();if(e.skip("uShort"),0===r){var a=e.parseUShort();e.skip("uShort",3);for(var n=0;n<a;n+=1){var s=e.parseUShort(),i=e.parseUShort(),o=e.parseShort();t[s+","+i]=o}}return t}(r);throw new Error("Unsupported kern table version ("+a+").")}};var Ja={parse:function(e,t,r,a){for(var n=new Be.Parser(e,t),s=a?n.parseUShort:n.parseULong,i=[],o=0;o<r+1;o+=1){var c=s.call(n);a&&(c*=2),i.push(c)}return i}};function en(e,t){require("fs").readFile(e,(function(e,r){if(e)return t(e.message);t(null,ir(r))}))}function tn(e,t){var r=new XMLHttpRequest;r.open("get",e,!0),r.responseType="arraybuffer",r.onload=function(){return r.response?t(null,r.response):t("Font could not be loaded: "+r.statusText)},r.onerror=function(){t("Font could not be loaded")},r.send()}function rn(e,t){for(var r=[],a=12,n=0;n<t;n+=1){var s=Be.getTag(e,a),i=Be.getULong(e,a+4),o=Be.getULong(e,a+8),c=Be.getULong(e,a+12);r.push({tag:s,checksum:i,offset:o,length:c,compression:!1}),a+=16}return r}function an(e,t){if("WOFF"===t.compression){var r=new Uint8Array(e.buffer,t.offset+2,t.compressedLength-2),a=new Uint8Array(t.length);if(ae(r,a),a.byteLength!==t.length)throw new Error("Decompression error: "+t.tag+" decompressed length doesn't match recorded length");return{data:new DataView(a.buffer,0),offset:0}}return{data:e,offset:t.offset}}function nn(e,t){var r,a;t=null==t?{}:t;var n,s,i,o,c,l,u,h,p,f,d,g,v=new Va({empty:!0}),m=new DataView(e,0),y=[],b=Be.getTag(m,0);if(b===String.fromCharCode(0,1,0,0)||"true"===b||"typ1"===b)v.outlinesFormat="truetype",y=rn(m,n=Be.getUShort(m,4));else if("OTTO"===b)v.outlinesFormat="cff",y=rn(m,n=Be.getUShort(m,4));else{if("wOFF"!==b)throw new Error("Unsupported OpenType signature "+b);var x=Be.getTag(m,4);if(x===String.fromCharCode(0,1,0,0))v.outlinesFormat="truetype";else{if("OTTO"!==x)throw new Error("Unsupported OpenType flavor "+b);v.outlinesFormat="cff"}y=function(e,t){for(var r=[],a=44,n=0;n<t;n+=1){var s=Be.getTag(e,a),i=Be.getULong(e,a+4),o=Be.getULong(e,a+8),c=Be.getULong(e,a+12),l=void 0;l=o<c&&"WOFF",r.push({tag:s,offset:i,compression:l,compressedLength:o,length:c}),a+=20}return r}(m,n=Be.getUShort(m,12))}for(var w=0;w<n;w+=1){var S=y[w],T=void 0;switch(S.tag){case"cmap":T=an(m,S),v.tables.cmap=_e.parse(T.data,T.offset),v.encoding=new Xe(v.tables.cmap);break;case"cvt ":T=an(m,S),g=new Be.Parser(T.data,T.offset),v.tables.cvt=g.parseShortList(S.length/2);break;case"fvar":i=S;break;case"fpgm":T=an(m,S),g=new Be.Parser(T.data,T.offset),v.tables.fpgm=g.parseByteList(S.length);break;case"head":T=an(m,S),v.tables.head=xt.parse(T.data,T.offset),v.unitsPerEm=v.tables.head.unitsPerEm,r=v.tables.head.indexToLocFormat;break;case"hhea":T=an(m,S),v.tables.hhea=wt.parse(T.data,T.offset),v.ascender=v.tables.hhea.ascender,v.descender=v.tables.hhea.descender,v.numberOfHMetrics=v.tables.hhea.numberOfHMetrics;break;case"hmtx":u=S;break;case"ltag":T=an(m,S),a=Tt.parse(T.data,T.offset);break;case"maxp":T=an(m,S),v.tables.maxp=Ft.parse(T.data,T.offset),v.numGlyphs=v.tables.maxp.numGlyphs;break;case"name":f=S;break;case"OS/2":T=an(m,S),v.tables.os2=Bt.parse(T.data,T.offset);break;case"post":T=an(m,S),v.tables.post=Gt.parse(T.data,T.offset),v.glyphNames=new Ye(v.tables.post);break;case"prep":T=an(m,S),g=new Be.Parser(T.data,T.offset),v.tables.prep=g.parseByteList(S.length);break;case"glyf":o=S;break;case"loca":p=S;break;case"CFF ":s=S;break;case"kern":h=S;break;case"GPOS":c=S;break;case"GSUB":l=S;break;case"meta":d=S}}var F=an(m,f);if(v.tables.name=Dt.parse(F.data,F.offset,a),v.names=v.tables.name,o&&p){var k=0===r,E=an(m,p),A=Ja.parse(E.data,E.offset,v.numGlyphs,k),I=an(m,o);v.glyphs=mr.parse(I.data,I.offset,A,v,t)}else{if(!s)throw new Error("Font doesn't contain TrueType or CFF outlines.");var M=an(m,s);bt.parse(M.data,M.offset,v,t)}var L=an(m,u);if(St.parse(v,L.data,L.offset,v.numberOfHMetrics,v.numGlyphs,v.glyphs,t),Ke(v,t),h){var C=an(m,h);v.kerningPairs=$a.parse(C.data,C.offset)}else v.kerningPairs={};if(c){var O=an(m,c);v.tables.gpos=Qa.parse(O.data,O.offset),v.position.init()}if(l){var R=an(m,l);v.tables.gsub=zt.parse(R.data,R.offset)}if(i){var U=an(m,i);v.tables.fvar=Ya.parse(U.data,U.offset,v.names)}if(d){var N=an(m,d);v.tables.meta=jt.parse(N.data,N.offset),v.metas=v.tables.meta}return v}var sn=Object.freeze({__proto__:null,Font:Va,Glyph:Qe,Path:ie,BoundingBox:se,_parse:Be,parse:nn,load:function(e,t,r){var a="undefined"==typeof window?en:tn;return new Promise((function(n,s){a(e,(function(e,a){if(e){if(t)return t(e);s(e)}var i;try{i=nn(a,r)}catch(e){if(t)return t(e,null);s(e)}if(t)return t(null,i);n(i)}))}))},loadSync:function(e,t){return nn(ir(require("fs").readFileSync(e)),t)}}),on=function(t){e.Loader.call(this,t),this.reversed=!1};on.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:on,load:function(t,r,a,n){var s=this,i=new e.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,(function(e){try{r(s.parse(e))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),a,n)},parse:function(e){function t(e){var t,r=[];e.forEach((function(e){"m"===e.type.toLowerCase()?(t=[e],r.push(t)):"z"!==e.type.toLowerCase()&&t.push(e)}));var a=[];return r.forEach((function(e){var t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};a.push(t);for(var r=e.length-1;r>0;r--){var n=e[r];t={type:n.type};void 0!==n.x2&&void 0!==n.y2?(t.x1=n.x2,t.y1=n.y2,t.x2=n.x1,t.y2=n.y1):void 0!==n.x1&&void 0!==n.y1&&(t.x1=n.x1,t.y1=n.y1),t.x=e[r-1].x,t.y=e[r-1].y,a.push(t)}})),a}return void 0===sn?(console.warn("THREE.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,r){for(var a=Math.round,n={},s=1e5/(72*(e.unitsPerEm||2048)),i=e.encoding.cmap.glyphIndexMap,o=Object.keys(i),c=0;c<o.length;c++){var l=o[c],u=e.glyphs.glyphs[i[l]];if(void 0!==l){var h={ha:a(u.advanceWidth*s),x_min:a(u.xMin*s),x_max:a(u.xMax*s),o:""};r&&(u.path.commands=t(u.path.commands)),u.path.commands.forEach((function(e){"c"===e.type.toLowerCase()&&(e.type="b"),h.o+=e.type.toLowerCase()+" ",void 0!==e.x&&void 0!==e.y&&(h.o+=a(e.x*s)+" "+a(e.y*s)+" "),void 0!==e.x1&&void 0!==e.y1&&(h.o+=a(e.x1*s)+" "+a(e.y1*s)+" "),void 0!==e.x2&&void 0!==e.y2&&(h.o+=a(e.x2*s)+" "+a(e.y2*s)+" ")})),n[String.fromCodePoint(u.unicode)]=h}}return{glyphs:n,familyName:e.getEnglishName("fullName"),ascender:a(e.ascender*s),descender:a(e.descender*s),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(sn.parse(e),this.reversed)}});var cn=function(t){e.Loader.call(this,t),this.animateBonePositions=!0,this.animateBoneRotations=!0};function ln(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}return r}cn.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:cn,load:function(t,r,a,n){var s=this,i=new e.FileLoader(s.manager);i.setPath(s.path),i.setRequestHeader(s.requestHeader),i.setWithCredentials(s.withCredentials),i.load(t,(function(e){try{r(s.parse(e))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),a,n)},parse:function(t){function r(t,a,n){if("ENDSITE"!==n.type){var s={time:a,position:new e.Vector3,rotation:new e.Quaternion};n.frames.push(s);for(var i=new e.Quaternion,o=new e.Vector3(1,0,0),c=new e.Vector3(0,1,0),l=new e.Vector3(0,0,1),u=0;u<n.channels.length;u++)switch(n.channels[u]){case"Xposition":s.position.x=parseFloat(t.shift().trim());break;case"Yposition":s.position.y=parseFloat(t.shift().trim());break;case"Zposition":s.position.z=parseFloat(t.shift().trim());break;case"Xrotation":i.setFromAxisAngle(o,parseFloat(t.shift().trim())*Math.PI/180),s.rotation.multiply(i);break;case"Yrotation":i.setFromAxisAngle(c,parseFloat(t.shift().trim())*Math.PI/180),s.rotation.multiply(i);break;case"Zrotation":i.setFromAxisAngle(l,parseFloat(t.shift().trim())*Math.PI/180),s.rotation.multiply(i);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(u=0;u<n.children.length;u++)r(t,a,n.children[u])}}function a(t,r,s){var i={name:"",type:"",frames:[]};s.push(i);var o=r.split(/[\s]+/);"END"===o[0].toUpperCase()&&"SITE"===o[1].toUpperCase()?(i.type="ENDSITE",i.name="ENDSITE"):(i.name=o[1],i.type=o[0].toUpperCase()),"{"!==n(t)&&console.error("THREE.BVHLoader: Expected opening { after type & name"),"OFFSET"!==(o=n(t).split(/[\s]+/))[0]&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+o[0]),4!==o.length&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");var c=new e.Vector3(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));if((isNaN(c.x)||isNaN(c.y)||isNaN(c.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET."),i.offset=c,"ENDSITE"!==i.type){"CHANNELS"!==(o=n(t).split(/[\s]+/))[0]&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");var l=parseInt(o[1]);i.channels=o.splice(2,l),i.children=[]}for(;;){var u=n(t);if("}"===u)return i;i.children.push(a(t,u,s))}}function n(e){for(var t;0===(t=e.shift().trim()).length;);return t}var s=this,i=function(e){"HIERARCHY"!==n(e)&&console.error("THREE.BVHLoader: HIERARCHY expected.");var t=[],s=a(e,n(e),t);"MOTION"!==n(e)&&console.error("THREE.BVHLoader: MOTION expected.");var i=n(e).split(/[\s]+/),o=parseInt(i[1]);isNaN(o)&&console.error("THREE.BVHLoader: Failed to read number of frames."),i=n(e).split(/[\s]+/);var c=parseFloat(i[2]);isNaN(c)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(var l=0;l<o;l++)r(i=n(e).split(/[\s]+/),l*c,s);return t}(t.split(/[\r\n]+/g)),o=[];!function t(r,a){var n=new e.Bone;if(a.push(n),n.position.add(r.offset),n.name=r.name,"ENDSITE"!==r.type)for(var s=0;s<r.children.length;s++)n.add(t(r.children[s],a));return n}(i[0],o);var c=function(t){for(var r=[],a=0;a<t.length;a++){var n=t[a];if("ENDSITE"!==n.type){for(var i=[],o=[],c=[],l=0;l<n.frames.length;l++){var u=n.frames[l];i.push(u.time),o.push(u.position.x+n.offset.x),o.push(u.position.y+n.offset.y),o.push(u.position.z+n.offset.z),c.push(u.rotation.x),c.push(u.rotation.y),c.push(u.rotation.z),c.push(u.rotation.w)}s.animateBonePositions&&r.push(new e.VectorKeyframeTrack(".bones["+n.name+"].position",i,o)),s.animateBoneRotations&&r.push(new e.QuaternionKeyframeTrack(".bones["+n.name+"].quaternion",i,c))}}return new e.AnimationClip("animation",-1,r)}(i);return{skeleton:new e.Skeleton(o),clip:c}}});var un={},hn=Uint8Array,pn=Uint16Array,fn=Uint32Array,dn=new hn([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gn=new hn([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),vn=new hn([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mn=function(e,t){for(var r=new pn(31),a=0;a<31;++a)r[a]=t+=1<<e[a-1];var n=new fn(r[30]);for(a=1;a<30;++a)for(var s=r[a];s<r[a+1];++s)n[s]=s-r[a]<<5|a;return[r,n]},yn=mn(dn,2),bn=yn[0],xn=yn[1];bn[28]=258,xn[258]=28;for(var wn=mn(gn,0),Sn=wn[0],Tn=wn[1],Fn=new pn(32768),kn=0;kn<32768;++kn){var En=(43690&kn)>>>1|(21845&kn)<<1;En=(61680&(En=(52428&En)>>>2|(13107&En)<<2))>>>4|(3855&En)<<4,Fn[kn]=((65280&En)>>>8|(255&En)<<8)>>>1}var An=function(e,t,r){for(var a=e.length,n=0,s=new pn(t);n<a;++n)++s[e[n]-1];var i,o=new pn(t);for(n=0;n<t;++n)o[n]=o[n-1]+s[n-1]<<1;if(r){i=new pn(1<<t);var c=15-t;for(n=0;n<a;++n)if(e[n])for(var l=n<<4|e[n],u=t-e[n],h=o[e[n]-1]++<<u,p=h|(1<<u)-1;h<=p;++h)i[Fn[h]>>>c]=l}else for(i=new pn(a),n=0;n<a;++n)e[n]&&(i[n]=Fn[o[e[n]-1]++]>>>15-e[n]);return i},In=new hn(288);for(kn=0;kn<144;++kn)In[kn]=8;for(kn=144;kn<256;++kn)In[kn]=9;for(kn=256;kn<280;++kn)In[kn]=7;for(kn=280;kn<288;++kn)In[kn]=8;var Mn=new hn(32);for(kn=0;kn<32;++kn)Mn[kn]=5;var Ln=An(In,9,0),Cn=An(In,9,1),On=An(Mn,5,0),Rn=An(Mn,5,1),Un=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Nn=function(e,t,r){var a=t/8|0;return(e[a]|e[a+1]<<8)>>(7&t)&r},Dn=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},Pn=function(e){return(e/8|0)+(7&e&&1)},Bn=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var a=new(e instanceof pn?pn:e instanceof fn?fn:hn)(r-t);return a.set(e.subarray(t,r)),a},Gn=function(e,t,r){var a=e.length;if(!a||r&&!r.l&&a<5)return t||new hn(0);var n=!t||r,s=!r||r.i;r||(r={}),t||(t=new hn(3*a));var i=function(e){var r=t.length;if(e>r){var a=new hn(Math.max(2*r,e));a.set(t),t=a}},o=r.f||0,c=r.p||0,l=r.b||0,u=r.l,h=r.d,p=r.m,f=r.n,d=8*a;do{if(!u){r.f=o=Nn(e,c,1);var g=Nn(e,c+1,3);if(c+=3,!g){var v=e[(A=Pn(c)+4)-4]|e[A-3]<<8,m=A+v;if(m>a){if(s)throw"unexpected EOF";break}n&&i(l+v),t.set(e.subarray(A,m),l),r.b=l+=v,r.p=c=8*m;continue}if(1==g)u=Cn,h=Rn,p=9,f=5;else{if(2!=g)throw"invalid block type";var y=Nn(e,c,31)+257,b=Nn(e,c+10,15)+4,x=y+Nn(e,c+5,31)+1;c+=14;for(var w=new hn(x),S=new hn(19),T=0;T<b;++T)S[vn[T]]=Nn(e,c+3*T,7);c+=3*b;var F=Un(S),k=(1<<F)-1;if(!s&&c+x*(F+7)>d)break;var E=An(S,F,1);for(T=0;T<x;){var A,I=E[Nn(e,c,k)];if(c+=15&I,(A=I>>>4)<16)w[T++]=A;else{var M=0,L=0;for(16==A?(L=3+Nn(e,c,3),c+=2,M=w[T-1]):17==A?(L=3+Nn(e,c,7),c+=3):18==A&&(L=11+Nn(e,c,127),c+=7);L--;)w[T++]=M}}var C=w.subarray(0,y),O=w.subarray(y);p=Un(C),f=Un(O),u=An(C,p,1),h=An(O,f,1)}if(c>d)throw"unexpected EOF"}n&&i(l+131072);for(var R=(1<<p)-1,U=(1<<f)-1,N=p+f+18;s||c+N<d;){var D=(M=u[Dn(e,c)&R])>>>4;if((c+=15&M)>d)throw"unexpected EOF";if(!M)throw"invalid length/literal";if(D<256)t[l++]=D;else{if(256==D){u=null;break}var P=D-254;if(D>264){var B=dn[T=D-257];P=Nn(e,c,(1<<B)-1)+bn[T],c+=B}var G=h[Dn(e,c)&U],_=G>>>4;if(!G)throw"invalid distance";c+=15&G;O=Sn[_];if(_>3){B=gn[_];O+=Dn(e,c)&(1<<B)-1,c+=B}if(c>d)throw"unexpected EOF";n&&i(l+131072);for(var H=l+P;l<H;l+=4)t[l]=t[l-O],t[l+1]=t[l+1-O],t[l+2]=t[l+2-O],t[l+3]=t[l+3-O];l=H}}r.l=u,r.p=c,r.b=l,u&&(o=1,r.m=p,r.d=h,r.n=f)}while(!o);return l==t.length?t:Bn(t,0,l)},_n=function(e,t,r){r<<=7&t;var a=t/8|0;e[a]|=r,e[a+1]|=r>>>8},Hn=function(e,t,r){r<<=7&t;var a=t/8|0;e[a]|=r,e[a+1]|=r>>>8,e[a+2]|=r>>>16},Vn=function(e,t){for(var r=[],a=0;a<e.length;++a)e[a]&&r.push({s:a,f:e[a]});var n=r.length,s=r.slice();if(!n)return[Kn,0];if(1==n){var i=new hn(r[0].s+1);return i[r[0].s]=1,[i,1]}r.sort((function(e,t){return e.f-t.f})),r.push({s:-1,f:25001});var o=r[0],c=r[1],l=0,u=1,h=2;for(r[0]={s:-1,f:o.f+c.f,l:o,r:c};u!=n-1;)o=r[r[l].f<r[h].f?l++:h++],c=r[l!=u&&r[l].f<r[h].f?l++:h++],r[u++]={s:-1,f:o.f+c.f,l:o,r:c};var p=s[0].s;for(a=1;a<n;++a)s[a].s>p&&(p=s[a].s);var f=new pn(p+1),d=zn(r[u-1],f,0);if(d>t){a=0;var g=0,v=d-t,m=1<<v;for(s.sort((function(e,t){return f[t.s]-f[e.s]||e.f-t.f}));a<n;++a){var y=s[a].s;if(!(f[y]>t))break;g+=m-(1<<d-f[y]),f[y]=t}for(g>>>=v;g>0;){var b=s[a].s;f[b]<t?g-=1<<t-f[b]++-1:++a}for(;a>=0&&g;--a){var x=s[a].s;f[x]==t&&(--f[x],++g)}d=t}return[new hn(f),d]},zn=function(e,t,r){return-1==e.s?Math.max(zn(e.l,t,r+1),zn(e.r,t,r+1)):t[e.s]=r},jn=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new pn(++t),a=0,n=e[0],s=1,i=function(e){r[a++]=e},o=1;o<=t;++o)if(e[o]==n&&o!=t)++s;else{if(!n&&s>2){for(;s>138;s-=138)i(32754);s>2&&(i(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(i(n),--s;s>6;s-=6)i(8304);s>2&&(i(s-3<<5|8208),s=0)}for(;s--;)i(n);s=1,n=e[o]}return[r.subarray(0,a),t]},Wn=function(e,t){for(var r=0,a=0;a<t.length;++a)r+=e[a]*t[a];return r},Xn=function(e,t,r){var a=r.length,n=Pn(t+2);e[n]=255&a,e[n+1]=a>>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var s=0;s<a;++s)e[n+s+4]=r[s];return 8*(n+4+a)},qn=function(e,t,r,a,n,s,i,o,c,l,u){_n(t,u++,r),++n[256];for(var h=Vn(n,15),p=h[0],f=h[1],d=Vn(s,15),g=d[0],v=d[1],m=jn(p),y=m[0],b=m[1],x=jn(g),w=x[0],S=x[1],T=new pn(19),F=0;F<y.length;++F)T[31&y[F]]++;for(F=0;F<w.length;++F)T[31&w[F]]++;for(var k=Vn(T,7),E=k[0],A=k[1],I=19;I>4&&!E[vn[I-1]];--I);var M,L,C,O,R=l+5<<3,U=Wn(n,In)+Wn(s,Mn)+i,N=Wn(n,p)+Wn(s,g)+i+14+3*I+Wn(T,E)+(2*T[16]+3*T[17]+7*T[18]);if(R<=U&&R<=N)return Xn(t,u,e.subarray(c,c+l));if(_n(t,u,1+(N<U)),u+=2,N<U){M=An(p,f,0),L=p,C=An(g,v,0),O=g;var D=An(E,A,0);_n(t,u,b-257),_n(t,u+5,S-1),_n(t,u+10,I-4),u+=14;for(F=0;F<I;++F)_n(t,u+3*F,E[vn[F]]);u+=3*I;for(var P=[y,w],B=0;B<2;++B){var G=P[B];for(F=0;F<G.length;++F){var _=31&G[F];_n(t,u,D[_]),u+=E[_],_>15&&(_n(t,u,G[F]>>>5&127),u+=G[F]>>>12)}}}else M=Ln,L=In,C=On,O=Mn;for(F=0;F<o;++F)if(a[F]>255){_=a[F]>>>18&31;Hn(t,u,M[_+257]),u+=L[_+257],_>7&&(_n(t,u,a[F]>>>23&31),u+=dn[_]);var H=31&a[F];Hn(t,u,C[H]),u+=O[H],H>3&&(Hn(t,u,a[F]>>>5&8191),u+=gn[H])}else Hn(t,u,M[a[F]]),u+=L[a[F]];return Hn(t,u,M[256]),u+L[256]},Yn=new fn([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Kn=new hn(0),Zn=function(e,t,r,a,n,s){var i=e.length,o=new hn(a+i+5*(1+Math.ceil(i/7e3))+n),c=o.subarray(a,o.length-n),l=0;if(!t||i<8)for(var u=0;u<=i;u+=65535){var h=u+65535;h<i?l=Xn(c,l,e.subarray(u,h)):(c[u]=s,l=Xn(c,l,e.subarray(u,i)))}else{for(var p=Yn[t-1],f=p>>>13,d=8191&p,g=(1<<r)-1,v=new pn(32768),m=new pn(g+1),y=Math.ceil(r/3),b=2*y,x=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<b)&g},w=new fn(25e3),S=new pn(288),T=new pn(32),F=0,k=0,E=(u=0,0),A=0,I=0;u<i;++u){var M=x(u),L=32767&u,C=m[M];if(v[L]=C,m[M]=L,A<=u){var O=i-u;if((F>7e3||E>24576)&&O>423){l=qn(e,c,0,w,S,T,k,E,I,u-I,l),E=F=k=0,I=u;for(var R=0;R<286;++R)S[R]=0;for(R=0;R<30;++R)T[R]=0}var U=2,N=0,D=d,P=L-C&32767;if(O>2&&M==x(u-P))for(var B=Math.min(f,O)-1,G=Math.min(32767,u),_=Math.min(258,O);P<=G&&--D&&L!=C;){if(e[u+U]==e[u+U-P]){for(var H=0;H<_&&e[u+H]==e[u+H-P];++H);if(H>U){if(U=H,N=P,H>B)break;var V=Math.min(P,H-2),z=0;for(R=0;R<V;++R){var j=u-P+R+32768&32767,W=j-v[j]+32768&32767;W>z&&(z=W,C=j)}}}P+=(L=C)-(C=v[L])+32768&32767}if(N){w[E++]=268435456|xn[U]<<18|Tn[N];var X=31&xn[U],q=31&Tn[N];k+=dn[X]+gn[q],++S[257+X],++T[q],A=u+U,++F}else w[E++]=e[u],++S[e[u]]}}l=qn(e,c,s,w,S,T,k,E,I,u-I,l),!s&&7&l&&(l=Xn(c,l+1,Kn))}return Bn(o,0,a+Pn(l)+n)},Qn=function(){for(var e=new fn(256),t=0;t<256;++t){for(var r=t,a=9;--a;)r=(1&r&&3988292384)^r>>>1;e[t]=r}return e}(),$n=function(){var e=-1;return{p:function(t){for(var r=e,a=0;a<t.length;++a)r=Qn[255&r^t[a]]^r>>>8;e=r},d:function(){return~e}}},Jn=function(){var e=1,t=0;return{p:function(r){for(var a=e,n=t,s=r.length,i=0;i!=s;){for(var o=Math.min(i+2655,s);i<o;++i)n+=a+=r[i];a=(65535&a)+15*(a>>16),n=(65535&n)+15*(n>>16)}e=a,t=n},d:function(){return((e%=65521)>>>8<<16|(255&(t%=65521))<<8|t>>>8)+2*((255&e)<<23)}}},es=function(e,t,r,a,n){return Zn(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,a,!n)},ts=function(e,t){var r={};for(var a in e)r[a]=e[a];for(var a in t)r[a]=t[a];return r},rs=function(e,t,r){for(var a=e(),n=e.toString(),s=n.slice(n.indexOf("[")+1,n.lastIndexOf("]")).replace(/ /g,"").split(","),i=0;i<a.length;++i){var o=a[i],c=s[i];if("function"==typeof o){t+=";"+c+"=";var l=o.toString();if(o.prototype)if(-1!=l.indexOf("[native code]")){var u=l.indexOf(" ",8)+1;t+=l.slice(u,l.indexOf("(",u))}else for(var h in t+=l,o.prototype)t+=";"+c+".prototype."+h+"="+o.prototype[h].toString();else t+=l}else r[c]=o}return[t,r]},as=[],ns=function(t,r,a,n){var s;if(!as[a]){for(var i="",o={},c=t.length-1,l=0;l<c;++l)i=(s=rs(t[l],i,o))[0],o=s[1];as[a]=rs(t[c],i,o)}var u=ts({},as[a][1]);return function(t,r,a,n,s){var i=un[r]||(un[r]=e.$URL.createObjectURL(new e.$Blob([t],{type:"text/javascript"}))),o=new Worker(i);return o.onerror=function(e){return s(e.error,null)},o.onmessage=function(e){return s(null,e.data)},o.postMessage(a,n),o}(as[a][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+r.toString()+"}",a,u,function(e){var t=[];for(var r in e)(e[r]instanceof hn||e[r]instanceof pn||e[r]instanceof fn)&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t}(u),n)},ss=function(){return[hn,pn,fn,dn,gn,vn,bn,Sn,Cn,Rn,Fn,An,Un,Nn,Dn,Pn,Bn,Gn,Us,hs,ps]},is=function(){return[hn,pn,fn,dn,gn,vn,xn,Tn,Ln,In,On,Mn,Fn,Yn,Kn,An,_n,Hn,Vn,zn,jn,Wn,Xn,qn,Pn,Bn,Zn,es,Ls,hs]},os=function(){return[xs,Ts,bs,$n,Qn]},cs=function(){return[ws,Ss]},ls=function(){return[Fs,bs,Jn]},us=function(){return[ks]},hs=function(e){return postMessage(e,[e.buffer])},ps=function(e){return e&&e.size&&new hn(e.size)},fs=function(e,t,r,a,n,s){var i=ns(r,a,n,(function(e,t){i.terminate(),s(e,t)}));return i.postMessage([e,t],t.consume?[e.buffer]:[]),function(){i.terminate()}},ds=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},gs=function(e,t,r,a,n){var s,i=ns(e,a,n,(function(e,r){e?(i.terminate(),t.ondata.call(t,e)):(r[1]&&i.terminate(),t.ondata.call(t,e,r[0],r[1]))}));i.postMessage(r),t.push=function(e,r){if(s)throw"stream finished";if(!t.ondata)throw"no stream handler";i.postMessage([e,s=r],[e.buffer])},t.terminate=function(){i.terminate()}},vs=function(e,t){return e[t]|e[t+1]<<8},ms=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+2*(e[t+3]<<23)},ys=function(e,t){return ms(e,t)|4294967296*ms(e,t)},bs=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},xs=function(e,t){var r=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&bs(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),r){e[3]=8;for(var a=0;a<=r.length;++a)e[a+10]=r.charCodeAt(a)}},ws=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],r=10;4&t&&(r+=e[10]|2+(e[11]<<8));for(var a=(t>>3&1)+(t>>4&1);a>0;a-=!e[r++]);return r+(2&t)},Ss=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16)+2*(e[t-1]<<23)},Ts=function(e){return 10+(e.filename&&e.filename.length+1||0)},Fs=function(e,t){var r=t.level,a=0==r?0:r<6?1:9==r?3:2;e[0]=120,e[1]=a<<6|(a?32-2*a:1)},ks=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function Es(e,t){return!t&&"function"==typeof e&&(t=e,e={}),this.ondata=t,e}var As=function(){function e(e,t){!t&&"function"==typeof e&&(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(es(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Is=function(e,t){gs([is,function(){return[ds,As]}],this,Es.call(this,e,t),(function(e){var t=new As(e.data);onmessage=ds(t)}),6)};function Ms(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return fs(e,t,[is],(function(e){return hs(Ls(e.data[0],e.data[1]))}),0,r)}function Ls(e,t){return es(e,t||{},0,0)}var Cs=function(){function e(e){this.s={},this.p=new hn(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,r=new hn(t+e.length);r.set(this.p),r.set(e,t),this.p=r},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,r=Gn(this.p,this.o,this.s);this.ondata(Bn(r,t,this.s.b),this.d),this.o=Bn(r,this.s.b-32768),this.s.b=this.o.length,this.p=Bn(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),Os=function(e){this.ondata=e,gs([ss,function(){return[ds,Cs]}],this,0,(function(){var e=new Cs;onmessage=ds(e)}),7)};function Rs(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return fs(e,t,[ss],(function(e){return hs(Us(e.data[0],ps(e.data[1])))}),1,r)}function Us(e,t){return Gn(e,t)}var Ns=function(){function e(e,t){this.c=$n(),this.l=0,this.v=1,As.call(this,e,t)}return e.prototype.push=function(e,t){As.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var r=es(e,this.o,this.v&&Ts(this.o),t&&8,!t);this.v&&(xs(r,this.o),this.v=0),t&&(bs(r,r.length-8,this.c.d()),bs(r,r.length-4,this.l)),this.ondata(r,t)},e}(),Ds=function(e,t){gs([is,os,function(){return[ds,As,Ns]}],this,Es.call(this,e,t),(function(e){var t=new Ns(e.data);onmessage=ds(t)}),8)};function Ps(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return fs(e,t,[is,os,function(){return[Bs]}],(function(e){return hs(Bs(e.data[0],e.data[1]))}),2,r)}function Bs(e,t){t||(t={});var r=$n(),a=e.length;r.p(e);var n=es(e,t,Ts(t),8),s=n.length;return xs(n,t),bs(n,s-8,r.d()),bs(n,s-4,a),n}var Gs=function(){function e(e){this.v=1,Cs.call(this,e)}return e.prototype.push=function(e,t){if(Cs.prototype.e.call(this,e),this.v){var r=this.p.length>3?ws(this.p):4;if(r>=this.p.length&&!t)return;this.p=this.p.subarray(r),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Cs.prototype.c.call(this,t)},e}(),_s=function(e){this.ondata=e,gs([ss,cs,function(){return[ds,Cs,Gs]}],this,0,(function(){var e=new Gs;onmessage=ds(e)}),9)};function Hs(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return fs(e,t,[ss,cs,function(){return[Vs]}],(function(e){return hs(Vs(e.data[0]))}),3,r)}function Vs(e,t){return Gn(e.subarray(ws(e),-8),t||new hn(Ss(e)))}var zs=function(){function e(e,t){this.c=Jn(),this.v=1,As.call(this,e,t)}return e.prototype.push=function(e,t){As.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var r=es(e,this.o,this.v&&2,t&&4,!t);this.v&&(Fs(r,this.o),this.v=0),t&&bs(r,r.length-4,this.c.d()),this.ondata(r,t)},e}(),js=function(e,t){gs([is,ls,function(){return[ds,As,zs]}],this,Es.call(this,e,t),(function(e){var t=new zs(e.data);onmessage=ds(t)}),10)};function Ws(e,t){t||(t={});var r=Jn();r.p(e);var a=es(e,t,2,4);return Fs(a,t),bs(a,a.length-4,r.d()),a}var Xs=function(){function e(e){this.v=1,Cs.call(this,e)}return e.prototype.push=function(e,t){if(Cs.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Cs.prototype.c.call(this,t)},e}(),qs=function(e){this.ondata=e,gs([ss,us,function(){return[ds,Cs,Xs]}],this,0,(function(){var e=new Xs;onmessage=ds(e)}),11)};function Ys(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return fs(e,t,[ss,us,function(){return[Ks]}],(function(e){return hs(Ks(e.data[0],ps(e.data[1])))}),5,r)}function Ks(e,t){return Gn((ks(e),e.subarray(2,-4)),t)}var Zs=function(){function e(e){this.G=Gs,this.I=Cs,this.Z=Xs,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var r=new hn(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var a=this,n=function(){a.ondata.apply(a,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(n):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(n):new this.Z(n),this.s.push(this.p,t),this.p=null}}},e}(),Qs=function(){function e(e){this.G=_s,this.I=Os,this.Z=qs,this.ondata=e}return e.prototype.push=function(e,t){Zs.prototype.push.call(this,e,t)},e}();var $s=function(e,t,r,a){for(var n in e){var s=e[n],i=t+n;s instanceof hn?r[i]=[s,a]:Array.isArray(s)?r[i]=[s[0],ts(a,s[1])]:$s(s,i+"/",r,a)}},Js="undefined"!=typeof TextEncoder&&new TextEncoder,ei=void 0!==e.$TextDecoder&&new e.$TextDecoder,ti=0;try{ei.decode(Kn,{stream:!0}),ti=1}catch(e){}var ri=function(e){for(var t="",r=0;;){var a=e[r++],n=(a>127)+(a>223)+(a>239);if(r+n>e.length)return[t,Bn(e,r-1)];n?3==n?(a=((15&a)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t+=String.fromCharCode(55296|a>>10,56320|1023&a)):t+=1&n?String.fromCharCode((31&a)<<6|63&e[r++]):String.fromCharCode((15&a)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(a)}},ai=function(){function t(t){this.ondata=t,ti?this.t=new e.$TextDecoder:this.p=Kn}return t.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t||(t=!1),this.t)return this.ondata(this.t.decode(e,{stream:!t}),t);var r=new hn(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length);var a=ri(r),n=a[0],s=a[1];if(t&&s.length)throw"invalid utf-8 data";this.p=s,this.ondata(n,t)},t}(),ni=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";this.ondata(si(e),t||!1)},e}();function si(e,t){if(t){for(var r=new hn(e.length),a=0;a<e.length;++a)r[a]=e.charCodeAt(a);return r}if(Js)return Js.encode(e);var n=e.length,s=new hn(e.length+(e.length>>1)),i=0,o=function(e){s[i++]=e};for(a=0;a<n;++a){if(i+5>s.length){var c=new hn(i+8+(n-a<<1));c.set(s),s=c}var l=e.charCodeAt(a);l<128||t?o(l):l<2048?(o(192|l>>>6),o(128|63&l)):l>55295&&l<57344?(o(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++a))>>>18),o(128|l>>>12&63),o(128|l>>>6&63),o(128|63&l)):(o(224|l>>>12),o(128|l>>>6&63),o(128|63&l))}return Bn(s,0,i)}function ii(e,t){if(t){for(var r="",a=0;a<e.length;a+=16384)r+=String.fromCharCode.apply(null,e.subarray(a,a+16384));return r}if(ei)return ei.decode(e);var n=ri(e),s=n[0];if(n[1].length)throw"invalid utf-8 data";return s}var oi=function(e){return 1==e?3:e<6?2:9==e?1:0},ci=function(e,t){return t+30+vs(e,t+26)+vs(e,t+28)},li=function(e,t,r){var a=vs(e,t+28),n=ii(e.subarray(t+46,t+46+a),!(2048&vs(e,t+8))),s=t+46+a,i=ms(e,t+20),o=r&&4294967295==i?ui(e,s):[i,ms(e,t+24),ms(e,t+42)],c=o[0],l=o[1],u=o[2];return[vs(e,t+10),c,l,n,s+vs(e,t+30)+vs(e,t+32),u]},ui=function(e,t){for(;1!=vs(e,t);t+=4+vs(e,t+2));return[ys(e,t+12),ys(e,t+4),ys(e,t+20)]},hi=function(e){var t=0;if(e)for(var r in e){var a=e[r].length;if(a>65535)throw"extra field too long";t+=a+4}return t},pi=function(e,t,r,a,n,s,i,o){var c=a.length,l=r.extra,u=o&&o.length,h=hi(l);bs(e,t,null!=i?33639248:67324752),t+=4,null!=i&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(null==s&&8),e[t++]=n&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var p=new Date(null==r.mtime?Date.now():r.mtime),f=p.getFullYear()-1980;if(f<0||f>119)throw"date not in range 1980-2099";if(bs(e,t,2*(f<<24)|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>>1),t+=4,null!=s&&(bs(e,t,r.crc),bs(e,t+4,s),bs(e,t+8,r.size)),bs(e,t+12,c),bs(e,t+14,h),t+=16,null!=i&&(bs(e,t,u),bs(e,t+6,r.attrs),bs(e,t+10,i),t+=14),e.set(a,t),t+=c,h)for(var d in l){var g=l[d],v=g.length;bs(e,t,+d),bs(e,t+2,v),e.set(g,t+4),t+=4+v}return u&&(e.set(o,t),t+=u),t},fi=function(e,t,r,a,n){bs(e,t,101010256),bs(e,t+8,r),bs(e,t+10,r),bs(e,t+12,a),bs(e,t+16,n)},di=function(){function e(e){this.filename=e,this.c=$n(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),gi=function(){function e(e,t){var r=this;t||(t={}),di.call(this,e),this.d=new As(t,(function(e,t){r.ondata(null,e,t)})),this.compression=8,this.flag=oi(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){di.prototype.push.call(this,e,t)},e}(),vi=function(){function e(e,t){var r=this;t||(t={}),di.call(this,e),this.d=new Is(t,(function(e,t,a){r.ondata(e,t,a)})),this.compression=8,this.flag=oi(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){di.prototype.push.call(this,e,t)},e}(),mi=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var r=si(e.filename),a=r.length,n=e.comment,s=n&&si(n),i=a!=e.filename.length||s&&n.length!=s.length,o=a+hi(e.extra)+30;if(a>65535)throw"filename too long";var c=new hn(o);pi(c,0,e,r,i);var l=[c],u=function(){for(var e=0,r=l;e<r.length;e++){var a=r[e];t.ondata(null,a,!1)}l=[]},h=this.d;this.d=0;var p=this.u.length,f=ts(e,{f:r,u:i,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),h){var e=t.u[p+1];e?e.r():t.d=1}h=1}}),d=0;e.ondata=function(r,a,n){if(r)t.ondata(r,a,n),t.terminate();else if(d+=a.length,l.push(a),n){var s=new hn(16);bs(s,0,134695760),bs(s,4,e.crc),bs(s,8,d),bs(s,12,e.size),l.push(s),f.c=d,f.b=o+d+16,f.crc=e.crc,f.size=e.size,h&&f.r(),h=1}else h&&u()},this.u.push(f)},e.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,r=0,a=0,n=this.u;a<n.length;a++){r+=46+(c=n[a]).f.length+hi(c.extra)+(c.o?c.o.length:0)}for(var s=new hn(r+22),i=0,o=this.u;i<o.length;i++){var c=o[i];pi(s,e,c,c.f,c.u,c.c,t,c.o),e+=46+c.f.length+hi(c.extra)+(c.o?c.o.length:0),t+=c.b}fi(s,e,this.u.length,r,t),this.ondata(null,s,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){t[e].t()}this.d=2},e}();var yi=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),bi=function(){function e(){var e=this;this.i=new Cs((function(t,r){e.ondata(null,t,r)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(r){this.ondata(r,e,t)}},e.compression=8,e}(),xi=function(){function e(e,t){var r=this;t<32e4?this.i=new Cs((function(e,t){r.ondata(null,e,t)})):(this.i=new Os((function(e,t,a){r.ondata(e,t,a)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=Bn(e,0)),this.i.push(e,t)},e.compression=8,e}(),wi=function(){function e(e){this.onfile=e,this.k=[],this.o={0:yi},this.p=Kn}return e.prototype.push=function(e,t){var r=this;if(!this.onfile)throw"no callback";if(this.c>0){var a=Math.min(this.c,e.length),n=e.subarray(0,a);if(this.c-=a,this.d?this.d.push(n,!this.c):this.k[0].push(n),(e=e.subarray(a)).length)return this.push(e,t)}else{var s=0,i=0,o=void 0,c=void 0;this.p.length?e.length?((c=new hn(this.p.length+e.length)).set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var l=c.length,u=this.c,h=u&&this.d,p=function(){var e,t=ms(c,i);if(67324752==t){s=1,o=i,f.d=null,f.c=0;var a=vs(c,i+6),n=vs(c,i+8),h=2048&a,p=8&a,d=vs(c,i+26),g=vs(c,i+28);if(l>i+30+d+g){var v=[];f.k.unshift(v),s=2;var m=ms(c,i+18),y=ms(c,i+22),b=ii(c.subarray(i+30,i+=30+d),!h);4294967295==m?(e=p?[-2]:ui(c,i),m=e[0],y=e[1]):p&&(m=-1),i+=g,f.c=m;var x={name:b,compression:n,start:function(){if(!x.ondata)throw"no callback";if(m){var e=r.o[n];if(!e)throw"unknown compression type "+n;var t=m<0?new e(b):new e(b,m,y);t.ondata=function(e,t,r){x.ondata(e,t,r)};for(var a=0,s=v;a<s.length;a++){var i=s[a];t.push(i,!1)}r.k[0]==v?r.d=t:t.push(Kn,!0)}else x.ondata(null,Kn,!0)},terminate:function(){r.k[0]==v&&r.d.terminate&&r.d.terminate()}};m>=0&&(x.size=m,x.originalSize=y),f.onfile(x)}return"break"}if(u){if(134695760==t)return o=i+=12+(-2==u&&8),s=2,f.c=0,"break";if(33639248==t)return o=i-=4,s=2,f.c=0,"break"}},f=this;i<l-4;++i){if("break"===p())break}if(this.p=Kn,u<0){var d=s?c.subarray(0,o-12-(-2==u&&8)-(134695760==ms(c,o-16)&&4)):c.subarray(0,i);h?h.push(d,!!s):this.k[+(2==s)].push(d)}if(2&s)return this.push(c.subarray(i),t);this.p=c.subarray(i)}if(t&&this.c)throw"invalid zip file"},e.prototype.register=function(e){this.o[e.compression]=e},e}();var Si=Object.freeze({__proto__:null,default:null,AsyncCompress:Ds,AsyncDecompress:Qs,AsyncDeflate:Is,AsyncGunzip:_s,AsyncGzip:Ds,AsyncInflate:Os,AsyncUnzipInflate:xi,AsyncUnzlib:qs,AsyncZipDeflate:vi,AsyncZlib:js,Compress:Ns,DecodeUTF8:ai,Decompress:Zs,Deflate:As,EncodeUTF8:ni,Gunzip:Gs,Gzip:Ns,Inflate:Cs,Unzip:wi,UnzipInflate:bi,UnzipPassThrough:yi,Unzlib:Xs,Zip:mi,ZipDeflate:gi,ZipPassThrough:di,Zlib:zs,compress:Ps,compressSync:Bs,decompress:function(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?Hs(e,t,r):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Rs(e,t,r):Ys(e,t,r)},decompressSync:function(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?Vs(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Us(e,t):Ks(e,t)},deflate:Ms,deflateSync:Ls,gunzip:Hs,gunzipSync:Vs,gzip:Ps,gzipSync:Bs,inflate:Rs,inflateSync:Us,strFromU8:ii,strToU8:si,unzip:function(e,t){if("function"!=typeof t)throw"no callback";for(var r=[],a=function(){for(var e=0;e<r.length;++e)r[e]()},n={},s=e.length-22;101010256!=ms(e,s);--s)if(!s||e.length-s>65558)return void t("invalid zip file",null);var i=vs(e,s+8);i||t(null,{});var o=i,c=ms(e,s+16),l=4294967295==c;if(l){if(s=ms(e,s-12),101075792!=ms(e,s))return void t("invalid zip file",null);o=i=ms(e,s+32),c=ms(e,s+48)}for(var u=function(s){var o=li(e,c,l),u=o[0],h=o[1],p=o[2],f=o[3],d=o[4],g=o[5],v=ci(e,g);c=d;var m=function(e,r){e?(a(),t(e,null)):(n[f]=r,--i||t(null,n))};if(u)if(8==u){var y=e.subarray(v,v+h);if(h<32e4)try{m(null,Us(y,new hn(p)))}catch(e){m(e,null)}else r.push(Rs(y,{size:p},m))}else m("unknown compression type "+u,null);else m(null,Bn(e,v,v+h))},h=0;h<o;++h)u();return a},unzipSync:function(e){for(var t={},r=e.length-22;101010256!=ms(e,r);--r)if(!r||e.length-r>65558)throw"invalid zip file";var a=vs(e,r+8);if(!a)return{};var n=ms(e,r+16),s=4294967295==n;if(s){if(r=ms(e,r-12),101075792!=ms(e,r))throw"invalid zip file";a=ms(e,r+32),n=ms(e,r+48)}for(var i=0;i<a;++i){var o=li(e,n,s),c=o[0],l=o[1],u=o[2],h=o[3],p=o[4],f=o[5],d=ci(e,f);if(n=p,c){if(8!=c)throw"unknown compression type "+c;t[h]=Us(e.subarray(d,d+l),new hn(u))}else t[h]=Bn(e,d,d+l)}return t},unzlib:Ys,unzlibSync:Ks,zip:function(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";var a={};$s(e,"",a,t);var n=Object.keys(a),s=n.length,i=0,o=0,c=s,l=new Array(s),u=[],h=function(){for(var e=0;e<u.length;++e)u[e]()},p=function(){var e=new hn(o+22),t=i,a=o-i;o=0;for(var n=0;n<c;++n){var s=l[n];try{var u=s.c.length;pi(e,o,s,s.f,s.u,u);var h=30+s.f.length+hi(s.extra),p=o+h;e.set(s.c,p),pi(e,i,s,s.f,s.u,u,o,s.m),i+=16+h+(s.m?s.m.length:0),o=p+u}catch(e){return r(e,null)}}fi(e,i,l.length,a,t),r(null,e)};s||p();for(var f=function(e){var t=n[e],c=a[t],f=c[0],d=c[1],g=$n(),v=f.length;g.p(f);var m=si(t),y=m.length,b=d.comment,x=b&&si(b),w=x&&x.length,S=hi(d.extra),T=0==d.level?0:8,F=function(a,n){if(a)h(),r(a,null);else{var c=n.length;l[e]=ts(d,{size:v,crc:g.d(),c:n,f:m,m:x,u:y!=t.length||x&&b.length!=w,compression:T}),i+=30+y+S+c,o+=76+2*(y+S)+(w||0)+c,--s||p()}};if(y>65535&&F("filename too long",null),T)if(v<16e4)try{F(null,Ls(f,d))}catch(e){F(e,null)}else u.push(Ms(f,d,F));else F(null,f)},d=0;d<c;++d)f(d);return h},zipSync:function(e,t){t||(t={});var r={},a=[];$s(e,"",r,t);var n=0,s=0;for(var i in r){var o=r[i],c=o[0],l=o[1],u=0==l.level?0:8,h=(T=si(i)).length,p=l.comment,f=p&&si(p),d=f&&f.length,g=hi(l.extra);if(h>65535)throw"filename too long";var v=u?Ls(c,l):c,m=v.length,y=$n();y.p(c),a.push(ts(l,{size:c.length,crc:y.d(),c:v,f:T,m:f,u:h!=i.length||f&&p.length!=d,o:n,compression:u})),n+=30+h+g+m,s+=76+2*(h+g)+(d||0)+m}for(var b=new hn(s+22),x=n,w=s-n,S=0;S<a.length;++S){var T=a[S];pi(b,T.o,T,T.f,T.u,T.c.length);var F=30+T.f.length+hi(T.extra);b.set(T.c,T.o+F),pi(b,n,T,T.f,T.u,T.c.length,T.o,T.m),n+=16+F+(T.m?T.m.length:0)}return fi(b,n,a.length,w,x),b},zlib:function(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return fs(e,t,[is,ls,function(){return[Ws]}],(function(e){return hs(Ws(e.data[0],e.data[1]))}),4,r)},zlibSync:Ws}),Ti={findSpan:function(e,t,r){var a=r.length-e-1;if(t>=r[a])return a-1;if(t<=r[e])return e;for(var n=e,s=a,i=Math.floor((n+s)/2);t<r[i]||t>=r[i+1];)t<r[i]?s=i:n=i,i=Math.floor((n+s)/2);return i},calcBasisFunctions:function(e,t,r,a){var n=[],s=[],i=[];n[0]=1;for(var o=1;o<=r;++o){s[o]=t-a[e+1-o],i[o]=a[e+o]-t;for(var c=0,l=0;l<o;++l){var u=i[l+1],h=s[o-l],p=n[l]/(u+h);n[l]=c+u*p,c=h*p}n[o]=c}return n},calcBSplinePoint:function(t,r,a,n){for(var s=this.findSpan(t,n,r),i=this.calcBasisFunctions(s,n,t,r),o=new e.Vector4(0,0,0,0),c=0;c<=t;++c){var l=a[s-t+c],u=i[c],h=l.w*u;o.x+=l.x*h,o.y+=l.y*h,o.z+=l.z*h,o.w+=l.w*u}return o},calcBasisFunctionDerivatives:function(e,t,r,a,n){for(var s=[],i=0;i<=r;++i)s[i]=0;var o=[];for(i=0;i<=a;++i)o[i]=s.slice(0);var c=[];for(i=0;i<=r;++i)c[i]=s.slice(0);c[0][0]=1;for(var l=s.slice(0),u=s.slice(0),h=1;h<=r;++h){l[h]=t-n[e+1-h],u[h]=n[e+h]-t;for(var p=0,f=0;f<h;++f){var d=u[f+1],g=l[h-f];c[h][f]=d+g;var v=c[f][h-1]/c[h][f];c[f][h]=p+d*v,p=g*v}c[h][h]=p}for(h=0;h<=r;++h)o[0][h]=c[h][r];for(f=0;f<=r;++f){var m=0,y=1,b=[];for(i=0;i<=r;++i)b[i]=s.slice(0);b[0][0]=1;for(var x=1;x<=a;++x){var w=0,S=f-x,T=r-x;f>=x&&(b[y][0]=b[m][0]/c[T+1][S],w=b[y][0]*c[S][T]);var F=f-1<=T?x-1:r-f;for(h=S>=-1?1:-S;h<=F;++h)b[y][h]=(b[m][h]-b[m][h-1])/c[T+1][S+h],w+=b[y][h]*c[S+h][T];f<=T&&(b[y][x]=-b[m][x-1]/c[T+1][f],w+=b[y][x]*c[f][T]),o[x][f]=w;h=m;m=y,y=h}}for(f=r,x=1;x<=a;++x){for(h=0;h<=r;++h)o[x][h]*=f;f*=r-x}return o},calcBSplineDerivatives:function(t,r,a,n,s){for(var i=s<t?s:t,o=[],c=this.findSpan(t,n,r),l=this.calcBasisFunctionDerivatives(c,n,t,i,r),u=[],h=0;h<a.length;++h){var p=(d=a[h].clone()).w;d.x*=p,d.y*=p,d.z*=p,u[h]=d}for(var f=0;f<=i;++f){for(var d=u[c-t].clone().multiplyScalar(l[f][0]),g=1;g<=t;++g)d.add(u[c-t+g].clone().multiplyScalar(l[f][g]));o[f]=d}for(f=i+1;f<=s+1;++f)o[f]=new e.Vector4(0,0,0);return o},calcKoverI:function(e,t){for(var r=1,a=2;a<=e;++a)r*=a;var n=1;for(a=2;a<=t;++a)n*=a;for(a=2;a<=e-t;++a)n*=a;return r/n},calcRationalCurveDerivatives:function(t){for(var r=t.length,a=[],n=[],s=0;s<r;++s){var i=t[s];a[s]=new e.Vector3(i.x,i.y,i.z),n[s]=i.w}for(var o=[],c=0;c<r;++c){var l=a[c].clone();for(s=1;s<=c;++s)l.sub(o[c-s].clone().multiplyScalar(this.calcKoverI(c,s)*n[s]));o[c]=l.divideScalar(n[0])}return o},calcNURBSDerivatives:function(e,t,r,a,n){var s=this.calcBSplineDerivatives(e,t,r,a,n);return this.calcRationalCurveDerivatives(s)},calcSurfacePoint:function(t,r,a,n,s,i,o,c){for(var l=this.findSpan(t,i,a),u=this.findSpan(r,o,n),h=this.calcBasisFunctions(l,i,t,a),p=this.calcBasisFunctions(u,o,r,n),f=[],d=0;d<=r;++d){f[d]=new e.Vector4(0,0,0,0);for(var g=0;g<=t;++g){var v=s[l-t+g][u-r+d].clone(),m=v.w;v.x*=m,v.y*=m,v.z*=m,f[d].add(v.multiplyScalar(h[g]))}}var y=new e.Vector4(0,0,0,0);for(d=0;d<=r;++d)y.add(f[d].multiplyScalar(p[d]));y.divideScalar(y.w),c.set(y.x,y.y,y.z)}},Fi=function(t,r,a,n,s){e.Curve.call(this),this.degree=t,this.knots=r,this.controlPoints=[],this.startKnot=n||0,this.endKnot=s||this.knots.length-1;for(var i=0;i<a.length;++i){var o=a[i];this.controlPoints[i]=new e.Vector4(o.x,o.y,o.z,o.w)}};(Fi.prototype=Object.create(e.Curve.prototype)).constructor=Fi,Fi.prototype.getPoint=function(t,r){var a=r||new e.Vector3,n=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=Ti.calcBSplinePoint(this.degree,this.knots,this.controlPoints,n);return 1!=s.w&&s.divideScalar(s.w),a.set(s.x,s.y,s.z)},Fi.prototype.getTangent=function(t,r){var a=r||new e.Vector3,n=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),s=Ti.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,n,1);return a.copy(s[1]).normalize(),a};var ki,Ei=function(){var t,r,a;function n(t){e.Loader.call(this,t)}function s(e,t){this.textureLoader=e,this.manager=t}function i(){}function o(){}function c(){}function l(){}function u(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function h(){}function p(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function f(e){return e/46186158e3}n.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:n,load:function(t,r,a,n){var s=this,i=""===s.path?e.LoaderUtils.extractUrlBase(t):s.path,o=new e.FileLoader(this.manager);o.setPath(s.path),o.setResponseType("arraybuffer"),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(t,(function(e){try{r(s.parse(e,i))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),a,n)},parse:function(r,a){if(o="Kaydara FBX Binary  \0",(i=r).byteLength>=o.length&&o===w(i,0,o.length))t=(new l).parse(r);else{var n=w(r);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;function a(t){var a=e[t-1];return e=e.slice(r+t),r++,a}for(var n=0;n<t.length;++n){if(a(1)===t[n])return!1}return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(p(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+p(n));t=(new c).parse(n)}var i,o;return new s(new e.TextureLoader(this.manager).setPath(this.resourcePath||a).setCrossOrigin(this.crossOrigin),this.manager).parse(t)}}),s.prototype={constructor:s,parse:function(){r=this.parseConnections();var e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),s=this.parseDeformers(),o=(new i).parse(s);return this.parseScene(s,o,n),a},parseConnections:function(){var e=new Map;"Connections"in t&&t.Connections.connections.forEach((function(t){var r=t[0],a=t[1],n=t[2];e.has(r)||e.set(r,{parents:[],children:[]});var s={ID:a,relationship:n};e.get(r).parents.push(s),e.has(a)||e.set(a,{parents:[],children:[]});var i={ID:r,relationship:n};e.get(a).children.push(i)}));return e},parseImages:function(){var e={},r={};if("Video"in t.Objects){var a=t.Objects.Video;for(var n in a){var s=a[n];if(e[l=parseInt(n)]=s.RelativeFilename||s.Filename,"Content"in s){var i=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,o="string"==typeof s.Content&&""!==s.Content;if(i||o){var c=this.parseImage(a[n]);r[s.RelativeFilename||s.Filename]=c}}}}for(var l in e){var u=e[l];void 0!==r[u]?e[l]=r[u]:e[l]=e[l].split("\\").pop()}return e},parseImage:function(t){var r,a=t.Content,n=t.RelativeFilename||t.Filename,s=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+s+'" is not supported.')}if("string"==typeof a)return"data:"+r+";base64,"+a;var i=new Uint8Array(a);return e.$window.URL.createObjectURL(new e.$Blob([i],{type:r}))},parseTextures:function(e){var r=new Map;if("Texture"in t.Objects){var a=t.Objects.Texture;for(var n in a){var s=this.parseTexture(a[n],e);r.set(parseInt(n),s)}}return r},parseTexture:function(t,r){var a=this.loadTexture(t,r);a.ID=t.id,a.name=t.attrName;var n=t.WrapModeU,s=t.WrapModeV,i=void 0!==n?n.value:0,o=void 0!==s?s.value:0;if(a.wrapS=0===i?e.RepeatWrapping:e.ClampToEdgeWrapping,a.wrapT=0===o?e.RepeatWrapping:e.ClampToEdgeWrapping,"Scaling"in t){var c=t.Scaling.value;a.repeat.x=c[0],a.repeat.y=c[1]}return a},loadTexture:function(t,a){var n,s,i=this.textureLoader.path,o=r.get(t.id).children;void 0!==o&&o.length>0&&void 0!==a[o[0].ID]&&(0!==(n=a[o[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var c=t.FileName.slice(-3).toLowerCase();if("tga"===c){var l=this.manager.getHandler(".tga");null===l?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),s=new e.Texture):s=l.load(n)}else"psd"===c?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),s=new e.Texture):s=this.textureLoader.load(n);return this.textureLoader.setPath(i),s},parseMaterials:function(e){var r=new Map;if("Material"in t.Objects){var a=t.Objects.Material;for(var n in a){var s=this.parseMaterial(a[n],e);null!==s&&r.set(parseInt(n),s)}}return r},parseMaterial:function(t,a){var n=t.id,s=t.attrName,i=t.ShadingModel;if("object"==typeof i&&(i=i.value),!r.has(n))return null;var o,c=this.parseParameters(t,a,n);switch(i.toLowerCase()){case"phong":o=new e.MeshPhongMaterial;break;case"lambert":o=new e.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',i),o=new e.MeshPhongMaterial}return o.setValues(c),o.name=s,o},parseParameters:function(t,a,n){var s={};t.BumpFactor&&(s.bumpScale=t.BumpFactor.value),t.Diffuse?s.color=(new e.Color).fromArray(t.Diffuse.value):!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(s.color=(new e.Color).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(s.displacementScale=t.DisplacementFactor.value),t.Emissive?s.emissive=(new e.Color).fromArray(t.Emissive.value):!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(s.emissive=(new e.Color).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(s.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(s.opacity=parseFloat(t.Opacity.value)),s.opacity<1&&(s.transparent=!0),t.ReflectionFactor&&(s.reflectivity=t.ReflectionFactor.value),t.Shininess&&(s.shininess=t.Shininess.value),t.Specular?s.specular=(new e.Color).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(s.specular=(new e.Color).fromArray(t.SpecularColor.value));var i=this;return r.get(n).children.forEach((function(t){var r=t.relationship;switch(r){case"Bump":s.bumpMap=i.getTexture(a,t.ID);break;case"Maya|TEX_ao_map":s.aoMap=i.getTexture(a,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=i.getTexture(a,t.ID),s.map.encoding=e.sRGBEncoding;break;case"DisplacementColor":s.displacementMap=i.getTexture(a,t.ID);break;case"EmissiveColor":s.emissiveMap=i.getTexture(a,t.ID),s.emissiveMap.encoding=e.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=i.getTexture(a,t.ID);break;case"ReflectionColor":s.envMap=i.getTexture(a,t.ID),s.envMap.mapping=e.EquirectangularReflectionMapping,s.envMap.encoding=e.sRGBEncoding;break;case"SpecularColor":s.specularMap=i.getTexture(a,t.ID),s.specularMap.encoding=e.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=i.getTexture(a,t.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}})),s},getTexture:function(e,a){return"LayeredTexture"in t.Objects&&a in t.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),a=r.get(a).children[0].ID),e.get(a)},parseDeformers:function(){var e={},a={};if("Deformer"in t.Objects){var n=t.Objects.Deformer;for(var s in n){var i=n[s],o=r.get(parseInt(s));if("Skin"===i.attrType){var c=this.parseSkeleton(o,n);c.ID=s,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),c.geometryID=o.parents[0].ID,e[s]=c}else if("BlendShape"===i.attrType){var l={id:s};l.rawTargets=this.parseMorphTargets(o,n),l.id=s,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),a[s]=l}}}return{skeletons:e,morphTargets:a}},parseSkeleton:function(t,r){var a=[];return t.children.forEach((function(t){var n=r[t.ID];if("Cluster"===n.attrType){var s={ID:t.ID,indices:[],weights:[],transformLink:(new e.Matrix4).fromArray(n.TransformLink.a)};"Indexes"in n&&(s.indices=n.Indexes.a,s.weights=n.Weights.a),a.push(s)}})),{rawBones:a,bones:[]}},parseMorphTargets:function(e,t){for(var a=[],n=0;n<e.children.length;n++){var s=e.children[n],i=t[s.ID],o={name:i.attrName,initialWeight:i.DeformPercent,id:i.id,fullWeights:i.FullWeights.a};if("BlendShapeChannel"!==i.attrType)return;o.geoID=r.get(parseInt(s.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,a.push(o)}return a},parseScene:function(n,s,i){a=new e.Group;var c=this.parseModels(n.skeletons,s,i),l=t.Objects.Model,u=this;c.forEach((function(e){var t=l[e.ID];u.setLookAtProperties(e,t),r.get(e.ID).parents.forEach((function(t){var r=c.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&a.add(e)})),this.bindSkeleton(n.skeletons,s,c),this.createAmbientLight(),this.setupMorphMaterials(),a.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);var t=y(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));var h=(new o).parse();1===a.children.length&&a.children[0].isGroup&&(a.children[0].animations=h,a=a.children[0]),a.animations=h},parseModels:function(a,n,s){var i=new Map,o=t.Objects.Model;for(var c in o){var l=parseInt(c),u=o[c],h=r.get(l),p=this.buildSkeleton(h,a,l,u.attrName);if(!p){switch(u.attrType){case"Camera":p=this.createCamera(h);break;case"Light":p=this.createLight(h);break;case"Mesh":p=this.createMesh(h,n,s);break;case"NurbsCurve":p=this.createCurve(h,n);break;case"LimbNode":case"Root":p=new e.Bone;break;case"Null":default:p=new e.Group}p.name=u.attrName?e.PropertyBinding.sanitizeNodeName(u.attrName):"",p.ID=l}this.getTransformData(p,u),i.set(l,p)}return i},buildSkeleton:function(t,r,a,n){var s=null;return t.parents.forEach((function(t){for(var i in r){var o=r[i];o.rawBones.forEach((function(r,i){if(r.ID===t.ID){var c=s;(s=new e.Bone).matrixWorld.copy(r.transformLink),s.name=n?e.PropertyBinding.sanitizeNodeName(n):"",s.ID=a,o.bones[i]=s,null!==c&&s.add(c)}}))}})),s},createCamera:function(r){var a,n;if(r.children.forEach((function(e){var r=t.Objects.NodeAttribute[e.ID];void 0!==r&&(n=r)})),void 0===n)a=new e.Object3D;else{var s=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(s=1);var i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);var o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);var c=e.$window.innerWidth,l=e.$window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(c=n.AspectWidth.value,l=n.AspectHeight.value);var u=c/l,h=45;void 0!==n.FieldOfView&&(h=n.FieldOfView.value);var p=n.FocalLength?n.FocalLength.value:null;switch(s){case 0:a=new e.PerspectiveCamera(h,u,i,o),null!==p&&a.setFocalLength(p);break;case 1:a=new e.OrthographicCamera(-c/2,c/2,l/2,-l/2,i,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),a=new e.Object3D}}return a},createLight:function(r){var a,n;if(r.children.forEach((function(e){var r=t.Objects.NodeAttribute[e.ID];void 0!==r&&(n=r)})),void 0===n)a=new e.Object3D;else{var s;s=void 0===n.LightType?0:n.LightType.value;var i=16777215;void 0!==n.Color&&(i=(new e.Color).fromArray(n.Color.value));var o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);var c=0;void 0!==n.FarAttenuationEnd&&(c=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(s){case 0:a=new e.PointLight(i,o,c,1);break;case 1:a=new e.DirectionalLight(i,o);break;case 2:var l=Math.PI/3;void 0!==n.InnerAngle&&(l=e.MathUtils.degToRad(n.InnerAngle.value));var u=0;void 0!==n.OuterAngle&&(u=e.MathUtils.degToRad(n.OuterAngle.value),u=Math.max(u,1)),a=new e.SpotLight(i,o,c,l,u,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),a=new e.PointLight(i,o)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(a.castShadow=!0)}return a},createMesh:function(t,r,a){var n,s=null,i=null,o=[];return t.children.forEach((function(e){r.has(e.ID)&&(s=r.get(e.ID)),a.has(e.ID)&&o.push(a.get(e.ID))})),o.length>1?i=o:o.length>0?i=o[0]:(i=new e.MeshPhongMaterial({color:13421772}),o.push(i)),"color"in s.attributes&&o.forEach((function(e){e.vertexColors=!0})),s.FBX_Deformer?(o.forEach((function(e){e.skinning=!0})),(n=new e.SkinnedMesh(s,i)).normalizeSkinWeights()):n=new e.Mesh(s,i),n},createCurve:function(t,r){var a=t.children.reduce((function(e,t){return r.has(t.ID)&&(e=r.get(t.ID)),e}),null),n=new e.LineBasicMaterial({color:3342591,linewidth:1});return new e.Line(a,n)},getTransformData:function(e,t){var r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?b(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r},setLookAtProperties:function(n,s){"LookAtProperty"in s&&r.get(n.ID).children.forEach((function(r){if("LookAtProperty"===r.relationship){var s=t.Objects.Model[r.ID];if("Lcl_Translation"in s){var i=s.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(i),a.add(n.target)):n.lookAt((new e.Vector3).fromArray(i))}}}))},bindSkeleton:function(t,a,n){var s=this.parsePoseNodes();for(var i in t){var o=t[i];r.get(parseInt(o.ID)).parents.forEach((function(t){if(a.has(t.ID)){var i=t.ID;r.get(i).parents.forEach((function(t){n.has(t.ID)&&n.get(t.ID).bind(new e.Skeleton(o.bones),s[t.ID])}))}}))}},parsePoseNodes:function(){var r={};if("Pose"in t.Objects){var a=t.Objects.Pose;for(var n in a)if("BindPose"===a[n].attrType){var s=a[n].PoseNode;Array.isArray(s)?s.forEach((function(t){r[t.Node]=(new e.Matrix4).fromArray(t.Matrix.a)})):r[s.Node]=(new e.Matrix4).fromArray(s.Matrix.a)}}return r},createAmbientLight:function(){if("GlobalSettings"in t&&"AmbientColor"in t.GlobalSettings){var r=t.GlobalSettings.AmbientColor.value,n=r[0],s=r[1],i=r[2];if(0!==n||0!==s||0!==i){var o=new e.Color(n,s,i);a.add(new e.AmbientLight(o,1))}}},setupMorphMaterials:function(){var e=this;a.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(r,a){e.setupMorphMaterial(t,r,a)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,r){var n=e.uuid,s=t.uuid,i=!1;if(a.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===s&&e.uuid!==n&&(i=!0)})):e.material.uuid===s&&e.uuid!==n&&(i=!0))})),!0===i){var o=t.clone();o.morphTargets=!0,void 0===r?e.material=o:e.material[r]=o}else t.morphTargets=!0}},i.prototype={constructor:i,parse:function(e){var a=new Map;if("Geometry"in t.Objects){var n=t.Objects.Geometry;for(var s in n){var i=r.get(parseInt(s)),o=this.parseGeometry(i,n[s],e);a.set(parseInt(s),o)}}return a},parseGeometry:function(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(e,r,a){var n=a.skeletons,s=[],i=e.parents.map((function(e){return t.Objects.Model[e.ID]}));if(0!==i.length){var o=e.children.reduce((function(e,t){return void 0!==n[t.ID]&&(e=n[t.ID]),e}),null);e.children.forEach((function(e){void 0!==a.morphTargets[e.ID]&&s.push(a.morphTargets[e.ID])}));var c=i[0],l={};"RotationOrder"in c&&(l.eulerOrder=b(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);var u=y(l);return this.genGeometry(r,o,s,u)}},genGeometry:function(t,r,a,n){var s=new e.BufferGeometry;t.attrName&&(s.name=t.attrName);var i=this.parseGeoNode(t,r),o=this.genBuffers(i),c=new e.Float32BufferAttribute(o.vertex,3);if(c.applyMatrix4(n),s.setAttribute("position",c),o.colors.length>0&&s.setAttribute("color",new e.Float32BufferAttribute(o.colors,3)),r&&(s.setAttribute("skinIndex",new e.Uint16BufferAttribute(o.weightsIndices,4)),s.setAttribute("skinWeight",new e.Float32BufferAttribute(o.vertexWeights,4)),s.FBX_Deformer=r),o.normal.length>0){var l=(new e.Matrix3).getNormalMatrix(n),u=new e.Float32BufferAttribute(o.normal,3);u.applyNormalMatrix(l),s.setAttribute("normal",u)}if(o.uvs.forEach((function(t,r){var a="uv"+(r+1).toString();0===r&&(a="uv"),s.setAttribute(a,new e.Float32BufferAttribute(o.uvs[r],2))})),i.material&&"AllSame"!==i.material.mappingType){var h=o.materialIndex[0],p=0;if(o.materialIndex.forEach((function(e,t){e!==h&&(s.addGroup(p,t-p,h),h=e,p=t)})),s.groups.length>0){var f=s.groups[s.groups.length-1],d=f.start+f.count;d!==o.materialIndex.length&&s.addGroup(d,o.materialIndex.length-d,h)}0===s.groups.length&&s.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(s,t,a,n),s},parseGeoNode:function(e,t){var r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];for(var a=0;e.LayerElementUV[a];)e.LayerElementUV[a].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[a])),a++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(a,n){void 0===r.weightTable[a]&&(r.weightTable[a]=[]),r.weightTable[a].push({id:t,weight:e.weights[n]})}))}))),r},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,a=0,n=!1,s=[],i=[],o=[],c=[],l=[],u=[],h=this;return e.vertexIndices.forEach((function(p,f){var d=!1;p<0&&(p^=-1,d=!0);var v=[],m=[];if(s.push(3*p,3*p+1,3*p+2),e.color){var y=g(f,r,p,e.color);o.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[p]&&e.weightTable[p].forEach((function(e){m.push(e.weight),v.push(e.id)})),m.length>4){n||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),n=!0);var b=[0,0,0,0],x=[0,0,0,0];m.forEach((function(e,t){var r=e,a=v[t];x.forEach((function(e,t,n){if(r>e){n[t]=r,r=e;var s=b[t];b[t]=a,a=s}}))})),v=b,m=x}for(;m.length<4;)m.push(0),v.push(0);for(var w=0;w<4;++w)l.push(m[w]),u.push(v[w])}if(e.normal){y=g(f,r,p,e.normal);i.push(y[0],y[1],y[2])}if(e.material&&"AllSame"!==e.material.mappingType)var S=g(f,r,p,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var a=g(f,r,p,e);void 0===c[t]&&(c[t]=[]),c[t].push(a[0]),c[t].push(a[1])})),a++,d&&(h.genFace(t,e,s,S,i,o,c,l,u,a),r++,a=0,s=[],i=[],o=[],c=[],l=[],u=[])})),t},genFace:function(e,t,r,a,n,s,i,o,c,l){for(var u=2;u<l;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(u-1)]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(o[0]),e.vertexWeights.push(o[1]),e.vertexWeights.push(o[2]),e.vertexWeights.push(o[3]),e.vertexWeights.push(o[4*(u-1)]),e.vertexWeights.push(o[4*(u-1)+1]),e.vertexWeights.push(o[4*(u-1)+2]),e.vertexWeights.push(o[4*(u-1)+3]),e.vertexWeights.push(o[4*u]),e.vertexWeights.push(o[4*u+1]),e.vertexWeights.push(o[4*u+2]),e.vertexWeights.push(o[4*u+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(u-1)]),e.weightsIndices.push(c[4*(u-1)+1]),e.weightsIndices.push(c[4*(u-1)+2]),e.weightsIndices.push(c[4*(u-1)+3]),e.weightsIndices.push(c[4*u]),e.weightsIndices.push(c[4*u+1]),e.weightsIndices.push(c[4*u+2]),e.weightsIndices.push(c[4*u+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[3*(u-1)]),e.colors.push(s[3*(u-1)+1]),e.colors.push(s[3*(u-1)+2]),e.colors.push(s[3*u]),e.colors.push(s[3*u+1]),e.colors.push(s[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(a),e.materialIndex.push(a),e.materialIndex.push(a)),t.normal&&(e.normal.push(n[0]),e.normal.push(n[1]),e.normal.push(n[2]),e.normal.push(n[3*(u-1)]),e.normal.push(n[3*(u-1)+1]),e.normal.push(n[3*(u-1)+2]),e.normal.push(n[3*u]),e.normal.push(n[3*u+1]),e.normal.push(n[3*u+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(i[r][0]),e.uvs[r].push(i[r][1]),e.uvs[r].push(i[r][2*(u-1)]),e.uvs[r].push(i[r][2*(u-1)+1]),e.uvs[r].push(i[r][2*u]),e.uvs[r].push(i[r][2*u+1])}))},addMorphTargets:function(e,r,a,n){if(0!==a.length){e.morphTargetsRelative=!0,e.morphAttributes.position=[];var s=this;a.forEach((function(a){a.rawTargets.forEach((function(a){var i=t.Objects.Geometry[a.geoID];void 0!==i&&s.genMorphGeometry(e,r,i,n,a.name)}))}))}},genMorphGeometry:function(t,r,a,n,s){for(var i=void 0!==r.PolygonVertexIndex?r.PolygonVertexIndex.a:[],o=void 0!==a.Vertices?a.Vertices.a:[],c=void 0!==a.Indexes?a.Indexes.a:[],l=3*t.attributes.position.count,u=new Float32Array(l),h=0;h<c.length;h++){var p=3*c[h];u[p]=o[3*h],u[p+1]=o[3*h+1],u[p+2]=o[3*h+2]}var f={vertexIndices:i,vertexPositions:u},d=this.genBuffers(f),g=new e.Float32BufferAttribute(d.vertex,3);g.name=s||a.attrName,g.applyMatrix4(n),t.morphAttributes.position.push(g)},parseNormals:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,a=e.Normals.a,n=[];return"IndexToDirect"===r&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:a,indices:n,mappingType:t,referenceType:r}},parseUVs:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,a=e.UV.a,n=[];return"IndexToDirect"===r&&(n=e.UVIndex.a),{dataSize:2,buffer:a,indices:n,mappingType:t,referenceType:r}},parseVertexColors:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType,a=e.Colors.a,n=[];return"IndexToDirect"===r&&(n=e.ColorIndex.a),{dataSize:4,buffer:a,indices:n,mappingType:t,referenceType:r}},parseMaterialIndices:function(e){var t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var a=e.Materials.a,n=[],s=0;s<a.length;++s)n.push(s);return{dataSize:1,buffer:a,indices:n,mappingType:t,referenceType:r}},parseNurbsGeometry:function(t){if(void 0===Fi)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new e.BufferGeometry;var r=parseInt(t.Order);if(isNaN(r))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new e.BufferGeometry;for(var a,n,s=r-1,i=t.KnotVector.a,o=[],c=t.Points.a,l=0,u=c.length;l<u;l+=4)o.push((new e.Vector4).fromArray(c,l));if("Closed"===t.Form)o.push(o[0]);else if("Periodic"===t.Form){a=s,n=i.length-1-a;for(l=0;l<s;++l)o.push(o[l])}var h=new Fi(s,i,o,a,n).getPoints(7*o.length),p=new Float32Array(3*h.length);h.forEach((function(e,t){e.toArray(p,3*t)}));var f=new e.BufferGeometry;return f.setAttribute("position",new e.BufferAttribute(p,3)),f}},o.prototype={constructor:o,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var r in t){var a=t[r],n=this.addClip(a);e.push(n)}return e},parseClips:function(){if(void 0!==t.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var r=this.parseAnimationLayers(e);return this.parseAnimStacks(r)}},parseAnimationCurveNodes:function(){var e=t.Objects.AnimationCurveNode,r=new Map;for(var a in e){var n=e[a];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){var s={id:n.id,attr:n.attrName,curves:{}};r.set(s.id,s)}}return r},parseAnimationCurves:function(e){var a=t.Objects.AnimationCurve;for(var n in a){var s={id:a[n].id,times:a[n].KeyTime.a.map(f),values:a[n].KeyValueFloat.a},i=r.get(s.id);if(void 0!==i){var o=i.parents[0].ID,c=i.parents[0].relationship;c.match(/X/)?e.get(o).curves.x=s:c.match(/Y/)?e.get(o).curves.y=s:c.match(/Z/)?e.get(o).curves.z=s:c.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=s)}}},parseAnimationLayers:function(n){var s=t.Objects.AnimationLayer,i=new Map;for(var o in s){var c=[],l=r.get(parseInt(o));if(void 0!==l)l.children.forEach((function(s,i){if(n.has(s.ID)){var o=n.get(s.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===c[i])if(void 0!==(d=r.get(s.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID)){if(void 0===(u=t.Objects.Model[d.toString()]))return void console.warn("THREE.FBXLoader: Encountered a unused curve.",s);var l={modelName:u.attrName?e.PropertyBinding.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};a.traverse((function(e){e.ID===u.id&&(l.transform=e.matrix,e.userData.transformData&&(l.eulerOrder=e.userData.transformData.eulerOrder))})),l.transform||(l.transform=new e.Matrix4),"PreRotation"in u&&(l.preRotation=u.PreRotation.value),"PostRotation"in u&&(l.postRotation=u.PostRotation.value),c[i]=l}c[i]&&(c[i][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===c[i]){var u,h=r.get(s.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,p=r.get(h).parents[0].ID,f=r.get(p).parents[0].ID,d=r.get(f).parents[0].ID;l={modelName:(u=t.Objects.Model[d]).attrName?e.PropertyBinding.sanitizeNodeName(u.attrName):"",morphName:t.Objects.Deformer[h].attrName};c[i]=l}c[i][o.attr]=o}}})),i.set(parseInt(o),c)}return i},parseAnimStacks:function(e){var a=t.Objects.AnimationStack,n={};for(var s in a){var i=r.get(parseInt(s)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var o=e.get(i[0].ID);n[s]={name:a[s].attrName,layer:o}}return n},addClip:function(t){var r=[],a=this;return t.layer.forEach((function(e){r=r.concat(a.generateTracks(e))})),new e.AnimationClip(t.name,-1,r)},generateTracks:function(t){var r=[],a=new e.Vector3,n=new e.Quaternion,s=new e.Vector3;if(t.transform&&t.transform.decompose(a,n,s),a=a.toArray(),n=(new e.Euler).setFromQuaternion(n,t.eulerOrder).toArray(),s=s.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){var i=this.generateVectorTrack(t.modelName,t.T.curves,a,"position");void 0!==i&&r.push(i)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){var o=this.generateRotationTrack(t.modelName,t.R.curves,n,t.preRotation,t.postRotation,t.eulerOrder);void 0!==o&&r.push(o)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){var c=this.generateVectorTrack(t.modelName,t.S.curves,s,"scale");void 0!==c&&r.push(c)}if(void 0!==t.DeformPercent){var l=this.generateMorphTrack(t);void 0!==l&&r.push(l)}return r},generateVectorTrack:function(t,r,a,n){var s=this.getTimesForAllAxes(r),i=this.getKeyframeTrackValues(s,r,a);return new e.VectorKeyframeTrack(t+"."+n,s,i)},generateRotationTrack:function(t,r,a,n,s,i){void 0!==r.x&&(this.interpolateRotations(r.x),r.x.values=r.x.values.map(e.MathUtils.degToRad)),void 0!==r.y&&(this.interpolateRotations(r.y),r.y.values=r.y.values.map(e.MathUtils.degToRad)),void 0!==r.z&&(this.interpolateRotations(r.z),r.z.values=r.z.values.map(e.MathUtils.degToRad));var o=this.getTimesForAllAxes(r),c=this.getKeyframeTrackValues(o,r,a);void 0!==n&&((n=n.map(e.MathUtils.degToRad)).push(i),n=(new e.Euler).fromArray(n),n=(new e.Quaternion).setFromEuler(n)),void 0!==s&&((s=s.map(e.MathUtils.degToRad)).push(i),s=(new e.Euler).fromArray(s),s=(new e.Quaternion).setFromEuler(s).invert());for(var l=new e.Quaternion,u=new e.Euler,h=[],p=0;p<c.length;p+=3)u.set(c[p],c[p+1],c[p+2],i),l.setFromEuler(u),void 0!==n&&l.premultiply(n),void 0!==s&&l.multiply(s),l.toArray(h,p/3*4);return new e.QuaternionKeyframeTrack(t+".quaternion",o,h)},generateMorphTrack:function(t){var r=t.DeformPercent.curves.morph,n=r.values.map((function(e){return e/100})),s=a.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new e.NumberKeyframeTrack(t.modelName+".morphTargetInfluences["+s+"]",r.times,n)},getTimesForAllAxes:function(e){var t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort((function(e,t){return e-t}))).length>1){for(var r=1,a=t[0],n=1;n<t.length;n++){var s=t[n];s!==a&&(t[r]=s,a=s,r++)}t=t.slice(0,r)}return t},getKeyframeTrackValues:function(e,t,r){var a=r,n=[],s=-1,i=-1,o=-1;return e.forEach((function(e){if(t.x&&(s=t.x.times.indexOf(e)),t.y&&(i=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==s){var r=t.x.values[s];n.push(r),a[0]=r}else n.push(a[0]);if(-1!==i){var c=t.y.values[i];n.push(c),a[1]=c}else n.push(a[1]);if(-1!==o){var l=t.z.values[o];n.push(l),a[2]=l}else n.push(a[2])})),n},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var r=e.values[t-1],a=e.values[t]-r,n=Math.abs(a);if(n>=180){for(var s=n/180,i=a/s,o=r+i,c=e.times[t-1],l=(e.times[t]-c)/s,u=c+l,h=[],p=[];u<e.times[t];)h.push(u),u+=l,p.push(o),o+=i;e.times=S(e.times,t,h),e.values=S(e.values,t,p)}}}},c.prototype={constructor:c,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new h,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,a){var n=e.match(/^[\s\t]*;/),s=e.match(/^[\s\t]*$/);if(!n&&!s){var i=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),o=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");i?t.parseNodeBegin(e,i):o?t.parseNodeProperty(e,o,r[++a]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var r=t[1].trim().replace(/^"/,"").replace(/"$/,""),a=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),n={name:r},s=this.parseNodeAttr(a),i=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,n):r in i?("PoseNode"===r?i.PoseNode.push(n):void 0!==i[r].id&&(i[r]={},i[r][i[r].id]=i[r]),""!==s.id&&(i[r][s.id]=n)):"number"==typeof s.id?(i[r]={},i[r][s.id]=n):"Properties70"!==r&&(i[r]="PoseNode"===r?[n]:n),"number"==typeof s.id&&(n.id=s.id),""!==s.name&&(n.attrName=s.name),""!==s.type&&(n.attrType=s.type),this.pushStack(n)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var r="",a="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),a=e[2]),{id:t,name:r,type:a}},parseNodeProperty:function(e,t,r){var a=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===a&&","===n&&(n=r.replace(/"/g,"").replace(/,$/,"").trim());var s=this.getCurrentNode();if("Properties70"!==s.name){if("C"===a){var i=n.split(",").slice(1),o=parseInt(i[0]),c=parseInt(i[1]),l=n.split(",").slice(3);a="connections",function(e,t){for(var r=0,a=e.length,n=t.length;r<n;r++,a++)e[a]=t[r]}(n=[o,c],l=l.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===s[a]&&(s[a]=[])}"Node"===a&&(s.id=n),a in s&&Array.isArray(s[a])?s[a].push(n):"a"!==a?s[a]=n:s.a=n,this.setCurrentProp(s,a),"a"===a&&","!==n.slice(-1)&&(s.a=x(n))}else this.parseNodeSpecialProperty(e,a,n)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=x(t.a))},parseNodeSpecialProperty:function(e,t,r){var a=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),n=a[0],s=a[1],i=a[2],o=a[3],c=a[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=x(c)}this.getPrevNode()[n]={type:s,type2:i,flag:o,value:c},this.setCurrentProp(this.getPrevNode(),n)}},l.prototype={constructor:l,parse:function(e){var t=new u(e);t.skip(23);var r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);for(var a=new h;!this.endOfContent(t);){var n=this.parseNode(t,r);null!==n&&a.add(n.name,n)}return a},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var r={},a=t>=7500?e.getUint64():e.getUint32(),n=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();var s=e.getUint8(),i=e.getString(s);if(0===a)return null;for(var o=[],c=0;c<n;c++)o.push(this.parseProperty(e));var l=o.length>0?o[0]:"",u=o.length>1?o[1]:"",h=o.length>2?o[2]:"";for(r.singleProperty=1===n&&e.getOffset()===a;a>e.getOffset();){var p=this.parseNode(e,t);null!==p&&this.parseSubNode(i,r,p)}return r.propertyList=o,"number"==typeof l&&(r.id=l),""!==u&&(r.attrName=u),""!==h&&(r.attrType=h),""!==i&&(r.name=i),r},parseSubNode:function(e,t,r){if(!0===r.singleProperty){var a=r.propertyList[0];Array.isArray(a)?(t[r.name]=r,r.a=a):t[r.name]=a}else if("Connections"===e&&"C"===r.name){var n=[];r.propertyList.forEach((function(e,t){0!==t&&n.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(n)}else if("Properties70"===r.name){Object.keys(r).forEach((function(e){t[e]=r[e]}))}else if("Properties70"===e&&"P"===r.name){var s,i=r.propertyList[0],o=r.propertyList[1],c=r.propertyList[2],l=r.propertyList[3];0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),s="Color"===o||"ColorRGB"===o||"Vector"===o||"Vector3D"===o||0===o.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[i]={type:o,type2:c,flag:l,value:s}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var r=e.getUint32();return e.getArrayBuffer(r);case"S":r=e.getUint32();return e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var a=e.getUint32(),n=e.getUint32(),s=e.getUint32();if(0===n)switch(t){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}void 0===Si&&console.error("THREE.FBXLoader: External library fflate.min.js required.");var i=new u(Ks(new Uint8Array(e.getArrayBuffer(s))).buffer);switch(t){case"b":case"c":return i.getBooleanArray(a);case"d":return i.getFloat64Array(a);case"f":return i.getFloat32Array(a);case"i":return i.getInt32Array(a);case"l":return i.getInt64Array(a)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}},u.prototype={constructor:u,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(t){for(var r=[],a=0;a<t;a++)r[a]=this.getUint8();var n=r.indexOf(0);return n>=0&&(r=r.slice(0,n)),e.LoaderUtils.decodeText(new Uint8Array(r))}},h.prototype={constructor:h,add:function(e,t){this[e]=t}};var d=[];function g(e,t,r,a){var n;switch(a.mappingType){case"ByPolygonVertex":n=e;break;case"ByPolygon":n=t;break;case"ByVertice":n=r;break;case"AllSame":n=a.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+a.mappingType)}"IndexToDirect"===a.referenceType&&(n=a.indices[n]);var s=n*a.dataSize,i=s+a.dataSize;return function(e,t,r,a){for(var n=r,s=0;n<a;n++,s++)e[s]=t[n];return e}(d,a.buffer,s,i)}var v=new e.Euler,m=new e.Vector3;function y(t){var r,a=new e.Matrix4,n=new e.Matrix4,s=new e.Matrix4,i=new e.Matrix4,o=new e.Matrix4,c=new e.Matrix4,l=new e.Matrix4,u=new e.Matrix4,h=new e.Matrix4,p=new e.Matrix4,f=new e.Matrix4,d=new e.Matrix4,g=t.inheritType?t.inheritType:0;(t.translation&&a.setPosition(m.fromArray(t.translation)),t.preRotation)&&((r=t.preRotation.map(e.MathUtils.degToRad)).push(t.eulerOrder),n.makeRotationFromEuler(v.fromArray(r)));t.rotation&&((r=t.rotation.map(e.MathUtils.degToRad)).push(t.eulerOrder),s.makeRotationFromEuler(v.fromArray(r)));t.postRotation&&((r=t.postRotation.map(e.MathUtils.degToRad)).push(t.eulerOrder),i.makeRotationFromEuler(v.fromArray(r)),i.invert());t.scale&&o.scale(m.fromArray(t.scale)),t.scalingOffset&&l.setPosition(m.fromArray(t.scalingOffset)),t.scalingPivot&&c.setPosition(m.fromArray(t.scalingPivot)),t.rotationOffset&&u.setPosition(m.fromArray(t.rotationOffset)),t.rotationPivot&&h.setPosition(m.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(f.copy(t.parentMatrix),p.copy(t.parentMatrixWorld));var y=(new e.Matrix4).copy(n).multiply(s).multiply(i),b=new e.Matrix4;b.extractRotation(p);var x=new e.Matrix4;x.copyPosition(p);var w=new e.Matrix4,S=(new e.Matrix4).copy(x).invert().multiply(p);w.copy(b).invert().multiply(S);var T=o,F=new e.Matrix4;if(0===g)F.copy(b).multiply(y).multiply(w).multiply(T);else if(1===g)F.copy(b).multiply(w).multiply(y).multiply(T);else{var k=(new e.Matrix4).scale((new e.Vector3).setFromMatrixScale(f)),E=(new e.Matrix4).copy(k).invert(),A=(new e.Matrix4).copy(w).multiply(E);F.copy(b).multiply(y).multiply(A).multiply(T)}var I=new e.Matrix4;I.copy(h).invert();var M=new e.Matrix4;M.copy(c).invert();var L=new e.Matrix4;L.copy(a).multiply(u).multiply(h).multiply(n).multiply(s).multiply(i).multiply(I).multiply(l).multiply(c).multiply(o).multiply(M);var C=(new e.Matrix4).copyPosition(L),O=(new e.Matrix4).copy(p).multiply(C);return d.copyPosition(O),(L=(new e.Matrix4).copy(d).multiply(F)).premultiply(p.invert()),L}function b(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function x(e){return e.split(",").map((function(e){return parseFloat(e)}))}function w(t,r,a){return void 0===r&&(r=0),void 0===a&&(a=t.byteLength),e.LoaderUtils.decodeText(new Uint8Array(t,r,a))}function S(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}return n}();function Ai(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}return r}function Ii(e){this.IFF=e}function Mi(e){this.IFF=e}function Li(){this.debugger=new Oi}function Ci(e){this.dv=new DataView(e),this.offset=0}function Oi(){this.active=!1,this.depth=0,this.formList=[]}function Ri(e){return e%2}function Ui(e){return e.length+1+(Ri(e.length+1)?1:0)}Ii.prototype={constructor:Ii,parseBlock:function(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();var e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(t>this.IFF.reader.dv.byteLength-this.IFF.reader.offset&&(this.IFF.reader.offset-=4,t=this.IFF.reader.getUint16()),this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"AUVO":case"STCK":case"PROC":case"VALU":case"FUNC":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NVSK":case"NCRD":case"WRPW":case"WRPH":case"NMOD":case"NPRW":case"NPLA":case"NODS":case"VERS":case"ENUM":case"TAG ":case"OPAC":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"GLOW":case"GVAL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"SURF":this.IFF.parseSurfaceLwo2(t);break;case"CLIP":this.IFF.parseClipLwo2(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"AUVU":case"AUVN":this.IFF.reader.skip(t-1),this.IFF.reader.getVariableLengthIndex();break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":var r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":var a=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(a<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.reader.skip(2);break;case"TMAP":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;case"BLOK":break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}},Mi.prototype={constructor:Mi,parseBlock:function(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();var e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"STCK":case"VALU":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NCRD":case"NMOD":case"NSEL":case"NPRW":case"NPLA":case"VERS":case"ENUM":case"TAG ":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"GLOW":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":var r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":var a=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(a<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.currentSurface.attributes.imageMapIndex=this.IFF.reader.getUint32();break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}},Li.prototype={constructor:Li,parse:function(e){if(this.reader=new Ci(e),this.tree={materials:{},layers:[],tags:[],textures:[]},this.currentLayer=this.tree,this.currentForm=this.tree,this.parseTopForm(),void 0!==this.tree.format){if("LWO2"===this.tree.format)for(this.parser=new Ii(this);!this.reader.endOfFile();)this.parser.parseBlock();else if("LWO3"===this.tree.format)for(this.parser=new Mi(this);!this.reader.endOfFile();)this.parser.parseBlock();return this.debugger.offset=this.reader.offset,this.debugger.closeForms(),this.tree}},parseTopForm(){if(this.debugger.offset=this.reader.offset,"FORM"===this.reader.getIDTag()){var e=this.reader.getUint32();this.debugger.dataOffset=this.reader.offset,this.debugger.length=e;var t=this.reader.getIDTag();("LWO2"===t||"LWO3"===t)&&(this.tree.format=t),this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()}else console.warn("LWOLoader: Top-level FORM missing.")},parseForm(e){var t=this.reader.getIDTag();switch(t){case"ISEQ":case"ANIM":case"STCC":case"VPVL":case"VPRM":case"NROT":case"WRPW":case"WRPH":case"FUNC":case"FALL":case"OPAC":case"GRAD":case"ENVS":case"VMOP":case"VMBG":case"OMAX":case"STEX":case"CKBG":case"CKEY":case"VMLA":case"VMLB":this.debugger.skipped=!0,this.skipForm(e);break;case"META":case"NNDS":case"NODS":case"NDTA":case"ADAT":case"AOVS":case"BLOK":case"IBGC":case"IOPC":case"IIMG":case"TXTR":this.debugger.length=4,this.debugger.skipped=!0;break;case"IFAL":case"ISCL":case"IPOS":case"IROT":case"IBMP":case"IUTD":case"IVTD":this.parseTextureNodeAttribute(t);break;case"ENVL":this.parseEnvelope(e);break;case"CLIP":"LWO2"===this.tree.format?this.parseForm(e):this.parseClip(e);break;case"STIL":this.parseImage();break;case"XREF":this.reader.skip(8),this.currentForm.referenceTexture={index:this.reader.getUint32(),refName:this.reader.getString()};break;case"IMST":this.parseImageStateForm(e);break;case"SURF":this.parseSurfaceForm(e);break;case"VALU":this.parseValueForm(e);break;case"NTAG":this.parseSubNode(e);break;case"ATTR":case"SATR":this.setupForm("attributes",e);break;case"NCON":this.parseConnections(e);break;case"SSHA":this.parentForm=this.currentForm,this.currentForm=this.currentSurface,this.setupForm("surfaceShader",e);break;case"SSHD":this.setupForm("surfaceShaderData",e);break;case"ENTR":this.parseEntryForm(e);break;case"IMAP":this.parseImageMap(e);break;case"TAMP":this.parseXVAL("amplitude",e);break;case"TMAP":this.setupForm("textureMap",e);break;case"CNTR":this.parseXVAL3("center",e);break;case"SIZE":this.parseXVAL3("scale",e);break;case"ROTA":this.parseXVAL3("rotation",e);break;default:this.parseUnknownForm(t,e)}this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()},setupForm(e,t){this.currentForm||(this.currentForm=this.currentNode),this.currentFormEnd=this.reader.offset+t,this.parentForm=this.currentForm,this.currentForm[e]?(console.warn("LWOLoader: form already exists on parent: ",e,this.currentForm),this.currentForm=this.currentForm[e]):(this.currentForm[e]={},this.currentForm=this.currentForm[e])},skipForm(e){this.reader.skip(e-4)},parseUnknownForm(t,r){var a,n,s;console.warn("LWOLoader: unknown FORM encountered: "+t,r),a=this.reader.dv.buffer,n=this.reader.offset,s=r-4,console.log(e.LoaderUtils.decodeText(new Uint8Array(a,n,s))),this.reader.skip(r-4)},parseSurfaceForm(e){this.reader.skip(8);var t=this.reader.getString(),r={attributes:{},connections:{},name:t,inputName:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e},parseSurfaceLwo2(e){var t=this.reader.getString(),r={attributes:{},connections:{},name:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e},parseSubNode(e){this.reader.skip(8);var t={name:this.reader.getString()};this.currentForm=t,this.currentNode=t,this.currentFormEnd=this.reader.offset+e},parseConnections(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm=this.currentSurface.connections},parseEntryForm(e){this.reader.skip(8);var t=this.reader.getString();this.currentForm=this.currentNode.attributes,this.setupForm(t,e)},parseValueForm(){this.reader.skip(8);var e=this.reader.getString();"double"===e?this.currentForm.value=this.reader.getUint64():"int"===e?this.currentForm.value=this.reader.getUint32():"vparam"===e?(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64()):"vparam3"===e&&(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64Array(3))},parseImageStateForm(){this.reader.skip(8),this.currentForm.mipMapLevel=this.reader.getFloat32()},parseImageMap(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm.maps||(this.currentForm.maps=[]);var t={};this.currentForm.maps.push(t),this.currentForm=t,this.reader.skip(10)},parseTextureNodeAttribute(e){switch(this.reader.skip(28),this.reader.skip(20),e){case"ISCL":this.currentNode.scale=this.reader.getFloat32Array(3);break;case"IPOS":this.currentNode.position=this.reader.getFloat32Array(3);break;case"IROT":this.currentNode.rotation=this.reader.getFloat32Array(3);break;case"IFAL":this.currentNode.falloff=this.reader.getFloat32Array(3);break;case"IBMP":this.currentNode.amplitude=this.reader.getFloat32();break;case"IUTD":this.currentNode.uTiles=this.reader.getFloat32();break;case"IVTD":this.currentNode.vTiles=this.reader.getFloat32()}this.reader.skip(2)},parseEnvelope(e){this.reader.skip(e-4)},parseClip(e){if("FORM"===this.reader.getIDTag())return this.reader.skip(16),void(this.currentNode.fileName=this.reader.getString());this.reader.setOffset(this.reader.offset-4),this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.reader.skip(8);var t={index:this.reader.getUint32()};this.tree.textures.push(t),this.currentForm=t},parseClipLwo2(e){for(var t={index:this.reader.getUint32(),fileName:""};;){var r=this.reader.getIDTag(),a=this.reader.getUint16();if("STIL"===r){t.fileName=this.reader.getString();break}if(a>=e)break}this.tree.textures.push(t),this.currentForm=t},parseImage(){this.reader.skip(8),this.currentForm.fileName=this.reader.getString()},parseXVAL(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]=this.reader.getFloat32(),this.reader.setOffset(r)},parseXVAL3(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]={x:this.reader.getFloat32(),y:this.reader.getFloat32(),z:this.reader.getFloat32()},this.reader.setOffset(r)},parseObjectTag(){this.tree.objectTags||(this.tree.objectTags={}),this.tree.objectTags[this.reader.getIDTag()]={tagString:this.reader.getString()}},parseLayer(e){var t={number:this.reader.getUint16(),flags:this.reader.getUint16(),pivot:this.reader.getFloat32Array(3),name:this.reader.getString()};this.tree.layers.push(t),this.currentLayer=t;var r=16+Ui(this.currentLayer.name);this.currentLayer.parent=r<e?this.reader.getUint16():-1},parsePoints(e){this.currentPoints=[];for(var t=0;t<e/4;t+=3)this.currentPoints.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32())},parseVertexMapping(e,t){var r=this.reader.offset+e,a=this.reader.getString();if(this.reader.offset!==r){this.reader.setOffset(this.reader.offset-Ui(a));var n=this.reader.getIDTag();this.reader.getUint16();var s=this.reader.getString(),i=e-6-Ui(s);switch(n){case"TXUV":this.parseUVMapping(s,r,t);break;case"MORF":case"SPOT":this.parseMorphTargets(s,r,n);break;case"APSL":case"NORM":case"WGHT":case"MNVW":case"PICK":case"RGB ":case"RGBA":this.reader.skip(i);break;default:console.warn("LWOLoader: unknown vertex map type: "+n),this.reader.skip(i)}}else this.currentForm.UVChannel=a},parseUVMapping(e,t,r){for(var a=[],n=[],s=[];this.reader.offset<t;)a.push(this.reader.getVariableLengthIndex()),r&&n.push(this.reader.getVariableLengthIndex()),s.push(this.reader.getFloat32(),this.reader.getFloat32());r?(this.currentLayer.discontinuousUVs||(this.currentLayer.discontinuousUVs={}),this.currentLayer.discontinuousUVs[e]={uvIndices:a,polyIndices:n,uvs:s}):(this.currentLayer.uvs||(this.currentLayer.uvs={}),this.currentLayer.uvs[e]={uvIndices:a,uvs:s})},parseMorphTargets(e,t,r){var a=[],n=[];for(r="MORF"===r?"relative":"absolute";this.reader.offset<t;)a.push(this.reader.getVariableLengthIndex()),n.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32());this.currentLayer.morphTargets||(this.currentLayer.morphTargets={}),this.currentLayer.morphTargets[e]={indices:a,points:n,type:r}},parsePolygonList(e){for(var t=this.reader.offset+e,r=this.reader.getIDTag(),a=[],n=[];this.reader.offset<t;){var s=this.reader.getUint16();s&=1023,n.push(s);for(var i=0;i<s;i++)a.push(this.reader.getVariableLengthIndex())}var o={type:r,vertexIndices:a,polygonDimensions:n,points:this.currentPoints};1===n[0]?o.type="points":2===n[0]&&(o.type="lines"),this.currentLayer.geometry=o},parseTagStrings(e){this.tree.tags=this.reader.getStringArray(e)},parsePolygonTagMapping(e){var t=this.reader.offset+e;"SURF"===this.reader.getIDTag()?this.parseMaterialIndices(t):this.reader.skip(e-4)},parseMaterialIndices(e){for(this.currentLayer.geometry.materialIndices=[];this.reader.offset<e;){var t=this.reader.getVariableLengthIndex(),r=this.reader.getUint16();this.currentLayer.geometry.materialIndices.push(t,r)}},parseUnknownCHUNK(e,t){console.warn("LWOLoader: unknown chunk type: "+e+" length: "+t);var r=this.reader.getString(t);this.currentForm[e]=r}},Ci.prototype={constructor:Ci,size:function(){return this.dv.buffer.byteLength},setOffset(e){e>0&&e<this.dv.buffer.byteLength?this.offset=e:console.error("LWOLoader: invalid buffer offset")},endOfFile:function(){return this.offset>=this.size()},skip:function(e){this.offset+=e},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getUint16:function(){var e=this.dv.getUint16(this.offset);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,!1);return this.offset+=4,e},getUint32:function(){var e=this.dv.getUint32(this.offset,!1);return this.offset+=4,e},getUint64:function(){return 4294967296*this.getUint32()+this.getUint32()},getFloat32:function(){var e=this.dv.getFloat32(this.offset,!1);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getVariableLengthIndex(){var e=this.getUint8();return 255===e?65536*this.getUint8()+256*this.getUint8()+this.getUint8():256*e+this.getUint8()},getIDTag(){return this.getString(4)},getString:function(t){if(0!==t){var r=[];if(t)for(var a=0;a<t;a++)r[a]=this.getUint8();else{for(var n,s=0;0!==n;)0!==(n=this.getUint8())&&r.push(n),s++;Ri(s+1)||this.getUint8()}return e.LoaderUtils.decodeText(new Uint8Array(r))}},getStringArray:function(e){var t=this.getString(e);return(t=t.split("\0")).filter(Boolean)}},Oi.prototype={constructor:Oi,enable:function(){this.active=!0},log:function(){if(this.active){var e;switch(this.node){case 0:e="FORM";break;case 1:e="CHK";break;case 2:e="S-CHK"}console.log("| ".repeat(this.depth)+e,this.nodeID,`( ${this.offset} ) -> ( ${this.dataOffset+this.length} )`,0==this.node?" {":"",this.skipped?"SKIPPED":"",0==this.node&&this.skipped?"}":""),0!=this.node||this.skipped||(this.depth+=1,this.formList.push(this.dataOffset+this.length)),this.skipped=!1}},closeForms:function(){if(this.active)for(var e=this.formList.length-1;e>=0;e--)this.offset>=this.formList[e]&&(this.depth-=1,console.log("| ".repeat(this.depth)+"}"),this.formList.splice(-1,1))}};var Ni=function(t,r){e.Loader.call(this,t),r=r||{},this.resourcePath=void 0!==r.resourcePath?r.resourcePath:""};function Di(e){this.textureLoader=e}function Pi(e){this.textureLoader=e}function Bi(){}Ni.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:Ni,load:function(t,r,a,n){var s=this,i=""===s.path?function(e,t){var r=e.indexOf(t);return-1===r?"./":e.substr(0,r)}(t,"Objects"):s.path,o=t.split(i).pop().split(".")[0],c=new e.FileLoader(this.manager);c.setPath(s.path),c.setResponseType("arraybuffer"),c.load(t,(function(e){try{r(s.parse(e,i,o))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),a,n)},parse:function(t,r,a){return ki=(new Li).parse(t),new Di(new e.TextureLoader(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin)).parse(a)}}),Di.prototype={constructor:Di,parse:function(e){return this.materials=new Pi(this.textureLoader).parse(),this.defaultLayerName=e,this.meshes=this.parseLayers(),{materials:this.materials,meshes:this.meshes}},parseLayers(){var e=[],t=[],r=new Bi,a=this;return ki.layers.forEach((function(n){var s=r.parse(n.geometry,n),i=a.parseMesh(s,n);e[n.number]=i,-1===n.parent?t.push(i):e[n.parent].add(i)})),this.applyPivots(t),t},parseMesh(t,r){var a,n=this.getMaterials(t.userData.matNames,r.geometry.type);return this.duplicateUVs(t,n),a="points"===r.geometry.type?new e.Points(t,n):"lines"===r.geometry.type?new e.LineSegments(t,n):new e.Mesh(t,n),r.name?a.name=r.name:a.name=this.defaultLayerName+"_layer_"+r.number,a.userData.pivot=r.pivot,a},applyPivots(e){e.forEach((function(e){e.traverse((function(e){var t=e.userData.pivot;if(e.position.x+=t[0],e.position.y+=t[1],e.position.z+=t[2],e.parent){var r=e.parent.userData.pivot;e.position.x-=r[0],e.position.y-=r[1],e.position.z-=r[2]}}))}))},getMaterials(t,r){var a=[],n=this;t.forEach((function(e,t){a[t]=n.getMaterialByName(e)})),"points"!==r&&"lines"!==r||a.forEach((function(t,n){var s={color:t.color};"points"===r?(s.size=.1,s.map=t.map,s.morphTargets=t.morphTargets,a[n]=new e.PointsMaterial(s)):"lines"===r&&(a[n]=new e.LineBasicMaterial(s))}));var s=a.filter(Boolean);return 1===s.length?s[0]:a},getMaterialByName(e){return this.materials.filter((function(t){return t.name===e}))[0]},duplicateUVs(t,r){var a=!1;Array.isArray(r)?r.forEach((function(e){e.aoMap&&(a=!0)})):r.aoMap&&(a=!0),a&&t.setAttribute("uv2",new e.BufferAttribute(t.attributes.uv.array,2))}},Pi.prototype={constructor:Pi,parse:function(){var e=[];for(var t in this.textures={},ki.materials)"LWO3"===ki.format?e.push(this.parseMaterial(ki.materials[t],t,ki.textures)):"LWO2"===ki.format&&e.push(this.parseMaterialLwo2(ki.materials[t],t,ki.textures));return e},parseMaterial(e,t,r){var a={name:t,side:this.getSide(e.attributes),flatShading:this.getSmooth(e.attributes)},n=this.parseConnections(e.connections,e.nodes),s=this.parseTextureNodes(n.maps);this.parseAttributeImageMaps(n.attributes,r,s,e.maps);var i=this.parseAttributes(n.attributes,s);return this.parseEnvMap(n,s,i),a=Object.assign(s,a),a=Object.assign(a,i),new(this.getMaterialType(n.attributes))(a)},parseMaterialLwo2(t,r){var a={name:r,side:this.getSide(t.attributes),flatShading:this.getSmooth(t.attributes)},n=this.parseAttributes(t.attributes,{});return a=Object.assign(a,n),new e.MeshPhongMaterial(a)},getSide(t){if(!t.side)return e.BackSide;switch(t.side){case 0:case 1:return e.BackSide;case 2:return e.FrontSide;case 3:return e.DoubleSide}},getSmooth:e=>!e.smooth||!e.smooth,parseConnections(e,t){var r={maps:{}},a=e.inputName,n=e.inputNodeName,s=e.nodeName,i=this;return a.forEach((function(e,a){if("Material"===e){var s=i.getNodeByRefName(n[a],t);r.attributes=s.attributes,r.envMap=s.fileName,r.name=n[a]}})),s.forEach((function(e,s){e===r.name&&(r.maps[a[s]]=i.getNodeByRefName(n[s],t))})),r},getNodeByRefName(e,t){for(var r in t)if(t[r].refName===e)return t[r]},parseTextureNodes(t){var r={};for(var a in t){var n=t[a],s=n.fileName;if(!s)return;var i=this.loadTexture(s);switch(void 0!==n.widthWrappingMode&&(i.wrapS=this.getWrappingType(n.widthWrappingMode)),void 0!==n.heightWrappingMode&&(i.wrapT=this.getWrappingType(n.heightWrappingMode)),a){case"Color":r.map=i;break;case"Roughness":r.roughnessMap=i,r.roughness=.5;break;case"Specular":r.specularMap=i,r.specular=16777215;break;case"Luminous":r.emissiveMap=i,r.emissive=8421504;break;case"Luminous Color":r.emissive=8421504;break;case"Metallic":r.metalnessMap=i,r.metalness=.5;break;case"Transparency":case"Alpha":r.alphaMap=i,r.transparent=!0;break;case"Normal":r.normalMap=i,void 0!==n.amplitude&&(r.normalScale=new e.Vector2(n.amplitude,n.amplitude));break;case"Bump":r.bumpMap=i}}return r.roughnessMap&&r.specularMap&&delete r.specularMap,r},parseAttributeImageMaps(e,t,r){for(var a in e){var n=e[a];if(n.maps){var s=n.maps[0],i=this.getTexturePathByIndex(s.imageIndex,t);if(!i)return;var o=this.loadTexture(i);switch(void 0!==s.wrap&&(o.wrapS=this.getWrappingType(s.wrap.w)),void 0!==s.wrap&&(o.wrapT=this.getWrappingType(s.wrap.h)),a){case"Color":r.map=o;break;case"Diffuse":r.aoMap=o;break;case"Roughness":r.roughnessMap=o,r.roughness=1;break;case"Specular":r.specularMap=o,r.specular=16777215;break;case"Luminosity":r.emissiveMap=o,r.emissive=8421504;break;case"Metallic":r.metalnessMap=o,r.metalness=1;break;case"Transparency":case"Alpha":r.alphaMap=o,r.transparent=!0;break;case"Normal":r.normalMap=o;break;case"Bump":r.bumpMap=o}}}},parseAttributes(t,r){var a={};return t.Color&&!r.map?a.color=(new e.Color).fromArray(t.Color.value):a.color=new e.Color,t.Transparency&&0!==t.Transparency.value&&(a.opacity=1-t.Transparency.value,a.transparent=!0),t["Bump Height"]&&(a.bumpScale=.1*t["Bump Height"].value),t["Refraction Index"]&&(a.refractionRatio=1/t["Refraction Index"].value),this.parsePhysicalAttributes(a,t,r),this.parseStandardAttributes(a,t,r),this.parsePhongAttributes(a,t,r),a},parsePhysicalAttributes(e,t){t.Clearcoat&&t.Clearcoat.value>0&&(e.clearcoat=t.Clearcoat.value,t["Clearcoat Gloss"]&&(e.clearcoatRoughness=.5*(1-t["Clearcoat Gloss"].value)))},parseStandardAttributes(t,r,a){r.Luminous&&(t.emissiveIntensity=r.Luminous.value,r["Luminous Color"]&&!a.emissive?t.emissive=(new e.Color).fromArray(r["Luminous Color"].value):t.emissive=new e.Color(8421504)),r.Roughness&&!a.roughnessMap&&(t.roughness=r.Roughness.value),r.Metallic&&!a.metalnessMap&&(t.metalness=r.Metallic.value)},parsePhongAttributes(t,r,a){r.Diffuse&&t.color.multiplyScalar(r.Diffuse.value),r.Reflection&&(t.reflectivity=r.Reflection.value,t.combine=e.AddOperation),r.Luminosity&&(t.emissiveIntensity=r.Luminosity.value,a.emissiveMap||a.map?t.emissive=new e.Color(8421504):t.emissive=t.color),r.Roughness||!r.Specular||a.specularMap||(r["Color Highlight"]?t.specular=(new e.Color).setScalar(r.Specular.value).lerp(t.color.clone().multiplyScalar(r.Specular.value),r["Color Highlight"].value):t.specular=(new e.Color).setScalar(r.Specular.value)),t.specular&&r.Glossiness&&(t.shininess=7+Math.pow(2,12*r.Glossiness.value+2))},parseEnvMap(t,r,a){if(t.envMap){var n=this.loadTexture(t.envMap);a.transparent&&a.opacity<.999?(n.mapping=e.EquirectangularRefractionMapping,void 0!==a.reflectivity&&(delete a.reflectivity,delete a.combine),void 0!==a.metalness&&delete a.metalness):n.mapping=e.EquirectangularReflectionMapping,r.envMap=n}},getTexturePathByIndex(e){var t="";return ki.textures?(ki.textures.forEach((function(r){r.index===e&&(t=r.fileName)})),t):t},loadTexture(e){return e?this.textureLoader.load(e,void 0,void 0,(function(){console.warn("LWOLoader: non-standard resource hierarchy. Use `resourcePath` parameter to specify root content directory.")})):null},getWrappingType(t){switch(t){case 0:return console.warn('LWOLoader: "Reset" texture wrapping type is not supported in three.js'),e.ClampToEdgeWrapping;case 1:return e.RepeatWrapping;case 2:return e.MirroredRepeatWrapping;case 3:return e.ClampToEdgeWrapping}},getMaterialType:t=>t.Clearcoat&&t.Clearcoat.value>0?e.MeshPhysicalMaterial:t.Roughness?e.MeshStandardMaterial:e.MeshPhongMaterial},Bi.prototype={constructor:Bi,parse(t,r){var a=new e.BufferGeometry;a.setAttribute("position",new e.Float32BufferAttribute(t.points,3));var n=this.splitIndices(t.vertexIndices,t.polygonDimensions);return a.setIndex(n),this.parseGroups(a,t),a.computeVertexNormals(),this.parseUVs(a,r,n),this.parseMorphTargets(a,r,n),a.translate(-r.pivot[0],-r.pivot[1],-r.pivot[2]),a},splitIndices(e,t){var r=[],a=0;return t.forEach((function(t){if(t<4)for(var n=0;n<t;n++)r.push(e[a+n]);else if(4===t)r.push(e[a],e[a+1],e[a+2],e[a],e[a+2],e[a+3]);else if(t>4){for(n=1;n<t-1;n++)r.push(e[a],e[a+n],e[a+n+1]);console.warn("LWOLoader: polygons with greater than 4 sides are not supported")}a+=t})),r},parseGroups(e,t){var r=ki.tags,a=[],n=3;"lines"===t.type&&(n=2),"points"===t.type&&(n=1);for(var s,i=this.splitMaterialIndices(t.polygonDimensions,t.materialIndices),o=0,c={},l=0,u=0,h=0;h<i.length;h+=2){var p,f=i[h+1];if(0===h&&(a[o]=r[f]),void 0===s&&(s=f),f!==s)c[r[s]]?p=c[r[s]]:(p=o,c[r[s]]=o,a[o]=r[s],o++),e.addGroup(l,u,p),l+=u,s=f,u=0;u+=n}e.groups.length>0&&(c[r[f]]?p=c[r[f]]:(p=o,c[r[f]]=o,a[o]=r[f]),e.addGroup(l,u,p));e.userData.matNames=a},splitMaterialIndices(e,t){var r=[];return e.forEach((function(e,a){if(e<=3)r.push(t[2*a],t[2*a+1]);else if(4===e)r.push(t[2*a],t[2*a+1],t[2*a],t[2*a+1]);else for(var n=0;n<e-2;n++)r.push(t[2*a],t[2*a+1])})),r},parseUVs(t,r){var a=Array.from(Array(2*t.attributes.position.count),(function(){return 0}));for(var n in r.uvs){var s=r.uvs[n].uvs;r.uvs[n].uvIndices.forEach((function(e,t){a[2*e]=s[2*t],a[2*e+1]=s[2*t+1]}))}t.setAttribute("uv",new e.Float32BufferAttribute(a,2))},parseMorphTargets(t,r){var a=0;for(var n in r.morphTargets){var s=t.attributes.position.array.slice();t.morphAttributes.position||(t.morphAttributes.position=[]);var i=r.morphTargets[n].points,o=r.morphTargets[n].indices,c=r.morphTargets[n].type;o.forEach((function(e,t){"relative"===c?(s[3*e]+=i[3*t],s[3*e+1]+=i[3*t+1],s[3*e+2]+=i[3*t+2]):(s[3*e]=i[3*t],s[3*e+1]=i[3*t+1],s[3*e+2]=i[3*t+2])})),t.morphAttributes.position[a]=new e.Float32BufferAttribute(s,3),t.morphAttributes.position[a].name=n,a++}t.morphTargetsRelative=!1}};var Gi=function(t){e.Loader.call(this,t)};Gi.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:Gi,load:function(t,r,a,n){var s=this,i=""===this.path?e.LoaderUtils.extractUrlBase(t):this.path,o=new e.FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(e){try{r(s.parse(e,i))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),a,n)},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var r=e.split("\n"),a={},n=/\s+/,s={},i=0;i<r.length;i++){var o=r[i];if(0!==(o=o.trim()).length&&"#"!==o.charAt(0)){var c=o.indexOf(" "),l=c>=0?o.substring(0,c):o;l=l.toLowerCase();var u=c>=0?o.substring(c+1):"";if(u=u.trim(),"newmtl"===l)a={name:u},s[u]=a;else if("ka"===l||"kd"===l||"ks"===l||"ke"===l){var h=u.split(n,3);a[l]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else a[l]=u}}var p=new Gi.MaterialCreator(this.resourcePath||t,this.materialOptions);return p.setCrossOrigin(this.crossOrigin),p.setManager(this.manager),p.setMaterials(s),p}}),(Gi.MaterialCreator=function(t,r){this.baseUrl=t||"",this.options=r,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:e.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:e.RepeatWrapping}).prototype={constructor:Gi.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var a=e[r],n={};for(var s in t[r]=n,a){var i=!0,o=a[s],c=s.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(o=[o[0]/255,o[1]/255,o[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===o[0]&&0===o[1]&&0===o[2]&&(i=!1)}i&&(n[c]=o)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(t){var r=this,a=this.materialsInfo[t],n={name:t,side:this.side};function s(e,t){if(!n[e]){var a=r.getTextureParams(t,n),s=r.loadTexture(function(e,t){return"string"!=typeof t||""===t?"":/^https?:\/\//i.test(t)?t:e+t}(r.baseUrl,a.url));s.repeat.copy(a.scale),s.offset.copy(a.offset),s.wrapS=r.wrap,s.wrapT=r.wrap,n[e]=s}}for(var i in a){var o,c=a[i];if(""!==c)switch(i.toLowerCase()){case"kd":n.color=(new e.Color).fromArray(c);break;case"ks":n.specular=(new e.Color).fromArray(c);break;case"ke":n.emissive=(new e.Color).fromArray(c);break;case"map_kd":s("map",c);break;case"map_ks":s("specularMap",c);break;case"map_ke":s("emissiveMap",c);break;case"norm":s("normalMap",c);break;case"map_bump":case"bump":s("bumpMap",c);break;case"map_d":s("alphaMap",c),n.transparent=!0;break;case"ns":n.shininess=parseFloat(c);break;case"d":(o=parseFloat(c))<1&&(n.opacity=o,n.transparent=!0);break;case"tr":o=parseFloat(c),this.options&&this.options.invertTrProperty&&(o=1-o),o>0&&(n.opacity=1-o,n.transparent=!0)}}return this.materials[t]=new e.MeshPhongMaterial(n),this.materials[t]},getTextureParams:function(t,r){var a,n={scale:new e.Vector2(1,1),offset:new e.Vector2(0,0)},s=t.split(/\s+/);return(a=s.indexOf("-bm"))>=0&&(r.bumpScale=parseFloat(s[a+1]),s.splice(a,2)),(a=s.indexOf("-s"))>=0&&(n.scale.set(parseFloat(s[a+1]),parseFloat(s[a+2])),s.splice(a,4)),(a=s.indexOf("-o"))>=0&&(n.offset.set(parseFloat(s[a+1]),parseFloat(s[a+2])),s.splice(a,4)),n.url=s.join(" ").trim(),n},loadTexture:function(t,r,a,n,s){var i,o=void 0!==this.manager?this.manager:e.DefaultLoadingManager,c=o.getHandler(t);return null===c&&(c=new e.TextureLoader(o)),c.setCrossOrigin&&c.setCrossOrigin(this.crossOrigin),i=c.load(t,a,n,s),void 0!==r&&(i.mapping=r),i}};var _i=function(t){e.CompressedTextureLoader.call(this,t)};_i.prototype=Object.assign(Object.create(e.CompressedTextureLoader.prototype),{constructor:_i,parse:function(t,r){var a={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function s(e,t,r,a){for(var n=r*a*4,s=new Uint8Array(e,t,n),i=new Uint8Array(n),o=0,c=0,l=0;l<a;l++)for(var u=0;u<r;u++){var h=s[c],p=s[++c],f=s[++c],d=s[++c];c++,i[o]=f,i[++o]=p,i[++o]=h,i[++o]=d,o++}return i}var i,o=n("DXT1"),c=n("DXT3"),l=n("DXT5"),u=n("ETC1"),h=new Int32Array(t,0,31);if(542327876!==h[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),a;if(4&!h[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),a;var p,f=h[21],d=!1;switch(f){case o:i=8,a.format=e.RGB_S3TC_DXT1_Format;break;case c:i=16,a.format=e.RGBA_S3TC_DXT3_Format;break;case l:i=16,a.format=e.RGBA_S3TC_DXT5_Format;break;case u:i=8,a.format=e.RGB_ETC1_Format;break;default:if(!(32===h[22]&&16711680&h[23]&&65280&h[24]&&255&h[25]&&4278190080&h[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(p=f,String.fromCharCode(255&p,p>>8&255,p>>16&255,p>>24&255))),a;d=!0,i=64,a.format=e.RGBAFormat}a.mipmapCount=1,131072&h[2]&&!1!==r&&(a.mipmapCount=Math.max(1,h[7]));var g=h[28];if(a.isCubemap=!!(512&g),a.isCubemap&&(!(1024&g)||!(2048&g)||!(4096&g)||!(8192&g)||!(16384&g)||!(32768&g)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),a;a.width=h[4],a.height=h[3];for(var v=h[1]+4,m=a.isCubemap?6:1,y=0;y<m;y++)for(var b=a.width,x=a.height,w=0;w<a.mipmapCount;w++){if(d)var S=(T=s(t,v,b,x)).length;else{S=Math.max(4,b)/4*Math.max(4,x)/4*i;var T=new Uint8Array(t,v,S)}var F={data:T,width:b,height:x};a.mipmaps.push(F),v+=S,b=Math.max(b>>1,1),x=Math.max(x>>1,1)}return a}});var Hi=function(){var t=/^[og]\s*(.+)?/,r=/^mtllib /,a=/^usemtl /,n=/^usemap /,s=new e.Vector3,i=new e.Vector3,o=new e.Vector3,c=new e.Vector3,l=new e.Vector3;function u(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var a={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){var a=r.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){var r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){var r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){var a=this.vertices,n=this.object.geometry.vertices;n.push(a[e+0],a[e+1],a[e+2]),n.push(a[t+0],a[t+1],a[t+2]),n.push(a[r+0],a[r+1],a[r+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){var a=this.normals,n=this.object.geometry.normals;n.push(a[e+0],a[e+1],a[e+2]),n.push(a[t+0],a[t+1],a[t+2]),n.push(a[r+0],a[r+1],a[r+2])},addFaceNormal:function(e,t,r){var a=this.vertices,n=this.object.geometry.normals;s.fromArray(a,e),i.fromArray(a,t),o.fromArray(a,r),l.subVectors(o,i),c.subVectors(s,i),l.cross(c),l.normalize(),n.push(l.x,l.y,l.z),n.push(l.x,l.y,l.z),n.push(l.x,l.y,l.z)},addColor:function(e,t,r){var a=this.colors,n=this.object.geometry.colors;void 0!==a[e]&&n.push(a[e+0],a[e+1],a[e+2]),void 0!==a[t]&&n.push(a[t+0],a[t+1],a[t+2]),void 0!==a[r]&&n.push(a[r+0],a[r+1],a[r+2])},addUV:function(e,t,r){var a=this.uvs,n=this.object.geometry.uvs;n.push(a[e+0],a[e+1]),n.push(a[t+0],a[t+1]),n.push(a[r+0],a[r+1])},addDefaultUV:function(){var e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,a,n,s,i,o,c){var l=this.vertices.length,u=this.parseVertexIndex(e,l),h=this.parseVertexIndex(t,l),p=this.parseVertexIndex(r,l);if(this.addVertex(u,h,p),this.addColor(u,h,p),void 0!==i&&""!==i){var f=this.normals.length;u=this.parseNormalIndex(i,f),h=this.parseNormalIndex(o,f),p=this.parseNormalIndex(c,f),this.addNormal(u,h,p)}else this.addFaceNormal(u,h,p);if(void 0!==a&&""!==a){var d=this.uvs.length;u=this.parseUVIndex(a,d),h=this.parseUVIndex(n,d),p=this.parseUVIndex(s,d),this.addUV(u,h,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,r=0,a=e.length;r<a;r++){var n=this.parseVertexIndex(e[r],t);this.addVertexPoint(n),this.addColor(n)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var r=this.vertices.length,a=this.uvs.length,n=0,s=e.length;n<s;n++)this.addVertexLine(this.parseVertexIndex(e[n],r));var i=0;for(s=t.length;i<s;i++)this.addUVLine(this.parseUVIndex(t[i],a))}};return e.startObject("",!1),e}function h(t){e.Loader.call(this,t),this.materials=null}return h.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:h,load:function(t,r,a,n){var s=this,i=new e.FileLoader(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,(function(e){try{r(s.parse(e))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),a,n)},setMaterials:function(e){return this.materials=e,this},parse:function(s){var i=new u;-1!==s.indexOf("\r\n")&&(s=s.replace(/\r\n/g,"\n")),-1!==s.indexOf("\\\n")&&(s=s.replace(/\\\n/g,""));for(var o=s.split("\n"),c="",l="",h=[],p="function"==typeof"".trimLeft,f=0,d=o.length;f<d;f++)if(c=o[f],0!==(c=p?c.trimLeft():c.trim()).length&&"#"!==(l=c.charAt(0)))if("v"===l){var g=c.split(/\s+/);switch(g[0]){case"v":i.vertices.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3])),g.length>=7?i.colors.push(parseFloat(g[4]),parseFloat(g[5]),parseFloat(g[6])):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(g[1]),parseFloat(g[2]),parseFloat(g[3]));break;case"vt":i.uvs.push(parseFloat(g[1]),parseFloat(g[2]))}}else if("f"===l){for(var v=c.substr(1).trim().split(/\s+/),m=[],y=0,b=v.length;y<b;y++){var x=v[y];if(x.length>0){var w=x.split("/");m.push(w)}}var S=m[0];for(y=1,b=m.length-1;y<b;y++){var T=m[y],F=m[y+1];i.addFace(S[0],T[0],F[0],S[1],T[1],F[1],S[2],T[2],F[2])}}else if("l"===l){var k=c.substring(1).trim().split(" "),E=[],A=[];if(-1===c.indexOf("/"))E=k;else for(var I=0,M=k.length;I<M;I++){var L=k[I].split("/");""!==L[0]&&E.push(L[0]),""!==L[1]&&A.push(L[1])}i.addLineGeometry(E,A)}else if("p"===l){var C=c.substr(1).trim().split(" ");i.addPointGeometry(C)}else if(null!==(h=t.exec(c))){var O=(" "+h[0].substr(1).trim()).substr(1);i.startObject(O)}else if(a.test(c))i.object.startMaterial(c.substring(7).trim(),i.materialLibraries);else if(r.test(c))i.materialLibraries.push(c.substring(7).trim());else if(n.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===l){if((h=c.split(" ")).length>1){var R=h[1].trim().toLowerCase();i.object.smooth="0"!==R&&"off"!==R}else i.object.smooth=!0;(X=i.object.currentMaterial())&&(X.smooth=i.object.smooth)}else{if("\0"===c)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}i.finalize();var U=new e.Group;if(U.materialLibraries=[].concat(i.materialLibraries),!0===!(1===i.objects.length&&0===i.objects[0].geometry.vertices.length))for(f=0,d=i.objects.length;f<d;f++){var N=i.objects[f],D=N.geometry,P=N.materials,B="Line"===D.type,G="Points"===D.type,_=!1;if(0!==D.vertices.length){(Z=new e.BufferGeometry).setAttribute("position",new e.Float32BufferAttribute(D.vertices,3)),D.normals.length>0&&Z.setAttribute("normal",new e.Float32BufferAttribute(D.normals,3)),D.colors.length>0&&(_=!0,Z.setAttribute("color",new e.Float32BufferAttribute(D.colors,3))),!0===D.hasUVIndices&&Z.setAttribute("uv",new e.Float32BufferAttribute(D.uvs,2));for(var H,V=[],z=0,j=P.length;z<j;z++){var W=(K=P[z]).name+"_"+K.smooth+"_"+_,X=i.materials[W];if(null!==this.materials)if(X=this.materials.create(K.name),!B||!X||X instanceof e.LineBasicMaterial){if(G&&X&&!(X instanceof e.PointsMaterial)){var q=new e.PointsMaterial({size:10,sizeAttenuation:!1});e.Material.prototype.copy.call(q,X),q.color.copy(X.color),q.map=X.map,X=q}}else{var Y=new e.LineBasicMaterial;e.Material.prototype.copy.call(Y,X),Y.color.copy(X.color),X=Y}void 0===X&&((X=B?new e.LineBasicMaterial:G?new e.PointsMaterial({size:1,sizeAttenuation:!1}):new e.MeshPhongMaterial).name=K.name,X.flatShading=!K.smooth,X.vertexColors=_,i.materials[W]=X),V.push(X)}if(V.length>1){for(z=0,j=P.length;z<j;z++){var K=P[z];Z.addGroup(K.groupStart,K.groupCount,z)}H=B?new e.LineSegments(Z,V):G?new e.Points(Z,V):new e.Mesh(Z,V)}else H=B?new e.LineSegments(Z,V[0]):G?new e.Points(Z,V[0]):new e.Mesh(Z,V[0]);H.name=N.name,U.add(H)}}else if(i.vertices.length>0){var Z;X=new e.PointsMaterial({size:1,sizeAttenuation:!1});(Z=new e.BufferGeometry).setAttribute("position",new e.Float32BufferAttribute(i.vertices,3)),i.colors.length>0&&void 0!==i.colors[0]&&(Z.setAttribute("color",new e.Float32BufferAttribute(i.colors,3)),X.vertexColors=!0);var Q=new e.Points(Z,X);U.add(Q)}return U}}),h}();var Vi=function(t){e.DataTextureLoader.call(this,t),this.type=e.FloatType};Vi.prototype=Object.assign(Object.create(e.DataTextureLoader.prototype),{constructor:Vi,parse:function(t){const r=65536,a=14,n=65537,s=16384,i=Math.pow(2.7182818,2.2);var o=new DataView(new ArrayBuffer(8));function c(e){if(0===e)return[e,0];o.setFloat64(0,e);var t=o.getUint32(0)>>>20&2047;0===t&&(o.setFloat64(0,e*Math.pow(2,64)),t=(o.getUint32(0)>>>20&2047)-64);var r=t-1022;return[function(e,t){for(var r=Math.min(3,Math.ceil(Math.abs(t)/1023)),a=e,n=0;n<r;n++)a*=Math.pow(2,Math.floor((t+n)/r));return a}(e,-r),r]}const l={l:0,c:0,lc:0};function u(e,t,r,a,n){for(;r<e;)t=t<<8|H(a,n),r+=8;r-=e,l.l=t>>r&(1<<e)-1,l.c=t,l.lc=r}const h=new Array(59);function p(e,t,r,a,s,i,o){for(var c=r,p=0,f=0;s<=i;s++){if(c.value-r.value>a)return!1;u(6,p,f,e,c);var d=l.l;if(p=l.c,f=l.lc,o[s]=d,63==d){if(c.value-r.value>a)throw"Something wrong with hufUnpackEncTable";u(8,p,f,e,c);var g=l.l+6;if(p=l.c,f=l.lc,s+g>i+1)throw"Something wrong with hufUnpackEncTable";for(;g--;)o[s++]=0;s--}else if(d>=59){if(s+(g=d-59+2)>i+1)throw"Something wrong with hufUnpackEncTable";for(;g--;)o[s++]=0;s--}}!function(e){for(var t=0;t<=58;++t)h[t]=0;for(t=0;t<n;++t)h[e[t]]+=1;var r=0;for(t=58;t>0;--t){var a=r+h[t]>>1;h[t]=r,r=a}for(t=0;t<n;++t){var s=e[t];s>0&&(e[t]=s|h[s]++<<6)}}(o)}function f(e){return 63&e}function d(e){return e>>6}const g={c:0,lc:0};function v(e,t,r,a){e=e<<8|H(r,a),t+=8,g.c=e,g.lc=t}const m={c:0,lc:0};function y(e,t,r,a,n,s,i,o,c,l){if(e==t){a<8&&(v(r,a,n,i),r=g.c,a=g.lc);var u=r>>(a-=8);u=new Uint8Array([u])[0];if(c.value+u>l)return!1;for(var h=o[c.value-1];u-- >0;)o[c.value++]=h}else{if(!(c.value<l))return!1;o[c.value++]=e}m.c=r,m.lc=a}function b(e){return 65535&e}function x(e){var t=b(e);return t>32767?t-65536:t}const w={a:0,b:0};function S(e,t){var r=x(e),a=x(t),n=r+(1&a)+(a>>1),s=n,i=n-a;w.a=s,w.b=i}function T(e,t){var r=b(e),a=b(t),n=r-(a>>1)&65535,s=a+n-32768&65535;w.a=s,w.b=n}function F(e,t,r,a,n,s,i){for(var o,c=i<16384,l=r>n?n:r,u=1;u<=l;)u<<=1;for(o=u>>=1,u>>=1;u>=1;){for(var h,p,f,d,g=0,v=g+s*(n-o),m=s*u,y=s*o,b=a*u,x=a*o;g<=v;g+=y){for(var F=g,k=g+a*(r-o);F<=k;F+=x){var E=F+b,A=(I=F+m)+b;c?(S(e[F+t],e[I+t]),h=w.a,f=w.b,S(e[E+t],e[A+t]),p=w.a,d=w.b,S(h,p),e[F+t]=w.a,e[E+t]=w.b,S(f,d),e[I+t]=w.a,e[A+t]=w.b):(T(e[F+t],e[I+t]),h=w.a,f=w.b,T(e[E+t],e[A+t]),p=w.a,d=w.b,T(h,p),e[F+t]=w.a,e[E+t]=w.b,T(f,d),e[I+t]=w.a,e[A+t]=w.b)}if(r&u){var I=F+m;c?S(e[F+t],e[I+t]):T(e[F+t],e[I+t]),h=w.a,e[I+t]=w.b,e[F+t]=h}}if(n&u)for(F=g,k=g+a*(r-o);F<=k;F+=x){E=F+b;c?S(e[F+t],e[E+t]):T(e[F+t],e[E+t]),h=w.a,e[E+t]=w.b,e[F+t]=h}o=u,u>>=1}return g}function k(e,t,r,i,o,c){var l=r.value,u=_(t,r),h=_(t,r);r.value+=4;var b=_(t,r);if(r.value+=4,u<0||u>=n||h<0||h>=n)throw"Something wrong with HUF_ENCSIZE";var x=new Array(n),w=new Array(s);if(function(e){for(var t=0;t<s;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(w),p(e,0,r,i-(r.value-l),u,h,x),b>8*(i-(r.value-l)))throw"Something wrong with hufUncompress";!function(e,t,r,n){for(;t<=r;t++){var s=d(e[t]),i=f(e[t]);if(s>>i)throw"Invalid table entry";if(i>a){if((u=n[s>>i-a]).len)throw"Invalid table entry";if(u.lit++,u.p){var o=u.p;u.p=new Array(u.lit);for(var c=0;c<u.lit-1;++c)u.p[c]=o[c]}else u.p=new Array(1);u.p[u.lit-1]=t}else if(i){var l=0;for(c=1<<a-i;c>0;c--){var u;if((u=n[(s<<a-i)+l]).len||u.p)throw"Invalid table entry";u.len=i,u.lit=t,l++}}}}(x,u,h,w),function(e,t,r,n,s,i,o,c,l,u){for(var h=0,p=0,b=c,x=Math.trunc(s.value+(i+7)/8);s.value<x;)for(v(h,p,r,s),h=g.c,p=g.lc;p>=a;)if((F=t[h>>p-a&16383]).len)p-=F.len,y(F.lit,o,h,p,r,0,s,l,u,b),h=m.c,p=m.lc;else{if(!F.p)throw"hufDecode issues";var w;for(w=0;w<F.lit;w++){for(var S=f(e[F.p[w]]);p<S&&s.value<x;)v(h,p,r,s),h=g.c,p=g.lc;if(p>=S&&d(e[F.p[w]])==(h>>p-S&(1<<S)-1)){p-=S,y(F.p[w],o,h,p,r,0,s,l,u,b),h=m.c,p=m.lc;break}}if(w==F.lit)throw"hufDecode issues"}var T=8-i&7;for(h>>=T,p-=T;p>0;){var F;if(!(F=t[h<<a-p&16383]).len)throw"hufDecode issues";p-=F.len,y(F.lit,o,h,p,r,0,s,l,u,b),h=m.c,p=m.lc}}(x,w,e,0,r,b,h,c,o,{value:0})}function E(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function A(e,t){for(var r=0,a=Math.floor((e.length+1)/2),n=0,s=e.length-1;!(n>s||(t[n++]=e[r++],n>s));)t[n++]=e[a++]}function I(e){for(var t=e.byteLength,r=new Array,a=0,n=new DataView(e);t>0;){var s=n.getInt8(a++);if(s<0){t-=(o=-s)+1;for(var i=0;i<o;i++)r.push(n.getUint8(a++))}else{var o=s;t-=2;var c=n.getUint8(a++);for(i=0;i<o+1;i++)r.push(c)}}return r}function M(e,t,r){for(var a,n=1;n<64;)65280==(a=t[e.value])?n=64:a>>8==255?n+=255&a:(r[n]=a,n++),e.value++}function L(e,t){t[0]=W(e[0]),t[1]=W(e[1]),t[2]=W(e[5]),t[3]=W(e[6]),t[4]=W(e[14]),t[5]=W(e[15]),t[6]=W(e[27]),t[7]=W(e[28]),t[8]=W(e[2]),t[9]=W(e[4]),t[10]=W(e[7]),t[11]=W(e[13]),t[12]=W(e[16]),t[13]=W(e[26]),t[14]=W(e[29]),t[15]=W(e[42]),t[16]=W(e[3]),t[17]=W(e[8]),t[18]=W(e[12]),t[19]=W(e[17]),t[20]=W(e[25]),t[21]=W(e[30]),t[22]=W(e[41]),t[23]=W(e[43]),t[24]=W(e[9]),t[25]=W(e[11]),t[26]=W(e[18]),t[27]=W(e[24]),t[28]=W(e[31]),t[29]=W(e[40]),t[30]=W(e[44]),t[31]=W(e[53]),t[32]=W(e[10]),t[33]=W(e[19]),t[34]=W(e[23]),t[35]=W(e[32]),t[36]=W(e[39]),t[37]=W(e[45]),t[38]=W(e[52]),t[39]=W(e[54]),t[40]=W(e[20]),t[41]=W(e[22]),t[42]=W(e[33]),t[43]=W(e[38]),t[44]=W(e[46]),t[45]=W(e[51]),t[46]=W(e[55]),t[47]=W(e[60]),t[48]=W(e[21]),t[49]=W(e[34]),t[50]=W(e[37]),t[51]=W(e[47]),t[52]=W(e[50]),t[53]=W(e[56]),t[54]=W(e[59]),t[55]=W(e[61]),t[56]=W(e[35]),t[57]=W(e[36]),t[58]=W(e[48]),t[59]=W(e[49]),t[60]=W(e[57]),t[61]=W(e[58]),t[62]=W(e[62]),t[63]=W(e[63])}function C(e){const t=.5*Math.cos(.7853975),r=.5*Math.cos(3.14159/16),a=.5*Math.cos(3.14159/8),n=.5*Math.cos(3*3.14159/16),s=.5*Math.cos(.981746875),i=.5*Math.cos(3*3.14159/8),o=.5*Math.cos(1.374445625);for(var c=new Array(4),l=new Array(4),u=new Array(4),h=new Array(4),p=0;p<8;++p){var f=8*p;c[0]=a*e[f+2],c[1]=i*e[f+2],c[2]=a*e[f+6],c[3]=i*e[f+6],l[0]=r*e[f+1]+n*e[f+3]+s*e[f+5]+o*e[f+7],l[1]=n*e[f+1]-o*e[f+3]-r*e[f+5]-s*e[f+7],l[2]=s*e[f+1]-r*e[f+3]+o*e[f+5]+n*e[f+7],l[3]=o*e[f+1]-s*e[f+3]+n*e[f+5]-r*e[f+7],u[0]=t*(e[f+0]+e[f+4]),u[3]=t*(e[f+0]-e[f+4]),u[1]=c[0]+c[3],u[2]=c[1]-c[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[f+0]=h[0]+l[0],e[f+1]=h[1]+l[1],e[f+2]=h[2]+l[2],e[f+3]=h[3]+l[3],e[f+4]=h[3]-l[3],e[f+5]=h[2]-l[2],e[f+6]=h[1]-l[1],e[f+7]=h[0]-l[0]}for(var d=0;d<8;++d)c[0]=a*e[16+d],c[1]=i*e[16+d],c[2]=a*e[48+d],c[3]=i*e[48+d],l[0]=r*e[8+d]+n*e[24+d]+s*e[40+d]+o*e[56+d],l[1]=n*e[8+d]-o*e[24+d]-r*e[40+d]-s*e[56+d],l[2]=s*e[8+d]-r*e[24+d]+o*e[40+d]+n*e[56+d],l[3]=o*e[8+d]-s*e[24+d]+n*e[40+d]-r*e[56+d],u[0]=t*(e[d]+e[32+d]),u[3]=t*(e[d]-e[32+d]),u[1]=c[0]+c[3],u[2]=c[1]-c[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[0+d]=h[0]+l[0],e[8+d]=h[1]+l[1],e[16+d]=h[2]+l[2],e[24+d]=h[3]+l[3],e[32+d]=h[3]-l[3],e[40+d]=h[2]-l[2],e[48+d]=h[1]-l[1],e[56+d]=h[0]-l[0]}function O(e){for(var t=0;t<64;++t){var r=e[0][t],a=e[1][t],n=e[2][t];e[0][t]=r+1.5747*n,e[1][t]=r-.1873*a-.4682*n,e[2][t]=r+1.8556*a}}function R(t,r,a){for(var n=0;n<64;++n)r[a+n]=e.DataUtils.toHalfFloat(U(t[n]))}function U(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(i,Math.abs(e)-1)}function N(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===Si&&console.error("THREE.EXRLoader: External library fflate.min.js required.");var r=Ks(t),a=new Uint8Array(r.length);return E(r),A(r,a),new DataView(a.buffer)}function D(e){var t=e.viewer,r={value:e.offset.value},a=new Uint8Array(e.width*e.lines*(Z.channels.length*e.type*2)),n={version:z(t,r),unknownUncompressedSize:z(t,r),unknownCompressedSize:z(t,r),acCompressedSize:z(t,r),dcCompressedSize:z(t,r),rleCompressedSize:z(t,r),rleUncompressedSize:z(t,r),rleRawSize:z(t,r),totalAcUncompressedCount:z(t,r),totalDcUncompressedCount:z(t,r),acCompression:z(t,r)};if(n.version<2)throw"EXRLoader.parse: "+Z.compression+" version "+n.version+" is unsupported";for(var s=new Array,i=X(t,r)-2;i>0;){var o=P(t.buffer,r),c=V(t,r),l=c>>2&3,u=new Int8Array([(c>>4)-1])[0],h=V(t,r);s.push({name:o,index:u,type:h,compression:l}),i-=o.length+3}for(var p=Z.channels,f=new Array(e.channels),d=0;d<e.channels;++d){var g=f[d]={},v=p[d];g.name=v.name,g.compression=0,g.decoded=!1,g.type=v.pixelType,g.pLinear=v.pLinear,g.width=e.width,g.height=e.lines}for(var m={idx:new Array(3)},y=0;y<e.channels;++y)for(g=f[y],d=0;d<s.length;++d){var b=s[d];g.name==b.name&&(g.compression=b.compression,b.index>=0&&(m.idx[b.index]=y),g.offset=y)}if(n.acCompressedSize>0)switch(n.acCompression){case 0:var x=new Uint16Array(n.totalAcUncompressedCount);k(e.array,t,r,n.acCompressedSize,x,n.totalAcUncompressedCount);break;case 1:var w=Ks(e.array.slice(r.value,r.value+n.totalAcUncompressedCount));x=new Uint16Array(w.buffer);r.value+=n.totalAcUncompressedCount}if(n.dcCompressedSize>0){var S={array:e.array,offset:r,size:n.dcCompressedSize},T=new Uint16Array(N(S).buffer);r.value+=n.dcCompressedSize}if(n.rleRawSize>0){var F=I((w=Ks(e.array.slice(r.value,r.value+n.rleCompressedSize))).buffer);r.value+=n.rleCompressedSize}var E=0,A=new Array(f.length);for(d=0;d<A.length;++d)A[d]=new Array;for(var U=0;U<e.lines;++U)for(var D=0;D<f.length;++D)A[D].push(E),E+=f[D].width*e.type*2;!function(e,t,r,a,n,s){var i=new DataView(s.buffer),o=r[e.idx[0]].width,c=r[e.idx[0]].height,l=Math.floor(o/8),u=Math.ceil(o/8),h=Math.ceil(c/8),p=o-8*(u-1),f=c-8*(h-1),d={value:0},g=new Array(3),v=new Array(3),m=new Array(3),y=new Array(3),b=new Array(3);for(let r=0;r<3;++r)b[r]=t[e.idx[r]],g[r]=r<1?0:g[r-1]+u*h,v[r]=new Float32Array(64),m[r]=new Uint16Array(64),y[r]=new Uint16Array(64*u);for(let t=0;t<h;++t){var x=8;t==h-1&&(x=f);var w=8;for(let e=0;e<u;++e){e==u-1&&(w=p);for(let e=0;e<3;++e)m[e].fill(0),m[e][0]=n[g[e]++],M(d,a,m[e]),L(m[e],v[e]),C(v[e]);O(v);for(let t=0;t<3;++t)R(v[t],y[t],64*e)}let s=0;for(let a=0;a<3;++a){const n=r[e.idx[a]].type;for(let e=8*t;e<8*t+x;++e){s=b[a][e];for(let t=0;t<l;++t){const r=64*t+8*(7&e);i.setUint16(s+0*n,y[a][r+0],!0),i.setUint16(s+2*n,y[a][r+1],!0),i.setUint16(s+4*n,y[a][r+2],!0),i.setUint16(s+6*n,y[a][r+3],!0),i.setUint16(s+8*n,y[a][r+4],!0),i.setUint16(s+10*n,y[a][r+5],!0),i.setUint16(s+12*n,y[a][r+6],!0),i.setUint16(s+14*n,y[a][r+7],!0),s+=16*n}}if(l!=u)for(let e=8*t;e<8*t+x;++e){const t=b[a][e]+8*l*2*n,r=64*l+8*(7&e);for(let e=0;e<w;++e)i.setUint16(t+2*e*n,y[a][r+e],!0)}}}for(var S=new Uint16Array(o),T=(i=new DataView(s.buffer),0);T<3;++T){r[e.idx[T]].decoded=!0;var F=r[e.idx[T]].type;if(2==r[T].type)for(var k=0;k<c;++k){const e=b[T][k];for(var E=0;E<o;++E)S[E]=i.getUint16(e+2*E*F,!0);for(E=0;E<o;++E)i.setFloat32(e+2*E*F,W(S[E]),!0)}}}(m,A,f,x,T,a);for(d=0;d<f.length;++d){if(!(g=f[d]).decoded)switch(g.compression){case 2:var B=0,G=0;for(U=0;U<e.lines;++U){for(var _=A[d][B],H=0;H<g.width;++H){for(var j=0;j<2*g.type;++j)a[_++]=F[G+j*g.width*g.height];G++}B++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(a.buffer)}function P(t,r){for(var a=new Uint8Array(t),n=0;0!=a[r.value+n];)n+=1;var s=(new e.$TextDecoder).decode(a.slice(r.value,r.value+n));return r.value=r.value+n+1,s}function B(e,t){var r=e.getUint32(0,!0);return t.value=t.value+8,r}function G(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function _(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function H(e,t){var r=e[t.value];return t.value=t.value+1,r}function V(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}function z(e,t){var r=Number(e.getBigInt64(t.value,!0));return t.value+=8,r}function j(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function W(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function X(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function q(t,r,a,n,s){return"string"===n||"stringvector"===n||"iccProfile"===n?function(t,r,a){var n=(new e.$TextDecoder).decode(new Uint8Array(t).slice(r.value,r.value+a));return r.value=r.value+a,n}(r,a,s):"chlist"===n?function(e,t,r,a){for(var n=r.value,s=[];r.value<n+a-1;){var i=P(t,r),o=G(e,r),c=V(e,r);r.value+=3;var l=G(e,r),u=G(e,r);s.push({name:i,pixelType:o,pLinear:c,xSampling:l,ySampling:u})}return r.value+=1,s}(t,r,a,s):"chromaticities"===n?function(e,t){return{redX:j(e,t),redY:j(e,t),greenX:j(e,t),greenY:j(e,t),blueX:j(e,t),blueY:j(e,t),whiteX:j(e,t),whiteY:j(e,t)}}(t,a):"compression"===n?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][V(e,t)]}(t,a):"box2i"===n?function(e,t){return{xMin:_(e,t),yMin:_(e,t),xMax:_(e,t),yMax:_(e,t)}}(t,a):"lineOrder"===n?function(e,t){return["INCREASING_Y"][V(e,t)]}(t,a):"float"===n?j(t,a):"v2f"===n?function(e,t){return[j(e,t),j(e,t)]}(t,a):"v3f"===n?function(e,t){return[j(e,t),j(e,t),j(e,t)]}(t,a):"int"===n?G(t,a):"rational"===n?function(e,t){return[G(e,t),_(e,t)]}(t,a):"timecode"===n?function(e,t){return[_(e,t),_(e,t)]}(t,a):"preview"===n?(a.value+=s,"skipped"):void(a.value+=s)}var Y=new DataView(t),K=new Uint8Array(t),Z={};Y.getUint32(0,!0),Y.getUint8(4,!0),Y.getUint8(5,!0);for(var Q={value:8},$=!0;$;){var J=P(t,Q);if(0==J)$=!1;else{var ee=P(t,Q),te=q(Y,t,Q,ee,_(Y,Q));void 0===te?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${ee}'.`):Z[J]=te}}var re,ae,ne,se,ie=Z.dataWindow.yMax+1;switch(Z.compression){case"NO_COMPRESSION":ae=1,re=function(e){return new DataView(e.array.buffer,e.offset.value,e.size)};break;case"RLE_COMPRESSION":ae=1,re=function(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array(I(t)),a=new Uint8Array(r.length);return E(r),A(r,a),new DataView(a.buffer)};break;case"ZIPS_COMPRESSION":ae=1,re=N;break;case"ZIP_COMPRESSION":ae=16,re=N;break;case"PIZ_COMPRESSION":ae=32,re=function(e){for(var t=e.viewer,a={value:e.offset.value},n=e.width*ae*(Z.channels.length*e.type),s=new Uint16Array(n),i=new Uint8Array(8192),o=0,c=new Array(e.channels),l=0;l<e.channels;l++)c[l]={},c[l].start=o,c[l].end=c[l].start,c[l].nx=e.width,c[l].ny=e.lines,c[l].size=e.type,o+=c[l].nx*c[l].ny*c[l].size;var u=X(t,a),h=X(t,a);if(h>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(u<=h)for(l=0;l<h-u+1;l++)i[l+u]=V(t,a);var p=new Uint16Array(r),f=function(e,t){for(var a=0,n=0;n<r;++n)(0==n||e[n>>3]&1<<(7&n))&&(t[a++]=n);for(var s=a-1;a<r;)t[a++]=0;return s}(i,p),d=_(t,a);for(k(e.array,t,a,d,s,o),l=0;l<e.channels;++l)for(var g=c[l],v=0;v<c[l].size;++v)F(s,g.start+v,g.nx,g.size,g.ny,g.nx*g.size,f);!function(e,t,r){for(var a=0;a<r;++a)t[a]=e[t[a]]}(p,s,o);for(var m=0,y=new Uint8Array(s.buffer.byteLength),b=0;b<e.lines;b++)for(var x=0;x<e.channels;x++){var w=(g=c[x]).nx*g.size,S=new Uint8Array(s.buffer,2*g.end,2*w);y.set(S,m),m+=2*w,g.end+=w}return new DataView(y.buffer)};break;case"PXR24_COMPRESSION":ae=16,re=function(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===Si&&console.error("THREE.EXRLoader: External library fflate.min.js required.");var r=Ks(t);const a=e.lines*e.channels*e.width,n=1==e.type?new Uint16Array(a):new Uint32Array(a);let s=0,i=0;const o=new Array(4);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let t=0;switch(e.type){case 1:o[0]=s,o[1]=o[0]+e.width,s=o[1]+e.width;for(let a=0;a<e.width;++a)t+=r[o[0]++]<<8|r[o[1]++],n[i]=t,i++;break;case 2:o[0]=s,o[1]=o[0]+e.width,o[2]=o[1]+e.width,s=o[2]+e.width;for(let a=0;a<e.width;++a)t+=r[o[0]++]<<24|r[o[1]++]<<16|r[o[2]++]<<8,n[i]=t,i++}}return new DataView(n.buffer)};break;case"DWAA_COMPRESSION":ae=32,re=D;break;case"DWAB_COMPRESSION":ae=256,re=D;break;default:throw"EXRLoader.parse: "+Z.compression+" is unsupported"}var oe=Z.channels[0].pixelType;if(1===oe)switch(this.type){case e.UnsignedByteType:case e.FloatType:se=function(e,t){return W(X(e,t))},ne=2;break;case e.HalfFloatType:se=X,ne=2}else{if(2!==oe)throw"EXRLoader.parse: unsupported pixelType "+oe+" for "+Z.compression+".";switch(this.type){case e.UnsignedByteType:case e.FloatType:se=j,ne=4;break;case e.HalfFloatType:se=function(t,r){return e.DataUtils.toHalfFloat(j(t,r))},ne=4}}for(var ce=ie/ae,le=0;le<ce;le++)B(Y,Q);var ue=Z.dataWindow.xMax-Z.dataWindow.xMin+1,he=Z.dataWindow.yMax-Z.dataWindow.yMin+1,pe=ue*he*4;switch(this.type){case e.UnsignedByteType:case e.FloatType:var fe=new Float32Array(pe);Z.channels.length<4&&fe.fill(1,0,pe);break;case e.HalfFloatType:fe=new Uint16Array(pe);Z.channels.length<4&&fe.fill(15360,0,pe);break;default:console.error("THREE.EXRLoader: unsupported type: ",this.type)}for(var de,ge,ve={R:0,G:1,B:2,A:3},me={size:0,width:ue,lines:ae,offset:Q,array:K,viewer:Y,type:oe,channels:Z.channels.length},ye={value:0},be=0;be<he/ae;be++){de=_(Y,Q),pe=_(Y,Q),me.lines=de+ae>he?he-de:ae,me.offset=Q,me.size=pe,ge=re(me),Q.value+=pe;for(var xe=0;xe<ae;xe++){var we=xe+be*ae;if(we>=he)break;for(var Se=0;Se<Z.channels.length;Se++)for(var Te=ve[Z.channels[Se].name],Fe=0;Fe<ue;Fe++){var ke=xe*(Z.channels.length*ue)+Se*ue+Fe;ye.value=ke*ne;var Ee=se(ge,ye);fe[4*ue*(he-1-we)+4*Fe+Te]=Ee}}}if(this.type===e.UnsignedByteType){let e,t;const r=fe.length,a=new Uint8Array(r);for(let r=0;r<he;++r)for(let n=0;n<ue;++n){t=r*ue*4+4*n;const s=fe[t],i=fe[t+1],o=fe[t+2];if(e=s>i?s:i,e=o>e?o:e,e<1e-32)a[t]=a[t+1]=a[t+2]=a[t+3]=0;else{const r=c(e);e=256*r[0]/e,a[t]=s*e,a[t+1]=i*e,a[t+2]=o*e,a[t+3]=r[1]+128}}fe=a}const Ae=this.type===e.UnsignedByteType?e.RGBEFormat:e.RGBAFormat;return{header:Z,width:ue,height:he,data:fe,format:Ae,type:this.type}},setDataType:function(e){return this.type=e,this},load:function(t,r,a,n){return e.DataTextureLoader.prototype.load.call(this,t,(function(t,a){switch(t.type){case e.UnsignedByteType:t.encoding=e.RGBEEncoding,t.minFilter=e.NearestFilter,t.magFilter=e.NearestFilter,t.generateMipmaps=!1,t.flipY=!1;break;case e.FloatType:case e.HalfFloatType:t.encoding=e.LinearEncoding,t.minFilter=e.LinearFilter,t.magFilter=e.LinearFilter,t.generateMipmaps=!1,t.flipY=!1}r&&r(t,a)}),a,n)}});var zi,ji,Wi,Xi,qi,Yi,Ki,Zi,Qi,$i,Ji,eo,to,ro,ao,no,so,io=function(t){e.Loader.call(this,t),this.defaultDPI=90,this.defaultUnit="px"};io.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:io,load:function(t,r,a,n){var s=this,i=new e.FileLoader(s.manager);i.setPath(s.path),i.setRequestHeader(s.requestHeader),i.setWithCredentials(s.withCredentials),i.load(t,(function(e){try{r(s.parse(e))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),a,n)},parse:function(t){var r=this;function a(e,t,r,a,s,i,o,c){if(0!=t&&0!=r){a=a*Math.PI/180,t=Math.abs(t),r=Math.abs(r);var l=(o.x-c.x)/2,u=(o.y-c.y)/2,h=Math.cos(a)*l+Math.sin(a)*u,p=-Math.sin(a)*l+Math.cos(a)*u,f=t*t,d=r*r,g=h*h,v=p*p,m=g/f+v/d;if(m>1){var y=Math.sqrt(m);f=(t*=y)*t,d=(r*=y)*r}var b=f*v+d*g,x=(f*d-b)/b,w=Math.sqrt(Math.max(0,x));s===i&&(w=-w);var S=w*t*p/r,T=-w*r*h/t,F=Math.cos(a)*S-Math.sin(a)*T+(o.x+c.x)/2,k=Math.sin(a)*S+Math.cos(a)*T+(o.y+c.y)/2,E=n(1,0,(h-S)/t,(p-T)/r),A=n((h-S)/t,(p-T)/r,(-h-S)/t,(-p-T)/r)%(2*Math.PI);e.currentPath.absellipse(F,k,t,r,E,E+A,0===i,a)}else e.lineTo(c.x,c.y)}function n(e,t,r,a){var n=e*r+t*a,s=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+a*a),i=Math.acos(Math.max(-1,Math.min(1,n/s)));return e*a-t*r<0&&(i=-i),i}function s(e,t){t=Object.assign({},t);var r={};if(e.hasAttribute("class"))for(var a=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim())),n=0;n<a.length;n++)r=Object.assign(r,d["."+a[n]]);function s(a,n,s){void 0===s&&(s=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(a)&&(t[n]=s(e.getAttribute(a))),r[a]&&(t[n]=s(r[a])),e.style&&""!==e.style[a]&&(t[n]=s(e.style[a]))}function i(e){return Math.max(0,Math.min(1,u(e)))}function o(e){return Math.max(0,u(e))}return e.hasAttribute("id")&&(r=Object.assign(r,d["#"+e.getAttribute("id")])),s("fill","fill"),s("fill-opacity","fillOpacity",i),s("opacity","opacity",i),s("stroke","stroke"),s("stroke-opacity","strokeOpacity",i),s("stroke-width","strokeWidth",o),s("stroke-linejoin","strokeLineJoin"),s("stroke-linecap","strokeLineCap"),s("stroke-miterlimit","strokeMiterLimit",o),s("visibility","visibility"),t}function i(e,t){return e-(t-e)}function o(e,t,r){if("string"!=typeof e)throw new TypeError("Invalid input: "+typeof e);var a={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},n=0,s=!0,i=[],o="",c="";function l(e,t,r){var a=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw a.partial=r,a}function u(){""!==o&&(""===c?i.push(Number(o)):i.push(Number(o)*Math.pow(10,Number(c)))),o="",c=""}var h,p=0,f=e.length;for(p=0;p<f;p++)if(h=e[p],Array.isArray(t)&&t.includes(i.length%r)&&a.FLAGS.test(h))n=1,o=h,u();else{if(0===n){if(a.WHITESPACE.test(h))continue;if(a.DIGIT.test(h)||a.SIGN.test(h)){n=1,o=h;continue}if(a.POINT.test(h)){n=2,o=h;continue}a.COMMA.test(h)&&(s&&l(h,p,i),s=!0)}if(1===n){if(a.DIGIT.test(h)){o+=h;continue}if(a.POINT.test(h)){o+=h,n=2;continue}if(a.EXP.test(h)){n=3;continue}a.SIGN.test(h)&&1===o.length&&a.SIGN.test(o[0])&&l(h,p,i)}if(2===n){if(a.DIGIT.test(h)){o+=h;continue}if(a.EXP.test(h)){n=3;continue}a.POINT.test(h)&&"."===o[o.length-1]&&l(h,p,i)}if(3===n){if(a.DIGIT.test(h)){c+=h;continue}if(a.SIGN.test(h)){if(""===c){c+=h;continue}1===c.length&&a.SIGN.test(c)&&l(h,p,i)}}a.WHITESPACE.test(h)?(u(),n=0,s=!1):a.COMMA.test(h)?(u(),n=0,s=!0):a.SIGN.test(h)?(u(),n=1,o=h):a.POINT.test(h)?(u(),n=2,o=h):l(h,p,i)}return u(),i}var c=["mm","cm","in","pt","pc","px"],l={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function u(e){var t="px";if("string"==typeof e||e instanceof String)for(var a=0,n=c.length;a<n;a++){var s=c[a];if(e.endsWith(s)){t=s,e=e.substring(0,e.length-s.length);break}}var i=void 0;return"px"===t&&"px"!==r.defaultUnit?i=l.in[r.defaultUnit]/r.defaultDPI:(i=l[t][r.defaultUnit])<0&&(i=l[t].in*r.defaultDPI),i*parseFloat(e)}function h(e){var t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function p(e){var t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}var f=[],d={},g=[],v=new e.Matrix3,m=new e.Matrix3,y=new e.Matrix3,b=new e.Matrix3,x=new e.Vector2,w=new e.Vector3,S=new e.Matrix3,T=(new e.$DOMParser).parseFromString(t,"image/svg+xml");return function t(r,n){if(1===r.nodeType){var c=function(t){if(!(t.hasAttribute("transform")||"use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))))return null;var r=function(t){var r=new e.Matrix3,a=v;if("use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))){var n=u(t.getAttribute("x")),s=u(t.getAttribute("y"));r.translate(n,s)}if(t.hasAttribute("transform"))for(var i=t.getAttribute("transform").split(")"),c=i.length-1;c>=0;c--){var l=i[c].trim();if(""!==l){var h=l.indexOf("("),p=l.length;if(h>0&&h<p){var f=l.substr(0,h),d=o(l.substr(h+1,p-h-1));switch(a.identity(),f){case"translate":if(d.length>=1){s=n=d[0];d.length>=2&&(s=d[1]),a.translate(n,s)}break;case"rotate":if(d.length>=1){var g=0,x=0,w=0;g=-d[0]*Math.PI/180,d.length>=3&&(x=d[1],w=d[2]),m.identity().translate(-x,-w),y.identity().rotate(g),b.multiplyMatrices(y,m),m.identity().translate(x,w),a.multiplyMatrices(m,b)}break;case"scale":if(d.length>=1){var S=d[0],T=S;d.length>=2&&(T=d[1]),a.scale(S,T)}break;case"skewX":1===d.length&&a.set(1,Math.tan(d[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===d.length&&a.set(1,0,0,Math.tan(d[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===d.length&&a.set(d[0],d[2],d[4],d[1],d[3],d[5],0,0,1)}}r.premultiply(a)}}return r}(t);g.length>0&&r.premultiply(g[g.length-1]);return S.copy(r),g.push(r),r}(r),l=!0,T=null;switch(r.nodeName){case"svg":break;case"style":!function(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(var t=0;t<e.sheet.cssRules.length;t++){var r=e.sheet.cssRules[t];if(1===r.type)for(var a=r.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim())),n=0;n<a.length;n++)d[a[n]]=Object.assign(d[a[n]]||{},r.style)}}(r);break;case"g":n=s(r,n);break;case"path":n=s(r,n),r.hasAttribute("d")&&(T=function(t){for(var r=new e.ShapePath,n=new e.Vector2,s=new e.Vector2,c=new e.Vector2,l=!0,u=!1,h=t.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),p=0,f=h.length;p<f;p++){var d=h[p],g=d.charAt(0),v=d.substr(1).trim();switch(!0===l&&(u=!0,l=!1),g){case"M":for(var m=0,y=(S=o(v)).length;m<y;m+=2)n.x=S[m+0],n.y=S[m+1],s.x=n.x,s.y=n.y,0===m?r.moveTo(n.x,n.y):r.lineTo(n.x,n.y),0===m&&!0===u&&c.copy(n);break;case"H":for(m=0,y=(S=o(v)).length;m<y;m++)n.x=S[m],s.x=n.x,s.y=n.y,r.lineTo(n.x,n.y),0===m&&!0===u&&c.copy(n);break;case"V":for(m=0,y=(S=o(v)).length;m<y;m++)n.y=S[m],s.x=n.x,s.y=n.y,r.lineTo(n.x,n.y),0===m&&!0===u&&c.copy(n);break;case"L":for(m=0,y=(S=o(v)).length;m<y;m+=2)n.x=S[m+0],n.y=S[m+1],s.x=n.x,s.y=n.y,r.lineTo(n.x,n.y),0===m&&!0===u&&c.copy(n);break;case"C":for(m=0,y=(S=o(v)).length;m<y;m+=6)r.bezierCurveTo(S[m+0],S[m+1],S[m+2],S[m+3],S[m+4],S[m+5]),s.x=S[m+2],s.y=S[m+3],n.x=S[m+4],n.y=S[m+5],0===m&&!0===u&&c.copy(n);break;case"S":for(m=0,y=(S=o(v)).length;m<y;m+=4)r.bezierCurveTo(i(n.x,s.x),i(n.y,s.y),S[m+0],S[m+1],S[m+2],S[m+3]),s.x=S[m+0],s.y=S[m+1],n.x=S[m+2],n.y=S[m+3],0===m&&!0===u&&c.copy(n);break;case"Q":for(m=0,y=(S=o(v)).length;m<y;m+=4)r.quadraticCurveTo(S[m+0],S[m+1],S[m+2],S[m+3]),s.x=S[m+0],s.y=S[m+1],n.x=S[m+2],n.y=S[m+3],0===m&&!0===u&&c.copy(n);break;case"T":for(m=0,y=(S=o(v)).length;m<y;m+=2){var b=i(n.x,s.x),x=i(n.y,s.y);r.quadraticCurveTo(b,x,S[m+0],S[m+1]),s.x=b,s.y=x,n.x=S[m+0],n.y=S[m+1],0===m&&!0===u&&c.copy(n)}break;case"A":for(m=0,y=(S=o(v,[3,4],7)).length;m<y;m+=7)if(S[m+5]!=n.x||S[m+6]!=n.y){var w=n.clone();n.x=S[m+5],n.y=S[m+6],s.x=n.x,s.y=n.y,a(r,S[m],S[m+1],S[m+2],S[m+3],S[m+4],w,n),0===m&&!0===u&&c.copy(n)}break;case"m":for(m=0,y=(S=o(v)).length;m<y;m+=2)n.x+=S[m+0],n.y+=S[m+1],s.x=n.x,s.y=n.y,0===m?r.moveTo(n.x,n.y):r.lineTo(n.x,n.y),0===m&&!0===u&&c.copy(n);break;case"h":for(m=0,y=(S=o(v)).length;m<y;m++)n.x+=S[m],s.x=n.x,s.y=n.y,r.lineTo(n.x,n.y),0===m&&!0===u&&c.copy(n);break;case"v":for(m=0,y=(S=o(v)).length;m<y;m++)n.y+=S[m],s.x=n.x,s.y=n.y,r.lineTo(n.x,n.y),0===m&&!0===u&&c.copy(n);break;case"l":for(m=0,y=(S=o(v)).length;m<y;m+=2)n.x+=S[m+0],n.y+=S[m+1],s.x=n.x,s.y=n.y,r.lineTo(n.x,n.y),0===m&&!0===u&&c.copy(n);break;case"c":for(m=0,y=(S=o(v)).length;m<y;m+=6)r.bezierCurveTo(n.x+S[m+0],n.y+S[m+1],n.x+S[m+2],n.y+S[m+3],n.x+S[m+4],n.y+S[m+5]),s.x=n.x+S[m+2],s.y=n.y+S[m+3],n.x+=S[m+4],n.y+=S[m+5],0===m&&!0===u&&c.copy(n);break;case"s":for(m=0,y=(S=o(v)).length;m<y;m+=4)r.bezierCurveTo(i(n.x,s.x),i(n.y,s.y),n.x+S[m+0],n.y+S[m+1],n.x+S[m+2],n.y+S[m+3]),s.x=n.x+S[m+0],s.y=n.y+S[m+1],n.x+=S[m+2],n.y+=S[m+3],0===m&&!0===u&&c.copy(n);break;case"q":for(m=0,y=(S=o(v)).length;m<y;m+=4)r.quadraticCurveTo(n.x+S[m+0],n.y+S[m+1],n.x+S[m+2],n.y+S[m+3]),s.x=n.x+S[m+0],s.y=n.y+S[m+1],n.x+=S[m+2],n.y+=S[m+3],0===m&&!0===u&&c.copy(n);break;case"t":for(m=0,y=(S=o(v)).length;m<y;m+=2){b=i(n.x,s.x),x=i(n.y,s.y);r.quadraticCurveTo(b,x,n.x+S[m+0],n.y+S[m+1]),s.x=b,s.y=x,n.x=n.x+S[m+0],n.y=n.y+S[m+1],0===m&&!0===u&&c.copy(n)}break;case"a":var S;for(m=0,y=(S=o(v,[3,4],7)).length;m<y;m+=7)if(0!=S[m+5]||0!=S[m+6]){w=n.clone();n.x+=S[m+5],n.y+=S[m+6],s.x=n.x,s.y=n.y,a(r,S[m],S[m+1],S[m+2],S[m+3],S[m+4],w,n),0===m&&!0===u&&c.copy(n)}break;case"Z":case"z":r.currentPath.autoClose=!0,r.currentPath.curves.length>0&&(n.copy(c),r.currentPath.currentPoint.copy(n),l=!0);break;default:console.warn(d)}u=!1}return r}(r));break;case"rect":n=s(r,n),T=function(t){var r=u(t.getAttribute("x")||0),a=u(t.getAttribute("y")||0),n=u(t.getAttribute("rx")||0),s=u(t.getAttribute("ry")||0),i=u(t.getAttribute("width")),o=u(t.getAttribute("height")),c=new e.ShapePath;c.moveTo(r+2*n,a),c.lineTo(r+i-2*n,a),(0!==n||0!==s)&&c.bezierCurveTo(r+i,a,r+i,a,r+i,a+2*s);c.lineTo(r+i,a+o-2*s),(0!==n||0!==s)&&c.bezierCurveTo(r+i,a+o,r+i,a+o,r+i-2*n,a+o);c.lineTo(r+2*n,a+o),(0!==n||0!==s)&&c.bezierCurveTo(r,a+o,r,a+o,r,a+o-2*s);c.lineTo(r,a+2*s),(0!==n||0!==s)&&c.bezierCurveTo(r,a,r,a,r+2*n,a);return c}(r);break;case"polygon":n=s(r,n),T=function(t){function r(e,t,r){var a=u(t),i=u(r);0===s?n.moveTo(a,i):n.lineTo(a,i),s++}var a=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,n=new e.ShapePath,s=0;return t.getAttribute("points").replace(a,r),n.currentPath.autoClose=!0,n}(r);break;case"polyline":n=s(r,n),T=function(t){function r(e,t,r){var a=u(t),i=u(r);0===s?n.moveTo(a,i):n.lineTo(a,i),s++}var a=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,n=new e.ShapePath,s=0;return t.getAttribute("points").replace(a,r),n.currentPath.autoClose=!1,n}(r);break;case"circle":n=s(r,n),T=function(t){var r=u(t.getAttribute("cx")||0),a=u(t.getAttribute("cy")||0),n=u(t.getAttribute("r")||0),s=new e.Path;s.absarc(r,a,n,0,2*Math.PI);var i=new e.ShapePath;return i.subPaths.push(s),i}(r);break;case"ellipse":n=s(r,n),T=function(t){var r=u(t.getAttribute("cx")||0),a=u(t.getAttribute("cy")||0),n=u(t.getAttribute("rx")||0),s=u(t.getAttribute("ry")||0),i=new e.Path;i.absellipse(r,a,n,s,0,2*Math.PI);var o=new e.ShapePath;return o.subPaths.push(i),o}(r);break;case"line":n=s(r,n),T=function(t){var r=u(t.getAttribute("x1")||0),a=u(t.getAttribute("y1")||0),n=u(t.getAttribute("x2")||0),s=u(t.getAttribute("y2")||0),i=new e.ShapePath;return i.moveTo(r,a),i.lineTo(n,s),i.currentPath.autoClose=!1,i}(r);break;case"defs":l=!1;break;case"use":n=s(r,n);var F=r.href.baseVal.substring(1),k=r.viewportElement.getElementById(F);k?t(k,n):console.warn("SVGLoader: 'use node' references non-existent node id: "+F)}if(T&&(void 0!==n.fill&&"none"!==n.fill&&T.color.setStyle(n.fill),function(e,t){function r(e){w.set(e.x,e.y,1).applyMatrix3(t),e.set(w.x,w.y)}for(var a=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),n=e.subPaths,s=0,i=n.length;s<i;s++)for(var o=n[s].curves,c=0;c<o.length;c++){var l=o[c];l.isLineCurve?(r(l.v1),r(l.v2)):l.isCubicBezierCurve?(r(l.v0),r(l.v1),r(l.v2),r(l.v3)):l.isQuadraticBezierCurve?(r(l.v0),r(l.v1),r(l.v2)):l.isEllipseCurve&&(a&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),x.set(l.aX,l.aY),r(x),l.aX=x.x,l.aY=x.y,l.xRadius*=h(t),l.yRadius*=p(t))}}(T,S),f.push(T),T.userData={node:r,style:n}),l)for(var E=r.childNodes,A=0;A<E.length;A++)t(E[A],n);c&&(g.pop(),g.length>0?S.copy(g[g.length-1]):S.identity())}}(T.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:f,xml:T.documentElement}}}),io.createShapes=function(t){const r=999999999,a=0,n=1,s=2,i=3,o=4,c=5,l=6,u={loc:a,t:0};function h(e,t,r,n){var i=e.x,o=t.x,c=r.x,l=n.x,h=e.y,f=t.y,d=r.y,g=n.y,v=(l-c)*(h-d)-(g-d)*(i-c),m=(g-d)*(o-i)-(l-c)*(f-h),y=v/m,b=((o-i)*(h-d)-(f-h)*(i-c))/m;if(0===m&&0!==v||y<=0||y>=1||b<0||b>1)return null;if(0===v&&0===m){for(var x=0;x<2;x++){if(p(0===x?r:n,e,t),u.loc==a)return{x:(w=0===x?r:n).x,y:w.y,t:u.t};if(u.loc==s)return{x:+(i+u.t*(o-i)).toPrecision(10),y:+(h+u.t*(f-h)).toPrecision(10),t:u.t}}return null}for(x=0;x<2;x++){var w;if(p(0===x?r:n,e,t),u.loc==a)return{x:(w=0===x?r:n).x,y:w.y,t:u.t}}return{x:+(i+y*(o-i)).toPrecision(10),y:+(h+y*(f-h)).toPrecision(10),t:y}}function p(e,t,r){var h,p=r.x-t.x,f=r.y-t.y,d=e.x-t.x,g=e.y-t.y,v=p*g-d*f;if(e.x===t.x&&e.y===t.y)return u.loc=a,void(u.t=0);if(e.x===r.x&&e.y===r.y)return u.loc=n,void(u.t=1);v<-Number.EPSILON?u.loc=i:v>Number.EPSILON?u.loc=o:p*d<0||f*g<0?u.loc=c:Math.sqrt(p*p+f*f)<Math.sqrt(d*d+g*g)?u.loc=l:(h=0!==p?d/p:g/f,u.loc=s,u.t=h)}function f(t,r,a){const n=new e.Vector2;r.getCenter(n);const s=[];return a.forEach((r=>{if(r.boundingBox.containsPoint(n)){(function(t,r){const a=[],n=[];for(let s=1;s<t.length;s++){const i=t[s-1],o=t[s];for(let t=1;t<r.length;t++){const s=h(i,o,r[t-1],r[t]);null!==s&&void 0===a.find((e=>e.t<=s.t+Number.EPSILON&&e.t>=s.t-Number.EPSILON))&&(a.push(s),n.push(new e.Vector2(s.x,s.y)))}}return n})(t,r.points).forEach((e=>{s.push({identifier:r.identifier,isCW:r.isCW,point:e})}))}})),s.sort(((e,t)=>e.point.x-t.point.x)),s}let d=0,g=r,v=-999999999,m=t.subPaths.map((t=>{const a=t.getPoints();let n=-999999999,s=r,i=-999999999,o=r;for(let e=0;e<a.length;e++){const t=a[e];t.y>n&&(n=t.y),t.y<s&&(s=t.y),t.x>i&&(i=t.x),t.x<o&&(o=t.x)}return v<=i&&(v=i+1),g>=o&&(g=o-1),{points:a,isCW:e.ShapeUtils.isClockWise(a),identifier:d++,boundingBox:new e.Box2(new e.Vector2(o,s),new e.Vector2(i,n))}}));m=m.filter((e=>e.points.length>0));const y=m.map((r=>function(t,r,a,n,s){null!=s&&""!==s||(s="nonzero");const i=new e.Vector2;t.boundingBox.getCenter(i);const o=f([new e.Vector2(a,i.y),new e.Vector2(n,i.y)],t.boundingBox,r);o.sort(((e,t)=>e.point.x-t.point.x));const c=[],l=[];o.forEach((e=>{e.identifier===t.identifier?c.push(e):l.push(e)}));const u=c[0].point.x,h=[];let p=0;for(;p<l.length&&l[p].point.x<u;)h.length>0&&h[h.length-1]===l[p].identifier?h.pop():h.push(l[p].identifier),p++;if(h.push(t.identifier),"evenodd"===s){const e=h.length%2==0,r=h[h.length-2];return{identifier:t.identifier,isHole:e,for:r}}if("nonzero"===s){let e=!0,a=null,n=null;for(let t=0;t<h.length;t++){const s=h[t];e?(n=r[s].isCW,e=!1,a=s):n!==r[s].isCW&&(n=r[s].isCW,e=!0)}return{identifier:t.identifier,isHole:e,for:a}}console.warn('fill-rule: "'+s+'" is currently not implemented.')}(r,m,g,v,t.userData.style.fillRule))),b=[];return m.forEach((t=>{if(!y[t.identifier].isHole){const r=new e.Shape(t.points);y.filter((e=>e.isHole&&e.for===t.identifier)).forEach((t=>{const a=m[t.identifier];r.holes.push(new e.Path(a.points))})),b.push(r)}})),b},io.getStrokeStyle=function(e,t,r,a,n){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:a=void 0!==a?a:"butt",strokeMiterLimit:n=void 0!==n?n:4}},io.pointsToStroke=function(t,r,a,n){var s=[],i=[],o=[];if(0===io.pointsToStrokeWithBuffers(t,r,a,n,s,i,o))return null;var c=new e.BufferGeometry;return c.setAttribute("position",new e.Float32BufferAttribute(s,3)),c.setAttribute("normal",new e.Float32BufferAttribute(i,3)),c.setAttribute("uv",new e.Float32BufferAttribute(o,2)),c},io.pointsToStrokeWithBuffers=(zi=new e.Vector2,ji=new e.Vector2,Wi=new e.Vector2,Xi=new e.Vector2,qi=new e.Vector2,Yi=new e.Vector2,Ki=new e.Vector2,Zi=new e.Vector2,Qi=new e.Vector2,$i=new e.Vector2,Ji=new e.Vector2,eo=new e.Vector2,to=new e.Vector2,ro=new e.Vector2,ao=new e.Vector2,no=new e.Vector2,so=new e.Vector2,function(e,t,r,a,n,s,i,o){r=void 0!==r?r:12,a=void 0!==a?a:.001,o=void 0!==o?o:0;var c=(e=function(e){for(var t=!1,r=1,n=e.length-1;r<n;r++)if(e[r].distanceTo(e[r+1])<a){t=!0;break}if(!t)return e;var s=[];for(s.push(e[0]),r=1,n=e.length-1;r<n;r++)e[r].distanceTo(e[r+1])>=a&&s.push(e[r]);return s.push(e[e.length-1]),s}(e)).length;if(c<2)return 0;var l,u,h,p,f,d=e[0].equals(e[c-1]),g=e[0],v=t.strokeWidth/2,m=1/(c-1),y=0,b=!1,x=0,w=3*o,S=2*o;U(e[0],e[1],zi).multiplyScalar(v),Zi.copy(e[0]).sub(zi),Qi.copy(e[0]).add(zi),$i.copy(Zi),Ji.copy(Qi);for(var T=1;T<c;T++){l=e[T],u=T===c-1?d?e[1]:void 0:e[T+1];var F=zi;U(g,l,F),Wi.copy(F).multiplyScalar(v),eo.copy(l).sub(Wi),to.copy(l).add(Wi);var k=y+m;if(h=!1,void 0!==u){U(l,u,ji),Wi.copy(ji).multiplyScalar(v),ro.copy(l).sub(Wi),ao.copy(l).add(Wi),p=!0,Wi.subVectors(u,g),F.dot(Wi)<0&&(p=!1),1===T&&(b=p),Wi.subVectors(u,l),Wi.normalize();var E=Math.abs(F.dot(Wi));if(0!==E){var A=v/E;Wi.multiplyScalar(-A),Xi.subVectors(l,g),qi.copy(Xi).setLength(A).add(Wi),no.copy(qi).negate();var I=qi.length(),M=Xi.length();Xi.divideScalar(M),Yi.subVectors(u,l);var L=Yi.length();switch(Yi.divideScalar(L),Xi.dot(no)<M&&Yi.dot(no)<L&&(h=!0),so.copy(qi).add(l),no.add(l),f=!1,h?p?(ao.copy(no),to.copy(no)):(ro.copy(no),eo.copy(no)):P(),t.strokeLineJoin){case"bevel":B(p,h,k);break;case"round":G(p,h),p?D(l,eo,ro,k,0):D(l,ao,to,k,1);break;case"miter":case"miter-clip":default:var C=v*t.strokeMiterLimit/I;if(C<1){if("miter-clip"!==t.strokeLineJoin){B(p,h,k);break}G(p,h),p?(Yi.subVectors(so,eo).multiplyScalar(C).add(eo),Ki.subVectors(so,ro).multiplyScalar(C).add(ro),N(eo,k,0),N(Yi,k,0),N(l,k,.5),N(l,k,.5),N(Yi,k,0),N(Ki,k,0),N(l,k,.5),N(Ki,k,0),N(ro,k,0)):(Yi.subVectors(so,to).multiplyScalar(C).add(to),Ki.subVectors(so,ao).multiplyScalar(C).add(ao),N(to,k,1),N(Yi,k,1),N(l,k,.5),N(l,k,.5),N(Yi,k,1),N(Ki,k,1),N(l,k,.5),N(Ki,k,1),N(ao,k,1))}else h?(p?(N(Qi,y,1),N(Zi,y,0),N(so,k,0),N(Qi,y,1),N(so,k,0),N(no,k,1)):(N(Qi,y,1),N(Zi,y,0),N(so,k,1),N(Zi,y,0),N(no,k,0),N(so,k,1)),p?ro.copy(so):ao.copy(so)):p?(N(eo,k,0),N(so,k,0),N(l,k,.5),N(l,k,.5),N(so,k,0),N(ro,k,0)):(N(to,k,1),N(so,k,1),N(l,k,.5),N(l,k,.5),N(so,k,1),N(ao,k,1)),f=!0}}else P()}else P();d||T!==c-1||_(e[0],$i,Ji,p,!0,y),y=k,g=l,Zi.copy(ro),Qi.copy(ao)}if(d){if(h&&n){var O=so,R=no;b!==p&&(O=no,R=so),p?(f||b)&&(R.toArray(n,0),R.toArray(n,9),f&&O.toArray(n,3)):!f&&b||(R.toArray(n,3),R.toArray(n,9),f&&O.toArray(n,0))}}else _(l,eo,to,p,!1,k);return x;function U(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function N(e,t,r){n&&(n[w]=e.x,n[w+1]=e.y,n[w+2]=0,s&&(s[w]=0,s[w+1]=0,s[w+2]=1),w+=3,i&&(i[S]=t,i[S+1]=r,S+=2)),x+=3}function D(e,t,a,n,s){zi.copy(t).sub(e).normalize(),ji.copy(a).sub(e).normalize();var i=Math.PI,o=zi.dot(ji);Math.abs(o)<1&&(i=Math.abs(Math.acos(o))),i/=r,Wi.copy(t);for(var c=0,l=r-1;c<l;c++)Xi.copy(Wi).rotateAround(e,i),N(Wi,n,s),N(Xi,n,s),N(e,n,.5),Wi.copy(Xi);N(Xi,n,s),N(a,n,s),N(e,n,.5)}function P(){N(Qi,y,1),N(Zi,y,0),N(eo,k,0),N(Qi,y,1),N(eo,k,1),N(to,k,0)}function B(e,t,r){t?e?(N(Qi,y,1),N(Zi,y,0),N(eo,k,0),N(Qi,y,1),N(eo,k,0),N(no,k,1),N(eo,r,0),N(ro,r,0),N(no,r,.5)):(N(Qi,y,1),N(Zi,y,0),N(to,k,1),N(Zi,y,0),N(no,k,0),N(to,k,1),N(to,r,1),N(ao,r,0),N(no,r,.5)):e?(N(eo,r,0),N(ro,r,0),N(l,r,.5)):(N(to,r,1),N(ao,r,0),N(l,r,.5))}function G(e,t){t&&(e?(N(Qi,y,1),N(Zi,y,0),N(eo,k,0),N(Qi,y,1),N(eo,k,0),N(no,k,1),N(eo,y,0),N(l,k,.5),N(no,k,1),N(l,k,.5),N(ro,y,0),N(no,k,1)):(N(Qi,y,1),N(Zi,y,0),N(to,k,1),N(Zi,y,0),N(no,k,0),N(to,k,1),N(to,y,1),N(no,k,0),N(l,k,.5),N(l,k,.5),N(no,k,0),N(ao,y,1)))}function _(e,r,a,s,i,o){switch(t.strokeLineCap){case"round":i?D(e,a,r,o,.5):D(e,r,a,o,.5);break;case"square":if(i)zi.subVectors(r,e),ji.set(zi.y,-zi.x),Wi.addVectors(zi,ji).add(e),Xi.subVectors(ji,zi).add(e),s?(Wi.toArray(n,3),Xi.toArray(n,0),Xi.toArray(n,9)):(Wi.toArray(n,3),Wi.toArray(n,9),Xi.toArray(n,0));else{zi.subVectors(a,e),ji.set(zi.y,-zi.x),Wi.addVectors(zi,ji).add(e),Xi.subVectors(ji,zi).add(e);var c=n.length;s?(Wi.toArray(n,c-3),Xi.toArray(n,c-6),Xi.toArray(n,c-12)):(Wi.toArray(n,c-6),Xi.toArray(n,c-3),Xi.toArray(n,c-12))}}}});var oo=function(t){e.DataTextureLoader.call(this,t),this.type=e.UnsignedByteType};oo.prototype=Object.assign(Object.create(e.DataTextureLoader.prototype),{constructor:oo,parse:function(t){var r=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},a=function(e,t,r){t=t||1024;for(var a=e.pos,n=-1,s=0,i="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));0>(n=o.indexOf("\n"))&&s<t&&a<e.byteLength;)i+=o,s+=o.length,a+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));return-1<n&&(!1!==r&&(e.pos+=s+n+1),i+o.slice(0,n))},n=function(t,r,a,n){var s=t[r+3],i=Math.pow(2,s-128)/255;a[n+0]=e.DataUtils.toHalfFloat(t[r+0]*i),a[n+1]=e.DataUtils.toHalfFloat(t[r+1]*i),a[n+2]=e.DataUtils.toHalfFloat(t[r+2]*i)},s=new Uint8Array(t);s.pos=0;var i,o,c,l,u,h,p=function(e){var t,n,s=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,c=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,l={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(t=a(e)))return r(1,"no header found");if(!(n=t.match(/^#\?(\S+)/)))return r(3,"bad initial token");for(l.valid|=1,l.programtype=n[1],l.string+=t+"\n";!1!==(t=a(e));)if(l.string+=t+"\n","#"!==t.charAt(0)){if((n=t.match(s))&&(l.gamma=parseFloat(n[1],10)),(n=t.match(i))&&(l.exposure=parseFloat(n[1],10)),(n=t.match(o))&&(l.valid|=2,l.format=n[1]),(n=t.match(c))&&(l.valid|=4,l.height=parseInt(n[1],10),l.width=parseInt(n[2],10)),2&l.valid&&4&l.valid)break}else l.comments+=t+"\n";return 2&l.valid?4&l.valid?l:r(3,"missing image size specifier"):r(3,"missing format specifier")}(s);if(-1!==p){var f=p.width,d=p.height,g=function(e,t,a){var n,s,i,o,c,l,u,h,p,f,d,g,v,m=t,y=a;if(m<8||m>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(m!==(e[2]<<8|e[3]))return r(3,"wrong scanline width");if(!(n=new Uint8Array(4*t*a)).length)return r(4,"unable to allocate buffer space");for(s=0,i=0,h=4*m,v=new Uint8Array(4),l=new Uint8Array(h);y>0&&i<e.byteLength;){if(i+4>e.byteLength)return r(1);if(v[0]=e[i++],v[1]=e[i++],v[2]=e[i++],v[3]=e[i++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=m)return r(3,"bad rgbe scanline format");for(u=0;u<h&&i<e.byteLength;){if((g=(o=e[i++])>128)&&(o-=128),0===o||u+o>h)return r(3,"bad scanline data");if(g)for(c=e[i++],p=0;p<o;p++)l[u++]=c;else l.set(e.subarray(i,i+o),u),u+=o,i+=o}for(f=m,p=0;p<f;p++)d=0,n[s]=l[p+d],d+=m,n[s+1]=l[p+d],d+=m,n[s+2]=l[p+d],d+=m,n[s+3]=l[p+d],s+=4;y--}return n}(s.subarray(s.pos),f,d);if(-1!==g){switch(this.type){case e.UnsignedByteType:var v=g,m=e.RGBEFormat,y=e.UnsignedByteType;break;case e.FloatType:for(var b=g.length/4*3,x=new Float32Array(b),w=0;w<b;w++)c=x,l=3*w,u=void 0,h=void 0,u=(i=g)[(o=4*w)+3],h=Math.pow(2,u-128)/255,c[l+0]=i[o+0]*h,c[l+1]=i[o+1]*h,c[l+2]=i[o+2]*h;v=x,m=e.RGBFormat,y=e.FloatType;break;case e.HalfFloatType:b=g.length/4*3;var S=new Uint16Array(b);for(w=0;w<b;w++)n(g,4*w,S,3*w);v=S,m=e.RGBFormat,y=e.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:f,height:d,data:v,header:p.string,gamma:p.gamma,exposure:p.exposure,format:m,type:y}}}return null},setDataType:function(e){return this.type=e,this},load:function(t,r,a,n){return e.DataTextureLoader.prototype.load.call(this,t,(function(t,a){switch(t.type){case e.UnsignedByteType:t.encoding=e.RGBEEncoding,t.minFilter=e.NearestFilter,t.magFilter=e.NearestFilter,t.generateMipmaps=!1,t.flipY=!0;break;case e.FloatType:case e.HalfFloatType:t.encoding=e.LinearEncoding,t.minFilter=e.LinearFilter,t.magFilter=e.LinearFilter,t.generateMipmaps=!1,t.flipY=!0}r&&r(t,a)}),a,n)}});const co="https://techbrood.com/threejs";function lo(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}return r}var uo=function(t){e.Loader.call(this,t)};uo.prototype=Object.assign(Object.create(e.Loader.prototype),{constructor:uo,load:function(t,r,a,n){var s=this,i=""===s.path?e.LoaderUtils.extractUrlBase(t):s.path,o=new e.FileLoader(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(t,(function(e){try{r(s.parse(e,i))}catch(e){n?n(e):console.error(e),s.manager.itemError(t)}}),a,n)},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},parse:function(t,r){function a(e,t){for(var r=[],a=e.childNodes,n=0,s=a.length;n<s;n++){var i=a[n];i.nodeName===t&&r.push(i)}return r}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),a=0,n=t.length;a<n;a++)r[a]=t[a];return r}function s(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),a=0,n=t.length;a<n;a++)r[a]=parseFloat(t[a]);return r}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),r=new Array(t.length),a=0,n=t.length;a<n;a++)r[a]=parseInt(t[a]);return r}function o(e){return e.substring(1)}function c(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function u(e){return void 0!==e?e.textContent:"Y_UP"}function h(e,t,r,n){var s=a(e,t)[0];if(void 0!==s)for(var i=a(s,r),o=0;o<i.length;o++)n(i[o])}function p(e,t){for(var r in e){e[r].build=t(e[r])}}function f(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function d(e){for(var t={inputs:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var s=o(n.getAttribute("source")),i=n.getAttribute("semantic");t.inputs[i]=s}}return t}function g(e){var t={},r=e.getAttribute("target").split("/"),a=r.shift(),n=r.shift(),s=-1!==n.indexOf("("),i=-1!==n.indexOf(".");if(i)r=n.split("."),n=r.shift(),t.member=r.shift();else if(s){var c=n.split("(");n=c.shift();for(var l=0;l<c.length;l++)c[l]=parseInt(c[l].replace(/\)/,""));t.indices=c}return t.id=a,t.sid=n,t.arraySyntax=s,t.memberSyntax=i,t.sampler=o(e.getAttribute("source")),t}function v(e){var t=[],r=e.channels,a=e.samplers,n=e.sources;for(var s in r)if(r.hasOwnProperty(s)){var i=r[s],o=a[i.sampler],c=o.inputs.INPUT,l=o.inputs.OUTPUT;S(y(i,n[c],n[l]),t)}return t}function m(e){return f($e.animations[e],v)}function y(e,t,r){var a,n,s,i,o,c,l=$e.nodes[e.id],u=Pe(l.id),h=l.transforms[e.sid],p=l.matrix.clone().transpose(),f={};switch(h){case"matrix":for(s=0,i=t.array.length;s<i;s++)if(a=t.array[s],n=s*r.stride,void 0===f[a]&&(f[a]={}),!0===e.arraySyntax){var d=r.array[n],g=e.indices[0]+4*e.indices[1];f[a][g]=d}else for(o=0,c=r.stride;o<c;o++)f[a][o]=r.array[n+o];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var v=function(e,t){var r=[];for(var a in e)r.push({time:parseFloat(a),value:e[a]});r.sort(s);for(var n=0;n<16;n++)T(r,n,t.elements[n]);return r;function s(e,t){return e.time-t.time}}(f,p);return{name:u.uuid,keyframes:v}}var b=new e.Vector3,x=new e.Vector3,w=new e.Quaternion;function S(t,r){for(var a=t.keyframes,n=t.name,s=[],i=[],o=[],c=[],l=0,u=a.length;l<u;l++){var h=a[l],p=h.time,f=h.value;Ee.fromArray(f).transpose(),Ee.decompose(b,w,x),s.push(p),i.push(b.x,b.y,b.z),o.push(w.x,w.y,w.z,w.w),c.push(x.x,x.y,x.z)}return i.length>0&&r.push(new e.VectorKeyframeTrack(n+".position",s,i)),o.length>0&&r.push(new e.QuaternionKeyframeTrack(n+".quaternion",s,o)),c.length>0&&r.push(new e.VectorKeyframeTrack(n+".scale",s,c)),r}function T(e,t,r){var a,n,s,i=!0;for(n=0,s=e.length;n<s;n++)void 0===(a=e[n]).value[t]?a.value[t]=null:i=!1;if(!0===i)for(n=0,s=e.length;n<s;n++)(a=e[n]).value[t]=r;else!function(e,t){for(var r,a,n=0,s=e.length;n<s;n++){var i=e[n];if(null===i.value[t]){if(r=F(e,n,t),a=k(e,n,t),null===r){i.value[t]=a.value[t];continue}if(null===a){i.value[t]=r.value[t];continue}E(i,r,a,t)}}}(e,t)}function F(e,t,r){for(;t>=0;){var a=e[t];if(null!==a.value[r])return a;t--}return null}function k(e,t,r){for(;t<e.length;){var a=e[t];if(null!==a.value[r])return a;t++}return null}function E(e,t,r,a){r.time-t.time!=0?e.value[a]=(e.time-t.time)*(r.value[a]-t.value[a])/(r.time-t.time)+t.value[a]:e.value[a]=t.value[a]}function A(t){for(var r=[],a=t.name,n=t.end-t.start||-1,s=t.animations,i=0,o=s.length;i<o;i++)for(var c=m(s[i]),l=0,u=c.length;l<u;l++)r.push(c[l]);return new e.AnimationClip(a,n,r)}function I(e){return f($e.clips[e],A)}function M(e){for(var t={sources:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=s(n.textContent);break;case"source":var i=n.getAttribute("id");t.sources[i]=ie(n);break;case"joints":t.joints=L(n);break;case"vertex_weights":t.vertexWeights=C(n)}}return t}function L(e){for(var t={inputs:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var s=n.getAttribute("semantic"),i=o(n.getAttribute("source"));t.inputs[s]=i}}return t}function C(e){for(var t={inputs:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var s=n.getAttribute("semantic"),c=o(n.getAttribute("source")),l=parseInt(n.getAttribute("offset"));t.inputs[s]={id:c,offset:l};break;case"vcount":t.vcount=i(n.textContent);break;case"v":t.v=i(n.textContent)}}return t}function R(t){var r={id:t.id},a=$e.geometries[r.id];return void 0!==t.skin&&(r.skin=function(t){var r,a,n,s=4,i={joints:[],indices:{array:[],stride:s},weights:{array:[],stride:s}},o=t.sources,c=t.vertexWeights,l=c.vcount,u=c.v,h=c.inputs.JOINT.offset,p=c.inputs.WEIGHT.offset,f=t.sources[t.joints.inputs.JOINT],d=t.sources[t.joints.inputs.INV_BIND_MATRIX],g=o[c.inputs.WEIGHT.id].array,v=0;for(r=0,n=l.length;r<n;r++){var m=l[r],y=[];for(a=0;a<m;a++){var b=u[v+h],x=g[u[v+p]];y.push({index:b,weight:x}),v+=2}for(y.sort(F),a=0;a<s;a++){var w=y[a];void 0!==w?(i.indices.array.push(w.index),i.weights.array.push(w.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}t.bindShapeMatrix?i.bindMatrix=(new e.Matrix4).fromArray(t.bindShapeMatrix).transpose():i.bindMatrix=(new e.Matrix4).identity();for(r=0,n=f.array.length;r<n;r++){var S=f.array[r],T=(new e.Matrix4).fromArray(d.array,r*d.stride).transpose();i.joints.push({name:S,boneInverse:T})}return i;function F(e,t){return t.weight-e.weight}}(t.skin),a.sources.skinIndices=r.skin.indices,a.sources.skinWeights=r.skin.weights),r}function U(e){return void 0!==e.build?e.build:e.init_from}function N(e){var t=$e.images[e];return void 0!==t?f(t,U):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function D(e){for(var t={surfaces:{},samplers:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"newparam":P(n,t);break;case"technique":t.technique=_(n);break;case"extra":t.extra=X(n)}}return t}function P(e,t){for(var r=e.getAttribute("sid"),a=0,n=e.childNodes.length;a<n;a++){var s=e.childNodes[a];if(1===s.nodeType)switch(s.nodeName){case"surface":t.surfaces[r]=B(s);break;case"sampler2D":t.samplers[r]=G(s)}}}function B(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"init_from":t.init_from=n.textContent}}return t}function G(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"source":t.source=n.textContent}}return t}function _(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=n.nodeName,t.parameters=H(n)}}return t}function H(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[n.nodeName]=V(n);break;case"transparent":t[n.nodeName]={opaque:n.getAttribute("opaque"),data:V(n)}}}return t}function V(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"color":t[n.nodeName]=s(n.textContent);break;case"float":t[n.nodeName]=parseFloat(n.textContent);break;case"texture":t[n.nodeName]={id:n.getAttribute("texture"),extra:z(n)}}}return t}function z(e){for(var t={technique:{}},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"extra":j(n,t)}}return t}function j(e,t){for(var r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":W(n,t)}}}function W(e,t){for(var r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=0:t.technique[n.nodeName]=parseInt(n.textContent)}}}function X(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":t.technique=q(n)}}return t}function q(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"double_sided":t[n.nodeName]=parseInt(n.textContent)}}return t}function Y(e){return e}function K(t){var r,a,n=(r=t.url,f($e.effects[r],Y)),s=n.profile.technique,i=n.profile.extra;switch(s.type){case"phong":case"blinn":a=new e.MeshPhongMaterial;break;case"lambert":a=new e.MeshLambertMaterial;break;default:a=new e.MeshBasicMaterial}function o(t){var r=n.profile.samplers[t.id],a=null;void 0!==r?a=N(n.profile.surfaces[r.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),a=N(t.id));if(null!==a){var s=function(e){var t,r=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(r=r.toLowerCase()){case"tga":t=Xe;break;default:t=Ye}return t}(a);if(void 0!==s){var i=s.load(a),o=t.extra;if(void 0!==o&&void 0!==o.technique&&!1===c(o.technique)){var l=o.technique;i.wrapS=l.wrapU?e.RepeatWrapping:e.ClampToEdgeWrapping,i.wrapT=l.wrapV?e.RepeatWrapping:e.ClampToEdgeWrapping,i.offset.set(l.offsetU||0,l.offsetV||0),i.repeat.set(l.repeatU||1,l.repeatV||1)}else i.wrapS=e.RepeatWrapping,i.wrapT=e.RepeatWrapping;return i}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",a),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",t.id),null}a.name=t.name||"";var l=s.parameters;for(var u in l){var h=l[u];switch(u){case"diffuse":h.color&&a.color.fromArray(h.color),h.texture&&(a.map=o(h.texture));break;case"specular":h.color&&a.specular&&a.specular.fromArray(h.color),h.texture&&(a.specularMap=o(h.texture));break;case"bump":h.texture&&(a.normalMap=o(h.texture));break;case"ambient":h.texture&&(a.lightMap=o(h.texture));break;case"shininess":h.float&&a.shininess&&(a.shininess=h.float);break;case"emission":h.color&&a.emissive&&a.emissive.fromArray(h.color),h.texture&&(a.emissiveMap=o(h.texture))}}var p=l.transparent,d=l.transparency;if(void 0===d&&p&&(d={float:1}),void 0===p&&d&&(p={opaque:"A_ONE",data:{color:[1,1,1,1]}}),p&&d)if(p.data.texture)a.transparent=!0;else{var g=p.data.color;switch(p.opaque){case"A_ONE":a.opacity=g[3]*d.float;break;case"RGB_ZERO":a.opacity=1-g[0]*d.float;break;case"A_ZERO":a.opacity=1-g[3]*d.float;break;case"RGB_ONE":a.opacity=g[0]*d.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',p.opaque)}a.opacity<1&&(a.transparent=!0)}return void 0!==i&&void 0!==i.technique&&1===i.technique.double_sided&&(a.side=e.DoubleSide),a}function Z(e){return f($e.materials[e],K)}function Q(e){for(var t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];switch(r.nodeName){case"technique_common":return $(r)}}return{}}function $(e){for(var t={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];switch(a.nodeName){case"perspective":case"orthographic":t.technique=a.nodeName,t.parameters=J(a)}}return t}function J(e){for(var t={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];switch(a.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[a.nodeName]=parseFloat(a.textContent)}}return t}function ee(t){var r;switch(t.optics.technique){case"perspective":r=new e.PerspectiveCamera(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":var a=t.optics.parameters.ymag,n=t.optics.parameters.xmag,s=t.optics.parameters.aspect_ratio;n=void 0===n?a*s:n,a=void 0===a?n/s:a,n*=.5,a*=.5,r=new e.OrthographicCamera(-n,n,a,-a,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:r=new e.PerspectiveCamera}return r.name=t.name||"",r}function te(e){var t=$e.cameras[e];return void 0!==t?f(t,ee):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function re(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=n.nodeName,t.parameters=ae(n)}}return t}function ae(t){for(var r={},a=0,n=t.childNodes.length;a<n;a++){var i=t.childNodes[a];if(1===i.nodeType)switch(i.nodeName){case"color":var o=s(i.textContent);r.color=(new e.Color).fromArray(o);break;case"falloff_angle":r.falloffAngle=parseFloat(i.textContent);break;case"quadratic_attenuation":var c=parseFloat(i.textContent);r.distance=c?Math.sqrt(1/c):0}}return r}function ne(t){var r;switch(t.technique){case"directional":r=new e.DirectionalLight;break;case"point":r=new e.PointLight;break;case"spot":r=new e.SpotLight;break;case"ambient":r=new e.AmbientLight}return t.parameters.color&&r.color.copy(t.parameters.color),t.parameters.distance&&(r.distance=t.parameters.distance),r}function se(e){var t=$e.lights[e];return void 0!==t?f(t,ne):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ie(e){for(var t={array:[],stride:3},r=0;r<e.childNodes.length;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"float_array":t.array=s(i.textContent);break;case"Name_array":t.array=n(i.textContent);break;case"technique_common":var o=a(i,"accessor")[0];void 0!==o&&(t.stride=parseInt(o.getAttribute("stride")))}}return t}function oe(e){for(var t={},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];1===a.nodeType&&(t[a.getAttribute("semantic")]=o(a.getAttribute("source")))}return t}function ce(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":var s=o(n.getAttribute("source")),c=n.getAttribute("semantic"),l=parseInt(n.getAttribute("offset")),u=parseInt(n.getAttribute("set")),h=u>0?c+u:c;t.inputs[h]={id:s,offset:l},t.stride=Math.max(t.stride,l+1),"TEXCOORD"===c&&(t.hasUV=!0);break;case"vcount":t.vcount=i(n.textContent);break;case"p":t.p=i(n.textContent)}}return t}function le(e){for(var t=0,r=0,a=e.length;r<a;r++){!0===e[r].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function ue(e){var t={},r=e.sources,a=e.vertices,n=e.primitives;if(0===n.length)return{};var s=function(e){for(var t={},r=0;r<e.length;r++){var a=e[r];void 0===t[a.type]&&(t[a.type]=[]),t[a.type].push(a)}return t}(n);for(var i in s){var o=s[i];le(o),t[i]=he(o,r,a)}return t}function he(t,r,a){for(var n={},s={array:[],stride:0},i={array:[],stride:0},o={array:[],stride:0},c={array:[],stride:0},l={array:[],stride:0},u=[],h=4,p=[],f=4,d=new e.BufferGeometry,g=[],v=0,m=0;m<t.length;m++){var y=t[m],b=y.inputs,x=0;switch(y.type){case"lines":case"linestrips":x=2*y.count;break;case"triangles":x=3*y.count;break;case"polylist":for(var w=0;w<y.count;w++){var S=y.vcount[w];switch(S){case 3:x+=3;break;case 4:x+=6;break;default:x+=3*(S-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",y.type)}for(var T in d.addGroup(v,x,m),v+=x,y.material&&g.push(y.material),b){var F=b[T];switch(T){case"VERTEX":for(var k in a){var E=a[k];switch(k){case"POSITION":var A=s.array.length;if(pe(y,r[E],F.offset,s.array),s.stride=r[E].stride,r.skinWeights&&r.skinIndices&&(pe(y,r.skinIndices,F.offset,u),pe(y,r.skinWeights,F.offset,p)),!1===y.hasUV&&!0===t.uvsNeedsFix){x=(s.array.length-A)/s.stride;for(var I=0;I<x;I++)o.array.push(0,0)}break;case"NORMAL":pe(y,r[E],F.offset,i.array),i.stride=r[E].stride;break;case"COLOR":pe(y,r[E],F.offset,l.array),l.stride=r[E].stride;break;case"TEXCOORD":pe(y,r[E],F.offset,o.array),o.stride=r[E].stride;break;case"TEXCOORD1":pe(y,r[E],F.offset,c.array),o.stride=r[E].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',k)}}break;case"NORMAL":pe(y,r[F.id],F.offset,i.array),i.stride=r[F.id].stride;break;case"COLOR":pe(y,r[F.id],F.offset,l.array),l.stride=r[F.id].stride;break;case"TEXCOORD":pe(y,r[F.id],F.offset,o.array),o.stride=r[F.id].stride;break;case"TEXCOORD1":pe(y,r[F.id],F.offset,c.array),c.stride=r[F.id].stride}}}return s.array.length>0&&d.setAttribute("position",new e.Float32BufferAttribute(s.array,s.stride)),i.array.length>0&&d.setAttribute("normal",new e.Float32BufferAttribute(i.array,i.stride)),l.array.length>0&&d.setAttribute("color",new e.Float32BufferAttribute(l.array,l.stride)),o.array.length>0&&d.setAttribute("uv",new e.Float32BufferAttribute(o.array,o.stride)),c.array.length>0&&d.setAttribute("uv2",new e.Float32BufferAttribute(c.array,c.stride)),u.length>0&&d.setAttribute("skinIndex",new e.Float32BufferAttribute(u,h)),p.length>0&&d.setAttribute("skinWeight",new e.Float32BufferAttribute(p,f)),n.data=d,n.type=t[0].type,n.materialKeys=g,n}function pe(e,t,r,a){var n=e.p,s=e.stride,i=e.vcount;function o(e){for(var t=n[e+r]*l,s=t+l;t<s;t++)a.push(c[t])}var c=t.array,l=t.stride;if(void 0!==e.vcount)for(var u=0,h=0,p=i.length;h<p;h++){var f=i[h];if(4===f){var d=u+1*s,g=u+2*s,v=u+3*s;o(u+0*s),o(d),o(v),o(d),o(g),o(v)}else if(3===f){d=u+1*s,g=u+2*s;o(u+0*s),o(d),o(g)}else if(f>4)for(var m=1,y=f-2;m<=y;m++){d=u+s*m,g=u+s*(m+1);o(u+0*s),o(d),o(g)}u+=s*f}else for(h=0,p=n.length;h<p;h+=s)o(h)}function fe(e){return f($e.geometries[e],ue)}function de(e){return void 0!==e.build?e.build:e}function ge(e,t){for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"joint":t.joints[a.getAttribute("sid")]=ve(a);break;case"link":t.links.push(ye(a))}}}function ve(e){for(var t,r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"prismatic":case"revolute":t=me(a)}}return t}function me(t,r){r={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new e.Vector3,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var a=0;a<t.childNodes.length;a++){var n=t.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"axis":var i=s(n.textContent);r.axis.fromArray(i);break;case"limits":var o=n.getElementsByTagName("max")[0],c=n.getElementsByTagName("min")[0];r.limits.max=parseFloat(o.textContent),r.limits.min=parseFloat(c.textContent)}}return r.limits.min>=r.limits.max&&(r.static=!0),r.middlePosition=(r.limits.min+r.limits.max)/2,r}function ye(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"attachment_full":t.attachments.push(be(a));break;case"matrix":case"translate":case"rotate":t.transforms.push(xe(a))}}return t}function be(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"link":t.links.push(ye(a));break;case"matrix":case"translate":case"rotate":t.transforms.push(xe(a))}}return t}function xe(t){var r={type:t.nodeName},a=s(t.textContent);switch(r.type){case"matrix":r.obj=new e.Matrix4,r.obj.fromArray(a).transpose();break;case"translate":r.obj=new e.Vector3,r.obj.fromArray(a);break;case"rotate":r.obj=new e.Vector3,r.obj.fromArray(a),r.angle=e.MathUtils.degToRad(a[3])}return r}function we(e,t){for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"technique_common":Se(a,t)}}}function Se(e,t){for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"inertia":t.inertia=s(a.textContent);break;case"mass":t.mass=s(a.textContent)[0]}}}function Te(e){for(var t={target:e.getAttribute("target").split("/").pop()},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"axis":var n=a.getElementsByTagName("param")[0];t.axis=n.textContent;var s=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=s.substr(0,s.length-1)}}return t}function Fe(e){return void 0!==e.build?e.build:e}function ke(t){for(var r=[],a=He.querySelector('[id="'+t.id+'"]'),n=0;n<a.childNodes.length;n++){var i=a.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"matrix":var o=s(i.textContent),c=(new e.Matrix4).fromArray(o).transpose();r.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:c});break;case"translate":case"scale":o=s(i.textContent);var l=(new e.Vector3).fromArray(o);r.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:l});break;case"rotate":o=s(i.textContent),l=(new e.Vector3).fromArray(o);var u=e.MathUtils.degToRad(o[3]);r.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:l,angle:u})}}return r}var Ee=new e.Matrix4,Ae=new e.Vector3;function Ie(t){for(var r={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new e.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},a=0;a<t.childNodes.length;a++){var n=t.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"node":r.nodes.push(n.getAttribute("id")),Ie(n);break;case"instance_camera":r.instanceCameras.push(o(n.getAttribute("url")));break;case"instance_controller":r.instanceControllers.push(Me(n));break;case"instance_light":r.instanceLights.push(o(n.getAttribute("url")));break;case"instance_geometry":r.instanceGeometries.push(Me(n));break;case"instance_node":r.instanceNodes.push(o(n.getAttribute("url")));break;case"matrix":var i=s(n.textContent);r.matrix.multiply(Ee.fromArray(i).transpose()),r.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":i=s(n.textContent);Ae.fromArray(i),r.matrix.multiply(Ee.makeTranslation(Ae.x,Ae.y,Ae.z)),r.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":i=s(n.textContent);var c=e.MathUtils.degToRad(i[3]);r.matrix.multiply(Ee.makeRotationAxis(Ae.fromArray(i),c)),r.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":i=s(n.textContent);r.matrix.scale(Ae.fromArray(i)),r.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return De(r.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",r.id):$e.nodes[r.id]=r,r}function Me(e){for(var t={id:o(e.getAttribute("url")),materials:{},skeletons:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];switch(a.nodeName){case"bind_material":for(var n=a.getElementsByTagName("instance_material"),s=0;s<n.length;s++){var i=n[s],c=i.getAttribute("symbol"),l=i.getAttribute("target");t.materials[c]=o(l)}break;case"skeleton":t.skeletons.push(o(a.textContent))}}return t}function Le(t,r){var a,n,s,i=[],o=[];for(a=0;a<t.length;a++){var c=t[a];if(De(c))Ce(Pe(c),r,i);else if(s=c,void 0!==$e.visualScenes[s])for(var l=$e.visualScenes[c].children,u=0;u<l.length;u++){var h=l[u];if("JOINT"===h.type)Ce(Pe(h.id),r,i)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",c)}for(a=0;a<r.length;a++)for(u=0;u<i.length;u++)if((n=i[u]).bone.name===r[a].name){o[a]=n,n.processed=!0;break}for(a=0;a<i.length;a++)!1===(n=i[a]).processed&&(o.push(n),n.processed=!0);var p=[],f=[];for(a=0;a<o.length;a++)n=o[a],p.push(n.bone),f.push(n.boneInverse);return new e.Skeleton(p,f)}function Ce(t,r,a){t.traverse((function(t){if(!0===t.isBone){for(var n,s=0;s<r.length;s++){var i=r[s];if(i.name===t.name){n=i.boneInverse;break}}void 0===n&&(n=new e.Matrix4),a.push({bone:t,boneInverse:n,processed:!1})}}))}function Oe(t){for(var r,a=[],n=t.matrix,s=t.nodes,i=t.type,o=t.instanceCameras,c=t.instanceControllers,l=t.instanceLights,u=t.instanceGeometries,h=t.instanceNodes,p=0,d=s.length;p<d;p++)a.push(Pe(s[p]));for(p=0,d=o.length;p<d;p++){var g=te(o[p]);null!==g&&a.push(g.clone())}for(p=0,d=c.length;p<d;p++)for(var v=c[p],m=(r=v.id,f($e.controllers[r],R)),y=Ne(fe(m.id),v.materials),b=Le(v.skeletons,m.skin.joints),x=0,w=y.length;x<w;x++){var S;(S=y[x]).isSkinnedMesh&&(S.bind(b,m.skin.bindMatrix),S.normalizeSkinWeights()),a.push(S)}for(p=0,d=l.length;p<d;p++){var T=se(l[p]);null!==T&&a.push(T.clone())}for(p=0,d=u.length;p<d;p++)for(x=0,w=(y=Ne(fe((v=u[p]).id),v.materials)).length;x<w;x++)a.push(y[x]);for(p=0,d=h.length;p<d;p++)a.push(Pe(h[p]).clone());if(0===s.length&&1===a.length)S=a[0];else{S="JOINT"===i?new e.Bone:new e.Group;for(p=0;p<a.length;p++)S.add(a[p])}return S.name="JOINT"===i?t.sid:t.name,S.matrix.copy(n),S.matrix.decompose(S.position,S.quaternion,S.scale),S}var Re=new e.MeshBasicMaterial({color:16711935});function Ue(e,t){for(var r=[],a=0,n=e.length;a<n;a++){var s=t[e[a]];void 0===s?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[a]),r.push(Re)):r.push(Z(s))}return r}function Ne(t,r){var a=[];for(var n in t){var s=t[n],i=Ue(s.materialKeys,r);0===i.length&&("lines"===n||"linestrips"===n?i.push(new e.LineBasicMaterial):i.push(new e.MeshPhongMaterial));var o=void 0!==s.data.attributes.skinIndex;if(o)for(var c=0,l=i.length;c<l;c++)i[c].skinning=!0;var u,h=1===i.length?i[0]:i;switch(n){case"lines":u=new e.LineSegments(s.data,h);break;case"linestrips":u=new e.Line(s.data,h);break;case"triangles":case"polylist":u=o?new e.SkinnedMesh(s.data,h):new e.Mesh(s.data,h)}a.push(u)}return a}function De(e){return void 0!==$e.nodes[e]}function Pe(e){return f($e.nodes[e],Oe)}function Be(t){var r=new e.Group;r.name=t.name;for(var a=t.children,n=0;n<a.length;n++){var s=a[n];r.add(Pe(s.id))}return r}function Ge(e){return f($e.visualScenes[e],Be)}if(0===t.length)return{scene:new e.Scene};var _e=(new e.$DOMParser).parseFromString(t,"application/xml"),He=a(_e,"COLLADA")[0],Ve=_e.getElementsByTagName("parsererror")[0];if(void 0!==Ve){var ze,je=a(Ve,"div")[0];return ze=je?je.textContent:function(e){for(var t="",r=[e];r.length;){var a=r.shift();a.nodeType===Node.TEXT_NODE?t+=a.textContent:(t+="\n",r.push.apply(r,a.childNodes))}return t.trim()}(Ve),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",ze),null}var We=He.getAttribute("version");console.log("THREE.ColladaLoader: File version",We);var Xe,qe=function(e){return{unit:l(a(e,"unit")[0]),upAxis:u(a(e,"up_axis")[0])}}(a(He,"asset")[0]),Ye=new e.TextureLoader(this.manager);Ye.setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin),O&&(Xe=new O(this.manager)).setPath(this.resourcePath||r);var Ke=[],Ze={},Qe=0,$e={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};h(He,"library_animations","animation",(function t(r){for(var a={sources:{},samplers:{},channels:{}},n=!1,s=0,i=r.childNodes.length;s<i;s++){var o,c=r.childNodes[s];if(1===c.nodeType)switch(c.nodeName){case"source":o=c.getAttribute("id"),a.sources[o]=ie(c);break;case"sampler":o=c.getAttribute("id"),a.samplers[o]=d(c);break;case"channel":o=c.getAttribute("target"),a.channels[o]=g(c);break;case"animation":t(c),n=!0;break;default:console.log(c)}}!1===n&&($e.animations[r.getAttribute("id")||e.MathUtils.generateUUID()]=a)})),h(He,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_animation":t.animations.push(o(n.getAttribute("url")))}}$e.clips[e.getAttribute("id")]=t})),h(He,"library_controllers","controller",(function(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"skin":t.id=o(n.getAttribute("source")),t.skin=M(n);break;case"morph":t.id=o(n.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}$e.controllers[e.getAttribute("id")]=t})),h(He,"library_images","image",(function(e){var t={init_from:a(e,"init_from")[0].textContent};$e.images[e.getAttribute("id")]=t})),h(He,"library_effects","effect",(function(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"profile_COMMON":t.profile=D(n)}}$e.effects[e.getAttribute("id")]=t})),h(He,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_effect":t.url=o(n.getAttribute("url"))}}$e.materials[e.getAttribute("id")]=t})),h(He,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"optics":t.optics=Q(n)}}$e.cameras[e.getAttribute("id")]=t})),h(He,"library_lights","light",(function(e){for(var t={},r=0,a=e.childNodes.length;r<a;r++){var n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":t=re(n)}}$e.lights[e.getAttribute("id")]=t})),h(He,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=a(e,"mesh")[0];if(void 0!==r){for(var n=0;n<r.childNodes.length;n++){var s=r.childNodes[n];if(1===s.nodeType){var i=s.getAttribute("id");switch(s.nodeName){case"source":t.sources[i]=ie(s);break;case"vertices":t.vertices=oe(s);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",s.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ce(s));break;default:console.log(s)}}}$e.geometries[e.getAttribute("id")]=t}})),h(He,"library_nodes","node",Ie),h(He,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),r=0;r<t.length;r++){var a=t[r];!1===a.hasAttribute("id")&&a.setAttribute("id","three_default_"+Qe++)}}(e);for(var r=a(e,"node"),n=0;n<r.length;n++)t.children.push(Ie(r[n]));$e.visualScenes[e.getAttribute("id")]=t})),h(He,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"technique_common":ge(a,t)}}$e.kinematicsModels[e.getAttribute("id")]=t})),h(He,"library_physics_models","physics_model",(function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"rigid_body":t.rigidBodies[a.getAttribute("name")]={},we(a,t.rigidBodies[a.getAttribute("name")])}}$e.physicsModels[e.getAttribute("id")]=t})),h(He,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},r=0;r<e.childNodes.length;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Te(a))}}$e.kinematicsScenes[o(e.getAttribute("url"))]=t})),p($e.animations,v),p($e.clips,A),p($e.controllers,R),p($e.images,U),p($e.effects,Y),p($e.materials,K),p($e.cameras,ee),p($e.lights,ne),p($e.geometries,ue),p($e.visualScenes,Be),function(){var t=$e.clips;if(!0===c(t)){if(!1===c($e.animations)){var r=[];for(var a in $e.animations)for(var n=m(a),s=0,i=n.length;s<i;s++)r.push(n[s]);Ke.push(new e.AnimationClip("default",-1,r))}}else for(var a in t)Ke.push(I(a))}(),function(){var t=Object.keys($e.kinematicsModels)[0],r=Object.keys($e.kinematicsScenes)[0],a=Object.keys($e.visualScenes)[0];if(void 0!==t&&void 0!==r){for(var n,s=(n=t,f($e.kinematicsModels[n],de)),i=function(e){return f($e.kinematicsScenes[e],Fe)}(r),o=Ge(a),c=i.bindJointAxis,l={},u=0,h=c.length;u<h;u++){var p=c[u],d=He.querySelector('[sid="'+p.target+'"]');if(d){var g=d.parentElement;m(p.jointIndex,g)}}var v=new e.Matrix4;Ze={joints:s&&s.joints,getJointValue:function(e){var t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(t,r){var a=l[t];if(a){var n=a.joint;if(r>n.limits.max||r<n.limits.min)console.warn("THREE.ColladaLoader: Joint "+t+" value "+r+" outside of limits (min: "+n.limits.min+", max: "+n.limits.max+").");else if(n.static)console.warn("THREE.ColladaLoader: Joint "+t+" is static.");else{var s=a.object,i=n.axis,o=a.transforms;Ee.identity();for(var c=0;c<o.length;c++){var u=o[c];if(u.sid&&-1!==u.sid.indexOf(t))switch(n.type){case"revolute":Ee.multiply(v.makeRotationAxis(i,e.MathUtils.degToRad(r)));break;case"prismatic":Ee.multiply(v.makeTranslation(i.x*r,i.y*r,i.z*r));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+n.type)}else switch(u.type){case"matrix":Ee.multiply(u.obj);break;case"translate":Ee.multiply(v.makeTranslation(u.obj.x,u.obj.y,u.obj.z));break;case"scale":Ee.scale(u.obj);break;case"rotate":Ee.multiply(v.makeRotationAxis(u.obj,u.angle))}}s.matrix.copy(Ee),s.matrix.decompose(s.position,s.quaternion,s.scale),l[t].position=r}}else console.log("THREE.ColladaLoader: "+t+" does not exist.")}}}function m(e,t){var r=t.getAttribute("name"),a=s.joints[e];o.traverse((function(n){n.name===r&&(l[e]={object:n,transforms:ke(t),joint:a,position:a.zeroPosition})}))}}();var Je=function(e){return Ge(o(a(e,"instance_visual_scene")[0].getAttribute("url")))}(a(He,"scene")[0]);return Je.animations=Ke,"Z_UP"===qe.upAxis&&Je.quaternion.setFromEuler(new e.Euler(-Math.PI/2,0,0)),Je.scale.multiplyScalar(qe.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Ke},kinematics:Ze,library:$e,scene:Je}}});function ho(e,t){return null!=e?e:t()}class po{__init(){this.currFrame=0}constructor(e,t,r,a,n=24,s=!0){this.tiles=e,this.totalFrame=t,this.row=r,this.col=a,po.prototype.__init.call(this),this.playing=!0,this.currFrame=0,this.frameGap=1e3/n,e.forEach((e=>{e.repeat.set(1/this.col,1/this.row),s&&(e.encoding=3001)})),this.updateOffset()}stop(){this.playing=!1}play(){this.playing=!0,this.startTime=Date.now(),this.startFrame=this.currFrame}get texture(){return this.tiles[this.currTile]}animate(){if(!this.playing||1===this.totalFrame)return;const e=Date.now();this.startTime=ho(this.startTime,(()=>e)),this.startFrame=ho(this.startFrame,(()=>this.currFrame));const t=this.startFrame+~~((e-this.startTime)/this.frameGap);this.currFrame=t%this.totalFrame,t>this.currFrame&&(this.startTime=e,this.startFrame=this.currFrame),this.updateOffset()}updateOffset(){this.currTile=~~(this.currFrame/(this.col*this.row)),this.currTileOffset=this.currFrame%(this.col*this.row);const e=this.tiles[this.currTile],t=1/this.row,r=this.currTileOffset%this.col,a=~~(this.currTileOffset/this.col);e&&(e.offset.x=r/this.col,e.offset.y=1-a/this.row-t)}dispose(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.mesh,"optionalAccess",e=>e.material,"access",e=>e.dispose,"call",e=>e()]),this.tiles.forEach((e=>e.dispose())),this.tiles.length=0,this.mesh=null}}const fo={url:["https://s3.ax1x.com/2021/02/26/yx0ObV.png","https://s3.ax1x.com/2021/02/26/yx0LD0.png","https://s3.ax1x.com/2021/02/26/yx0Hvn.png"],x:0,y:0,z:-15,w:10,h:10,col:2,row:2,total:10,fps:16};var go=function(t){!1===e.$window.isSecureContext&&console.error("THREE.DeviceOrientationControls: DeviceOrientationEvent is only available in secure contexts (https)");var r=this,a={type:"change"};this.object=t,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var n,s,i,o,c,l=function(e){r.deviceOrientation=e},u=function(){r.screenOrientation=e.$window.orientation||0},h=(n=new e.Vector3(0,0,1),s=new e.Euler,i=new e.Quaternion,o=new e.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(e,t,r,a,c){s.set(r,t,-a,"YXZ"),e.setFromEuler(s),e.multiply(o),e.multiply(i.setFromAxisAngle(n,-c))});this.connect=function(){u(),void 0!==e.$window.DeviceOrientationEvent&&"function"==typeof e.$window.DeviceOrientationEvent.requestPermission?e.$window.DeviceOrientationEvent.requestPermission().then((function(t){"granted"==t&&(e.$window.addEventListener("orientationchange",u),e.$window.addEventListener("deviceorientation",l))})).catch((function(e){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)})):(e.$window.addEventListener("orientationchange",u),e.$window.addEventListener("deviceorientation",l)),r.enabled=!0},this.disconnect=function(){e.$window.removeEventListener("orientationchange",u),e.$window.removeEventListener("deviceorientation",l),r.enabled=!1},this.update=(c=new e.Quaternion,function(){if(!1!==r.enabled){var t=r.deviceOrientation;if(t){var n=t.alpha?e.MathUtils.degToRad(t.alpha)+r.alphaOffset:0,s=t.beta?e.MathUtils.degToRad(t.beta):0,i=t.gamma?e.MathUtils.degToRad(t.gamma):0,o=r.screenOrientation?e.MathUtils.degToRad(r.screenOrientation):0;h(r.object.quaternion,n,s,i,o),8*(1-c.dot(r.object.quaternion))>1e-6&&(c.copy(r.object.quaternion),r.dispatchEvent(a))}}}),this.dispose=function(){r.disconnect()},this.connect()};(go.prototype=Object.create(e.EventDispatcher.prototype)).constructor=go;function vo(e,t,r,a){if(Array.isArray(e)){for(var n=vo(new Float64Array(e),t,r,a),s=0;s<e.length;s++)e[s]=n[s];return e}if(!t||!r)throw Error("Bad dimensions");a||(a=e.length/(t*r));for(var i=r>>1,o=t*a,c=new(0,e.constructor)(t*a),l=0;l<i;++l){var u=l*o,h=(r-l-1)*o;c.set(e.subarray(u,u+o)),e.copyWithin(u,h,h+o),e.set(c,h)}return e}exports.DemoBVHLoader=class extends L{async init(){const{scene:t,camera:r}=this.deps,a=new cn;r.position.set(0,200,300);const n=await a.loadAsync(M+"/models/bvh/pirouette.bvh"),s=new e.SkeletonHelper(n.skeleton.bones[0]);s.skeleton=n.skeleton;const i=new e.Group;i.add(n.skeleton.bones[0]),this.add(s),this.add(i),t.background=new e.Color(15658734),this.add(new e.GridHelper(400,10)),this.mixer=new e.AnimationMixer(s),this.mixer.clipAction(n.clip).setEffectiveWeight(1).play(),this.addControl(),this.orbitControl.minDistance=300,this.orbitControl.maxDistance=700}update(){ln([this,"access",e=>e.mixer,"optionalAccess",e=>e.update,"call",e=>e(this.deps.clock.getDelta())]),ln([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset(),this.mixer.stopAllAction(),this.mixer=null}},exports.DemoColladaLoader=class extends L{async init(){const{camera:t}=this.deps;t.position.set(8,10,8),t.lookAt(0,3,0);const r=new uo,a=await r.loadAsync(M+"/models/collada/elf/elf.dae");this.add(a.scene);const n=new e.AmbientLight(13421772,.4);this.add(n);const s=new e.DirectionalLight(16777215,.8);s.position.set(1,1,0).normalize(),this.add(s),this.addControl()}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoDeviceOrientationControls=class extends L{async init(){const{camera:t,textureLoader:r}=this.deps;this.control=new go(t);const a=new e.SphereGeometry(500,60,40);a.scale(-1,1,1);const n=new e.MeshBasicMaterial({map:await r.loadAsync("https://s3.ax1x.com/2021/02/26/yx0quq.jpg")}),s=new e.BoxGeometry(100,100,100,4,4,4),i=new e.MeshBasicMaterial({color:16711935,wireframe:!0});this.add(new e.Mesh(a,n)),this.add(new e.Mesh(s,i))}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.control,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset(),this.control.disconnect(),this.control.dispose(),this.control=null}},exports.DemoEXRLoader=class extends L{async init(){const{renderer:t}=this.deps,r=(new Vi).setDataType(e.FloatType),a=await r.loadAsync(M+"/textures/memorial.exr"),n=new e.MeshBasicMaterial({map:a}),s=new e.PlaneGeometry(4.5*a.image.width/a.image.height,4.5);this.add(new e.Mesh(s,n)),this.lastToneMapping=t.toneMapping,this.lastToneMappingExposure=t.toneMappingExposure,t.toneMapping=e.ReinhardToneMapping,t.toneMappingExposure=2}update(){}dispose(){this.deps.renderer.toneMapping=this.lastToneMapping,this.deps.renderer.toneMappingExposure=this.lastToneMappingExposure,this.reset()}},exports.DemoFBXLoader=class extends L{async init(){const{camera:t,scene:r}=this.deps;t.position.set(100,200,300),r.background=new e.Color(10526880),r.fog=new e.Fog(10526880,200,1e3);const a=new e.HemisphereLight(16777215,4473924);a.position.set(0,200,0),this.add(a);const n=new e.DirectionalLight(16777215);n.position.set(0,200,100),n.castShadow=!0,n.shadow.camera.top=180,n.shadow.camera.bottom=-100,n.shadow.camera.left=-120,n.shadow.camera.right=120,this.add(n);const s=new e.Mesh(new e.PlaneGeometry(2e3,2e3),new e.MeshPhongMaterial({color:10066329,depthWrite:!1}));s.rotation.x=-Math.PI/2,s.receiveShadow=!0,this.add(s);const i=new e.GridHelper(2e3,20,0,0);i.material.opacity=.2,i.material.transparent=!0,this.add(i);const o=new Ei,c=await o.loadAsync(M+"/models/fbx/Samba Dancing.fbx"),l=new e.AnimationMixer(c);l.clipAction(c.animations[0]).play(),c.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),this.add(c),this.addControl(),this.orbitControl.target.set(0,100,0),this.orbitControl.update(),this.mixer=l}update(){Ai([this,"access",e=>e.mixer,"optionalAccess",e=>e.update,"call",e=>e(this.deps.clock.getDelta())]),Ai([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset(),this.mixer.stopAllAction(),this.mixer=null}},exports.DemoGLTFLoader=class extends L{async init(){const t=await this.deps.gltfLoader.loadAsync("https://dtmall-tel.alicdn.com/edgeComputingConfig/upload_models/1591673169101/RobotExpressive.glb");t.scene.position.z=2.5,t.scene.position.y=-2,this.add(new e.DirectionalLight(16777215,1)),this.add(new e.AmbientLight(16777215,1)),this.add(t.scene),this.deps.camera.position.z=10;const r=["Idle","Walking","Running","Dance","Death","Sitting","Standing"],a=["Jump","Yes","No","Wave","Punch","ThumbsUp"];this.mixer=new e.AnimationMixer(t.scene);const n={};for(let s=0;s<t.animations.length;s++){const i=t.animations[s],o=this.mixer.clipAction(i);n[i.name]=o,(a.indexOf(i.name)>=0||r.indexOf(i.name)>=4)&&(o.clampWhenFinished=!0,o.loop=e.LoopOnce)}n.Walking.play(),this.addControl()}update(){lo([this,"access",e=>e.mixer,"optionalAccess",e=>e.update,"call",e=>e(this.deps.clock.getDelta())]),lo([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.mixer.stopAllAction(),this.mixer=null,this.reset()}},exports.DemoHDRPrefilterTexture=class extends L{async init(){const{scene:t,camera:r}=this.deps,a=await this.deps.textureLoader.loadAsync("https://cdn.static.oppenlab.com/weblf/test/hdr-prefilter.png");!function(t,r=!0){r&&(t.format=e.RGBEFormat,t.encoding=e.RGBEEncoding),t.generateMipmaps=!1,t.magFilter=e.NearestFilter,t.minFilter=e.NearestFilter,t.type=e.UnsignedByteType,t.mapping=e.CubeUVReflectionMapping,t.name="PMREM.cubeUv"}(a);const n=new e.PlaneGeometry(3,3),s=new e.MeshBasicMaterial({map:a}),i=new e.Mesh(n,s);this.add(i),t.background=a,r.position.z=1,this.addControl()}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoLWOLoader=class extends L{async init(){const{scene:t,renderer:r,camera:a}=this.deps;a.position.set(-.7,14.6,43.2),t.background=new e.Color(10526880);const n=new e.AmbientLight(11184810,1.75);this.add(n);const s=new e.DirectionalLight(16777215,1);s.position.set(0,200,100),s.castShadow=!0,s.shadow.camera.top=180,s.shadow.camera.bottom=-100,s.shadow.camera.left=-120,s.shadow.camera.right=120,this.add(s);const i=new e.DirectionalLight(16777215,.7);i.position.set(-100,200,-100),this.add(i);const o=new e.DirectionalLight(16777215,.4);o.position.set(100,-200,100),this.add(o);const c=new e.DirectionalLight(16777215,1);c.position.set(-100,-100,100),this.add(c);const l=new e.GridHelper(200,20,0,0);l.material.opacity=.3,l.material.transparent=!0,this.add(l);const u=new Ni,h=await u.loadAsync(M+"/models/lwo/Objects/LWO3/Demo.lwo"),p=h.meshes[0];p.position.set(-2,12,0);const f=h.meshes[1];f.position.set(2,12,0);const d=h.meshes[2];d.position.set(0,10.5,-1),this.add(p),this.add(d),this.add(f),r.shadowMap.enabled=!0,r.physicallyCorrectLights=!0,r.gammaFactor=1.18,this.addControl(),this.orbitControl.target.set(1.33,10,-6.7)}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoMTLLoader=class extends L{async init(){const{camera:t,renderer:r}=this.deps,a=new e.LoadingManager;a.addHandler(/\.dds$/i,new _i);const n=new Gi(a),s=new Hi(a),i=await n.loadAsync(M+"/models/obj/male02/male02.mtl");i.preload();const o=await s.setMaterials(i).loadAsync(M+"/models/obj/male02/male02.obj");o.position.y=-95,this.addControl(),this.add(new e.AmbientLight(13421772,.4)),this.addCamera(new e.PointLight(16777215,.8)),this.add(o),this.add(t),o.position.y=-95,t.position.z=200,r.outputEncoding=e.LinearEncoding}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoMemoryTest=class extends L{async init(){this.reset(!1);const t=await this.deps.gltfLoader.loadAsync(M+"/models/gltf/Soldier.glb");this.add(new e.DirectionalLight(16777215,1)),this.add(new e.AmbientLight(16777215,1)),this.add(t.scene),this.timer=setTimeout((()=>this.init()),300)}update(){}dispose(){this.reset(),clearTimeout(this.timer)}},exports.DemoMeshOpt=class extends L{async init(){const{gltfLoader:t,camera:r,scene:a}=this.deps;C.setWasmPath("/decoder_base.wasm"),t.setMeshoptDecoder(C);const n=Date.now(),s=await t.loadAsync("https://cdn.static.oppenlab.com/weblf/test/pirate.glb");console.log(Date.now()-n);const i=new e.PointLight(16777215,.8);i.position.set(3,3,0),this.add(new e.AmbientLight(13421772,.3)),this.add(s.scene),this.add(r),this.addCamera(i),s.scene.position.y=-1,a.position.z=0,r.position.y=1,r.position.z=3,a.background=new e.Color(3148324),this.addControl()}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoMeshQuantization=class extends L{async init(){const{camera:t,gltfLoader:r,scene:a}=this.deps,n=Date.now();C.setWasmPath("/decoder_base.wasm"),r.setMeshoptDecoder(C);const s=await r.loadAsync("https://cdn.static.oppenlab.com/weblf/test/PrimaryIonDrive-EXT_MESH_QUANTIZATION.glb"),i=Date.now();console.log("load glb time",i-n),this.add(s.scene),this.add(new e.DirectionalLight(16777215,1)),this.add(new e.AmbientLight(16777215,1)),t.position.z=3,a.position.z=0,this.addControl()}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoOBJLoader=class extends L{async init(){const{textureLoader:t,camera:r,renderer:a}=this.deps,n=await t.loadAsync(M+"/textures/UV_Grid_Sm.jpg"),s=new Hi,i=await s.loadAsync(M+"/models/obj/male02/male02.obj");this.add(new e.AmbientLight(13421772,.4)),this.addCamera(new e.PointLight(16777215,.8)),this.add(i),this.add(r),i.traverse((function(e){e.isMesh&&(e.material.map=n)})),i.position.y=-95,r.position.z=200,a.outputEncoding=e.LinearEncoding,this.addControl()}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoPDBLoader=class extends L{async init(){const{camera:t,scene:r,renderer:a}=this.deps;t.position.z=100,r.position.z=0,r.background=new e.Color(328965),a.outputEncoding=e.LinearEncoding,this.addControl(),this.obj=new e.Group,this.obj.scale.set(.1,.1,.1),this.add(this.obj);const n=new e.DirectionalLight(16777215,.8);n.position.set(1,1,1);const s=new e.DirectionalLight(16777215,.5);s.position.set(-1,-1,1),this.add(n),this.add(s);const i=new R,o=await i.loadAsync(M+"/models/molecules/caffeine.pdb");this.loadMolecule(o)}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}loadMolecule(t){var r=t.geometryAtoms,a=t.geometryBonds,n=t.json,s=new e.Vector3,i=new e.BoxGeometry(1,1,1),o=new e.IcosahedronGeometry(1,2);r.computeBoundingBox(),r.boundingBox.getCenter(s).negate(),r.translate(s.x,s.y,s.z),a.translate(s.x,s.y,s.z);for(var c=r.getAttribute("position"),l=r.getAttribute("color"),u=new e.Vector3,h=new e.Color,p=0;p<c.count;p++){u.x=c.getX(p),u.y=c.getY(p),u.z=c.getZ(p),h.r=l.getX(p),h.g=l.getY(p),h.b=l.getZ(p);var f=new e.MeshPhongMaterial({color:h});(v=new e.Mesh(o,f)).position.copy(u),v.position.multiplyScalar(75),v.scale.multiplyScalar(25),this.obj.add(v);n.atoms[p]}c=a.getAttribute("position");var d=new e.Vector3,g=new e.Vector3;for(p=0;p<c.count;p+=2){var v;d.x=c.getX(p),d.y=c.getY(p),d.z=c.getZ(p),g.x=c.getX(p+1),g.y=c.getY(p+1),g.z=c.getZ(p+1),d.multiplyScalar(75),g.multiplyScalar(75),(v=new e.Mesh(i,new e.MeshPhongMaterial({color:16777215}))).position.copy(d),v.position.lerp(g,.5),v.scale.set(5,5,d.distanceTo(g)),v.lookAt(g),this.obj.add(v)}}},exports.DemoRGBELoader=class extends L{async init(){const{renderer:t,gltfLoader:r,scene:a,camera:n}=this.deps,s=await r.loadAsync(co+"/examples/models/gltf/MetalRoughSpheres/glTF/MetalRoughSpheres.gltf");s.scene.rotation.copy(new e.Euler(0,0,0)),t.physicallyCorrectLights=!0;const i=new oo,o=new e.PMREMGenerator(t);o.compileEquirectangularShader();const c=Date.now(),l=await i.setDataType(e.UnsignedByteType).loadAsync(co+"/examples/textures/equirectangular/venice_sunset_2k.hdr"),u=Date.now(),h=o.fromEquirectangular(l).texture;console.log("time cost",Date.now()-u,u-c),l.dispose(),o.dispose(),a.background=h,s.scene.traverse((function(e){e.material&&(e.material.isMeshStandardMaterial||e.material.isShaderMaterial&&void 0!==e.material.envMap)&&(e.material.envMap=h,e.material.envMapIntensity=1.5),(e.isMesh||e.isLight)&&(e.castShadow=!0)}));const p=new e.DirectionalLight(14540253,4);p.position.set(0,0,1).normalize();const f=new e.SpotLight(16777215,1);f.position.set(5,10,5),f.angle=.5,f.penumbra=.75,f.intensity=100,f.decay=2,n.position.set(2,1,15),this.add(s.scene),this.add(p),this.add(new e.AmbientLight(2236962)),this.add(f),this.addControl()}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoSTLLoader=class extends L{async init(){const{camera:t,renderer:r,scene:a}=this.deps;t.position.set(3,.15,3),r.setClearColor(16777215),a.position.z=0,a.background=new e.Color(7496795),a.fog=new e.Fog(7496795,2,15),r.shadowMap.enabled=!0;const n=new e.Mesh(new e.PlaneGeometry(40,40),new e.MeshPhongMaterial({color:10066329,specular:1052688}));n.rotation.x=-Math.PI/2,n.position.y=-.5,n.receiveShadow=!0,this.add(n),this.add(new e.AmbientLight(4473924)),this.addShadowedLight(1,1,1,16777215,1.35),this.addShadowedLight(.5,1,-1,16755200,1),this.addControl(),this.loadModels()}addShadowedLight(t,r,a,n,s){const i=new e.DirectionalLight(n,s);i.position.set(t,r,a),this.add(i),i.castShadow=!0;i.shadow.camera.left=-1,i.shadow.camera.right=1,i.shadow.camera.top=1,i.shadow.camera.bottom=-1,i.shadow.camera.near=1,i.shadow.camera.far=4,i.shadow.bias=-.002}loadModels(){const t=new D;t.load(M+"/models/stl/ascii/slotted_disk.stl",(t=>{const r=new e.MeshPhongMaterial({color:16733491,specular:1118481,shininess:200}),a=new e.Mesh(t,r);a.position.set(0,-.25,.6),a.rotation.set(0,-Math.PI/2,0),a.scale.set(.5,.5,.5),a.castShadow=!0,a.receiveShadow=!0,this.add(a)}));const r=new e.MeshPhongMaterial({color:11184810,specular:1118481,shininess:200});t.load(M+"/models/stl/binary/pr2_head_pan.stl",(t=>{const a=new e.Mesh(t,r);a.position.set(0,-.37,-.6),a.rotation.set(-Math.PI/2,0,0),a.scale.set(2,2,2),a.castShadow=!0,a.receiveShadow=!0,this.add(a)})),t.load("./models/stl/binary/pr2_head_tilt.stl",(t=>{const a=new e.Mesh(t,r);a.position.set(.136,-.37,-.6),a.rotation.set(-Math.PI/2,.3,0),a.scale.set(2,2,2),a.castShadow=!0,a.receiveShadow=!0,this.add(a)})),t.load(M+"/models/stl/binary/colored.stl",(t=>{let a=r;t.hasColors&&(a=new e.MeshPhongMaterial({opacity:t.alpha,vertexColors:!0}));const n=new e.Mesh(t,a);n.position.set(.5,.2,0),n.rotation.set(-Math.PI/2,Math.PI/2,0),n.scale.set(.3,.3,.3),n.castShadow=!0,n.receiveShadow=!0,this.add(n)}))}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()]),this.deps.camera.lookAt(new e.Vector3(0,-.25,0))}dispose(){this.reset()}},exports.DemoSVGLoader=class extends L{async init(){const{camera:t,renderer:r}=this.deps,a=new io,n=await a.loadAsync("https://techbrood.com/threejs/examples/models/svg/tiger.svg"),s=new e.GridHelper(160,10);s.rotation.x=Math.PI/2,this.add(s),this.add(this.initSVG(n)),this.addControl(),t.position.set(0,0,200),r.outputEncoding=e.LinearEncoding}initSVG(t){const r=!1,a=!1,{paths:n}=t;var s=new e.Group;s.scale.multiplyScalar(.25),s.position.x=-70,s.position.y=70,s.scale.y*=-1;for(var i=0;i<n.length;i++){var o=n[i],c=o.userData.style.fill;if(void 0!==c&&"none"!==c)for(var l=new e.MeshBasicMaterial({color:(new e.Color).setStyle(c),opacity:o.userData.style.fillOpacity,transparent:o.userData.style.fillOpacity<1,side:e.DoubleSide,depthWrite:!1,wireframe:r}),u=o.toShapes(!0),h=0;h<u.length;h++){var p=u[h],f=new e.ShapeGeometry(p),d=new e.Mesh(f,l);s.add(d)}var g=o.userData.style.stroke;if(void 0!==g&&"none"!==g){l=new e.MeshBasicMaterial({color:(new e.Color).setStyle(g),opacity:o.userData.style.strokeOpacity,transparent:o.userData.style.strokeOpacity<1,side:e.DoubleSide,depthWrite:!1,wireframe:a}),h=0;for(var v=o.subPaths.length;h<v;h++){var m=o.subPaths[h];if(f=io.pointsToStroke(m.getPoints(),o.userData.style)){d=new e.Mesh(f,l);s.add(d)}}}}return s}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoTGALoader=class extends L{async init(){const{camera:t,renderer:r}=this.deps,a=new O,[n,s]=await Promise.all([a.loadAsync(M+"/textures/crate_grey8.tga"),a.loadAsync(M+"/textures/crate_color8.tga")]);t.position.set(0,50,250);const i=new e.BoxGeometry(50,50,50),o=new e.MeshPhongMaterial({color:16777215,map:n}),c=new e.Mesh(i,o);c.position.x=-50;const l=new e.MeshPhongMaterial({color:16777215,map:s}),u=new e.Mesh(i,l);u.position.x=50;const h=new e.DirectionalLight(16777215,1);h.position.set(1,1,1),this.add(c),this.add(u),this.add(h),this.add(new e.AmbientLight(16777215,.4)),this.addControl(),r.outputEncoding=e.LinearEncoding}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoTTFLoader=class extends L{async init(){const{camera:t,scene:r,renderer:a}=this.deps;t.position.set(0,400,700),r.background=new e.Color(0),r.fog=new e.Fog(0,250,1400);const n=new e.DirectionalLight(16777215,.125);n.position.set(0,0,1).normalize(),this.add(n);const s=new e.PointLight(16777215,1.5);s.position.set(0,100,90),s.color.setHSL(Math.random(),1,.5),this.add(s);const i=new e.MeshPhongMaterial({color:16777215,flatShading:!0}),o=new e.Group;o.position.y=100,this.add(o);const c=new on,l=await c.loadAsync(M+"/fonts/ttf/kenpixel.ttf");console.log(l),this.createText(new e.Font(l),o,i);const u=new e.Mesh(new e.PlaneGeometry(1e4,1e4),new e.MeshBasicMaterial({color:16777215,opacity:.5,transparent:!0}));u.position.y=100,u.rotation.x=-Math.PI/2,a.outputEncoding=e.LinearEncoding,this.add(u),this.addControl()}createText(t,r,a){const n=new e.TextGeometry("three.js",{font:t,size:70,height:20,curveSegments:4,bevelThickness:2,bevelSize:1.5,bevelEnabled:!0});n.computeBoundingBox(),n.computeVertexNormals();const s=-.5*(n.boundingBox.max.x-n.boundingBox.min.x),i=new e.Mesh(n,a);i.position.x=s,i.position.y=30,i.position.z=0,i.rotation.x=0,i.rotation.y=2*Math.PI,r.add(i);{const t=new e.Mesh(n,a);t.position.x=s,t.position.y=-30,t.position.z=20,t.rotation.x=Math.PI,t.rotation.y=2*Math.PI,r.add(t)}}update(){!function(e){let t,r=e[0],a=1;for(;a<e.length;){const n=e[a],s=e[a+1];if(a+=2,("optionalAccess"===n||"optionalCall"===n)&&null==r)return;"access"===n||"optionalAccess"===n?(t=r,r=s(r)):"call"!==n&&"optionalCall"!==n||(r=s(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoThreeSpritePlayer=class extends L{async init(){const{textureLoader:t}=this.deps,r=await Promise.all(fo.url.map((e=>t.loadAsync(e)))),a=new po(r,fo.total,fo.row,fo.col,fo.fps,!0),n=new e.PlaneGeometry(fo.w,fo.h),s=new e.MeshBasicMaterial({map:a.texture,transparent:!1}),i=new e.Mesh(n,s),o=new e.BoxGeometry,c=new e.Mesh(o,s);c.position.y=-1.2,i.position.z=-8,i.position.y=4,this.add(i),this.add(c),this.mesh=i,this.player=a}update(){this.player.animate(),this.mesh.material.map=this.player.texture}dispose(){this.reset(),this.player.dispose(),this.player=null,this.mesh=null}},exports.GLTFLoader=T,exports.WechatPlatform=class{constructor(e,t,r){const a=wx.getSystemInfoSync(),n="android"===a.platform;this.canvas=e,this.canvasW=void 0===t?e.width:t,this.canvasH=void 0===r?e.height:r,this.document={createElementNS:(t,r)=>"canvas"===r?e:"img"===r?e.createImage():void 0},this.window={innerWidth:a.windowWidth,innerHeight:a.windowHeight,devicePixelRatio:a.pixelRatio,URL:new s,AudioContext:function(){},requestAnimationFrame:this.canvas.requestAnimationFrame,cancelAnimationFrame:this.canvas.cancelAnimationFrame,DeviceOrientationEvent:{requestPermission:()=>Promise.resolve("granted")},DOMParser:x,TextDecoder:w},[this.canvas,this.document,this.window].forEach((e=>{const t=e.__proto__;e.__proto__={},e.__proto__.__proto__=t,function(e,t){for(let r of Object.getOwnPropertyNames(t))if("constructor"!==r&&"prototype"!==r&&"name"!==r){let a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,a)}}(e.__proto__,u.prototype)})),this.patchCanvas(),this.onDeviceMotionChange=e=>{e.type="deviceorientation",n&&(e.alpha*=-1,e.beta*=-1,e.gamma*=-1),this.window.dispatchEvent(e)}}patchCanvas(){const{canvasH:e,canvasW:t}=this;Object.defineProperty(this.canvas,"style",{get(){return{width:this.width+"px",height:this.height+"px"}}}),Object.defineProperty(this.canvas,"clientHeight",{get(){return e||this.height}}),Object.defineProperty(this.canvas,"clientWidth",{get(){return t||this.width}}),this.canvas.ownerDocument=this.document}patchXHR(){return m.useFetchPatch=!0,this}getGlobals(){return{atob:i,Blob:t,window:this.window,document:this.document,HTMLCanvasElement:void 0,XMLHttpRequest:m,OffscreenCanvas:S,createImageBitmap:void 0}}enableDeviceOrientation(e){return new Promise(((t,r)=>{wx.onDeviceMotionChange(this.onDeviceMotionChange),wx.startDeviceMotionListening({interval:e,success:e=>{t(e),this.enabledDeviceMotion=!0},fail:r})}))}disableDeviceOrientation(){return new Promise(((e,t)=>{wx.offDeviceMotionChange(this.onDeviceMotionChange),this.enabledDeviceMotion&&wx.stopDeviceMotionListening({success:()=>{e(),this.enabledDeviceMotion=!1},fail:t})}))}dispatchTouchEvent(e={}){const t={...this},r={changedTouches:e.changedTouches.map((e=>new l(e))),touches:e.touches.map((e=>new l(e))),targetTouches:Array.prototype.slice.call(e.touches.map((e=>new l(e)))),timeStamp:e.timeStamp,target:t,currentTarget:t,type:e.type,cancelBubble:!1,cancelable:!1};this.canvas.dispatchEvent(r)}dispose(){this.disableDeviceOrientation(),this.canvas.width=0,this.canvas.height=0,this.canvas&&(this.canvas.ownerDocument=null),this.onDeviceMotionChange=null,this.document=null,this.window=null,this.canvas=null}},exports.screenshot=function(e,t,r,a){const{width:n,height:s}=e.domElement,i=new a(n,s),o=new Uint8Array(n*s*4);return i.texture.encoding=e.outputEncoding,e.setRenderTarget(i),e.render(t,r),e.readRenderTargetPixels(i,0,0,n,s,o),e.setRenderTarget(null),i.dispose(),vo(o,n,s,4),[o,n,s]};
